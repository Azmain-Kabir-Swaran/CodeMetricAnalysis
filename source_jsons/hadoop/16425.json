{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "Quota.java",
  "functionName": "getGlobalQuota",
  "functionId": "getGlobalQuota___path-String",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/Quota.java",
  "functionStartLine": 164,
  "functionEndLine": 198,
  "numCommitsSeen": 15,
  "timeTaken": 1356,
  "changeHistory": [
    "8730a7bf6025a3b2b7d6e6686533283b854af192",
    "761594549ec0c6bab50a28a7eb6c741aec7239d7"
  ],
  "changeHistoryShort": {
    "8730a7bf6025a3b2b7d6e6686533283b854af192": "Ybodychange",
    "761594549ec0c6bab50a28a7eb6c741aec7239d7": "Yintroduced"
  },
  "changeHistoryDetails": {
    "8730a7bf6025a3b2b7d6e6686533283b854af192": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-15003. RBF: Make Router support storage type quota. Contributed by Jinglun.\n",
      "commitDate": "26/12/19 7:52 PM",
      "commitName": "8730a7bf6025a3b2b7d6e6686533283b854af192",
      "commitAuthor": "Ayush Saxena",
      "commitDateOld": "29/11/19 10:25 AM",
      "commitNameOld": "6b2d6d4aafb110bef1b77d4ccbba4350e624b57d",
      "commitAuthorOld": "Ayush Saxena",
      "daysBetweenCommits": 27.39,
      "commitsBetweenForRepo": 86,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,25 +1,35 @@\n   QuotaUsage getGlobalQuota(String path) throws IOException {\n     if (!router.isQuotaEnabled()) {\n       throw new IOException(\"The quota system is disabled in Router.\");\n     }\n \n     long nQuota \u003d HdfsConstants.QUOTA_RESET;\n     long sQuota \u003d HdfsConstants.QUOTA_RESET;\n+    long[] typeQuota \u003d new long[StorageType.values().length];\n+    eachByStorageType(t -\u003e typeQuota[t.ordinal()] \u003d HdfsConstants.QUOTA_RESET);\n+\n     RouterQuotaManager manager \u003d this.router.getQuotaManager();\n     TreeMap\u003cString, RouterQuotaUsage\u003e pts \u003d\n         manager.getParentsContainingQuota(path);\n     Entry\u003cString, RouterQuotaUsage\u003e entry \u003d pts.lastEntry();\n     while (entry !\u003d null \u0026\u0026 (nQuota \u003d\u003d HdfsConstants.QUOTA_RESET\n-        || sQuota \u003d\u003d HdfsConstants.QUOTA_RESET)) {\n+        || sQuota \u003d\u003d HdfsConstants.QUOTA_RESET || orByStorageType(\n+          t -\u003e typeQuota[t.ordinal()] \u003d\u003d HdfsConstants.QUOTA_RESET))) {\n       String ppath \u003d entry.getKey();\n       QuotaUsage quota \u003d entry.getValue();\n       if (nQuota \u003d\u003d HdfsConstants.QUOTA_RESET) {\n         nQuota \u003d quota.getQuota();\n       }\n       if (sQuota \u003d\u003d HdfsConstants.QUOTA_RESET) {\n         sQuota \u003d quota.getSpaceQuota();\n       }\n+      eachByStorageType(t -\u003e {\n+        if (typeQuota[t.ordinal()] \u003d\u003d HdfsConstants.QUOTA_RESET) {\n+          typeQuota[t.ordinal()] \u003d quota.getTypeQuota(t);\n+        }\n+      });\n       entry \u003d pts.lowerEntry(ppath);\n     }\n-    return new QuotaUsage.Builder().quota(nQuota).spaceQuota(sQuota).build();\n+    return new QuotaUsage.Builder().quota(nQuota).spaceQuota(sQuota)\n+        .typeQuota(typeQuota).build();\n   }\n\\ No newline at end of file\n",
      "actualSource": "  QuotaUsage getGlobalQuota(String path) throws IOException {\n    if (!router.isQuotaEnabled()) {\n      throw new IOException(\"The quota system is disabled in Router.\");\n    }\n\n    long nQuota \u003d HdfsConstants.QUOTA_RESET;\n    long sQuota \u003d HdfsConstants.QUOTA_RESET;\n    long[] typeQuota \u003d new long[StorageType.values().length];\n    eachByStorageType(t -\u003e typeQuota[t.ordinal()] \u003d HdfsConstants.QUOTA_RESET);\n\n    RouterQuotaManager manager \u003d this.router.getQuotaManager();\n    TreeMap\u003cString, RouterQuotaUsage\u003e pts \u003d\n        manager.getParentsContainingQuota(path);\n    Entry\u003cString, RouterQuotaUsage\u003e entry \u003d pts.lastEntry();\n    while (entry !\u003d null \u0026\u0026 (nQuota \u003d\u003d HdfsConstants.QUOTA_RESET\n        || sQuota \u003d\u003d HdfsConstants.QUOTA_RESET || orByStorageType(\n          t -\u003e typeQuota[t.ordinal()] \u003d\u003d HdfsConstants.QUOTA_RESET))) {\n      String ppath \u003d entry.getKey();\n      QuotaUsage quota \u003d entry.getValue();\n      if (nQuota \u003d\u003d HdfsConstants.QUOTA_RESET) {\n        nQuota \u003d quota.getQuota();\n      }\n      if (sQuota \u003d\u003d HdfsConstants.QUOTA_RESET) {\n        sQuota \u003d quota.getSpaceQuota();\n      }\n      eachByStorageType(t -\u003e {\n        if (typeQuota[t.ordinal()] \u003d\u003d HdfsConstants.QUOTA_RESET) {\n          typeQuota[t.ordinal()] \u003d quota.getTypeQuota(t);\n        }\n      });\n      entry \u003d pts.lowerEntry(ppath);\n    }\n    return new QuotaUsage.Builder().quota(nQuota).spaceQuota(sQuota)\n        .typeQuota(typeQuota).build();\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/Quota.java",
      "extendedDetails": {}
    },
    "761594549ec0c6bab50a28a7eb6c741aec7239d7": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-14814. RBF: RouterQuotaUpdateService supports inherited rule. Contributed by Jinglun.\n",
      "commitDate": "08/10/19 1:31 AM",
      "commitName": "761594549ec0c6bab50a28a7eb6c741aec7239d7",
      "commitAuthor": "Ayush Saxena",
      "diff": "@@ -0,0 +1,25 @@\n+  QuotaUsage getGlobalQuota(String path) throws IOException {\n+    if (!router.isQuotaEnabled()) {\n+      throw new IOException(\"The quota system is disabled in Router.\");\n+    }\n+\n+    long nQuota \u003d HdfsConstants.QUOTA_RESET;\n+    long sQuota \u003d HdfsConstants.QUOTA_RESET;\n+    RouterQuotaManager manager \u003d this.router.getQuotaManager();\n+    TreeMap\u003cString, RouterQuotaUsage\u003e pts \u003d\n+        manager.getParentsContainingQuota(path);\n+    Entry\u003cString, RouterQuotaUsage\u003e entry \u003d pts.lastEntry();\n+    while (entry !\u003d null \u0026\u0026 (nQuota \u003d\u003d HdfsConstants.QUOTA_RESET\n+        || sQuota \u003d\u003d HdfsConstants.QUOTA_RESET)) {\n+      String ppath \u003d entry.getKey();\n+      QuotaUsage quota \u003d entry.getValue();\n+      if (nQuota \u003d\u003d HdfsConstants.QUOTA_RESET) {\n+        nQuota \u003d quota.getQuota();\n+      }\n+      if (sQuota \u003d\u003d HdfsConstants.QUOTA_RESET) {\n+        sQuota \u003d quota.getSpaceQuota();\n+      }\n+      entry \u003d pts.lowerEntry(ppath);\n+    }\n+    return new QuotaUsage.Builder().quota(nQuota).spaceQuota(sQuota).build();\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  QuotaUsage getGlobalQuota(String path) throws IOException {\n    if (!router.isQuotaEnabled()) {\n      throw new IOException(\"The quota system is disabled in Router.\");\n    }\n\n    long nQuota \u003d HdfsConstants.QUOTA_RESET;\n    long sQuota \u003d HdfsConstants.QUOTA_RESET;\n    RouterQuotaManager manager \u003d this.router.getQuotaManager();\n    TreeMap\u003cString, RouterQuotaUsage\u003e pts \u003d\n        manager.getParentsContainingQuota(path);\n    Entry\u003cString, RouterQuotaUsage\u003e entry \u003d pts.lastEntry();\n    while (entry !\u003d null \u0026\u0026 (nQuota \u003d\u003d HdfsConstants.QUOTA_RESET\n        || sQuota \u003d\u003d HdfsConstants.QUOTA_RESET)) {\n      String ppath \u003d entry.getKey();\n      QuotaUsage quota \u003d entry.getValue();\n      if (nQuota \u003d\u003d HdfsConstants.QUOTA_RESET) {\n        nQuota \u003d quota.getQuota();\n      }\n      if (sQuota \u003d\u003d HdfsConstants.QUOTA_RESET) {\n        sQuota \u003d quota.getSpaceQuota();\n      }\n      entry \u003d pts.lowerEntry(ppath);\n    }\n    return new QuotaUsage.Builder().quota(nQuota).spaceQuota(sQuota).build();\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/Quota.java"
    }
  }
}