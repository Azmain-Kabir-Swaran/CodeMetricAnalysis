{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "RouterAdminServer.java",
  "functionName": "synchronizeQuota",
  "functionId": "synchronizeQuota___path-String__nsQuota-long__ssQuota-long__type-StorageType",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterAdminServer.java",
  "functionStartLine": 420,
  "functionEndLine": 429,
  "numCommitsSeen": 55,
  "timeTaken": 4467,
  "changeHistory": [
    "8730a7bf6025a3b2b7d6e6686533283b854af192",
    "42fc8884ab9763e8778670f301896bf473ecf1d2",
    "aa938662f9cca7abd83a7c1be15c0636ae4344f1",
    "4244653e430374d77ce52e4791f5b4817092003a",
    "17a87977f29ced49724f561a68565217c8cb4e94",
    "a922b9c82cc564e86dc0ef84bcc3597cb7b7c211"
  ],
  "changeHistoryShort": {
    "8730a7bf6025a3b2b7d6e6686533283b854af192": "Ymultichange(Yparameterchange,Ybodychange)",
    "42fc8884ab9763e8778670f301896bf473ecf1d2": "Ybodychange",
    "aa938662f9cca7abd83a7c1be15c0636ae4344f1": "Ybodychange",
    "4244653e430374d77ce52e4791f5b4817092003a": "Ymultichange(Yparameterchange,Ybodychange)",
    "17a87977f29ced49724f561a68565217c8cb4e94": "Ybodychange",
    "a922b9c82cc564e86dc0ef84bcc3597cb7b7c211": "Yintroduced"
  },
  "changeHistoryDetails": {
    "8730a7bf6025a3b2b7d6e6686533283b854af192": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HDFS-15003. RBF: Make Router support storage type quota. Contributed by Jinglun.\n",
      "commitDate": "26/12/19 7:52 PM",
      "commitName": "8730a7bf6025a3b2b7d6e6686533283b854af192",
      "commitAuthor": "Ayush Saxena",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HDFS-15003. RBF: Make Router support storage type quota. Contributed by Jinglun.\n",
          "commitDate": "26/12/19 7:52 PM",
          "commitName": "8730a7bf6025a3b2b7d6e6686533283b854af192",
          "commitAuthor": "Ayush Saxena",
          "commitDateOld": "14/12/19 4:27 AM",
          "commitNameOld": "72aee114f8b1feae4a187cce0aa5a8d2ff55f416",
          "commitAuthorOld": "Ayush Saxena",
          "daysBetweenCommits": 12.64,
          "commitsBetweenForRepo": 31,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,10 +1,10 @@\n-  private void synchronizeQuota(String path, long nsQuota, long ssQuota)\n-      throws IOException {\n+  private void synchronizeQuota(String path, long nsQuota, long ssQuota,\n+      StorageType type) throws IOException {\n     if (isQuotaSyncRequired(nsQuota, ssQuota)) {\n       if (iStateStoreCache) {\n         ((StateStoreCache) this.router.getSubclusterResolver()).loadCache(true);\n       }\n       Quota routerQuota \u003d this.router.getRpcServer().getQuotaModule();\n-      routerQuota.setQuota(path, nsQuota, ssQuota, null, false);\n+      routerQuota.setQuota(path, nsQuota, ssQuota, type, false);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void synchronizeQuota(String path, long nsQuota, long ssQuota,\n      StorageType type) throws IOException {\n    if (isQuotaSyncRequired(nsQuota, ssQuota)) {\n      if (iStateStoreCache) {\n        ((StateStoreCache) this.router.getSubclusterResolver()).loadCache(true);\n      }\n      Quota routerQuota \u003d this.router.getRpcServer().getQuotaModule();\n      routerQuota.setQuota(path, nsQuota, ssQuota, type, false);\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterAdminServer.java",
          "extendedDetails": {
            "oldValue": "[path-String, nsQuota-long, ssQuota-long]",
            "newValue": "[path-String, nsQuota-long, ssQuota-long, type-StorageType]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-15003. RBF: Make Router support storage type quota. Contributed by Jinglun.\n",
          "commitDate": "26/12/19 7:52 PM",
          "commitName": "8730a7bf6025a3b2b7d6e6686533283b854af192",
          "commitAuthor": "Ayush Saxena",
          "commitDateOld": "14/12/19 4:27 AM",
          "commitNameOld": "72aee114f8b1feae4a187cce0aa5a8d2ff55f416",
          "commitAuthorOld": "Ayush Saxena",
          "daysBetweenCommits": 12.64,
          "commitsBetweenForRepo": 31,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,10 +1,10 @@\n-  private void synchronizeQuota(String path, long nsQuota, long ssQuota)\n-      throws IOException {\n+  private void synchronizeQuota(String path, long nsQuota, long ssQuota,\n+      StorageType type) throws IOException {\n     if (isQuotaSyncRequired(nsQuota, ssQuota)) {\n       if (iStateStoreCache) {\n         ((StateStoreCache) this.router.getSubclusterResolver()).loadCache(true);\n       }\n       Quota routerQuota \u003d this.router.getRpcServer().getQuotaModule();\n-      routerQuota.setQuota(path, nsQuota, ssQuota, null, false);\n+      routerQuota.setQuota(path, nsQuota, ssQuota, type, false);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void synchronizeQuota(String path, long nsQuota, long ssQuota,\n      StorageType type) throws IOException {\n    if (isQuotaSyncRequired(nsQuota, ssQuota)) {\n      if (iStateStoreCache) {\n        ((StateStoreCache) this.router.getSubclusterResolver()).loadCache(true);\n      }\n      Quota routerQuota \u003d this.router.getRpcServer().getQuotaModule();\n      routerQuota.setQuota(path, nsQuota, ssQuota, type, false);\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterAdminServer.java",
          "extendedDetails": {}
        }
      ]
    },
    "42fc8884ab9763e8778670f301896bf473ecf1d2": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-14815. RBF: Update the quota in MountTable when calling setQuota on a MountTable src. Contributed by Jinglun.\n",
      "commitDate": "07/11/19 7:18 PM",
      "commitName": "42fc8884ab9763e8778670f301896bf473ecf1d2",
      "commitAuthor": "Ayush Saxena",
      "commitDateOld": "20/09/19 9:23 PM",
      "commitNameOld": "aa938662f9cca7abd83a7c1be15c0636ae4344f1",
      "commitAuthorOld": "Ayush Saxena",
      "daysBetweenCommits": 47.96,
      "commitsBetweenForRepo": 266,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,10 +1,10 @@\n   private void synchronizeQuota(String path, long nsQuota, long ssQuota)\n       throws IOException {\n     if (isQuotaSyncRequired(nsQuota, ssQuota)) {\n       if (iStateStoreCache) {\n         ((StateStoreCache) this.router.getSubclusterResolver()).loadCache(true);\n       }\n       Quota routerQuota \u003d this.router.getRpcServer().getQuotaModule();\n-      routerQuota.setQuota(path, nsQuota, ssQuota, null);\n+      routerQuota.setQuota(path, nsQuota, ssQuota, null, false);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void synchronizeQuota(String path, long nsQuota, long ssQuota)\n      throws IOException {\n    if (isQuotaSyncRequired(nsQuota, ssQuota)) {\n      if (iStateStoreCache) {\n        ((StateStoreCache) this.router.getSubclusterResolver()).loadCache(true);\n      }\n      Quota routerQuota \u003d this.router.getRpcServer().getQuotaModule();\n      routerQuota.setQuota(path, nsQuota, ssQuota, null, false);\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterAdminServer.java",
      "extendedDetails": {}
    },
    "aa938662f9cca7abd83a7c1be15c0636ae4344f1": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-14833. RBF: Router Update Doesn\u0027t Sync Quota. Contributed by Ayush Saxena.\n",
      "commitDate": "20/09/19 9:23 PM",
      "commitName": "aa938662f9cca7abd83a7c1be15c0636ae4344f1",
      "commitAuthor": "Ayush Saxena",
      "commitDateOld": "04/09/19 2:39 AM",
      "commitNameOld": "05704754a0a3af97311fe99792763cbb34608192",
      "commitAuthorOld": "Surendra Singh Lilhore",
      "daysBetweenCommits": 16.78,
      "commitsBetweenForRepo": 143,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,12 +1,10 @@\n   private void synchronizeQuota(String path, long nsQuota, long ssQuota)\n       throws IOException {\n-    if (router.isQuotaEnabled() \u0026\u0026\n-        (nsQuota !\u003d HdfsConstants.QUOTA_DONT_SET\n-        || ssQuota !\u003d HdfsConstants.QUOTA_DONT_SET)) {\n-      HdfsFileStatus ret \u003d this.router.getRpcServer().getFileInfo(path);\n-      if (ret !\u003d null) {\n-        this.router.getRpcServer().getQuotaModule().setQuota(path, nsQuota,\n-            ssQuota, null);\n+    if (isQuotaSyncRequired(nsQuota, ssQuota)) {\n+      if (iStateStoreCache) {\n+        ((StateStoreCache) this.router.getSubclusterResolver()).loadCache(true);\n       }\n+      Quota routerQuota \u003d this.router.getRpcServer().getQuotaModule();\n+      routerQuota.setQuota(path, nsQuota, ssQuota, null);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void synchronizeQuota(String path, long nsQuota, long ssQuota)\n      throws IOException {\n    if (isQuotaSyncRequired(nsQuota, ssQuota)) {\n      if (iStateStoreCache) {\n        ((StateStoreCache) this.router.getSubclusterResolver()).loadCache(true);\n      }\n      Quota routerQuota \u003d this.router.getRpcServer().getQuotaModule();\n      routerQuota.setQuota(path, nsQuota, ssQuota, null);\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterAdminServer.java",
      "extendedDetails": {}
    },
    "4244653e430374d77ce52e4791f5b4817092003a": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HDFS-14150. RBF: Quotas of the sub-cluster should be removed when removing the mount point. Contributed by Takanobu Asanuma.\n",
      "commitDate": "24/06/19 9:33 AM",
      "commitName": "4244653e430374d77ce52e4791f5b4817092003a",
      "commitAuthor": "Yiqun Lin",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HDFS-14150. RBF: Quotas of the sub-cluster should be removed when removing the mount point. Contributed by Takanobu Asanuma.\n",
          "commitDate": "24/06/19 9:33 AM",
          "commitName": "4244653e430374d77ce52e4791f5b4817092003a",
          "commitAuthor": "Yiqun Lin",
          "commitDateOld": "24/06/19 9:33 AM",
          "commitNameOld": "8f6f9d9c8398567064c9369f48213db63f45538c",
          "commitAuthorOld": "Yiqun Lin",
          "daysBetweenCommits": 0.0,
          "commitsBetweenForRepo": 3,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,14 +1,12 @@\n-  private void synchronizeQuota(MountTable mountTable) throws IOException {\n-    String path \u003d mountTable.getSourcePath();\n-    long nsQuota \u003d mountTable.getQuota().getQuota();\n-    long ssQuota \u003d mountTable.getQuota().getSpaceQuota();\n-\n-    if (nsQuota !\u003d HdfsConstants.QUOTA_DONT_SET\n-        || ssQuota !\u003d HdfsConstants.QUOTA_DONT_SET) {\n+  private void synchronizeQuota(String path, long nsQuota, long ssQuota)\n+      throws IOException {\n+    if (router.isQuotaEnabled() \u0026\u0026\n+        (nsQuota !\u003d HdfsConstants.QUOTA_DONT_SET\n+        || ssQuota !\u003d HdfsConstants.QUOTA_DONT_SET)) {\n       HdfsFileStatus ret \u003d this.router.getRpcServer().getFileInfo(path);\n       if (ret !\u003d null) {\n         this.router.getRpcServer().getQuotaModule().setQuota(path, nsQuota,\n             ssQuota, null);\n       }\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void synchronizeQuota(String path, long nsQuota, long ssQuota)\n      throws IOException {\n    if (router.isQuotaEnabled() \u0026\u0026\n        (nsQuota !\u003d HdfsConstants.QUOTA_DONT_SET\n        || ssQuota !\u003d HdfsConstants.QUOTA_DONT_SET)) {\n      HdfsFileStatus ret \u003d this.router.getRpcServer().getFileInfo(path);\n      if (ret !\u003d null) {\n        this.router.getRpcServer().getQuotaModule().setQuota(path, nsQuota,\n            ssQuota, null);\n      }\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterAdminServer.java",
          "extendedDetails": {
            "oldValue": "[mountTable-MountTable]",
            "newValue": "[path-String, nsQuota-long, ssQuota-long]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-14150. RBF: Quotas of the sub-cluster should be removed when removing the mount point. Contributed by Takanobu Asanuma.\n",
          "commitDate": "24/06/19 9:33 AM",
          "commitName": "4244653e430374d77ce52e4791f5b4817092003a",
          "commitAuthor": "Yiqun Lin",
          "commitDateOld": "24/06/19 9:33 AM",
          "commitNameOld": "8f6f9d9c8398567064c9369f48213db63f45538c",
          "commitAuthorOld": "Yiqun Lin",
          "daysBetweenCommits": 0.0,
          "commitsBetweenForRepo": 3,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,14 +1,12 @@\n-  private void synchronizeQuota(MountTable mountTable) throws IOException {\n-    String path \u003d mountTable.getSourcePath();\n-    long nsQuota \u003d mountTable.getQuota().getQuota();\n-    long ssQuota \u003d mountTable.getQuota().getSpaceQuota();\n-\n-    if (nsQuota !\u003d HdfsConstants.QUOTA_DONT_SET\n-        || ssQuota !\u003d HdfsConstants.QUOTA_DONT_SET) {\n+  private void synchronizeQuota(String path, long nsQuota, long ssQuota)\n+      throws IOException {\n+    if (router.isQuotaEnabled() \u0026\u0026\n+        (nsQuota !\u003d HdfsConstants.QUOTA_DONT_SET\n+        || ssQuota !\u003d HdfsConstants.QUOTA_DONT_SET)) {\n       HdfsFileStatus ret \u003d this.router.getRpcServer().getFileInfo(path);\n       if (ret !\u003d null) {\n         this.router.getRpcServer().getQuotaModule().setQuota(path, nsQuota,\n             ssQuota, null);\n       }\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void synchronizeQuota(String path, long nsQuota, long ssQuota)\n      throws IOException {\n    if (router.isQuotaEnabled() \u0026\u0026\n        (nsQuota !\u003d HdfsConstants.QUOTA_DONT_SET\n        || ssQuota !\u003d HdfsConstants.QUOTA_DONT_SET)) {\n      HdfsFileStatus ret \u003d this.router.getRpcServer().getFileInfo(path);\n      if (ret !\u003d null) {\n        this.router.getRpcServer().getQuotaModule().setQuota(path, nsQuota,\n            ssQuota, null);\n      }\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterAdminServer.java",
          "extendedDetails": {}
        }
      ]
    },
    "17a87977f29ced49724f561a68565217c8cb4e94": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-13583. RBF: Router admin clrQuota is not synchronized with nameservice. Contributed by Dibyendu Karmakar.\n",
      "commitDate": "23/07/18 8:15 PM",
      "commitName": "17a87977f29ced49724f561a68565217c8cb4e94",
      "commitAuthor": "Yiqun Lin",
      "commitDateOld": "16/07/18 9:46 AM",
      "commitNameOld": "359ea4e18147af5677c6d88265e26de6b6c72999",
      "commitAuthorOld": "Inigo Goiri",
      "daysBetweenCommits": 7.44,
      "commitsBetweenForRepo": 46,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,11 +1,14 @@\n   private void synchronizeQuota(MountTable mountTable) throws IOException {\n     String path \u003d mountTable.getSourcePath();\n     long nsQuota \u003d mountTable.getQuota().getQuota();\n     long ssQuota \u003d mountTable.getQuota().getSpaceQuota();\n \n     if (nsQuota !\u003d HdfsConstants.QUOTA_DONT_SET\n         || ssQuota !\u003d HdfsConstants.QUOTA_DONT_SET) {\n-      this.router.getRpcServer().getQuotaModule().setQuota(path, nsQuota,\n-          ssQuota, null);\n+      HdfsFileStatus ret \u003d this.router.getRpcServer().getFileInfo(path);\n+      if (ret !\u003d null) {\n+        this.router.getRpcServer().getQuotaModule().setQuota(path, nsQuota,\n+            ssQuota, null);\n+      }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void synchronizeQuota(MountTable mountTable) throws IOException {\n    String path \u003d mountTable.getSourcePath();\n    long nsQuota \u003d mountTable.getQuota().getQuota();\n    long ssQuota \u003d mountTable.getQuota().getSpaceQuota();\n\n    if (nsQuota !\u003d HdfsConstants.QUOTA_DONT_SET\n        || ssQuota !\u003d HdfsConstants.QUOTA_DONT_SET) {\n      HdfsFileStatus ret \u003d this.router.getRpcServer().getFileInfo(path);\n      if (ret !\u003d null) {\n        this.router.getRpcServer().getQuotaModule().setQuota(path, nsQuota,\n            ssQuota, null);\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterAdminServer.java",
      "extendedDetails": {}
    },
    "a922b9c82cc564e86dc0ef84bcc3597cb7b7c211": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-13346. RBF: Fix synchronization of router quota and nameservice quota.\n",
      "commitDate": "10/05/18 11:51 PM",
      "commitName": "a922b9c82cc564e86dc0ef84bcc3597cb7b7c211",
      "commitAuthor": "Yiqun Lin",
      "diff": "@@ -0,0 +1,11 @@\n+  private void synchronizeQuota(MountTable mountTable) throws IOException {\n+    String path \u003d mountTable.getSourcePath();\n+    long nsQuota \u003d mountTable.getQuota().getQuota();\n+    long ssQuota \u003d mountTable.getQuota().getSpaceQuota();\n+\n+    if (nsQuota !\u003d HdfsConstants.QUOTA_DONT_SET\n+        || ssQuota !\u003d HdfsConstants.QUOTA_DONT_SET) {\n+      this.router.getRpcServer().getQuotaModule().setQuota(path, nsQuota,\n+          ssQuota, null);\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  private void synchronizeQuota(MountTable mountTable) throws IOException {\n    String path \u003d mountTable.getSourcePath();\n    long nsQuota \u003d mountTable.getQuota().getQuota();\n    long ssQuota \u003d mountTable.getQuota().getSpaceQuota();\n\n    if (nsQuota !\u003d HdfsConstants.QUOTA_DONT_SET\n        || ssQuota !\u003d HdfsConstants.QUOTA_DONT_SET) {\n      this.router.getRpcServer().getQuotaModule().setQuota(path, nsQuota,\n          ssQuota, null);\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterAdminServer.java"
    }
  }
}