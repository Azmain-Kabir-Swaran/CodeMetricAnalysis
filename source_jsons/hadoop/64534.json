{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "S3AFileSystem.java",
  "functionName": "verifyBucketExists",
  "functionId": "verifyBucketExists",
  "sourceFilePath": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
  "functionStartLine": 556,
  "functionEndLine": 562,
  "numCommitsSeen": 141,
  "timeTaken": 4909,
  "changeHistory": [
    "e77767bb1e8dfb8b0bd7af4664c900f7238b4fa0",
    "de8b6ca5ef8614de6d6277b7617e27c788b0555c",
    "39ec1515a205952eda7e171408a8b83eceb4abde"
  ],
  "changeHistoryShort": {
    "e77767bb1e8dfb8b0bd7af4664c900f7238b4fa0": "Ymultichange(Yexceptionschange,Ybodychange)",
    "de8b6ca5ef8614de6d6277b7617e27c788b0555c": "Ybodychange",
    "39ec1515a205952eda7e171408a8b83eceb4abde": "Yintroduced"
  },
  "changeHistoryDetails": {
    "e77767bb1e8dfb8b0bd7af4664c900f7238b4fa0": {
      "type": "Ymultichange(Yexceptionschange,Ybodychange)",
      "commitMessage": "HADOOP-16711.\n\nThis adds a new option fs.s3a.bucket.probe, range (0-2) to\ncontrol which probe for a bucket existence to perform on startup.\n\n0: no checks\n1: v1 check (as has been performend until now)\n2: v2 bucket check, which also incudes a permission check. Default.\n\nWhen set to 0, bucket existence checks won\u0027t be done\nduring initialization thus making it faster.\nWhen the bucket is not available in S3,\nor if fs.s3a.endpoint points to the wrong instance of a private S3 store\nconsecutive calls like listing, read, write etc. will fail with\nan UnknownStoreException.\n\nContributed by:\n  * Mukund Thakur (main patch and tests)\n  * Rajesh Balamohan (v0 list and performance tests)\n  * lqjacklee (HADOOP-15990/v2 list)\n  * Steve Loughran (UnknownStoreException support)\n\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/Constants.java\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3ARetryPolicy.java\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AUtils.java\n       new file:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/UnknownStoreException.java\n       new file:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/impl/ErrorTranslation.java\n       modified:   hadoop-tools/hadoop-aws/src/site/markdown/tools/hadoop-aws/index.md\n       modified:   hadoop-tools/hadoop-aws/src/site/markdown/tools/hadoop-aws/performance.md\n       modified:   hadoop-tools/hadoop-aws/src/site/markdown/tools/hadoop-aws/troubleshooting_s3a.md\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/AbstractS3AMockTest.java\n       new file:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/ITestS3ABucketExistence.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/MockS3ClientFactory.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/TestS3AExceptionTranslation.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/AbstractS3GuardToolTestBase.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardToolDynamoDB.java\n       modified:   hadoop-tools/hadoop-aws/src/test/resources/core-site.xml\n\nChange-Id: Ic174f803e655af172d81c1274ed92b51bdceb384\n",
      "commitDate": "21/02/20 5:44 AM",
      "commitName": "e77767bb1e8dfb8b0bd7af4664c900f7238b4fa0",
      "commitAuthor": "Mukund Thakur",
      "subchanges": [
        {
          "type": "Yexceptionschange",
          "commitMessage": "HADOOP-16711.\n\nThis adds a new option fs.s3a.bucket.probe, range (0-2) to\ncontrol which probe for a bucket existence to perform on startup.\n\n0: no checks\n1: v1 check (as has been performend until now)\n2: v2 bucket check, which also incudes a permission check. Default.\n\nWhen set to 0, bucket existence checks won\u0027t be done\nduring initialization thus making it faster.\nWhen the bucket is not available in S3,\nor if fs.s3a.endpoint points to the wrong instance of a private S3 store\nconsecutive calls like listing, read, write etc. will fail with\nan UnknownStoreException.\n\nContributed by:\n  * Mukund Thakur (main patch and tests)\n  * Rajesh Balamohan (v0 list and performance tests)\n  * lqjacklee (HADOOP-15990/v2 list)\n  * Steve Loughran (UnknownStoreException support)\n\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/Constants.java\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3ARetryPolicy.java\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AUtils.java\n       new file:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/UnknownStoreException.java\n       new file:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/impl/ErrorTranslation.java\n       modified:   hadoop-tools/hadoop-aws/src/site/markdown/tools/hadoop-aws/index.md\n       modified:   hadoop-tools/hadoop-aws/src/site/markdown/tools/hadoop-aws/performance.md\n       modified:   hadoop-tools/hadoop-aws/src/site/markdown/tools/hadoop-aws/troubleshooting_s3a.md\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/AbstractS3AMockTest.java\n       new file:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/ITestS3ABucketExistence.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/MockS3ClientFactory.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/TestS3AExceptionTranslation.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/AbstractS3GuardToolTestBase.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardToolDynamoDB.java\n       modified:   hadoop-tools/hadoop-aws/src/test/resources/core-site.xml\n\nChange-Id: Ic174f803e655af172d81c1274ed92b51bdceb384\n",
          "commitDate": "21/02/20 5:44 AM",
          "commitName": "e77767bb1e8dfb8b0bd7af4664c900f7238b4fa0",
          "commitAuthor": "Mukund Thakur",
          "commitDateOld": "13/02/20 11:09 AM",
          "commitNameOld": "56dee667707926f3796c7757be1a133a362f05c9",
          "commitAuthorOld": "Steve Loughran",
          "daysBetweenCommits": 7.77,
          "commitsBetweenForRepo": 21,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,7 +1,7 @@\n   protected void verifyBucketExists()\n-      throws FileNotFoundException, IOException {\n+      throws UnknownStoreException, IOException {\n     if (!invoker.retry(\"doesBucketExist\", bucket, true,\n         () -\u003e s3.doesBucketExist(bucket))) {\n-      throw new FileNotFoundException(\"Bucket \" + bucket + \" does not exist\");\n+      throw new UnknownStoreException(\"Bucket \" + bucket + \" does not exist\");\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  protected void verifyBucketExists()\n      throws UnknownStoreException, IOException {\n    if (!invoker.retry(\"doesBucketExist\", bucket, true,\n        () -\u003e s3.doesBucketExist(bucket))) {\n      throw new UnknownStoreException(\"Bucket \" + bucket + \" does not exist\");\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
          "extendedDetails": {
            "oldValue": "[FileNotFoundException, IOException]",
            "newValue": "[UnknownStoreException, IOException]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HADOOP-16711.\n\nThis adds a new option fs.s3a.bucket.probe, range (0-2) to\ncontrol which probe for a bucket existence to perform on startup.\n\n0: no checks\n1: v1 check (as has been performend until now)\n2: v2 bucket check, which also incudes a permission check. Default.\n\nWhen set to 0, bucket existence checks won\u0027t be done\nduring initialization thus making it faster.\nWhen the bucket is not available in S3,\nor if fs.s3a.endpoint points to the wrong instance of a private S3 store\nconsecutive calls like listing, read, write etc. will fail with\nan UnknownStoreException.\n\nContributed by:\n  * Mukund Thakur (main patch and tests)\n  * Rajesh Balamohan (v0 list and performance tests)\n  * lqjacklee (HADOOP-15990/v2 list)\n  * Steve Loughran (UnknownStoreException support)\n\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/Constants.java\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3ARetryPolicy.java\n       modified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AUtils.java\n       new file:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/UnknownStoreException.java\n       new file:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/impl/ErrorTranslation.java\n       modified:   hadoop-tools/hadoop-aws/src/site/markdown/tools/hadoop-aws/index.md\n       modified:   hadoop-tools/hadoop-aws/src/site/markdown/tools/hadoop-aws/performance.md\n       modified:   hadoop-tools/hadoop-aws/src/site/markdown/tools/hadoop-aws/troubleshooting_s3a.md\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/AbstractS3AMockTest.java\n       new file:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/ITestS3ABucketExistence.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/MockS3ClientFactory.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/TestS3AExceptionTranslation.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/AbstractS3GuardToolTestBase.java\n       modified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardToolDynamoDB.java\n       modified:   hadoop-tools/hadoop-aws/src/test/resources/core-site.xml\n\nChange-Id: Ic174f803e655af172d81c1274ed92b51bdceb384\n",
          "commitDate": "21/02/20 5:44 AM",
          "commitName": "e77767bb1e8dfb8b0bd7af4664c900f7238b4fa0",
          "commitAuthor": "Mukund Thakur",
          "commitDateOld": "13/02/20 11:09 AM",
          "commitNameOld": "56dee667707926f3796c7757be1a133a362f05c9",
          "commitAuthorOld": "Steve Loughran",
          "daysBetweenCommits": 7.77,
          "commitsBetweenForRepo": 21,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,7 +1,7 @@\n   protected void verifyBucketExists()\n-      throws FileNotFoundException, IOException {\n+      throws UnknownStoreException, IOException {\n     if (!invoker.retry(\"doesBucketExist\", bucket, true,\n         () -\u003e s3.doesBucketExist(bucket))) {\n-      throw new FileNotFoundException(\"Bucket \" + bucket + \" does not exist\");\n+      throw new UnknownStoreException(\"Bucket \" + bucket + \" does not exist\");\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  protected void verifyBucketExists()\n      throws UnknownStoreException, IOException {\n    if (!invoker.retry(\"doesBucketExist\", bucket, true,\n        () -\u003e s3.doesBucketExist(bucket))) {\n      throw new UnknownStoreException(\"Bucket \" + bucket + \" does not exist\");\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
          "extendedDetails": {}
        }
      ]
    },
    "de8b6ca5ef8614de6d6277b7617e27c788b0555c": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-13786 Add S3A committer for zero-rename commits to S3 endpoints.\nContributed by Steve Loughran and Ryan Blue.\n",
      "commitDate": "22/11/17 7:28 AM",
      "commitName": "de8b6ca5ef8614de6d6277b7617e27c788b0555c",
      "commitAuthor": "Steve Loughran",
      "commitDateOld": "25/09/17 3:59 PM",
      "commitNameOld": "47011d7dd300b0c74bb6cfe25b918c479d718f4f",
      "commitAuthorOld": "Aaron Fabbri",
      "daysBetweenCommits": 57.69,
      "commitsBetweenForRepo": 477,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,18 +1,7 @@\n   protected void verifyBucketExists()\n       throws FileNotFoundException, IOException {\n-    try {\n-      if (!s3.doesBucketExist(bucket)) {\n-        throw new FileNotFoundException(\"Bucket \" + bucket + \" does not exist\");\n-      }\n-    } catch (AmazonS3Exception e) {\n-      // this is a sign of a serious startup problem so do dump everything\n-      LOG.warn(stringify(e), e);\n-      throw translateException(\"doesBucketExist\", bucket, e);\n-    } catch (AmazonServiceException e) {\n-      // this is a sign of a serious startup problem so do dump everything\n-      LOG.warn(stringify(e), e);\n-      throw translateException(\"doesBucketExist\", bucket, e);\n-    } catch (AmazonClientException e) {\n-      throw translateException(\"doesBucketExist\", bucket, e);\n+    if (!invoker.retry(\"doesBucketExist\", bucket, true,\n+        () -\u003e s3.doesBucketExist(bucket))) {\n+      throw new FileNotFoundException(\"Bucket \" + bucket + \" does not exist\");\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void verifyBucketExists()\n      throws FileNotFoundException, IOException {\n    if (!invoker.retry(\"doesBucketExist\", bucket, true,\n        () -\u003e s3.doesBucketExist(bucket))) {\n      throw new FileNotFoundException(\"Bucket \" + bucket + \" does not exist\");\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {}
    },
    "39ec1515a205952eda7e171408a8b83eceb4abde": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-13130. s3a failures can surface as RTEs, not IOEs. (Steve Loughran)\n",
      "commitDate": "21/05/16 8:39 AM",
      "commitName": "39ec1515a205952eda7e171408a8b83eceb4abde",
      "commitAuthor": "Steve Loughran",
      "diff": "@@ -0,0 +1,18 @@\n+  protected void verifyBucketExists()\n+      throws FileNotFoundException, IOException {\n+    try {\n+      if (!s3.doesBucketExist(bucket)) {\n+        throw new FileNotFoundException(\"Bucket \" + bucket + \" does not exist\");\n+      }\n+    } catch (AmazonS3Exception e) {\n+      // this is a sign of a serious startup problem so do dump everything\n+      LOG.warn(stringify(e), e);\n+      throw translateException(\"doesBucketExist\", bucket, e);\n+    } catch (AmazonServiceException e) {\n+      // this is a sign of a serious startup problem so do dump everything\n+      LOG.warn(stringify(e), e);\n+      throw translateException(\"doesBucketExist\", bucket, e);\n+    } catch (AmazonClientException e) {\n+      throw translateException(\"doesBucketExist\", bucket, e);\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  protected void verifyBucketExists()\n      throws FileNotFoundException, IOException {\n    try {\n      if (!s3.doesBucketExist(bucket)) {\n        throw new FileNotFoundException(\"Bucket \" + bucket + \" does not exist\");\n      }\n    } catch (AmazonS3Exception e) {\n      // this is a sign of a serious startup problem so do dump everything\n      LOG.warn(stringify(e), e);\n      throw translateException(\"doesBucketExist\", bucket, e);\n    } catch (AmazonServiceException e) {\n      // this is a sign of a serious startup problem so do dump everything\n      LOG.warn(stringify(e), e);\n      throw translateException(\"doesBucketExist\", bucket, e);\n    } catch (AmazonClientException e) {\n      throw translateException(\"doesBucketExist\", bucket, e);\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java"
    }
  }
}