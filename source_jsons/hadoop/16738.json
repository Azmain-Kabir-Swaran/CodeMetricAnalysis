{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "RouterQuotaUpdateService.java",
  "functionName": "fixGlobalQuota",
  "functionId": "fixGlobalQuota___location-RemoteLocation__remoteQuota-QuotaUsage",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterQuotaUpdateService.java",
  "functionStartLine": 142,
  "functionEndLine": 166,
  "numCommitsSeen": 9,
  "timeTaken": 1359,
  "changeHistory": [
    "8730a7bf6025a3b2b7d6e6686533283b854af192",
    "761594549ec0c6bab50a28a7eb6c741aec7239d7"
  ],
  "changeHistoryShort": {
    "8730a7bf6025a3b2b7d6e6686533283b854af192": "Ybodychange",
    "761594549ec0c6bab50a28a7eb6c741aec7239d7": "Yintroduced"
  },
  "changeHistoryDetails": {
    "8730a7bf6025a3b2b7d6e6686533283b854af192": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-15003. RBF: Make Router support storage type quota. Contributed by Jinglun.\n",
      "commitDate": "26/12/19 7:52 PM",
      "commitName": "8730a7bf6025a3b2b7d6e6686533283b854af192",
      "commitAuthor": "Ayush Saxena",
      "commitDateOld": "04/12/19 2:19 AM",
      "commitNameOld": "47fdae79041ba2bb036ef7723a93ade5b1ac3619",
      "commitAuthorOld": "Yiqun Lin",
      "daysBetweenCommits": 22.73,
      "commitsBetweenForRepo": 78,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,15 +1,25 @@\n   private void fixGlobalQuota(RemoteLocation location, QuotaUsage remoteQuota)\n       throws IOException {\n     QuotaUsage gQuota \u003d\n         this.rpcServer.getQuotaModule().getGlobalQuota(location.getSrc());\n     if (remoteQuota.getQuota() !\u003d gQuota.getQuota()\n         || remoteQuota.getSpaceQuota() !\u003d gQuota.getSpaceQuota()) {\n       this.rpcServer.getQuotaModule()\n           .setQuotaInternal(location.getSrc(), Arrays.asList(location),\n               gQuota.getQuota(), gQuota.getSpaceQuota(), null);\n       LOG.info(\"[Fix Quota] src\u003d{} dst\u003d{} oldQuota\u003d{}/{} newQuota\u003d{}/{}\",\n           location.getSrc(), location, remoteQuota.getQuota(),\n           remoteQuota.getSpaceQuota(), gQuota.getQuota(),\n           gQuota.getSpaceQuota());\n     }\n+    for (StorageType t : StorageType.values()) {\n+      if (remoteQuota.getTypeQuota(t) !\u003d gQuota.getTypeQuota(t)) {\n+        this.rpcServer.getQuotaModule()\n+            .setQuotaInternal(location.getSrc(), Arrays.asList(location),\n+                HdfsConstants.QUOTA_DONT_SET, gQuota.getTypeQuota(t), t);\n+        LOG.info(\"[Fix Quota] src\u003d{} dst\u003d{} type\u003d{} oldQuota\u003d{} newQuota\u003d{}\",\n+            location.getSrc(), location, t, remoteQuota.getTypeQuota(t),\n+            gQuota.getTypeQuota(t));\n+      }\n+    }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void fixGlobalQuota(RemoteLocation location, QuotaUsage remoteQuota)\n      throws IOException {\n    QuotaUsage gQuota \u003d\n        this.rpcServer.getQuotaModule().getGlobalQuota(location.getSrc());\n    if (remoteQuota.getQuota() !\u003d gQuota.getQuota()\n        || remoteQuota.getSpaceQuota() !\u003d gQuota.getSpaceQuota()) {\n      this.rpcServer.getQuotaModule()\n          .setQuotaInternal(location.getSrc(), Arrays.asList(location),\n              gQuota.getQuota(), gQuota.getSpaceQuota(), null);\n      LOG.info(\"[Fix Quota] src\u003d{} dst\u003d{} oldQuota\u003d{}/{} newQuota\u003d{}/{}\",\n          location.getSrc(), location, remoteQuota.getQuota(),\n          remoteQuota.getSpaceQuota(), gQuota.getQuota(),\n          gQuota.getSpaceQuota());\n    }\n    for (StorageType t : StorageType.values()) {\n      if (remoteQuota.getTypeQuota(t) !\u003d gQuota.getTypeQuota(t)) {\n        this.rpcServer.getQuotaModule()\n            .setQuotaInternal(location.getSrc(), Arrays.asList(location),\n                HdfsConstants.QUOTA_DONT_SET, gQuota.getTypeQuota(t), t);\n        LOG.info(\"[Fix Quota] src\u003d{} dst\u003d{} type\u003d{} oldQuota\u003d{} newQuota\u003d{}\",\n            location.getSrc(), location, t, remoteQuota.getTypeQuota(t),\n            gQuota.getTypeQuota(t));\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterQuotaUpdateService.java",
      "extendedDetails": {}
    },
    "761594549ec0c6bab50a28a7eb6c741aec7239d7": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-14814. RBF: RouterQuotaUpdateService supports inherited rule. Contributed by Jinglun.\n",
      "commitDate": "08/10/19 1:31 AM",
      "commitName": "761594549ec0c6bab50a28a7eb6c741aec7239d7",
      "commitAuthor": "Ayush Saxena",
      "diff": "@@ -0,0 +1,15 @@\n+  private void fixGlobalQuota(RemoteLocation location, QuotaUsage remoteQuota)\n+      throws IOException {\n+    QuotaUsage gQuota \u003d\n+        this.rpcServer.getQuotaModule().getGlobalQuota(location.getSrc());\n+    if (remoteQuota.getQuota() !\u003d gQuota.getQuota()\n+        || remoteQuota.getSpaceQuota() !\u003d gQuota.getSpaceQuota()) {\n+      this.rpcServer.getQuotaModule()\n+          .setQuotaInternal(location.getSrc(), Arrays.asList(location),\n+              gQuota.getQuota(), gQuota.getSpaceQuota(), null);\n+      LOG.info(\"[Fix Quota] src\u003d{} dst\u003d{} oldQuota\u003d{}/{} newQuota\u003d{}/{}\",\n+          location.getSrc(), location, remoteQuota.getQuota(),\n+          remoteQuota.getSpaceQuota(), gQuota.getQuota(),\n+          gQuota.getSpaceQuota());\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  private void fixGlobalQuota(RemoteLocation location, QuotaUsage remoteQuota)\n      throws IOException {\n    QuotaUsage gQuota \u003d\n        this.rpcServer.getQuotaModule().getGlobalQuota(location.getSrc());\n    if (remoteQuota.getQuota() !\u003d gQuota.getQuota()\n        || remoteQuota.getSpaceQuota() !\u003d gQuota.getSpaceQuota()) {\n      this.rpcServer.getQuotaModule()\n          .setQuotaInternal(location.getSrc(), Arrays.asList(location),\n              gQuota.getQuota(), gQuota.getSpaceQuota(), null);\n      LOG.info(\"[Fix Quota] src\u003d{} dst\u003d{} oldQuota\u003d{}/{} newQuota\u003d{}/{}\",\n          location.getSrc(), location, remoteQuota.getQuota(),\n          remoteQuota.getSpaceQuota(), gQuota.getQuota(),\n          gQuota.getSpaceQuota());\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterQuotaUpdateService.java"
    }
  }
}