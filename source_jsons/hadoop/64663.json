{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "S3AFileSystem.java",
  "functionName": "close",
  "functionId": "close",
  "sourceFilePath": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
  "functionStartLine": 3268,
  "functionEndLine": 3280,
  "numCommitsSeen": 141,
  "timeTaken": 8072,
  "changeHistory": [
    "990063d2af0a37e9474949f33128805e34c3f016",
    "6574f27fa348542411bff888b184cd7ce34e5d9e",
    "e02b1023c2f42b6792d2941c1f987ae06259b021",
    "6d0bffe17eadedd60d4599427248b0db4a7c5502",
    "7f783970364930cc461d1a73833bc58cdd10553e",
    "d7152332b32a575c3a92e3f4c44b95e58462528d",
    "da9a39eed138210de29b59b90c449b28da1c04f9",
    "ef450df443f1dea1c52082cf281f25db7141972f",
    "6555af81a26b0b72ec3bee7034e01f5bd84b1564",
    "621b43e254afaff708cd6fc4698b29628f6abc33",
    "47f80922dc7cb2fa6d084e6fb1f354c4ec1d4c69",
    "39ec1515a205952eda7e171408a8b83eceb4abde",
    "4e7ad4f0a88bd36bc91db6b1bd311d7f5c6bebee"
  ],
  "changeHistoryShort": {
    "990063d2af0a37e9474949f33128805e34c3f016": "Ybodychange",
    "6574f27fa348542411bff888b184cd7ce34e5d9e": "Ybodychange",
    "e02b1023c2f42b6792d2941c1f987ae06259b021": "Ybodychange",
    "6d0bffe17eadedd60d4599427248b0db4a7c5502": "Ybodychange",
    "7f783970364930cc461d1a73833bc58cdd10553e": "Ybodychange",
    "d7152332b32a575c3a92e3f4c44b95e58462528d": "Ybodychange",
    "da9a39eed138210de29b59b90c449b28da1c04f9": "Ybodychange",
    "ef450df443f1dea1c52082cf281f25db7141972f": "Ybodychange",
    "6555af81a26b0b72ec3bee7034e01f5bd84b1564": "Ybodychange",
    "621b43e254afaff708cd6fc4698b29628f6abc33": "Ybodychange",
    "47f80922dc7cb2fa6d084e6fb1f354c4ec1d4c69": "Ymultichange(Ymodifierchange,Ybodychange)",
    "39ec1515a205952eda7e171408a8b83eceb4abde": "Ymodifierchange",
    "4e7ad4f0a88bd36bc91db6b1bd311d7f5c6bebee": "Yintroduced"
  },
  "changeHistoryDetails": {
    "990063d2af0a37e9474949f33128805e34c3f016": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-16665. Filesystems to be closed if they failed during initialize().\n\nContributed by Steve Loughran.\n\nThis FileSystem instantiation so if an IOException or RuntimeException is\nraised in the invocation of FileSystem.initialize() then a best-effort\nattempt is made to close the FS instance; exceptions raised that there\nare swallowed.\n\nThe S3AFileSystem is also modified to do its own cleanup if an\nIOException is raised during its initialize() process, it being the\nFS we know has the \"potential\" to leak threads, especially in\nextension points (e.g AWS Authenticators) which spawn threads.\n\nChange-Id: Ib84073a606c9d53bf53cbfca4629876a03894f04\n",
      "commitDate": "12/11/19 10:17 AM",
      "commitName": "990063d2af0a37e9474949f33128805e34c3f016",
      "commitAuthor": "Steve Loughran",
      "commitDateOld": "04/11/19 3:55 AM",
      "commitNameOld": "dca19fc3aa509949daf29bc902b2f74760407fc4",
      "commitAuthorOld": "Gabor Bota",
      "daysBetweenCommits": 8.27,
      "commitsBetweenForRepo": 33,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,30 +1,13 @@\n   public void close() throws IOException {\n     if (closed.getAndSet(true)) {\n       // already closed\n       return;\n     }\n     isClosed \u003d true;\n     LOG.debug(\"Filesystem {} is closed\", uri);\n     try {\n       super.close();\n     } finally {\n-      if (transfers !\u003d null) {\n-        transfers.shutdownNow(true);\n-        transfers \u003d null;\n-      }\n-      HadoopExecutors.shutdown(boundedThreadPool, LOG,\n-          THREAD_POOL_SHUTDOWN_DELAY_SECONDS, TimeUnit.SECONDS);\n-      boundedThreadPool \u003d null;\n-      HadoopExecutors.shutdown(unboundedThreadPool, LOG,\n-          THREAD_POOL_SHUTDOWN_DELAY_SECONDS, TimeUnit.SECONDS);\n-      unboundedThreadPool \u003d null;\n-      S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n-      metadataStore \u003d null;\n-      instrumentation \u003d null;\n-      closeAutocloseables(LOG, credentials);\n-      cleanupWithLogger(LOG, delegationTokens.orElse(null));\n-      cleanupWithLogger(LOG, signerManager);\n-      signerManager \u003d null;\n-      credentials \u003d null;\n+      stopAllServices();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    isClosed \u003d true;\n    LOG.debug(\"Filesystem {} is closed\", uri);\n    try {\n      super.close();\n    } finally {\n      stopAllServices();\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {}
    },
    "6574f27fa348542411bff888b184cd7ce34e5d9e": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-16570. S3A committers encounter scale issues.\n\nContributed by Steve Loughran.\n\nThis addresses two scale issues which has surfaced in large scale benchmarks\nof the S3A Committers.\n\n* Thread pools are not cleaned up.\n  This now happens, with tests.\n\n* OOM on job commit for jobs with many thousands of tasks,\n  each generating tens of (very large) files.\n\nInstead of loading all pending commits into memory as a single list, the list\nof files to load is the sole list which is passed around; .pendingset files are\nloaded and processed in isolation -and reloaded if necessary for any\nabort/rollback operation.\n\nThe parallel commit/abort/revert operations now work at the .pendingset level,\nrather than that of individual pending commit files. The existing parallelized\nTasks API is still used to commit those files, but with a null thread pool, so\nas to serialize the operations.\n\nChange-Id: I5c8240cd31800eaa83d112358770ca0eb2bca797\n",
      "commitDate": "04/10/19 10:54 AM",
      "commitName": "6574f27fa348542411bff888b184cd7ce34e5d9e",
      "commitAuthor": "Steve Loughran",
      "commitDateOld": "02/10/19 4:03 PM",
      "commitNameOld": "559ee277f50716a9a8c736ba3b655aad9f616e96",
      "commitAuthorOld": "Siddharth Seth",
      "daysBetweenCommits": 1.79,
      "commitsBetweenForRepo": 34,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,24 +1,30 @@\n   public void close() throws IOException {\n     if (closed.getAndSet(true)) {\n       // already closed\n       return;\n     }\n     isClosed \u003d true;\n     LOG.debug(\"Filesystem {} is closed\", uri);\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n+      HadoopExecutors.shutdown(boundedThreadPool, LOG,\n+          THREAD_POOL_SHUTDOWN_DELAY_SECONDS, TimeUnit.SECONDS);\n+      boundedThreadPool \u003d null;\n+      HadoopExecutors.shutdown(unboundedThreadPool, LOG,\n+          THREAD_POOL_SHUTDOWN_DELAY_SECONDS, TimeUnit.SECONDS);\n+      unboundedThreadPool \u003d null;\n       S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n       metadataStore \u003d null;\n       instrumentation \u003d null;\n       closeAutocloseables(LOG, credentials);\n       cleanupWithLogger(LOG, delegationTokens.orElse(null));\n       cleanupWithLogger(LOG, signerManager);\n       signerManager \u003d null;\n       credentials \u003d null;\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    isClosed \u003d true;\n    LOG.debug(\"Filesystem {} is closed\", uri);\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n      HadoopExecutors.shutdown(boundedThreadPool, LOG,\n          THREAD_POOL_SHUTDOWN_DELAY_SECONDS, TimeUnit.SECONDS);\n      boundedThreadPool \u003d null;\n      HadoopExecutors.shutdown(unboundedThreadPool, LOG,\n          THREAD_POOL_SHUTDOWN_DELAY_SECONDS, TimeUnit.SECONDS);\n      unboundedThreadPool \u003d null;\n      S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n      metadataStore \u003d null;\n      instrumentation \u003d null;\n      closeAutocloseables(LOG, credentials);\n      cleanupWithLogger(LOG, delegationTokens.orElse(null));\n      cleanupWithLogger(LOG, signerManager);\n      signerManager \u003d null;\n      credentials \u003d null;\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {}
    },
    "e02b1023c2f42b6792d2941c1f987ae06259b021": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-16445. Allow separate custom signing algorithms for S3 and DDB (#1332)\n\n",
      "commitDate": "20/09/19 11:20 PM",
      "commitName": "e02b1023c2f42b6792d2941c1f987ae06259b021",
      "commitAuthor": "Siddharth Seth",
      "commitDateOld": "12/09/19 4:12 AM",
      "commitNameOld": "4e273a31f66013b7c20e8114451f5bc6c741f2cc",
      "commitAuthorOld": "Gabor Bota",
      "daysBetweenCommits": 8.8,
      "commitsBetweenForRepo": 88,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,22 +1,24 @@\n   public void close() throws IOException {\n     if (closed.getAndSet(true)) {\n       // already closed\n       return;\n     }\n     isClosed \u003d true;\n     LOG.debug(\"Filesystem {} is closed\", uri);\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n       S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n       metadataStore \u003d null;\n       instrumentation \u003d null;\n       closeAutocloseables(LOG, credentials);\n       cleanupWithLogger(LOG, delegationTokens.orElse(null));\n+      cleanupWithLogger(LOG, signerManager);\n+      signerManager \u003d null;\n       credentials \u003d null;\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    isClosed \u003d true;\n    LOG.debug(\"Filesystem {} is closed\", uri);\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n      S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n      metadataStore \u003d null;\n      instrumentation \u003d null;\n      closeAutocloseables(LOG, credentials);\n      cleanupWithLogger(LOG, delegationTokens.orElse(null));\n      cleanupWithLogger(LOG, signerManager);\n      signerManager \u003d null;\n      credentials \u003d null;\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {}
    },
    "6d0bffe17eadedd60d4599427248b0db4a7c5502": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-14556. S3A to support Delegation Tokens.\n\nContributed by Steve Loughran and Daryn Sharp.\n",
      "commitDate": "14/01/19 9:59 AM",
      "commitName": "6d0bffe17eadedd60d4599427248b0db4a7c5502",
      "commitAuthor": "Steve Loughran",
      "commitDateOld": "07/01/19 9:51 PM",
      "commitNameOld": "7f783970364930cc461d1a73833bc58cdd10553e",
      "commitAuthorOld": "Akira Ajisaka",
      "daysBetweenCommits": 6.51,
      "commitsBetweenForRepo": 32,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,21 +1,22 @@\n   public void close() throws IOException {\n     if (closed.getAndSet(true)) {\n       // already closed\n       return;\n     }\n     isClosed \u003d true;\n     LOG.debug(\"Filesystem {} is closed\", uri);\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n       S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n       metadataStore \u003d null;\n       instrumentation \u003d null;\n       closeAutocloseables(LOG, credentials);\n+      cleanupWithLogger(LOG, delegationTokens.orElse(null));\n       credentials \u003d null;\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    isClosed \u003d true;\n    LOG.debug(\"Filesystem {} is closed\", uri);\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n      S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n      metadataStore \u003d null;\n      instrumentation \u003d null;\n      closeAutocloseables(LOG, credentials);\n      cleanupWithLogger(LOG, delegationTokens.orElse(null));\n      credentials \u003d null;\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {}
    },
    "7f783970364930cc461d1a73833bc58cdd10553e": {
      "type": "Ybodychange",
      "commitMessage": "Revert \"HADOOP-14556. S3A to support Delegation Tokens.\"\n\nThis reverts commit d7152332b32a575c3a92e3f4c44b95e58462528d.\n",
      "commitDate": "07/01/19 9:51 PM",
      "commitName": "7f783970364930cc461d1a73833bc58cdd10553e",
      "commitAuthor": "Akira Ajisaka",
      "commitDateOld": "07/01/19 5:18 AM",
      "commitNameOld": "d7152332b32a575c3a92e3f4c44b95e58462528d",
      "commitAuthorOld": "Steve Loughran",
      "daysBetweenCommits": 0.69,
      "commitsBetweenForRepo": 7,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,22 +1,21 @@\n   public void close() throws IOException {\n     if (closed.getAndSet(true)) {\n       // already closed\n       return;\n     }\n     isClosed \u003d true;\n     LOG.debug(\"Filesystem {} is closed\", uri);\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n       S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n       metadataStore \u003d null;\n       instrumentation \u003d null;\n       closeAutocloseables(LOG, credentials);\n-      cleanupWithLogger(LOG, delegationTokens.orElse(null));\n       credentials \u003d null;\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    isClosed \u003d true;\n    LOG.debug(\"Filesystem {} is closed\", uri);\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n      S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n      metadataStore \u003d null;\n      instrumentation \u003d null;\n      closeAutocloseables(LOG, credentials);\n      credentials \u003d null;\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {}
    },
    "d7152332b32a575c3a92e3f4c44b95e58462528d": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-14556. S3A to support Delegation Tokens.\n\nContributed by Steve Loughran.\n",
      "commitDate": "07/01/19 5:18 AM",
      "commitName": "d7152332b32a575c3a92e3f4c44b95e58462528d",
      "commitAuthor": "Steve Loughran",
      "commitDateOld": "28/11/18 9:45 AM",
      "commitNameOld": "5d96b74f33ca716c9fe4fadb046f79ed488a3059",
      "commitAuthorOld": "Sean Mackrory",
      "daysBetweenCommits": 39.81,
      "commitsBetweenForRepo": 242,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,21 +1,22 @@\n   public void close() throws IOException {\n     if (closed.getAndSet(true)) {\n       // already closed\n       return;\n     }\n     isClosed \u003d true;\n     LOG.debug(\"Filesystem {} is closed\", uri);\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n       S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n       metadataStore \u003d null;\n       instrumentation \u003d null;\n       closeAutocloseables(LOG, credentials);\n+      cleanupWithLogger(LOG, delegationTokens.orElse(null));\n       credentials \u003d null;\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    isClosed \u003d true;\n    LOG.debug(\"Filesystem {} is closed\", uri);\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n      S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n      metadataStore \u003d null;\n      instrumentation \u003d null;\n      closeAutocloseables(LOG, credentials);\n      cleanupWithLogger(LOG, delegationTokens.orElse(null));\n      credentials \u003d null;\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {}
    },
    "da9a39eed138210de29b59b90c449b28da1c04f9": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-15583. Stabilize S3A Assumed Role support.\nContributed by Steve Loughran.\n",
      "commitDate": "08/08/18 10:57 PM",
      "commitName": "da9a39eed138210de29b59b90c449b28da1c04f9",
      "commitAuthor": "Steve Loughran",
      "commitDateOld": "27/06/18 10:37 PM",
      "commitNameOld": "2b2399d623539ab68e71a38fa9fbfc9a405bddb8",
      "commitAuthorOld": "Akira Ajisaka",
      "daysBetweenCommits": 42.01,
      "commitsBetweenForRepo": 267,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,22 +1,21 @@\n   public void close() throws IOException {\n     if (closed.getAndSet(true)) {\n       // already closed\n       return;\n     }\n     isClosed \u003d true;\n     LOG.debug(\"Filesystem {} is closed\", uri);\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n-      if (metadataStore !\u003d null) {\n-        metadataStore.close();\n-        metadataStore \u003d null;\n-      }\n-      IOUtils.closeQuietly(instrumentation);\n+      S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n+      metadataStore \u003d null;\n       instrumentation \u003d null;\n+      closeAutocloseables(LOG, credentials);\n+      credentials \u003d null;\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    isClosed \u003d true;\n    LOG.debug(\"Filesystem {} is closed\", uri);\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n      S3AUtils.closeAll(LOG, metadataStore, instrumentation);\n      metadataStore \u003d null;\n      instrumentation \u003d null;\n      closeAutocloseables(LOG, credentials);\n      credentials \u003d null;\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {}
    },
    "ef450df443f1dea1c52082cf281f25db7141972f": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-15113. NPE in S3A getFileStatus: null instrumentation on using closed instance.\nContributed by Steve Loughran.\n",
      "commitDate": "21/12/17 6:15 AM",
      "commitName": "ef450df443f1dea1c52082cf281f25db7141972f",
      "commitAuthor": "Steve Loughran",
      "commitDateOld": "18/12/17 1:19 PM",
      "commitNameOld": "35ad9b1dd279b769381ea1625d9bf776c309c5cb",
      "commitAuthorOld": "Steve Loughran",
      "daysBetweenCommits": 2.71,
      "commitsBetweenForRepo": 19,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,20 +1,22 @@\n   public void close() throws IOException {\n     if (closed.getAndSet(true)) {\n       // already closed\n       return;\n     }\n+    isClosed \u003d true;\n+    LOG.debug(\"Filesystem {} is closed\", uri);\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n       if (metadataStore !\u003d null) {\n         metadataStore.close();\n         metadataStore \u003d null;\n       }\n       IOUtils.closeQuietly(instrumentation);\n       instrumentation \u003d null;\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    isClosed \u003d true;\n    LOG.debug(\"Filesystem {} is closed\", uri);\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n      if (metadataStore !\u003d null) {\n        metadataStore.close();\n        metadataStore \u003d null;\n      }\n      IOUtils.closeQuietly(instrumentation);\n      instrumentation \u003d null;\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {}
    },
    "6555af81a26b0b72ec3bee7034e01f5bd84b1564": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-14475 Metrics of S3A don\u0027t print out when enabled. Contributed by Younger and Sean Mackrory.\n",
      "commitDate": "05/12/17 11:06 AM",
      "commitName": "6555af81a26b0b72ec3bee7034e01f5bd84b1564",
      "commitAuthor": "Aaron Fabbri",
      "commitDateOld": "27/11/17 8:31 AM",
      "commitNameOld": "3cd75845da1aced3d88e0ce68c68e8d95f48fb79",
      "commitAuthorOld": "Rohith Sharma K S",
      "daysBetweenCommits": 8.11,
      "commitsBetweenForRepo": 51,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,18 +1,20 @@\n   public void close() throws IOException {\n     if (closed.getAndSet(true)) {\n       // already closed\n       return;\n     }\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n       if (metadataStore !\u003d null) {\n         metadataStore.close();\n         metadataStore \u003d null;\n       }\n+      IOUtils.closeQuietly(instrumentation);\n+      instrumentation \u003d null;\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n      if (metadataStore !\u003d null) {\n        metadataStore.close();\n        metadataStore \u003d null;\n      }\n      IOUtils.closeQuietly(instrumentation);\n      instrumentation \u003d null;\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {}
    },
    "621b43e254afaff708cd6fc4698b29628f6abc33": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-13345 HS3Guard: Improved Consistency for S3A.\nContributed by: Chris Nauroth, Aaron Fabbri, Mingliang Liu, Lei (Eddy) Xu,\nSean Mackrory, Steve Loughran and others.\n",
      "commitDate": "01/09/17 6:13 AM",
      "commitName": "621b43e254afaff708cd6fc4698b29628f6abc33",
      "commitAuthor": "Steve Loughran",
      "commitDateOld": "05/06/17 11:26 AM",
      "commitNameOld": "6aeda55bb8f741d9dafd41f6dfbf1a88acdd4003",
      "commitAuthorOld": "Mingliang Liu",
      "daysBetweenCommits": 87.78,
      "commitsBetweenForRepo": 591,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,14 +1,18 @@\n   public void close() throws IOException {\n     if (closed.getAndSet(true)) {\n       // already closed\n       return;\n     }\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n+      if (metadataStore !\u003d null) {\n+        metadataStore.close();\n+        metadataStore \u003d null;\n+      }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n      if (metadataStore !\u003d null) {\n        metadataStore.close();\n        metadataStore \u003d null;\n      }\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {}
    },
    "47f80922dc7cb2fa6d084e6fb1f354c4ec1d4c69": {
      "type": "Ymultichange(Ymodifierchange,Ybodychange)",
      "commitMessage": "HADOOP-13599. s3a close() to be non-synchronized, so avoid risk of deadlock on shutdown. Contributed by Steve Loughran.\n",
      "commitDate": "28/09/16 4:19 PM",
      "commitName": "47f80922dc7cb2fa6d084e6fb1f354c4ec1d4c69",
      "commitAuthor": "Chris Nauroth",
      "subchanges": [
        {
          "type": "Ymodifierchange",
          "commitMessage": "HADOOP-13599. s3a close() to be non-synchronized, so avoid risk of deadlock on shutdown. Contributed by Steve Loughran.\n",
          "commitDate": "28/09/16 4:19 PM",
          "commitName": "47f80922dc7cb2fa6d084e6fb1f354c4ec1d4c69",
          "commitAuthor": "Chris Nauroth",
          "commitDateOld": "06/09/16 9:36 AM",
          "commitNameOld": "d152557cf7f4d2288524c222fcbaf152bdc038b0",
          "commitAuthorOld": "Chris Nauroth",
          "daysBetweenCommits": 22.28,
          "commitsBetweenForRepo": 134,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,10 +1,14 @@\n-  public synchronized void close() throws IOException {\n+  public void close() throws IOException {\n+    if (closed.getAndSet(true)) {\n+      // already closed\n+      return;\n+    }\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
          "extendedDetails": {
            "oldValue": "[public, synchronized]",
            "newValue": "[public]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HADOOP-13599. s3a close() to be non-synchronized, so avoid risk of deadlock on shutdown. Contributed by Steve Loughran.\n",
          "commitDate": "28/09/16 4:19 PM",
          "commitName": "47f80922dc7cb2fa6d084e6fb1f354c4ec1d4c69",
          "commitAuthor": "Chris Nauroth",
          "commitDateOld": "06/09/16 9:36 AM",
          "commitNameOld": "d152557cf7f4d2288524c222fcbaf152bdc038b0",
          "commitAuthorOld": "Chris Nauroth",
          "daysBetweenCommits": 22.28,
          "commitsBetweenForRepo": 134,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,10 +1,14 @@\n-  public synchronized void close() throws IOException {\n+  public void close() throws IOException {\n+    if (closed.getAndSet(true)) {\n+      // already closed\n+      return;\n+    }\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public void close() throws IOException {\n    if (closed.getAndSet(true)) {\n      // already closed\n      return;\n    }\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
          "extendedDetails": {}
        }
      ]
    },
    "39ec1515a205952eda7e171408a8b83eceb4abde": {
      "type": "Ymodifierchange",
      "commitMessage": "HADOOP-13130. s3a failures can surface as RTEs, not IOEs. (Steve Loughran)\n",
      "commitDate": "21/05/16 8:39 AM",
      "commitName": "39ec1515a205952eda7e171408a8b83eceb4abde",
      "commitAuthor": "Steve Loughran",
      "commitDateOld": "20/05/16 5:52 AM",
      "commitNameOld": "757050ff355d40bc28f9dbfd0c0083c5f337d270",
      "commitAuthorOld": "Steve Loughran",
      "daysBetweenCommits": 1.12,
      "commitsBetweenForRepo": 4,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,10 +1,10 @@\n-  public void close() throws IOException {\n+  public synchronized void close() throws IOException {\n     try {\n       super.close();\n     } finally {\n       if (transfers !\u003d null) {\n         transfers.shutdownNow(true);\n         transfers \u003d null;\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public synchronized void close() throws IOException {\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java",
      "extendedDetails": {
        "oldValue": "[public]",
        "newValue": "[public, synchronized]"
      }
    },
    "4e7ad4f0a88bd36bc91db6b1bd311d7f5c6bebee": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-11463 Replace method-local TransferManager object with S3AFileSystem#transfers. (Ted Yu via stevel)\n",
      "commitDate": "05/02/15 4:20 AM",
      "commitName": "4e7ad4f0a88bd36bc91db6b1bd311d7f5c6bebee",
      "commitAuthor": "Steve Loughran",
      "diff": "@@ -0,0 +1,10 @@\n+  public void close() throws IOException {\n+    try {\n+      super.close();\n+    } finally {\n+      if (transfers !\u003d null) {\n+        transfers.shutdownNow(true);\n+        transfers \u003d null;\n+      }\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    try {\n      super.close();\n    } finally {\n      if (transfers !\u003d null) {\n        transfers.shutdownNow(true);\n        transfers \u003d null;\n      }\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java"
    }
  }
}