{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "FSNamesystem.java",
  "functionName": "queryRollingUpgrade",
  "functionId": "queryRollingUpgrade",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java",
  "functionStartLine": 7168,
  "functionEndLine": 7186,
  "numCommitsSeen": 873,
  "timeTaken": 36632,
  "changeHistory": [
    "1824aee9da4056de0fb638906b2172e486bbebe7",
    "ff013d2c952272f3176dcf624251b05d610503b5",
    "9d3e4cccf9cd0ffb60ee0e7c65cea5ae3c8015c2",
    "ff0b99eafeda035ebe0dc82cfe689808047a8893",
    "60b858bfa65e0feb665e1a84784a3d45e9091c66",
    "e3d2e4c156851de7dac16154521a2e06ea83ec7b"
  ],
  "changeHistoryShort": {
    "1824aee9da4056de0fb638906b2172e486bbebe7": "Ybodychange",
    "ff013d2c952272f3176dcf624251b05d610503b5": "Ybodychange",
    "9d3e4cccf9cd0ffb60ee0e7c65cea5ae3c8015c2": "Ybodychange",
    "ff0b99eafeda035ebe0dc82cfe689808047a8893": "Ybodychange",
    "60b858bfa65e0feb665e1a84784a3d45e9091c66": "Ybodychange",
    "e3d2e4c156851de7dac16154521a2e06ea83ec7b": "Ybodychange"
  },
  "changeHistoryDetails": {
    "1824aee9da4056de0fb638906b2172e486bbebe7": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-15217 Add more information to longest write/read lock held log\n\n",
      "commitDate": "18/04/20 1:52 PM",
      "commitName": "1824aee9da4056de0fb638906b2172e486bbebe7",
      "commitAuthor": "Toshihiro Suzuki",
      "commitDateOld": "25/03/20 10:28 AM",
      "commitNameOld": "a700803a18fb957d2799001a2ce1dcb70f75c080",
      "commitAuthorOld": "Arpit Agarwal",
      "daysBetweenCommits": 24.14,
      "commitsBetweenForRepo": 78,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,19 +1,19 @@\n   RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n     final String operationName \u003d \"queryRollingUpgrade\";\n     checkSuperuserPrivilege(operationName);\n     checkOperation(OperationCategory.READ);\n     readLock();\n     try {\n       checkOperation(OperationCategory.READ);\n       if (!isRollingUpgrade()) {\n         return null;\n       }\n       Preconditions.checkNotNull(rollingUpgradeInfo);\n       boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n       rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n     } finally {\n-      readUnlock(operationName);\n+      readUnlock(operationName, getLockReportInfoSupplier(null));\n     }\n     logAuditEvent(true, operationName, null, null, null);\n     return rollingUpgradeInfo;\n   }\n\\ No newline at end of file\n",
      "actualSource": "  RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n    final String operationName \u003d \"queryRollingUpgrade\";\n    checkSuperuserPrivilege(operationName);\n    checkOperation(OperationCategory.READ);\n    readLock();\n    try {\n      checkOperation(OperationCategory.READ);\n      if (!isRollingUpgrade()) {\n        return null;\n      }\n      Preconditions.checkNotNull(rollingUpgradeInfo);\n      boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n      rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n    } finally {\n      readUnlock(operationName, getLockReportInfoSupplier(null));\n    }\n    logAuditEvent(true, operationName, null, null, null);\n    return rollingUpgradeInfo;\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java",
      "extendedDetails": {}
    },
    "ff013d2c952272f3176dcf624251b05d610503b5": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-13602. Add checkOperation(WRITE) checks in FSNamesystem. Contributed by Chao Sun.",
      "commitDate": "31/05/18 5:37 PM",
      "commitName": "ff013d2c952272f3176dcf624251b05d610503b5",
      "commitAuthor": "Chao Sun",
      "commitDateOld": "26/04/18 1:52 PM",
      "commitNameOld": "2adda92de1535c0472c0df33a145fa1814703f4f",
      "commitAuthorOld": "Owen O\u0027Malley",
      "daysBetweenCommits": 35.16,
      "commitsBetweenForRepo": 296,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,18 +1,19 @@\n   RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n     final String operationName \u003d \"queryRollingUpgrade\";\n     checkSuperuserPrivilege(operationName);\n     checkOperation(OperationCategory.READ);\n     readLock();\n     try {\n+      checkOperation(OperationCategory.READ);\n       if (!isRollingUpgrade()) {\n         return null;\n       }\n       Preconditions.checkNotNull(rollingUpgradeInfo);\n       boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n       rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n     } finally {\n       readUnlock(operationName);\n     }\n     logAuditEvent(true, operationName, null, null, null);\n     return rollingUpgradeInfo;\n   }\n\\ No newline at end of file\n",
      "actualSource": "  RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n    final String operationName \u003d \"queryRollingUpgrade\";\n    checkSuperuserPrivilege(operationName);\n    checkOperation(OperationCategory.READ);\n    readLock();\n    try {\n      checkOperation(OperationCategory.READ);\n      if (!isRollingUpgrade()) {\n        return null;\n      }\n      Preconditions.checkNotNull(rollingUpgradeInfo);\n      boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n      rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n    } finally {\n      readUnlock(operationName);\n    }\n    logAuditEvent(true, operationName, null, null, null);\n    return rollingUpgradeInfo;\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java",
      "extendedDetails": {}
    },
    "9d3e4cccf9cd0ffb60ee0e7c65cea5ae3c8015c2": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-5040.Audit log for admin commands/ logging output of all DFS admin commands. Contributed by Kuhu Shukla.\n",
      "commitDate": "26/09/17 9:29 AM",
      "commitName": "9d3e4cccf9cd0ffb60ee0e7c65cea5ae3c8015c2",
      "commitAuthor": "Brahma Reddy Battula",
      "commitDateOld": "24/09/17 9:03 PM",
      "commitNameOld": "d0b2c5850b523a3888b2fadcfcdf6edbed33f221",
      "commitAuthorOld": "Anu Engineer",
      "daysBetweenCommits": 1.52,
      "commitsBetweenForRepo": 15,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,16 +1,18 @@\n   RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n-    checkSuperuserPrivilege();\n+    final String operationName \u003d \"queryRollingUpgrade\";\n+    checkSuperuserPrivilege(operationName);\n     checkOperation(OperationCategory.READ);\n     readLock();\n     try {\n       if (!isRollingUpgrade()) {\n         return null;\n       }\n       Preconditions.checkNotNull(rollingUpgradeInfo);\n       boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n       rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n-      return rollingUpgradeInfo;\n     } finally {\n-      readUnlock(\"queryRollingUpgrade\");\n+      readUnlock(operationName);\n     }\n+    logAuditEvent(true, operationName, null, null, null);\n+    return rollingUpgradeInfo;\n   }\n\\ No newline at end of file\n",
      "actualSource": "  RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n    final String operationName \u003d \"queryRollingUpgrade\";\n    checkSuperuserPrivilege(operationName);\n    checkOperation(OperationCategory.READ);\n    readLock();\n    try {\n      if (!isRollingUpgrade()) {\n        return null;\n      }\n      Preconditions.checkNotNull(rollingUpgradeInfo);\n      boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n      rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n    } finally {\n      readUnlock(operationName);\n    }\n    logAuditEvent(true, operationName, null, null, null);\n    return rollingUpgradeInfo;\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java",
      "extendedDetails": {}
    },
    "ff0b99eafeda035ebe0dc82cfe689808047a8893": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-10872. Add MutableRate metrics for FSNamesystemLock operations. Contributed by Erik Krogen.\n",
      "commitDate": "14/11/16 11:05 AM",
      "commitName": "ff0b99eafeda035ebe0dc82cfe689808047a8893",
      "commitAuthor": "Zhe Zhang",
      "commitDateOld": "08/11/16 6:17 PM",
      "commitNameOld": "ed0bebabaaf27cd730f7f8eb002d92c9c7db327d",
      "commitAuthorOld": "Brahma Reddy Battula",
      "daysBetweenCommits": 5.7,
      "commitsBetweenForRepo": 36,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,16 +1,16 @@\n   RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n     checkSuperuserPrivilege();\n     checkOperation(OperationCategory.READ);\n     readLock();\n     try {\n       if (!isRollingUpgrade()) {\n         return null;\n       }\n       Preconditions.checkNotNull(rollingUpgradeInfo);\n       boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n       rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n       return rollingUpgradeInfo;\n     } finally {\n-      readUnlock();\n+      readUnlock(\"queryRollingUpgrade\");\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n    checkSuperuserPrivilege();\n    checkOperation(OperationCategory.READ);\n    readLock();\n    try {\n      if (!isRollingUpgrade()) {\n        return null;\n      }\n      Preconditions.checkNotNull(rollingUpgradeInfo);\n      boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n      rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n      return rollingUpgradeInfo;\n    } finally {\n      readUnlock(\"queryRollingUpgrade\");\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java",
      "extendedDetails": {}
    },
    "60b858bfa65e0feb665e1a84784a3d45e9091c66": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-8656. Preserve compatibility of ClientProtocol#rollingUpgrade after finalization.\n",
      "commitDate": "26/06/15 11:30 AM",
      "commitName": "60b858bfa65e0feb665e1a84784a3d45e9091c66",
      "commitAuthor": "Andrew Wang",
      "commitDateOld": "26/06/15 10:49 AM",
      "commitNameOld": "de480d6c8945bd8b5b00e8657b7a72ce8dd9b6b5",
      "commitAuthorOld": "Jing Zhao",
      "daysBetweenCommits": 0.03,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,14 +1,16 @@\n   RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n     checkSuperuserPrivilege();\n     checkOperation(OperationCategory.READ);\n     readLock();\n     try {\n-      if (rollingUpgradeInfo !\u003d null) {\n-        boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n-        rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n+      if (!isRollingUpgrade()) {\n+        return null;\n       }\n+      Preconditions.checkNotNull(rollingUpgradeInfo);\n+      boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n+      rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n       return rollingUpgradeInfo;\n     } finally {\n       readUnlock();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n    checkSuperuserPrivilege();\n    checkOperation(OperationCategory.READ);\n    readLock();\n    try {\n      if (!isRollingUpgrade()) {\n        return null;\n      }\n      Preconditions.checkNotNull(rollingUpgradeInfo);\n      boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n      rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n      return rollingUpgradeInfo;\n    } finally {\n      readUnlock();\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java",
      "extendedDetails": {}
    },
    "e3d2e4c156851de7dac16154521a2e06ea83ec7b": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-6000. Avoid saving namespace when starting rolling upgrade. Contributed by Jing Zhao.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-5535@1571840 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "25/02/14 1:58 PM",
      "commitName": "e3d2e4c156851de7dac16154521a2e06ea83ec7b",
      "commitAuthor": "Jing Zhao",
      "commitDateOld": "25/02/14 12:24 PM",
      "commitNameOld": "abc9a6dad5ebcad07dd899a6e5f6ca26da28622b",
      "commitAuthorOld": "",
      "daysBetweenCommits": 0.07,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,10 +1,14 @@\n   RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n     checkSuperuserPrivilege();\n     checkOperation(OperationCategory.READ);\n     readLock();\n     try {\n+      if (rollingUpgradeInfo !\u003d null) {\n+        boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n+        rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n+      }\n       return rollingUpgradeInfo;\n     } finally {\n       readUnlock();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  RollingUpgradeInfo queryRollingUpgrade() throws IOException {\n    checkSuperuserPrivilege();\n    checkOperation(OperationCategory.READ);\n    readLock();\n    try {\n      if (rollingUpgradeInfo !\u003d null) {\n        boolean hasRollbackImage \u003d this.getFSImage().hasRollbackFSImage();\n        rollingUpgradeInfo.setCreatedRollbackImages(hasRollbackImage);\n      }\n      return rollingUpgradeInfo;\n    } finally {\n      readUnlock();\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java",
      "extendedDetails": {}
    }
  }
}