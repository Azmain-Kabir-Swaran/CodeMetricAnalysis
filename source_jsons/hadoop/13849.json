{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "BlockManager.java",
  "functionName": "removeBRLeaseIfNeeded",
  "functionId": "removeBRLeaseIfNeeded___nodeID-DatanodeID(modifiers-final)__context-BlockReportContext(modifiers-final)",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java",
  "functionStartLine": 2798,
  "functionEndLine": 2819,
  "numCommitsSeen": 477,
  "timeTaken": 6932,
  "changeHistory": [
    "b5adc5c3011f111f86d232cb33ec522547f68a95",
    "391ce535a739dc92cb90017d759217265a4fd969"
  ],
  "changeHistoryShort": {
    "b5adc5c3011f111f86d232cb33ec522547f68a95": "Ybodychange",
    "391ce535a739dc92cb90017d759217265a4fd969": "Yintroduced"
  },
  "changeHistoryDetails": {
    "b5adc5c3011f111f86d232cb33ec522547f68a95": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-10838. Last full block report received time for each DN should be easily discoverable. Contributed by Surendra Singh Lilhore.\n",
      "commitDate": "06/03/17 4:39 PM",
      "commitName": "b5adc5c3011f111f86d232cb33ec522547f68a95",
      "commitAuthor": "Arpit Agarwal",
      "commitDateOld": "01/03/17 8:23 PM",
      "commitNameOld": "25c84d279bcefb72a3dd8058f25bba1713504849",
      "commitAuthorOld": "Ming Ma",
      "daysBetweenCommits": 4.84,
      "commitsBetweenForRepo": 29,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,20 +1,22 @@\n   public void removeBRLeaseIfNeeded(final DatanodeID nodeID,\n       final BlockReportContext context) throws IOException {\n     namesystem.writeLock();\n     DatanodeDescriptor node;\n     try {\n       node \u003d datanodeManager.getDatanode(nodeID);\n       if (context !\u003d null) {\n         if (context.getTotalRpcs() \u003d\u003d context.getCurRpc() + 1) {\n           long leaseId \u003d this.getBlockReportLeaseManager().removeLease(node);\n           BlockManagerFaultInjector.getInstance().\n               removeBlockReportLease(node, leaseId);\n+          node.setLastBlockReportTime(now());\n+          node.setLastBlockReportMonotonic(Time.monotonicNow());\n         }\n         LOG.debug(\"Processing RPC with index {} out of total {} RPCs in \"\n                 + \"processReport 0x{}\", context.getCurRpc(),\n             context.getTotalRpcs(), Long.toHexString(context.getReportId()));\n       }\n     } finally {\n       namesystem.writeUnlock();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void removeBRLeaseIfNeeded(final DatanodeID nodeID,\n      final BlockReportContext context) throws IOException {\n    namesystem.writeLock();\n    DatanodeDescriptor node;\n    try {\n      node \u003d datanodeManager.getDatanode(nodeID);\n      if (context !\u003d null) {\n        if (context.getTotalRpcs() \u003d\u003d context.getCurRpc() + 1) {\n          long leaseId \u003d this.getBlockReportLeaseManager().removeLease(node);\n          BlockManagerFaultInjector.getInstance().\n              removeBlockReportLease(node, leaseId);\n          node.setLastBlockReportTime(now());\n          node.setLastBlockReportMonotonic(Time.monotonicNow());\n        }\n        LOG.debug(\"Processing RPC with index {} out of total {} RPCs in \"\n                + \"processReport 0x{}\", context.getCurRpc(),\n            context.getTotalRpcs(), Long.toHexString(context.getReportId()));\n      }\n    } finally {\n      namesystem.writeUnlock();\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java",
      "extendedDetails": {}
    },
    "391ce535a739dc92cb90017d759217265a4fd969": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-10301. Remove FBR tracking state to fix false zombie storage detection for interleaving block reports. Contributed by Vinitha Gankidi.",
      "commitDate": "14/10/16 6:13 PM",
      "commitName": "391ce535a739dc92cb90017d759217265a4fd969",
      "commitAuthor": "Vinitha Reddy Gankidi",
      "diff": "@@ -0,0 +1,20 @@\n+  public void removeBRLeaseIfNeeded(final DatanodeID nodeID,\n+      final BlockReportContext context) throws IOException {\n+    namesystem.writeLock();\n+    DatanodeDescriptor node;\n+    try {\n+      node \u003d datanodeManager.getDatanode(nodeID);\n+      if (context !\u003d null) {\n+        if (context.getTotalRpcs() \u003d\u003d context.getCurRpc() + 1) {\n+          long leaseId \u003d this.getBlockReportLeaseManager().removeLease(node);\n+          BlockManagerFaultInjector.getInstance().\n+              removeBlockReportLease(node, leaseId);\n+        }\n+        LOG.debug(\"Processing RPC with index {} out of total {} RPCs in \"\n+                + \"processReport 0x{}\", context.getCurRpc(),\n+            context.getTotalRpcs(), Long.toHexString(context.getReportId()));\n+      }\n+    } finally {\n+      namesystem.writeUnlock();\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public void removeBRLeaseIfNeeded(final DatanodeID nodeID,\n      final BlockReportContext context) throws IOException {\n    namesystem.writeLock();\n    DatanodeDescriptor node;\n    try {\n      node \u003d datanodeManager.getDatanode(nodeID);\n      if (context !\u003d null) {\n        if (context.getTotalRpcs() \u003d\u003d context.getCurRpc() + 1) {\n          long leaseId \u003d this.getBlockReportLeaseManager().removeLease(node);\n          BlockManagerFaultInjector.getInstance().\n              removeBlockReportLease(node, leaseId);\n        }\n        LOG.debug(\"Processing RPC with index {} out of total {} RPCs in \"\n                + \"processReport 0x{}\", context.getCurRpc(),\n            context.getTotalRpcs(), Long.toHexString(context.getReportId()));\n      }\n    } finally {\n      namesystem.writeUnlock();\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java"
    }
  }
}