{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "S3GuardFsckViolationHandler.java",
  "functionName": "handleComparePair",
  "functionId": "handleComparePair___comparePair-S3GuardFsck.ComparePair__sB-StringBuilder__handleMode-HandleMode",
  "sourceFilePath": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3GuardFsckViolationHandler.java",
  "functionStartLine": 96,
  "functionEndLine": 127,
  "numCommitsSeen": 5,
  "timeTaken": 3343,
  "changeHistory": [
    "c91ff8c18ffc070eeef22afeb2e519b184398e89",
    "4e273a31f66013b7c20e8114451f5bc6c741f2cc"
  ],
  "changeHistoryShort": {
    "c91ff8c18ffc070eeef22afeb2e519b184398e89": "Ymultichange(Yparameterchange,Ymodifierchange,Yexceptionschange,Ybodychange)",
    "4e273a31f66013b7c20e8114451f5bc6c741f2cc": "Yintroduced"
  },
  "changeHistoryDetails": {
    "c91ff8c18ffc070eeef22afeb2e519b184398e89": {
      "type": "Ymultichange(Yparameterchange,Ymodifierchange,Yexceptionschange,Ybodychange)",
      "commitMessage": "HADOOP-16858. S3Guard fsck: Add option to remove orphaned entries (#1851). Contributed by Gabor Bota.\n\nAdding a new feature to S3GuardTool\u0027s fsck: -fix. \r\n\r\nChange-Id: I2cdb6601fea1d859b54370046b827ef06eb1107d",
      "commitDate": "18/03/20 4:48 AM",
      "commitName": "c91ff8c18ffc070eeef22afeb2e519b184398e89",
      "commitAuthor": "Gabor Bota",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HADOOP-16858. S3Guard fsck: Add option to remove orphaned entries (#1851). Contributed by Gabor Bota.\n\nAdding a new feature to S3GuardTool\u0027s fsck: -fix. \r\n\r\nChange-Id: I2cdb6601fea1d859b54370046b827ef06eb1107d",
          "commitDate": "18/03/20 4:48 AM",
          "commitName": "c91ff8c18ffc070eeef22afeb2e519b184398e89",
          "commitAuthor": "Gabor Bota",
          "commitDateOld": "10/12/19 6:51 AM",
          "commitNameOld": "875a3e97dd4a26fe224a1858c54d1b4512db6be3",
          "commitAuthorOld": "Gabor Bota",
          "daysBetweenCommits": 98.87,
          "commitsBetweenForRepo": 318,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,20 +1,32 @@\n-  protected static void handleComparePair(S3GuardFsck.ComparePair comparePair,\n-      StringBuilder sB) {\n+  protected void handleComparePair(S3GuardFsck.ComparePair comparePair,\n+      StringBuilder sB, HandleMode handleMode) throws IOException {\n \n     for (S3GuardFsck.Violation violation : comparePair.getViolations()) {\n       try {\n         ViolationHandler handler \u003d violation.getHandler()\n             .getDeclaredConstructor(S3GuardFsck.ComparePair.class)\n             .newInstance(comparePair);\n-        final String errorStr \u003d handler.getError();\n-        sB.append(errorStr);\n+\n+        switch (handleMode) {\n+          case FIX:\n+            final String errorStr \u003d handler.getError();\n+            sB.append(errorStr);\n+            break;\n+          case LOG:\n+            final String fixStr \u003d handler.fixViolation(rawFs, metadataStore);\n+            sB.append(fixStr);\n+            break;\n+          default:\n+            throw new UnsupportedOperationException(\"Unknown handleMode: \" + handleMode);\n+        }\n+\n       } catch (NoSuchMethodException e) {\n         LOG.error(\"Can not find declared constructor for handler: {}\",\n             violation.getHandler());\n       } catch (IllegalAccessException | InstantiationException | InvocationTargetException e) {\n         LOG.error(\"Can not instantiate handler: {}\",\n             violation.getHandler());\n       }\n       sB.append(newLine);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  protected void handleComparePair(S3GuardFsck.ComparePair comparePair,\n      StringBuilder sB, HandleMode handleMode) throws IOException {\n\n    for (S3GuardFsck.Violation violation : comparePair.getViolations()) {\n      try {\n        ViolationHandler handler \u003d violation.getHandler()\n            .getDeclaredConstructor(S3GuardFsck.ComparePair.class)\n            .newInstance(comparePair);\n\n        switch (handleMode) {\n          case FIX:\n            final String errorStr \u003d handler.getError();\n            sB.append(errorStr);\n            break;\n          case LOG:\n            final String fixStr \u003d handler.fixViolation(rawFs, metadataStore);\n            sB.append(fixStr);\n            break;\n          default:\n            throw new UnsupportedOperationException(\"Unknown handleMode: \" + handleMode);\n        }\n\n      } catch (NoSuchMethodException e) {\n        LOG.error(\"Can not find declared constructor for handler: {}\",\n            violation.getHandler());\n      } catch (IllegalAccessException | InstantiationException | InvocationTargetException e) {\n        LOG.error(\"Can not instantiate handler: {}\",\n            violation.getHandler());\n      }\n      sB.append(newLine);\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3GuardFsckViolationHandler.java",
          "extendedDetails": {
            "oldValue": "[comparePair-S3GuardFsck.ComparePair, sB-StringBuilder]",
            "newValue": "[comparePair-S3GuardFsck.ComparePair, sB-StringBuilder, handleMode-HandleMode]"
          }
        },
        {
          "type": "Ymodifierchange",
          "commitMessage": "HADOOP-16858. S3Guard fsck: Add option to remove orphaned entries (#1851). Contributed by Gabor Bota.\n\nAdding a new feature to S3GuardTool\u0027s fsck: -fix. \r\n\r\nChange-Id: I2cdb6601fea1d859b54370046b827ef06eb1107d",
          "commitDate": "18/03/20 4:48 AM",
          "commitName": "c91ff8c18ffc070eeef22afeb2e519b184398e89",
          "commitAuthor": "Gabor Bota",
          "commitDateOld": "10/12/19 6:51 AM",
          "commitNameOld": "875a3e97dd4a26fe224a1858c54d1b4512db6be3",
          "commitAuthorOld": "Gabor Bota",
          "daysBetweenCommits": 98.87,
          "commitsBetweenForRepo": 318,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,20 +1,32 @@\n-  protected static void handleComparePair(S3GuardFsck.ComparePair comparePair,\n-      StringBuilder sB) {\n+  protected void handleComparePair(S3GuardFsck.ComparePair comparePair,\n+      StringBuilder sB, HandleMode handleMode) throws IOException {\n \n     for (S3GuardFsck.Violation violation : comparePair.getViolations()) {\n       try {\n         ViolationHandler handler \u003d violation.getHandler()\n             .getDeclaredConstructor(S3GuardFsck.ComparePair.class)\n             .newInstance(comparePair);\n-        final String errorStr \u003d handler.getError();\n-        sB.append(errorStr);\n+\n+        switch (handleMode) {\n+          case FIX:\n+            final String errorStr \u003d handler.getError();\n+            sB.append(errorStr);\n+            break;\n+          case LOG:\n+            final String fixStr \u003d handler.fixViolation(rawFs, metadataStore);\n+            sB.append(fixStr);\n+            break;\n+          default:\n+            throw new UnsupportedOperationException(\"Unknown handleMode: \" + handleMode);\n+        }\n+\n       } catch (NoSuchMethodException e) {\n         LOG.error(\"Can not find declared constructor for handler: {}\",\n             violation.getHandler());\n       } catch (IllegalAccessException | InstantiationException | InvocationTargetException e) {\n         LOG.error(\"Can not instantiate handler: {}\",\n             violation.getHandler());\n       }\n       sB.append(newLine);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  protected void handleComparePair(S3GuardFsck.ComparePair comparePair,\n      StringBuilder sB, HandleMode handleMode) throws IOException {\n\n    for (S3GuardFsck.Violation violation : comparePair.getViolations()) {\n      try {\n        ViolationHandler handler \u003d violation.getHandler()\n            .getDeclaredConstructor(S3GuardFsck.ComparePair.class)\n            .newInstance(comparePair);\n\n        switch (handleMode) {\n          case FIX:\n            final String errorStr \u003d handler.getError();\n            sB.append(errorStr);\n            break;\n          case LOG:\n            final String fixStr \u003d handler.fixViolation(rawFs, metadataStore);\n            sB.append(fixStr);\n            break;\n          default:\n            throw new UnsupportedOperationException(\"Unknown handleMode: \" + handleMode);\n        }\n\n      } catch (NoSuchMethodException e) {\n        LOG.error(\"Can not find declared constructor for handler: {}\",\n            violation.getHandler());\n      } catch (IllegalAccessException | InstantiationException | InvocationTargetException e) {\n        LOG.error(\"Can not instantiate handler: {}\",\n            violation.getHandler());\n      }\n      sB.append(newLine);\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3GuardFsckViolationHandler.java",
          "extendedDetails": {
            "oldValue": "[protected, static]",
            "newValue": "[protected]"
          }
        },
        {
          "type": "Yexceptionschange",
          "commitMessage": "HADOOP-16858. S3Guard fsck: Add option to remove orphaned entries (#1851). Contributed by Gabor Bota.\n\nAdding a new feature to S3GuardTool\u0027s fsck: -fix. \r\n\r\nChange-Id: I2cdb6601fea1d859b54370046b827ef06eb1107d",
          "commitDate": "18/03/20 4:48 AM",
          "commitName": "c91ff8c18ffc070eeef22afeb2e519b184398e89",
          "commitAuthor": "Gabor Bota",
          "commitDateOld": "10/12/19 6:51 AM",
          "commitNameOld": "875a3e97dd4a26fe224a1858c54d1b4512db6be3",
          "commitAuthorOld": "Gabor Bota",
          "daysBetweenCommits": 98.87,
          "commitsBetweenForRepo": 318,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,20 +1,32 @@\n-  protected static void handleComparePair(S3GuardFsck.ComparePair comparePair,\n-      StringBuilder sB) {\n+  protected void handleComparePair(S3GuardFsck.ComparePair comparePair,\n+      StringBuilder sB, HandleMode handleMode) throws IOException {\n \n     for (S3GuardFsck.Violation violation : comparePair.getViolations()) {\n       try {\n         ViolationHandler handler \u003d violation.getHandler()\n             .getDeclaredConstructor(S3GuardFsck.ComparePair.class)\n             .newInstance(comparePair);\n-        final String errorStr \u003d handler.getError();\n-        sB.append(errorStr);\n+\n+        switch (handleMode) {\n+          case FIX:\n+            final String errorStr \u003d handler.getError();\n+            sB.append(errorStr);\n+            break;\n+          case LOG:\n+            final String fixStr \u003d handler.fixViolation(rawFs, metadataStore);\n+            sB.append(fixStr);\n+            break;\n+          default:\n+            throw new UnsupportedOperationException(\"Unknown handleMode: \" + handleMode);\n+        }\n+\n       } catch (NoSuchMethodException e) {\n         LOG.error(\"Can not find declared constructor for handler: {}\",\n             violation.getHandler());\n       } catch (IllegalAccessException | InstantiationException | InvocationTargetException e) {\n         LOG.error(\"Can not instantiate handler: {}\",\n             violation.getHandler());\n       }\n       sB.append(newLine);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  protected void handleComparePair(S3GuardFsck.ComparePair comparePair,\n      StringBuilder sB, HandleMode handleMode) throws IOException {\n\n    for (S3GuardFsck.Violation violation : comparePair.getViolations()) {\n      try {\n        ViolationHandler handler \u003d violation.getHandler()\n            .getDeclaredConstructor(S3GuardFsck.ComparePair.class)\n            .newInstance(comparePair);\n\n        switch (handleMode) {\n          case FIX:\n            final String errorStr \u003d handler.getError();\n            sB.append(errorStr);\n            break;\n          case LOG:\n            final String fixStr \u003d handler.fixViolation(rawFs, metadataStore);\n            sB.append(fixStr);\n            break;\n          default:\n            throw new UnsupportedOperationException(\"Unknown handleMode: \" + handleMode);\n        }\n\n      } catch (NoSuchMethodException e) {\n        LOG.error(\"Can not find declared constructor for handler: {}\",\n            violation.getHandler());\n      } catch (IllegalAccessException | InstantiationException | InvocationTargetException e) {\n        LOG.error(\"Can not instantiate handler: {}\",\n            violation.getHandler());\n      }\n      sB.append(newLine);\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3GuardFsckViolationHandler.java",
          "extendedDetails": {
            "oldValue": "[]",
            "newValue": "[IOException]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HADOOP-16858. S3Guard fsck: Add option to remove orphaned entries (#1851). Contributed by Gabor Bota.\n\nAdding a new feature to S3GuardTool\u0027s fsck: -fix. \r\n\r\nChange-Id: I2cdb6601fea1d859b54370046b827ef06eb1107d",
          "commitDate": "18/03/20 4:48 AM",
          "commitName": "c91ff8c18ffc070eeef22afeb2e519b184398e89",
          "commitAuthor": "Gabor Bota",
          "commitDateOld": "10/12/19 6:51 AM",
          "commitNameOld": "875a3e97dd4a26fe224a1858c54d1b4512db6be3",
          "commitAuthorOld": "Gabor Bota",
          "daysBetweenCommits": 98.87,
          "commitsBetweenForRepo": 318,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,20 +1,32 @@\n-  protected static void handleComparePair(S3GuardFsck.ComparePair comparePair,\n-      StringBuilder sB) {\n+  protected void handleComparePair(S3GuardFsck.ComparePair comparePair,\n+      StringBuilder sB, HandleMode handleMode) throws IOException {\n \n     for (S3GuardFsck.Violation violation : comparePair.getViolations()) {\n       try {\n         ViolationHandler handler \u003d violation.getHandler()\n             .getDeclaredConstructor(S3GuardFsck.ComparePair.class)\n             .newInstance(comparePair);\n-        final String errorStr \u003d handler.getError();\n-        sB.append(errorStr);\n+\n+        switch (handleMode) {\n+          case FIX:\n+            final String errorStr \u003d handler.getError();\n+            sB.append(errorStr);\n+            break;\n+          case LOG:\n+            final String fixStr \u003d handler.fixViolation(rawFs, metadataStore);\n+            sB.append(fixStr);\n+            break;\n+          default:\n+            throw new UnsupportedOperationException(\"Unknown handleMode: \" + handleMode);\n+        }\n+\n       } catch (NoSuchMethodException e) {\n         LOG.error(\"Can not find declared constructor for handler: {}\",\n             violation.getHandler());\n       } catch (IllegalAccessException | InstantiationException | InvocationTargetException e) {\n         LOG.error(\"Can not instantiate handler: {}\",\n             violation.getHandler());\n       }\n       sB.append(newLine);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  protected void handleComparePair(S3GuardFsck.ComparePair comparePair,\n      StringBuilder sB, HandleMode handleMode) throws IOException {\n\n    for (S3GuardFsck.Violation violation : comparePair.getViolations()) {\n      try {\n        ViolationHandler handler \u003d violation.getHandler()\n            .getDeclaredConstructor(S3GuardFsck.ComparePair.class)\n            .newInstance(comparePair);\n\n        switch (handleMode) {\n          case FIX:\n            final String errorStr \u003d handler.getError();\n            sB.append(errorStr);\n            break;\n          case LOG:\n            final String fixStr \u003d handler.fixViolation(rawFs, metadataStore);\n            sB.append(fixStr);\n            break;\n          default:\n            throw new UnsupportedOperationException(\"Unknown handleMode: \" + handleMode);\n        }\n\n      } catch (NoSuchMethodException e) {\n        LOG.error(\"Can not find declared constructor for handler: {}\",\n            violation.getHandler());\n      } catch (IllegalAccessException | InstantiationException | InvocationTargetException e) {\n        LOG.error(\"Can not instantiate handler: {}\",\n            violation.getHandler());\n      }\n      sB.append(newLine);\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3GuardFsckViolationHandler.java",
          "extendedDetails": {}
        }
      ]
    },
    "4e273a31f66013b7c20e8114451f5bc6c741f2cc": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-16423. S3Guard fsck: Check metadata consistency between S3 and metadatastore (log) (#1208). Contributed by Gabor Bota.\n\nChange-Id: I6bbb331b6c0a41c61043e482b95504fda8a50596",
      "commitDate": "12/09/19 4:12 AM",
      "commitName": "4e273a31f66013b7c20e8114451f5bc6c741f2cc",
      "commitAuthor": "Gabor Bota",
      "diff": "@@ -0,0 +1,20 @@\n+  protected static void handleComparePair(S3GuardFsck.ComparePair comparePair,\n+      StringBuilder sB) {\n+\n+    for (S3GuardFsck.Violation violation : comparePair.getViolations()) {\n+      try {\n+        ViolationHandler handler \u003d violation.getHandler()\n+            .getDeclaredConstructor(S3GuardFsck.ComparePair.class)\n+            .newInstance(comparePair);\n+        final String errorStr \u003d handler.getError();\n+        sB.append(errorStr);\n+      } catch (NoSuchMethodException e) {\n+        LOG.error(\"Can not find declared constructor for handler: {}\",\n+            violation.getHandler());\n+      } catch (IllegalAccessException | InstantiationException | InvocationTargetException e) {\n+        LOG.error(\"Can not instantiate handler: {}\",\n+            violation.getHandler());\n+      }\n+      sB.append(newLine);\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  protected static void handleComparePair(S3GuardFsck.ComparePair comparePair,\n      StringBuilder sB) {\n\n    for (S3GuardFsck.Violation violation : comparePair.getViolations()) {\n      try {\n        ViolationHandler handler \u003d violation.getHandler()\n            .getDeclaredConstructor(S3GuardFsck.ComparePair.class)\n            .newInstance(comparePair);\n        final String errorStr \u003d handler.getError();\n        sB.append(errorStr);\n      } catch (NoSuchMethodException e) {\n        LOG.error(\"Can not find declared constructor for handler: {}\",\n            violation.getHandler());\n      } catch (IllegalAccessException | InstantiationException | InvocationTargetException e) {\n        LOG.error(\"Can not instantiate handler: {}\",\n            violation.getHandler());\n      }\n      sB.append(newLine);\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3GuardFsckViolationHandler.java"
    }
  }
}