{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "EditLogTailer.java",
  "functionName": "run",
  "functionId": "run",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/ha/EditLogTailer.java",
  "functionStartLine": 300,
  "functionEndLine": 319,
  "numCommitsSeen": 51,
  "timeTaken": 1851,
  "changeHistory": [
    "5e26de982b1ab68fffeb897fef4c97458ad46708",
    "c3e62de9ce952aa8572b3cae6a8497b8fdef40aa",
    "d880c7cc784cf636b2590fd98ea7c8ee67065a30",
    "9a07ba8945407cd8f63169faf9e0faa4311d38c7",
    "20a6560bdfd8c4e3b6c3ac9b0f0f62d32e3a2191",
    "2481474bd9c50a23e4fd2eea67ac2dea11ca1f58",
    "f87a4b40bc99e76602a75906df31747cfdbff78a"
  ],
  "changeHistoryShort": {
    "5e26de982b1ab68fffeb897fef4c97458ad46708": "Ybodychange",
    "c3e62de9ce952aa8572b3cae6a8497b8fdef40aa": "Ybodychange",
    "d880c7cc784cf636b2590fd98ea7c8ee67065a30": "Ybodychange",
    "9a07ba8945407cd8f63169faf9e0faa4311d38c7": "Ybodychange",
    "20a6560bdfd8c4e3b6c3ac9b0f0f62d32e3a2191": "Ybodychange",
    "2481474bd9c50a23e4fd2eea67ac2dea11ca1f58": "Ybodychange",
    "f87a4b40bc99e76602a75906df31747cfdbff78a": "Yintroduced"
  },
  "changeHistoryDetails": {
    "5e26de982b1ab68fffeb897fef4c97458ad46708": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-2924. Standby checkpointing fails to authenticate in secure cluster. Contributed by Todd Lipcon.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1242439 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "09/02/12 10:22 AM",
      "commitName": "5e26de982b1ab68fffeb897fef4c97458ad46708",
      "commitAuthor": "Todd Lipcon",
      "commitDateOld": "09/02/12 9:39 AM",
      "commitNameOld": "bad0a2a4a14efe2f1d19015d3d59aa3c75faa2db",
      "commitAuthorOld": "Aaron Myers",
      "daysBetweenCommits": 0.03,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,38 +1,10 @@\n     public void run() {\n-      while (shouldRun) {\n-        try {\n-          // There\u0027s no point in triggering a log roll if the Standby hasn\u0027t\n-          // read any more transactions since the last time a roll was\n-          // triggered. \n-          if (tooLongSinceLastLoad() \u0026\u0026\n-              lastRollTriggerTxId \u003c lastLoadedTxnId) {\n-            triggerActiveLogRoll();\n+      SecurityUtil.doAsLoginUserOrFatal(\n+          new PrivilegedAction\u003cObject\u003e() {\n+          @Override\n+          public Object run() {\n+            doWork();\n+            return null;\n           }\n-          /**\n-           * Check again in case someone calls {@link EditLogTailer#stop} while\n-           * we\u0027re triggering an edit log roll, since ipc.Client catches and\n-           * ignores {@link InterruptedException} in a few places. This fixes\n-           * the bug described in HDFS-2823.\n-           */\n-          if (!shouldRun) {\n-            break;\n-          }\n-          doTailEdits();\n-        } catch (EditLogInputException elie) {\n-          LOG.warn(\"Error while reading edits from disk. Will try again.\", elie);\n-        } catch (InterruptedException ie) {\n-          // interrupter should have already set shouldRun to false\n-          continue;\n-        } catch (Throwable t) {\n-          LOG.error(\"Unknown error encountered while tailing edits. \" +\n-              \"Shutting down standby NN.\", t);\n-          runtime.exit(1);\n-        }\n-\n-        try {\n-          Thread.sleep(sleepTimeMs);\n-        } catch (InterruptedException e) {\n-          LOG.warn(\"Edit log tailer interrupted\", e);\n-        }\n-      }\n+        });\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void run() {\n      SecurityUtil.doAsLoginUserOrFatal(\n          new PrivilegedAction\u003cObject\u003e() {\n          @Override\n          public Object run() {\n            doWork();\n            return null;\n          }\n        });\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/ha/EditLogTailer.java",
      "extendedDetails": {}
    },
    "c3e62de9ce952aa8572b3cae6a8497b8fdef40aa": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-2737. Automatically trigger log rolls periodically on the active NN. Contributed by Todd Lipcon and Aaron T. Myers.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1234256 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "20/01/12 7:17 PM",
      "commitName": "c3e62de9ce952aa8572b3cae6a8497b8fdef40aa",
      "commitAuthor": "Aaron Myers",
      "commitDateOld": "16/01/12 2:16 PM",
      "commitNameOld": "d880c7cc784cf636b2590fd98ea7c8ee67065a30",
      "commitAuthorOld": "Aaron Myers",
      "daysBetweenCommits": 4.21,
      "commitsBetweenForRepo": 19,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,22 +1,38 @@\n     public void run() {\n       while (shouldRun) {\n         try {\n+          // There\u0027s no point in triggering a log roll if the Standby hasn\u0027t\n+          // read any more transactions since the last time a roll was\n+          // triggered. \n+          if (tooLongSinceLastLoad() \u0026\u0026\n+              lastRollTriggerTxId \u003c lastLoadedTxnId) {\n+            triggerActiveLogRoll();\n+          }\n+          /**\n+           * Check again in case someone calls {@link EditLogTailer#stop} while\n+           * we\u0027re triggering an edit log roll, since ipc.Client catches and\n+           * ignores {@link InterruptedException} in a few places. This fixes\n+           * the bug described in HDFS-2823.\n+           */\n+          if (!shouldRun) {\n+            break;\n+          }\n           doTailEdits();\n         } catch (EditLogInputException elie) {\n           LOG.warn(\"Error while reading edits from disk. Will try again.\", elie);\n         } catch (InterruptedException ie) {\n           // interrupter should have already set shouldRun to false\n           continue;\n         } catch (Throwable t) {\n           LOG.error(\"Unknown error encountered while tailing edits. \" +\n               \"Shutting down standby NN.\", t);\n           runtime.exit(1);\n         }\n \n         try {\n-          Thread.sleep(sleepTime);\n+          Thread.sleep(sleepTimeMs);\n         } catch (InterruptedException e) {\n           LOG.warn(\"Edit log tailer interrupted\", e);\n         }\n       }\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void run() {\n      while (shouldRun) {\n        try {\n          // There\u0027s no point in triggering a log roll if the Standby hasn\u0027t\n          // read any more transactions since the last time a roll was\n          // triggered. \n          if (tooLongSinceLastLoad() \u0026\u0026\n              lastRollTriggerTxId \u003c lastLoadedTxnId) {\n            triggerActiveLogRoll();\n          }\n          /**\n           * Check again in case someone calls {@link EditLogTailer#stop} while\n           * we\u0027re triggering an edit log roll, since ipc.Client catches and\n           * ignores {@link InterruptedException} in a few places. This fixes\n           * the bug described in HDFS-2823.\n           */\n          if (!shouldRun) {\n            break;\n          }\n          doTailEdits();\n        } catch (EditLogInputException elie) {\n          LOG.warn(\"Error while reading edits from disk. Will try again.\", elie);\n        } catch (InterruptedException ie) {\n          // interrupter should have already set shouldRun to false\n          continue;\n        } catch (Throwable t) {\n          LOG.error(\"Unknown error encountered while tailing edits. \" +\n              \"Shutting down standby NN.\", t);\n          runtime.exit(1);\n        }\n\n        try {\n          Thread.sleep(sleepTimeMs);\n        } catch (InterruptedException e) {\n          LOG.warn(\"Edit log tailer interrupted\", e);\n        }\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/ha/EditLogTailer.java",
      "extendedDetails": {}
    },
    "d880c7cc784cf636b2590fd98ea7c8ee67065a30": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-2772. On transition to active, standby should not swallow ELIE. Contributed by Aaron T. Myers\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1232197 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "16/01/12 2:16 PM",
      "commitName": "d880c7cc784cf636b2590fd98ea7c8ee67065a30",
      "commitAuthor": "Aaron Myers",
      "commitDateOld": "06/01/12 12:44 PM",
      "commitNameOld": "9a07ba8945407cd8f63169faf9e0faa4311d38c7",
      "commitAuthorOld": "Todd Lipcon",
      "daysBetweenCommits": 10.06,
      "commitsBetweenForRepo": 56,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,20 +1,22 @@\n     public void run() {\n       while (shouldRun) {\n         try {\n           doTailEdits();\n+        } catch (EditLogInputException elie) {\n+          LOG.warn(\"Error while reading edits from disk. Will try again.\", elie);\n         } catch (InterruptedException ie) {\n           // interrupter should have already set shouldRun to false\n           continue;\n         } catch (Throwable t) {\n-          LOG.error(\"Error encountered while tailing edits. Shutting down \" +\n-              \"standby NN.\", t);\n+          LOG.error(\"Unknown error encountered while tailing edits. \" +\n+              \"Shutting down standby NN.\", t);\n           runtime.exit(1);\n         }\n \n         try {\n           Thread.sleep(sleepTime);\n         } catch (InterruptedException e) {\n           LOG.warn(\"Edit log tailer interrupted\", e);\n         }\n       }\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void run() {\n      while (shouldRun) {\n        try {\n          doTailEdits();\n        } catch (EditLogInputException elie) {\n          LOG.warn(\"Error while reading edits from disk. Will try again.\", elie);\n        } catch (InterruptedException ie) {\n          // interrupter should have already set shouldRun to false\n          continue;\n        } catch (Throwable t) {\n          LOG.error(\"Unknown error encountered while tailing edits. \" +\n              \"Shutting down standby NN.\", t);\n          runtime.exit(1);\n        }\n\n        try {\n          Thread.sleep(sleepTime);\n        } catch (InterruptedException e) {\n          LOG.warn(\"Edit log tailer interrupted\", e);\n        }\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/ha/EditLogTailer.java",
      "extendedDetails": {}
    },
    "9a07ba8945407cd8f63169faf9e0faa4311d38c7": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-2709. Appropriately handle error conditions in EditLogTailer. Contributed by Aaron T. Myers.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1228390 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "06/01/12 12:44 PM",
      "commitName": "9a07ba8945407cd8f63169faf9e0faa4311d38c7",
      "commitAuthor": "Todd Lipcon",
      "commitDateOld": "04/01/12 4:22 PM",
      "commitNameOld": "5b8dcb20a2fad2e7e9dee56c451f68f9d865b5ae",
      "commitAuthorOld": "Todd Lipcon",
      "daysBetweenCommits": 1.85,
      "commitsBetweenForRepo": 21,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,28 +1,20 @@\n     public void run() {\n       while (shouldRun) {\n         try {\n-          try {\n-            doTailEdits();\n-          } catch (IOException e) {\n-            if (e.getCause() instanceof RuntimeException) {\n-              throw (RuntimeException)e.getCause();\n-            } else if (e.getCause() instanceof Error) {\n-              throw (Error)e.getCause();\n-            }\n-                \n-            // Will try again\n-            LOG.info(\"Got error, will try again.\", e);\n-          }\n+          doTailEdits();\n+        } catch (InterruptedException ie) {\n+          // interrupter should have already set shouldRun to false\n+          continue;\n         } catch (Throwable t) {\n-          // TODO(HA): What should we do in this case? Shutdown the standby NN?\n-          LOG.error(\"Edit log tailer received throwable\", t);\n-          lastError \u003d t;\n+          LOG.error(\"Error encountered while tailing edits. Shutting down \" +\n+              \"standby NN.\", t);\n+          runtime.exit(1);\n         }\n \n         try {\n           Thread.sleep(sleepTime);\n         } catch (InterruptedException e) {\n           LOG.warn(\"Edit log tailer interrupted\", e);\n         }\n       }\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void run() {\n      while (shouldRun) {\n        try {\n          doTailEdits();\n        } catch (InterruptedException ie) {\n          // interrupter should have already set shouldRun to false\n          continue;\n        } catch (Throwable t) {\n          LOG.error(\"Error encountered while tailing edits. Shutting down \" +\n              \"standby NN.\", t);\n          runtime.exit(1);\n        }\n\n        try {\n          Thread.sleep(sleepTime);\n        } catch (InterruptedException e) {\n          LOG.warn(\"Edit log tailer interrupted\", e);\n        }\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/ha/EditLogTailer.java",
      "extendedDetails": {}
    },
    "20a6560bdfd8c4e3b6c3ac9b0f0f62d32e3a2191": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-2692. Fix bugs related to failover from/into safe mode. Contributed by Todd Lipcon.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1225709 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "29/12/11 4:30 PM",
      "commitName": "20a6560bdfd8c4e3b6c3ac9b0f0f62d32e3a2191",
      "commitAuthor": "Todd Lipcon",
      "commitDateOld": "20/12/11 7:03 PM",
      "commitNameOld": "36d1c49486587c2dbb193e8538b1d4510c462fa6",
      "commitAuthorOld": "Todd Lipcon",
      "daysBetweenCommits": 8.89,
      "commitsBetweenForRepo": 20,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,21 +1,28 @@\n     public void run() {\n       while (shouldRun) {\n         try {\n           try {\n             doTailEdits();\n           } catch (IOException e) {\n+            if (e.getCause() instanceof RuntimeException) {\n+              throw (RuntimeException)e.getCause();\n+            } else if (e.getCause() instanceof Error) {\n+              throw (Error)e.getCause();\n+            }\n+                \n             // Will try again\n             LOG.info(\"Got error, will try again.\", e);\n           }\n         } catch (Throwable t) {\n           // TODO(HA): What should we do in this case? Shutdown the standby NN?\n           LOG.error(\"Edit log tailer received throwable\", t);\n+          lastError \u003d t;\n         }\n \n         try {\n           Thread.sleep(sleepTime);\n         } catch (InterruptedException e) {\n           LOG.warn(\"Edit log tailer interrupted\", e);\n         }\n       }\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void run() {\n      while (shouldRun) {\n        try {\n          try {\n            doTailEdits();\n          } catch (IOException e) {\n            if (e.getCause() instanceof RuntimeException) {\n              throw (RuntimeException)e.getCause();\n            } else if (e.getCause() instanceof Error) {\n              throw (Error)e.getCause();\n            }\n                \n            // Will try again\n            LOG.info(\"Got error, will try again.\", e);\n          }\n        } catch (Throwable t) {\n          // TODO(HA): What should we do in this case? Shutdown the standby NN?\n          LOG.error(\"Edit log tailer received throwable\", t);\n          lastError \u003d t;\n        }\n\n        try {\n          Thread.sleep(sleepTime);\n        } catch (InterruptedException e) {\n          LOG.warn(\"Edit log tailer interrupted\", e);\n        }\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/ha/EditLogTailer.java",
      "extendedDetails": {}
    },
    "2481474bd9c50a23e4fd2eea67ac2dea11ca1f58": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-2634. Standby needs to ingest latest edit logs before transitioning to active. Contributed by Todd Lipcon.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1212187 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "08/12/11 3:55 PM",
      "commitName": "2481474bd9c50a23e4fd2eea67ac2dea11ca1f58",
      "commitAuthor": "Todd Lipcon",
      "commitDateOld": "30/11/11 1:46 PM",
      "commitNameOld": "f87a4b40bc99e76602a75906df31747cfdbff78a",
      "commitAuthorOld": "Todd Lipcon",
      "daysBetweenCommits": 8.09,
      "commitsBetweenForRepo": 46,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,36 +1,21 @@\n     public void run() {\n       while (shouldRun) {\n         try {\n-          long lastTxnId \u003d image.getLastAppliedTxId();\n-          \n-          if (LOG.isDebugEnabled()) {\n-            LOG.debug(\"lastTxnId: \" + lastTxnId);\n-          }\n           try {\n-            // At least one record should be available.\n-            Collection\u003cEditLogInputStream\u003e streams \u003d editLog\n-                .selectInputStreams(lastTxnId + 1, lastTxnId + 1, false);\n-            if (LOG.isDebugEnabled()) {\n-              LOG.debug(\"edit streams to load from: \" + streams.size());\n-            }\n-            \n-            long editsLoaded \u003d image.loadEdits(streams, namesystem);\n-            if (LOG.isDebugEnabled()) {\n-              LOG.debug(\"editsLoaded: \" + editsLoaded);\n-            }\n+            doTailEdits();\n           } catch (IOException e) {\n             // Will try again\n             LOG.info(\"Got error, will try again.\", e);\n           }\n         } catch (Throwable t) {\n           // TODO(HA): What should we do in this case? Shutdown the standby NN?\n           LOG.error(\"Edit log tailer received throwable\", t);\n         }\n \n         try {\n           Thread.sleep(sleepTime);\n         } catch (InterruptedException e) {\n           LOG.warn(\"Edit log tailer interrupted\", e);\n         }\n       }\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void run() {\n      while (shouldRun) {\n        try {\n          try {\n            doTailEdits();\n          } catch (IOException e) {\n            // Will try again\n            LOG.info(\"Got error, will try again.\", e);\n          }\n        } catch (Throwable t) {\n          // TODO(HA): What should we do in this case? Shutdown the standby NN?\n          LOG.error(\"Edit log tailer received throwable\", t);\n        }\n\n        try {\n          Thread.sleep(sleepTime);\n        } catch (InterruptedException e) {\n          LOG.warn(\"Edit log tailer interrupted\", e);\n        }\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/ha/EditLogTailer.java",
      "extendedDetails": {}
    },
    "f87a4b40bc99e76602a75906df31747cfdbff78a": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-1975. Support for sharing the namenode state from active to standby. Contributed by Jitendra Nath Pandey, Aaron T Myers, and Todd Lipcon.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1208813 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "30/11/11 1:46 PM",
      "commitName": "f87a4b40bc99e76602a75906df31747cfdbff78a",
      "commitAuthor": "Todd Lipcon",
      "diff": "@@ -0,0 +1,36 @@\n+    public void run() {\n+      while (shouldRun) {\n+        try {\n+          long lastTxnId \u003d image.getLastAppliedTxId();\n+          \n+          if (LOG.isDebugEnabled()) {\n+            LOG.debug(\"lastTxnId: \" + lastTxnId);\n+          }\n+          try {\n+            // At least one record should be available.\n+            Collection\u003cEditLogInputStream\u003e streams \u003d editLog\n+                .selectInputStreams(lastTxnId + 1, lastTxnId + 1, false);\n+            if (LOG.isDebugEnabled()) {\n+              LOG.debug(\"edit streams to load from: \" + streams.size());\n+            }\n+            \n+            long editsLoaded \u003d image.loadEdits(streams, namesystem);\n+            if (LOG.isDebugEnabled()) {\n+              LOG.debug(\"editsLoaded: \" + editsLoaded);\n+            }\n+          } catch (IOException e) {\n+            // Will try again\n+            LOG.info(\"Got error, will try again.\", e);\n+          }\n+        } catch (Throwable t) {\n+          // TODO(HA): What should we do in this case? Shutdown the standby NN?\n+          LOG.error(\"Edit log tailer received throwable\", t);\n+        }\n+\n+        try {\n+          Thread.sleep(sleepTime);\n+        } catch (InterruptedException e) {\n+          LOG.warn(\"Edit log tailer interrupted\", e);\n+        }\n+      }\n+    }\n\\ No newline at end of file\n",
      "actualSource": "    public void run() {\n      while (shouldRun) {\n        try {\n          long lastTxnId \u003d image.getLastAppliedTxId();\n          \n          if (LOG.isDebugEnabled()) {\n            LOG.debug(\"lastTxnId: \" + lastTxnId);\n          }\n          try {\n            // At least one record should be available.\n            Collection\u003cEditLogInputStream\u003e streams \u003d editLog\n                .selectInputStreams(lastTxnId + 1, lastTxnId + 1, false);\n            if (LOG.isDebugEnabled()) {\n              LOG.debug(\"edit streams to load from: \" + streams.size());\n            }\n            \n            long editsLoaded \u003d image.loadEdits(streams, namesystem);\n            if (LOG.isDebugEnabled()) {\n              LOG.debug(\"editsLoaded: \" + editsLoaded);\n            }\n          } catch (IOException e) {\n            // Will try again\n            LOG.info(\"Got error, will try again.\", e);\n          }\n        } catch (Throwable t) {\n          // TODO(HA): What should we do in this case? Shutdown the standby NN?\n          LOG.error(\"Edit log tailer received throwable\", t);\n        }\n\n        try {\n          Thread.sleep(sleepTime);\n        } catch (InterruptedException e) {\n          LOG.warn(\"Edit log tailer interrupted\", e);\n        }\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/ha/EditLogTailer.java"
    }
  }
}