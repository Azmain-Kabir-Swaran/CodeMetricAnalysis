{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "NativeAzureFileSystem.java",
  "functionName": "close",
  "functionId": "close",
  "sourceFilePath": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
  "functionStartLine": 918,
  "functionEndLine": 924,
  "numCommitsSeen": 66,
  "timeTaken": 3347,
  "changeHistory": [
    "5f6edb30c2bb648d5564c951edc25645e17e6636",
    "734eeb4f357ad3210355a0d3fdbc80706a770d61",
    "2217e2f8ff418b88eac6ad36cafe3a9795a11f40",
    "0a02b5a19bcca8d0c49d2adfc3909aebdf9d606e",
    "0d91576ec31f63402f2db6107a04155368e2632d",
    "81bc395deb3ba00567dc067d6ca71bacf9e3bc82"
  ],
  "changeHistoryShort": {
    "5f6edb30c2bb648d5564c951edc25645e17e6636": "Ybodychange",
    "734eeb4f357ad3210355a0d3fdbc80706a770d61": "Ybodychange",
    "2217e2f8ff418b88eac6ad36cafe3a9795a11f40": "Ybodychange",
    "0a02b5a19bcca8d0c49d2adfc3909aebdf9d606e": "Ymultichange(Ymodifierchange,Ybodychange)",
    "0d91576ec31f63402f2db6107a04155368e2632d": "Ybodychange",
    "81bc395deb3ba00567dc067d6ca71bacf9e3bc82": "Yintroduced"
  },
  "changeHistoryDetails": {
    "5f6edb30c2bb648d5564c951edc25645e17e6636": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-12350. WASB Logging: Improve WASB Logging around deletes, reads and writes. Contributed by Dushyanth.\n",
      "commitDate": "05/10/15 8:11 PM",
      "commitName": "5f6edb30c2bb648d5564c951edc25645e17e6636",
      "commitAuthor": "cnauroth",
      "commitDateOld": "28/09/15 3:31 PM",
      "commitNameOld": "3abbdc929bde05f8819f5410cef1eaeb8940203f",
      "commitAuthorOld": "Kihwal Lee",
      "daysBetweenCommits": 7.19,
      "commitsBetweenForRepo": 44,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,27 +1,25 @@\n   public synchronized void close() throws IOException {\n     if (isClosed) {\n       return;\n     }\n \n     // Call the base close() to close any resources there.\n     super.close();\n     // Close the store to close any resources there - e.g. the bandwidth\n     // updater thread would be stopped at this time.\n     store.close();\n     // Notify the metrics system that this file system is closed, which may\n     // trigger one final metrics push to get the accurate final file system\n     // metrics out.\n \n     long startTime \u003d System.currentTimeMillis();\n \n     if(!getConf().getBoolean(SKIP_AZURE_METRICS_PROPERTY_NAME, false)) {\n       AzureFileSystemMetricsSystem.unregisterSource(metricsSourceName);\n       AzureFileSystemMetricsSystem.fileSystemClosed();\n     }\n \n-    if (LOG.isDebugEnabled()) {\n-        LOG.debug(\"Submitting metrics when file system closed took \"\n-                + (System.currentTimeMillis() - startTime) + \" ms.\");\n-    }\n+    LOG.debug(\"Submitting metrics when file system closed took {} ms.\",\n+        (System.currentTimeMillis() - startTime));\n     isClosed \u003d true;\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public synchronized void close() throws IOException {\n    if (isClosed) {\n      return;\n    }\n\n    // Call the base close() to close any resources there.\n    super.close();\n    // Close the store to close any resources there - e.g. the bandwidth\n    // updater thread would be stopped at this time.\n    store.close();\n    // Notify the metrics system that this file system is closed, which may\n    // trigger one final metrics push to get the accurate final file system\n    // metrics out.\n\n    long startTime \u003d System.currentTimeMillis();\n\n    if(!getConf().getBoolean(SKIP_AZURE_METRICS_PROPERTY_NAME, false)) {\n      AzureFileSystemMetricsSystem.unregisterSource(metricsSourceName);\n      AzureFileSystemMetricsSystem.fileSystemClosed();\n    }\n\n    LOG.debug(\"Submitting metrics when file system closed took {} ms.\",\n        (System.currentTimeMillis() - startTime));\n    isClosed \u003d true;\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
      "extendedDetails": {}
    },
    "734eeb4f357ad3210355a0d3fdbc80706a770d61": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-11248. Add hadoop configuration to disable Azure Filesystem metrics collection. Contributed by Shanyu Zhao.\n",
      "commitDate": "03/11/14 2:29 PM",
      "commitName": "734eeb4f357ad3210355a0d3fdbc80706a770d61",
      "commitAuthor": "cnauroth",
      "commitDateOld": "08/10/14 2:20 PM",
      "commitNameOld": "2217e2f8ff418b88eac6ad36cafe3a9795a11f40",
      "commitAuthorOld": "cnauroth",
      "daysBetweenCommits": 26.05,
      "commitsBetweenForRepo": 231,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,25 +1,27 @@\n   public synchronized void close() throws IOException {\n     if (isClosed) {\n       return;\n     }\n \n     // Call the base close() to close any resources there.\n     super.close();\n     // Close the store to close any resources there - e.g. the bandwidth\n     // updater thread would be stopped at this time.\n     store.close();\n     // Notify the metrics system that this file system is closed, which may\n     // trigger one final metrics push to get the accurate final file system\n     // metrics out.\n \n     long startTime \u003d System.currentTimeMillis();\n \n-    AzureFileSystemMetricsSystem.unregisterSource(metricsSourceName);\n-    AzureFileSystemMetricsSystem.fileSystemClosed();\n+    if(!getConf().getBoolean(SKIP_AZURE_METRICS_PROPERTY_NAME, false)) {\n+      AzureFileSystemMetricsSystem.unregisterSource(metricsSourceName);\n+      AzureFileSystemMetricsSystem.fileSystemClosed();\n+    }\n \n     if (LOG.isDebugEnabled()) {\n         LOG.debug(\"Submitting metrics when file system closed took \"\n                 + (System.currentTimeMillis() - startTime) + \" ms.\");\n     }\n     isClosed \u003d true;\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public synchronized void close() throws IOException {\n    if (isClosed) {\n      return;\n    }\n\n    // Call the base close() to close any resources there.\n    super.close();\n    // Close the store to close any resources there - e.g. the bandwidth\n    // updater thread would be stopped at this time.\n    store.close();\n    // Notify the metrics system that this file system is closed, which may\n    // trigger one final metrics push to get the accurate final file system\n    // metrics out.\n\n    long startTime \u003d System.currentTimeMillis();\n\n    if(!getConf().getBoolean(SKIP_AZURE_METRICS_PROPERTY_NAME, false)) {\n      AzureFileSystemMetricsSystem.unregisterSource(metricsSourceName);\n      AzureFileSystemMetricsSystem.fileSystemClosed();\n    }\n\n    if (LOG.isDebugEnabled()) {\n        LOG.debug(\"Submitting metrics when file system closed took \"\n                + (System.currentTimeMillis() - startTime) + \" ms.\");\n    }\n    isClosed \u003d true;\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
      "extendedDetails": {}
    },
    "2217e2f8ff418b88eac6ad36cafe3a9795a11f40": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-10809. hadoop-azure: page blob support. Contributed by Dexter Bradshaw, Mostafa Elhemali, Eric Hanson, and Mike Liddell.\n",
      "commitDate": "08/10/14 2:20 PM",
      "commitName": "2217e2f8ff418b88eac6ad36cafe3a9795a11f40",
      "commitAuthor": "cnauroth",
      "commitDateOld": "19/09/14 11:33 AM",
      "commitNameOld": "9f03a7c018bb2c497cd0ef758f1a3e08e8163d06",
      "commitAuthorOld": "Allen Wittenauer",
      "daysBetweenCommits": 19.12,
      "commitsBetweenForRepo": 199,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,25 +1,25 @@\n   public synchronized void close() throws IOException {\n     if (isClosed) {\n       return;\n     }\n-    \n+\n     // Call the base close() to close any resources there.\n     super.close();\n-    // Close the store\n+    // Close the store to close any resources there - e.g. the bandwidth\n+    // updater thread would be stopped at this time.\n     store.close();\n-    \n     // Notify the metrics system that this file system is closed, which may\n     // trigger one final metrics push to get the accurate final file system\n     // metrics out.\n \n     long startTime \u003d System.currentTimeMillis();\n \n     AzureFileSystemMetricsSystem.unregisterSource(metricsSourceName);\n     AzureFileSystemMetricsSystem.fileSystemClosed();\n \n     if (LOG.isDebugEnabled()) {\n         LOG.debug(\"Submitting metrics when file system closed took \"\n                 + (System.currentTimeMillis() - startTime) + \" ms.\");\n     }\n     isClosed \u003d true;\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public synchronized void close() throws IOException {\n    if (isClosed) {\n      return;\n    }\n\n    // Call the base close() to close any resources there.\n    super.close();\n    // Close the store to close any resources there - e.g. the bandwidth\n    // updater thread would be stopped at this time.\n    store.close();\n    // Notify the metrics system that this file system is closed, which may\n    // trigger one final metrics push to get the accurate final file system\n    // metrics out.\n\n    long startTime \u003d System.currentTimeMillis();\n\n    AzureFileSystemMetricsSystem.unregisterSource(metricsSourceName);\n    AzureFileSystemMetricsSystem.fileSystemClosed();\n\n    if (LOG.isDebugEnabled()) {\n        LOG.debug(\"Submitting metrics when file system closed took \"\n                + (System.currentTimeMillis() - startTime) + \" ms.\");\n    }\n    isClosed \u003d true;\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
      "extendedDetails": {}
    },
    "0a02b5a19bcca8d0c49d2adfc3909aebdf9d606e": {
      "type": "Ymultichange(Ymodifierchange,Ybodychange)",
      "commitMessage": "HADOOP-10840. Fix OutOfMemoryError caused by metrics system in Azure File System. Contributed by Shanyu Zhao.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1611247 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "16/07/14 10:04 PM",
      "commitName": "0a02b5a19bcca8d0c49d2adfc3909aebdf9d606e",
      "commitAuthor": "Chris Nauroth",
      "subchanges": [
        {
          "type": "Ymodifierchange",
          "commitMessage": "HADOOP-10840. Fix OutOfMemoryError caused by metrics system in Azure File System. Contributed by Shanyu Zhao.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1611247 13f79535-47bb-0310-9956-ffa450edef68\n",
          "commitDate": "16/07/14 10:04 PM",
          "commitName": "0a02b5a19bcca8d0c49d2adfc3909aebdf9d606e",
          "commitAuthor": "Chris Nauroth",
          "commitDateOld": "24/06/14 1:52 PM",
          "commitNameOld": "0d91576ec31f63402f2db6107a04155368e2632d",
          "commitAuthorOld": "Chris Nauroth",
          "daysBetweenCommits": 22.34,
          "commitsBetweenForRepo": 141,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,19 +1,25 @@\n-  public void close() throws IOException {\n+  public synchronized void close() throws IOException {\n+    if (isClosed) {\n+      return;\n+    }\n+    \n     // Call the base close() to close any resources there.\n     super.close();\n     // Close the store\n     store.close();\n     \n     // Notify the metrics system that this file system is closed, which may\n     // trigger one final metrics push to get the accurate final file system\n     // metrics out.\n \n     long startTime \u003d System.currentTimeMillis();\n \n+    AzureFileSystemMetricsSystem.unregisterSource(metricsSourceName);\n     AzureFileSystemMetricsSystem.fileSystemClosed();\n \n     if (LOG.isDebugEnabled()) {\n         LOG.debug(\"Submitting metrics when file system closed took \"\n                 + (System.currentTimeMillis() - startTime) + \" ms.\");\n     }\n+    isClosed \u003d true;\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public synchronized void close() throws IOException {\n    if (isClosed) {\n      return;\n    }\n    \n    // Call the base close() to close any resources there.\n    super.close();\n    // Close the store\n    store.close();\n    \n    // Notify the metrics system that this file system is closed, which may\n    // trigger one final metrics push to get the accurate final file system\n    // metrics out.\n\n    long startTime \u003d System.currentTimeMillis();\n\n    AzureFileSystemMetricsSystem.unregisterSource(metricsSourceName);\n    AzureFileSystemMetricsSystem.fileSystemClosed();\n\n    if (LOG.isDebugEnabled()) {\n        LOG.debug(\"Submitting metrics when file system closed took \"\n                + (System.currentTimeMillis() - startTime) + \" ms.\");\n    }\n    isClosed \u003d true;\n  }",
          "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
          "extendedDetails": {
            "oldValue": "[public]",
            "newValue": "[public, synchronized]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HADOOP-10840. Fix OutOfMemoryError caused by metrics system in Azure File System. Contributed by Shanyu Zhao.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1611247 13f79535-47bb-0310-9956-ffa450edef68\n",
          "commitDate": "16/07/14 10:04 PM",
          "commitName": "0a02b5a19bcca8d0c49d2adfc3909aebdf9d606e",
          "commitAuthor": "Chris Nauroth",
          "commitDateOld": "24/06/14 1:52 PM",
          "commitNameOld": "0d91576ec31f63402f2db6107a04155368e2632d",
          "commitAuthorOld": "Chris Nauroth",
          "daysBetweenCommits": 22.34,
          "commitsBetweenForRepo": 141,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,19 +1,25 @@\n-  public void close() throws IOException {\n+  public synchronized void close() throws IOException {\n+    if (isClosed) {\n+      return;\n+    }\n+    \n     // Call the base close() to close any resources there.\n     super.close();\n     // Close the store\n     store.close();\n     \n     // Notify the metrics system that this file system is closed, which may\n     // trigger one final metrics push to get the accurate final file system\n     // metrics out.\n \n     long startTime \u003d System.currentTimeMillis();\n \n+    AzureFileSystemMetricsSystem.unregisterSource(metricsSourceName);\n     AzureFileSystemMetricsSystem.fileSystemClosed();\n \n     if (LOG.isDebugEnabled()) {\n         LOG.debug(\"Submitting metrics when file system closed took \"\n                 + (System.currentTimeMillis() - startTime) + \" ms.\");\n     }\n+    isClosed \u003d true;\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public synchronized void close() throws IOException {\n    if (isClosed) {\n      return;\n    }\n    \n    // Call the base close() to close any resources there.\n    super.close();\n    // Close the store\n    store.close();\n    \n    // Notify the metrics system that this file system is closed, which may\n    // trigger one final metrics push to get the accurate final file system\n    // metrics out.\n\n    long startTime \u003d System.currentTimeMillis();\n\n    AzureFileSystemMetricsSystem.unregisterSource(metricsSourceName);\n    AzureFileSystemMetricsSystem.fileSystemClosed();\n\n    if (LOG.isDebugEnabled()) {\n        LOG.debug(\"Submitting metrics when file system closed took \"\n                + (System.currentTimeMillis() - startTime) + \" ms.\");\n    }\n    isClosed \u003d true;\n  }",
          "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
          "extendedDetails": {}
        }
      ]
    },
    "0d91576ec31f63402f2db6107a04155368e2632d": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-10728. Metrics system for Windows Azure Storage Filesystem. Contributed by Dexter Bradshaw, Mostafa Elhemali, Xi Fang, Johannes Klein, David Lao, Mike Liddell, Chuan Liu, Lengning Liu, Ivan Mitic, Michael Rys, Alexander Stojanovic, Brian Swan, and Min Wei.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1605187 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "24/06/14 1:52 PM",
      "commitName": "0d91576ec31f63402f2db6107a04155368e2632d",
      "commitAuthor": "Chris Nauroth",
      "commitDateOld": "20/06/14 11:36 AM",
      "commitNameOld": "61bf9f779919206296d2ce84a8a6b2d912709a59",
      "commitAuthorOld": "Chris Nauroth",
      "daysBetweenCommits": 4.09,
      "commitsBetweenForRepo": 30,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,6 +1,19 @@\n   public void close() throws IOException {\n     // Call the base close() to close any resources there.\n     super.close();\n     // Close the store\n     store.close();\n+    \n+    // Notify the metrics system that this file system is closed, which may\n+    // trigger one final metrics push to get the accurate final file system\n+    // metrics out.\n+\n+    long startTime \u003d System.currentTimeMillis();\n+\n+    AzureFileSystemMetricsSystem.fileSystemClosed();\n+\n+    if (LOG.isDebugEnabled()) {\n+        LOG.debug(\"Submitting metrics when file system closed took \"\n+                + (System.currentTimeMillis() - startTime) + \" ms.\");\n+    }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    // Call the base close() to close any resources there.\n    super.close();\n    // Close the store\n    store.close();\n    \n    // Notify the metrics system that this file system is closed, which may\n    // trigger one final metrics push to get the accurate final file system\n    // metrics out.\n\n    long startTime \u003d System.currentTimeMillis();\n\n    AzureFileSystemMetricsSystem.fileSystemClosed();\n\n    if (LOG.isDebugEnabled()) {\n        LOG.debug(\"Submitting metrics when file system closed took \"\n                + (System.currentTimeMillis() - startTime) + \" ms.\");\n    }\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
      "extendedDetails": {}
    },
    "81bc395deb3ba00567dc067d6ca71bacf9e3bc82": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-9629. Support Windows Azure Storage - Blob as a file system in Hadoop. Contributed by Dexter Bradshaw, Mostafa Elhemali, Xi Fang, Johannes Klein, David Lao, Mike Liddell, Chuan Liu, Lengning Liu, Ivan Mitic, Michael Rys, Alexander Stojanovic, Brian Swan, and Min Wei.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1601781 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "10/06/14 3:26 PM",
      "commitName": "81bc395deb3ba00567dc067d6ca71bacf9e3bc82",
      "commitAuthor": "Chris Nauroth",
      "diff": "@@ -0,0 +1,6 @@\n+  public void close() throws IOException {\n+    // Call the base close() to close any resources there.\n+    super.close();\n+    // Close the store\n+    store.close();\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public void close() throws IOException {\n    // Call the base close() to close any resources there.\n    super.close();\n    // Close the store\n    store.close();\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java"
    }
  }
}