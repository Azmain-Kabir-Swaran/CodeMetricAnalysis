{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "DirectoryWithSnapshotFeature.java",
  "functionName": "process",
  "functionId": "process___inode-INode",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/DirectoryWithSnapshotFeature.java",
  "functionStartLine": 181,
  "functionEndLine": 185,
  "numCommitsSeen": 103,
  "timeTaken": 4538,
  "changeHistory": [
    "b2c85db86c9a62b0a03ee87547265077f664970a",
    "4536399d47f6c061e149e2504600804a0f1e093d",
    "00fe1ed3a4b3ee35fe24be257ec36445d2f44d63",
    "5dae97a584d30cef3e34141edfaca49c4ec57913",
    "44a6560b5da3f79d2299579a36e7a2a60a91f823",
    "72d783374c1e302492d7ce537222b563241038bb",
    "0fa5cad0b27780c27a284c23101b1099d4886506",
    "92e0416ced279a910616985bf11fa3f8b1b1de9b",
    "9c6a7bebe23ffb85d7fd95607f3b7bb4fe82dbe4",
    "9701555899315c94584b24d8717c1d7540a4a491",
    "3b3ea5c4220e674064c7603a449f63904c10bac1",
    "f29fa9e820e25730d00a1a00c51c6f11028fb5a7",
    "02e6b72ae148fc8c2ba02ef624536b9e48997b31",
    "e7db60fbfcc222b32d610ffd912683494674ad2f",
    "00d318378e4b43d36be91b29ae3ef8a879a81e1e"
  ],
  "changeHistoryShort": {
    "b2c85db86c9a62b0a03ee87547265077f664970a": "Ybodychange",
    "4536399d47f6c061e149e2504600804a0f1e093d": "Ybodychange",
    "00fe1ed3a4b3ee35fe24be257ec36445d2f44d63": "Ybodychange",
    "5dae97a584d30cef3e34141edfaca49c4ec57913": "Ybodychange",
    "44a6560b5da3f79d2299579a36e7a2a60a91f823": "Yfilerename",
    "72d783374c1e302492d7ce537222b563241038bb": "Ybodychange",
    "0fa5cad0b27780c27a284c23101b1099d4886506": "Ybodychange",
    "92e0416ced279a910616985bf11fa3f8b1b1de9b": "Ybodychange",
    "9c6a7bebe23ffb85d7fd95607f3b7bb4fe82dbe4": "Ybodychange",
    "9701555899315c94584b24d8717c1d7540a4a491": "Ybodychange",
    "3b3ea5c4220e674064c7603a449f63904c10bac1": "Ymultichange(Yreturntypechange,Ybodychange)",
    "f29fa9e820e25730d00a1a00c51c6f11028fb5a7": "Ymultichange(Yreturntypechange,Ybodychange)",
    "02e6b72ae148fc8c2ba02ef624536b9e48997b31": "Ybodychange",
    "e7db60fbfcc222b32d610ffd912683494674ad2f": "Ybodychange",
    "00d318378e4b43d36be91b29ae3ef8a879a81e1e": "Yintroduced"
  },
  "changeHistoryDetails": {
    "b2c85db86c9a62b0a03ee87547265077f664970a": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-7728. Avoid updating quota usage while loading edits. Contributed by Jing Zhao.\n",
      "commitDate": "13/05/15 9:50 PM",
      "commitName": "b2c85db86c9a62b0a03ee87547265077f664970a",
      "commitAuthor": "Haohui Mai",
      "commitDateOld": "09/05/15 10:51 PM",
      "commitNameOld": "4536399d47f6c061e149e2504600804a0f1e093d",
      "commitAuthorOld": "Haohui Mai",
      "daysBetweenCommits": 3.96,
      "commitsBetweenForRepo": 43,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,6 +1,5 @@\n         public void process(INode inode) {\n           if (inode !\u003d null) {\n-            inode.computeQuotaUsage(reclaimContext.storagePolicySuite(), counts, false);\n             inode.destroyAndCollectBlocks(reclaimContext);\n           }\n         }\n\\ No newline at end of file\n",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            inode.destroyAndCollectBlocks(reclaimContext);\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/DirectoryWithSnapshotFeature.java",
      "extendedDetails": {}
    },
    "4536399d47f6c061e149e2504600804a0f1e093d": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-8357. Consolidate parameters of INode.CleanSubtree() into a parameter objects. Contributed by Li Lu.\n",
      "commitDate": "09/05/15 10:51 PM",
      "commitName": "4536399d47f6c061e149e2504600804a0f1e093d",
      "commitAuthor": "Haohui Mai",
      "commitDateOld": "08/05/15 11:04 PM",
      "commitNameOld": "00fe1ed3a4b3ee35fe24be257ec36445d2f44d63",
      "commitAuthorOld": "Haohui Mai",
      "daysBetweenCommits": 0.99,
      "commitsBetweenForRepo": 7,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,7 +1,6 @@\n         public void process(INode inode) {\n           if (inode !\u003d null) {\n-            inode.computeQuotaUsage(bsps, counts, false);\n-            inode.destroyAndCollectBlocks(bsps, collectedBlocks, removedINodes,\n-                                          null);\n+            inode.computeQuotaUsage(reclaimContext.storagePolicySuite(), counts, false);\n+            inode.destroyAndCollectBlocks(reclaimContext);\n           }\n         }\n\\ No newline at end of file\n",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            inode.computeQuotaUsage(reclaimContext.storagePolicySuite(), counts, false);\n            inode.destroyAndCollectBlocks(reclaimContext);\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/DirectoryWithSnapshotFeature.java",
      "extendedDetails": {}
    },
    "00fe1ed3a4b3ee35fe24be257ec36445d2f44d63": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-6757. Simplify lease manager with INodeID. Contributed by Haohui Mai.\n",
      "commitDate": "08/05/15 11:04 PM",
      "commitName": "00fe1ed3a4b3ee35fe24be257ec36445d2f44d63",
      "commitAuthor": "Haohui Mai",
      "commitDateOld": "02/04/15 9:20 PM",
      "commitNameOld": "72f6bd4893dcf10d6dad24753f9be99505a87a1f",
      "commitAuthorOld": "Jing Zhao",
      "daysBetweenCommits": 36.07,
      "commitsBetweenForRepo": 375,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,6 +1,7 @@\n         public void process(INode inode) {\n           if (inode !\u003d null) {\n             inode.computeQuotaUsage(bsps, counts, false);\n-            inode.destroyAndCollectBlocks(bsps, collectedBlocks, removedINodes);\n+            inode.destroyAndCollectBlocks(bsps, collectedBlocks, removedINodes,\n+                                          null);\n           }\n         }\n\\ No newline at end of file\n",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            inode.computeQuotaUsage(bsps, counts, false);\n            inode.destroyAndCollectBlocks(bsps, collectedBlocks, removedINodes,\n                                          null);\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/DirectoryWithSnapshotFeature.java",
      "extendedDetails": {}
    },
    "5dae97a584d30cef3e34141edfaca49c4ec57913": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-7723. Quota By Storage Type namenode implemenation. (Contributed by Xiaoyu Yao)\n",
      "commitDate": "11/02/15 10:41 AM",
      "commitName": "5dae97a584d30cef3e34141edfaca49c4ec57913",
      "commitAuthor": "Arpit Agarwal",
      "commitDateOld": "02/02/15 4:32 PM",
      "commitNameOld": "8cb473124c1cf1c6f68ead7bde06558ebf7ce47e",
      "commitAuthorOld": "Haohui Mai",
      "daysBetweenCommits": 8.76,
      "commitsBetweenForRepo": 109,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,6 +1,6 @@\n         public void process(INode inode) {\n           if (inode !\u003d null) {\n-            inode.computeQuotaUsage(counts, false);\n-            inode.destroyAndCollectBlocks(collectedBlocks, removedINodes);\n+            inode.computeQuotaUsage(bsps, counts, false);\n+            inode.destroyAndCollectBlocks(bsps, collectedBlocks, removedINodes);\n           }\n         }\n\\ No newline at end of file\n",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            inode.computeQuotaUsage(bsps, counts, false);\n            inode.destroyAndCollectBlocks(bsps, collectedBlocks, removedINodes);\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/DirectoryWithSnapshotFeature.java",
      "extendedDetails": {}
    },
    "44a6560b5da3f79d2299579a36e7a2a60a91f823": {
      "type": "Yfilerename",
      "commitMessage": "HDFS-5632. Flatten INodeDirectory hierarchy: Replace INodeDirectoryWithSnapshot with DirectoryWithSnapshotFeature.  Contributed by jing9 \n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1550917 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "14/12/13 2:13 AM",
      "commitName": "44a6560b5da3f79d2299579a36e7a2a60a91f823",
      "commitAuthor": "Tsz-wo Sze",
      "commitDateOld": "13/12/13 6:00 PM",
      "commitNameOld": "d63cfdbf1a5389acb27e8cd61f4c14d8eaedb26f",
      "commitAuthorOld": "Zhijie Shen",
      "daysBetweenCommits": 0.34,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            inode.computeQuotaUsage(counts, false);\n            inode.destroyAndCollectBlocks(collectedBlocks, removedINodes);\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/DirectoryWithSnapshotFeature.java",
      "extendedDetails": {
        "oldPath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
        "newPath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/DirectoryWithSnapshotFeature.java"
      }
    },
    "72d783374c1e302492d7ce537222b563241038bb": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4791. Update and fix deletion of reference inode.  Contributed by Jing Zhao\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1479198 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "04/05/13 3:10 PM",
      "commitName": "72d783374c1e302492d7ce537222b563241038bb",
      "commitAuthor": "Tsz-wo Sze",
      "commitDateOld": "30/04/13 2:05 PM",
      "commitNameOld": "3a3e0f573129c8308332d4b301a9319ee579d85a",
      "commitAuthorOld": "Tsz-wo Sze",
      "daysBetweenCommits": 4.05,
      "commitsBetweenForRepo": 5,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,36 +1,6 @@\n         public void process(INode inode) {\n           if (inode !\u003d null) {\n             inode.computeQuotaUsage(counts, false);\n             inode.destroyAndCollectBlocks(collectedBlocks, removedINodes);\n-\n-            boolean handleRef \u003d false;\n-            if (inode.isReference()) {\n-              INodeReference.WithCount wc \u003d (INodeReference.WithCount) inode\n-                  .asReference().getReferredINode();\n-              if (wc.getReferenceCount() \u003e 0) {\n-                handleRef \u003d true;\n-              }\n-            }\n-\n-            if (handleRef) {\n-              final Snapshot postSnapshot \u003d posterior.snapshot;\n-              if (inode instanceof INodeReference.DstReference) {\n-                // we are handling a reference node and its subtree stored in\n-                // the created list of a snapshot diff, which must be associated\n-                // with the latest snapshot of the dst tree before the rename \n-                // operation.\n-                destroyDstSnapshot(inode, postSnapshot, null, collectedBlocks,\n-                    removedINodes);\n-              } else if (inode instanceof INodeReference.WithName) {\n-                // the inode should be renamed again. We only need to delete\n-                // postSnapshot in its subtree.\n-                try {\n-                  inode.cleanSubtree(postSnapshot, null, collectedBlocks,\n-                      removedINodes);\n-                } catch (QuotaExceededException e) {\n-                  LOG.error(\"Error: should not throw QuotaExceededException\", e);\n-                }\n-              }\n-            }\n           }\n         }\n\\ No newline at end of file\n",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            inode.computeQuotaUsage(counts, false);\n            inode.destroyAndCollectBlocks(collectedBlocks, removedINodes);\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
      "extendedDetails": {}
    },
    "0fa5cad0b27780c27a284c23101b1099d4886506": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4686. Update quota computation for rename and INodeReference.  Contributed by Jing Zhao\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1471647 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "24/04/13 1:31 PM",
      "commitName": "0fa5cad0b27780c27a284c23101b1099d4886506",
      "commitAuthor": "Tsz-wo Sze",
      "commitDateOld": "23/04/13 7:11 PM",
      "commitNameOld": "3a812e9f3ae66cfa525faceb5af9085a4cc37232",
      "commitAuthorOld": "Tsz-wo Sze",
      "daysBetweenCommits": 0.76,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,25 +1,36 @@\n         public void process(INode inode) {\n           if (inode !\u003d null) {\n-            if (INodeReference.tryRemoveReference(inode) \u003c\u003d 0) {\n-              inode.computeQuotaUsage(counts, false);\n-              inode.destroyAndCollectBlocks(collectedBlocks, removedINodes);\n-            } else {\n-              // if the node is a reference node, we should continue the \n-              // snapshot deletion process\n-              try {\n-                // use null as prior here because we are handling a reference\n-                // node stored in the created list of a snapshot diff. This \n-                // snapshot diff must be associated with the latest snapshot of\n-                // the dst tree before the rename operation. In this scenario,\n-                // the prior snapshot should be the one created in the src tree,\n-                // and it can be identified by the cleanSubtree since we call\n-                // recordModification before the rename.\n-                counts.add(inode.cleanSubtree(posterior.snapshot, null,\n-                    collectedBlocks, removedINodes));\n-              } catch (QuotaExceededException e) {\n-                String error \u003d \"should not have QuotaExceededException while deleting snapshot\";\n-                LOG.error(error, e);\n+            inode.computeQuotaUsage(counts, false);\n+            inode.destroyAndCollectBlocks(collectedBlocks, removedINodes);\n+\n+            boolean handleRef \u003d false;\n+            if (inode.isReference()) {\n+              INodeReference.WithCount wc \u003d (INodeReference.WithCount) inode\n+                  .asReference().getReferredINode();\n+              if (wc.getReferenceCount() \u003e 0) {\n+                handleRef \u003d true;\n+              }\n+            }\n+\n+            if (handleRef) {\n+              final Snapshot postSnapshot \u003d posterior.snapshot;\n+              if (inode instanceof INodeReference.DstReference) {\n+                // we are handling a reference node and its subtree stored in\n+                // the created list of a snapshot diff, which must be associated\n+                // with the latest snapshot of the dst tree before the rename \n+                // operation.\n+                destroyDstSnapshot(inode, postSnapshot, null, collectedBlocks,\n+                    removedINodes);\n+              } else if (inode instanceof INodeReference.WithName) {\n+                // the inode should be renamed again. We only need to delete\n+                // postSnapshot in its subtree.\n+                try {\n+                  inode.cleanSubtree(postSnapshot, null, collectedBlocks,\n+                      removedINodes);\n+                } catch (QuotaExceededException e) {\n+                  LOG.error(\"Error: should not throw QuotaExceededException\", e);\n+                }\n               }\n             }\n           }\n         }\n\\ No newline at end of file\n",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            inode.computeQuotaUsage(counts, false);\n            inode.destroyAndCollectBlocks(collectedBlocks, removedINodes);\n\n            boolean handleRef \u003d false;\n            if (inode.isReference()) {\n              INodeReference.WithCount wc \u003d (INodeReference.WithCount) inode\n                  .asReference().getReferredINode();\n              if (wc.getReferenceCount() \u003e 0) {\n                handleRef \u003d true;\n              }\n            }\n\n            if (handleRef) {\n              final Snapshot postSnapshot \u003d posterior.snapshot;\n              if (inode instanceof INodeReference.DstReference) {\n                // we are handling a reference node and its subtree stored in\n                // the created list of a snapshot diff, which must be associated\n                // with the latest snapshot of the dst tree before the rename \n                // operation.\n                destroyDstSnapshot(inode, postSnapshot, null, collectedBlocks,\n                    removedINodes);\n              } else if (inode instanceof INodeReference.WithName) {\n                // the inode should be renamed again. We only need to delete\n                // postSnapshot in its subtree.\n                try {\n                  inode.cleanSubtree(postSnapshot, null, collectedBlocks,\n                      removedINodes);\n                } catch (QuotaExceededException e) {\n                  LOG.error(\"Error: should not throw QuotaExceededException\", e);\n                }\n              }\n            }\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
      "extendedDetails": {}
    },
    "92e0416ced279a910616985bf11fa3f8b1b1de9b": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4727. Update inodeMap after deleting files/directories/snapshots.  Contributed by Jing Zhao\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1470756 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "22/04/13 5:00 PM",
      "commitName": "92e0416ced279a910616985bf11fa3f8b1b1de9b",
      "commitAuthor": "Tsz-wo Sze",
      "commitDateOld": "22/04/13 3:13 PM",
      "commitNameOld": "43bdc22e9207a74678665de5f109dd7e56fe979a",
      "commitAuthorOld": "Tsz-wo Sze",
      "daysBetweenCommits": 0.07,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,25 +1,25 @@\n         public void process(INode inode) {\n           if (inode !\u003d null) {\n             if (INodeReference.tryRemoveReference(inode) \u003c\u003d 0) {\n               inode.computeQuotaUsage(counts, false);\n-              inode.destroyAndCollectBlocks(collectedBlocks);\n+              inode.destroyAndCollectBlocks(collectedBlocks, removedINodes);\n             } else {\n               // if the node is a reference node, we should continue the \n               // snapshot deletion process\n               try {\n                 // use null as prior here because we are handling a reference\n                 // node stored in the created list of a snapshot diff. This \n                 // snapshot diff must be associated with the latest snapshot of\n                 // the dst tree before the rename operation. In this scenario,\n                 // the prior snapshot should be the one created in the src tree,\n                 // and it can be identified by the cleanSubtree since we call\n                 // recordModification before the rename.\n                 counts.add(inode.cleanSubtree(posterior.snapshot, null,\n-                    collectedBlocks));\n+                    collectedBlocks, removedINodes));\n               } catch (QuotaExceededException e) {\n                 String error \u003d \"should not have QuotaExceededException while deleting snapshot\";\n                 LOG.error(error, e);\n               }\n             }\n           }\n         }\n\\ No newline at end of file\n",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            if (INodeReference.tryRemoveReference(inode) \u003c\u003d 0) {\n              inode.computeQuotaUsage(counts, false);\n              inode.destroyAndCollectBlocks(collectedBlocks, removedINodes);\n            } else {\n              // if the node is a reference node, we should continue the \n              // snapshot deletion process\n              try {\n                // use null as prior here because we are handling a reference\n                // node stored in the created list of a snapshot diff. This \n                // snapshot diff must be associated with the latest snapshot of\n                // the dst tree before the rename operation. In this scenario,\n                // the prior snapshot should be the one created in the src tree,\n                // and it can be identified by the cleanSubtree since we call\n                // recordModification before the rename.\n                counts.add(inode.cleanSubtree(posterior.snapshot, null,\n                    collectedBlocks, removedINodes));\n              } catch (QuotaExceededException e) {\n                String error \u003d \"should not have QuotaExceededException while deleting snapshot\";\n                LOG.error(error, e);\n              }\n            }\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
      "extendedDetails": {}
    },
    "9c6a7bebe23ffb85d7fd95607f3b7bb4fe82dbe4": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4675. Fix rename across snapshottable directories.  Contributed by Jing Zhao\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1467540 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "12/04/13 7:48 PM",
      "commitName": "9c6a7bebe23ffb85d7fd95607f3b7bb4fe82dbe4",
      "commitAuthor": "Tsz-wo Sze",
      "commitDateOld": "04/04/13 4:52 PM",
      "commitNameOld": "ca848beb533790ae8abb6498f5d4676594fbae4c",
      "commitAuthorOld": "Tsz-wo Sze",
      "daysBetweenCommits": 8.12,
      "commitsBetweenForRepo": 24,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,8 +1,25 @@\n         public void process(INode inode) {\n           if (inode !\u003d null) {\n             if (INodeReference.tryRemoveReference(inode) \u003c\u003d 0) {\n               inode.computeQuotaUsage(counts, false);\n               inode.destroyAndCollectBlocks(collectedBlocks);\n+            } else {\n+              // if the node is a reference node, we should continue the \n+              // snapshot deletion process\n+              try {\n+                // use null as prior here because we are handling a reference\n+                // node stored in the created list of a snapshot diff. This \n+                // snapshot diff must be associated with the latest snapshot of\n+                // the dst tree before the rename operation. In this scenario,\n+                // the prior snapshot should be the one created in the src tree,\n+                // and it can be identified by the cleanSubtree since we call\n+                // recordModification before the rename.\n+                counts.add(inode.cleanSubtree(posterior.snapshot, null,\n+                    collectedBlocks));\n+              } catch (QuotaExceededException e) {\n+                String error \u003d \"should not have QuotaExceededException while deleting snapshot\";\n+                LOG.error(error, e);\n+              }\n             }\n           }\n         }\n\\ No newline at end of file\n",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            if (INodeReference.tryRemoveReference(inode) \u003c\u003d 0) {\n              inode.computeQuotaUsage(counts, false);\n              inode.destroyAndCollectBlocks(collectedBlocks);\n            } else {\n              // if the node is a reference node, we should continue the \n              // snapshot deletion process\n              try {\n                // use null as prior here because we are handling a reference\n                // node stored in the created list of a snapshot diff. This \n                // snapshot diff must be associated with the latest snapshot of\n                // the dst tree before the rename operation. In this scenario,\n                // the prior snapshot should be the one created in the src tree,\n                // and it can be identified by the cleanSubtree since we call\n                // recordModification before the rename.\n                counts.add(inode.cleanSubtree(posterior.snapshot, null,\n                    collectedBlocks));\n              } catch (QuotaExceededException e) {\n                String error \u003d \"should not have QuotaExceededException while deleting snapshot\";\n                LOG.error(error, e);\n              }\n            }\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
      "extendedDetails": {}
    },
    "9701555899315c94584b24d8717c1d7540a4a491": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4534. Add INodeReference in order to support rename with snapshots.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1458164 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "18/03/13 11:27 PM",
      "commitName": "9701555899315c94584b24d8717c1d7540a4a491",
      "commitAuthor": "Tsz-wo Sze",
      "commitDateOld": "11/03/13 7:41 PM",
      "commitNameOld": "3b3ea5c4220e674064c7603a449f63904c10bac1",
      "commitAuthorOld": "Tsz-wo Sze",
      "daysBetweenCommits": 7.16,
      "commitsBetweenForRepo": 42,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,6 +1,8 @@\n         public void process(INode inode) {\n           if (inode !\u003d null) {\n-            inode.computeQuotaUsage(counts, false);\n-            inode.destroyAndCollectBlocks(collectedBlocks);\n+            if (INodeReference.tryRemoveReference(inode) \u003c\u003d 0) {\n+              inode.computeQuotaUsage(counts, false);\n+              inode.destroyAndCollectBlocks(collectedBlocks);\n+            }\n           }\n         }\n\\ No newline at end of file\n",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            if (INodeReference.tryRemoveReference(inode) \u003c\u003d 0) {\n              inode.computeQuotaUsage(counts, false);\n              inode.destroyAndCollectBlocks(collectedBlocks);\n            }\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
      "extendedDetails": {}
    },
    "3b3ea5c4220e674064c7603a449f63904c10bac1": {
      "type": "Ymultichange(Yreturntypechange,Ybodychange)",
      "commitMessage": "HDFS-4563. Update namespace/diskspace usage after deleting snapshots.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1455396 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "11/03/13 7:41 PM",
      "commitName": "3b3ea5c4220e674064c7603a449f63904c10bac1",
      "commitAuthor": "Tsz-wo Sze",
      "subchanges": [
        {
          "type": "Yreturntypechange",
          "commitMessage": "HDFS-4563. Update namespace/diskspace usage after deleting snapshots.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1455396 13f79535-47bb-0310-9956-ffa450edef68\n",
          "commitDate": "11/03/13 7:41 PM",
          "commitName": "3b3ea5c4220e674064c7603a449f63904c10bac1",
          "commitAuthor": "Tsz-wo Sze",
          "commitDateOld": "10/03/13 8:45 PM",
          "commitNameOld": "43f8d0b9c9e209eb503451613c2f8d3fed07c203",
          "commitAuthorOld": "Tsz-wo Sze",
          "daysBetweenCommits": 0.96,
          "commitsBetweenForRepo": 4,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,6 +1,6 @@\n-        public int process(INode inode) {\n+        public void process(INode inode) {\n           if (inode !\u003d null) {\n-            return inode.destroyAndCollectBlocks(collectedBlocks);\n+            inode.computeQuotaUsage(counts, false);\n+            inode.destroyAndCollectBlocks(collectedBlocks);\n           }\n-          return 0;\n         }\n\\ No newline at end of file\n",
          "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            inode.computeQuotaUsage(counts, false);\n            inode.destroyAndCollectBlocks(collectedBlocks);\n          }\n        }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
          "extendedDetails": {
            "oldValue": "int",
            "newValue": "void"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-4563. Update namespace/diskspace usage after deleting snapshots.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1455396 13f79535-47bb-0310-9956-ffa450edef68\n",
          "commitDate": "11/03/13 7:41 PM",
          "commitName": "3b3ea5c4220e674064c7603a449f63904c10bac1",
          "commitAuthor": "Tsz-wo Sze",
          "commitDateOld": "10/03/13 8:45 PM",
          "commitNameOld": "43f8d0b9c9e209eb503451613c2f8d3fed07c203",
          "commitAuthorOld": "Tsz-wo Sze",
          "daysBetweenCommits": 0.96,
          "commitsBetweenForRepo": 4,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,6 +1,6 @@\n-        public int process(INode inode) {\n+        public void process(INode inode) {\n           if (inode !\u003d null) {\n-            return inode.destroyAndCollectBlocks(collectedBlocks);\n+            inode.computeQuotaUsage(counts, false);\n+            inode.destroyAndCollectBlocks(collectedBlocks);\n           }\n-          return 0;\n         }\n\\ No newline at end of file\n",
          "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            inode.computeQuotaUsage(counts, false);\n            inode.destroyAndCollectBlocks(collectedBlocks);\n          }\n        }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
          "extendedDetails": {}
        }
      ]
    },
    "f29fa9e820e25730d00a1a00c51c6f11028fb5a7": {
      "type": "Ymultichange(Yreturntypechange,Ybodychange)",
      "commitMessage": "HDFS-4499. Fix file/directory/snapshot deletion for file diff.  Contributed by Jing Zhao\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1448504 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "20/02/13 7:27 PM",
      "commitName": "f29fa9e820e25730d00a1a00c51c6f11028fb5a7",
      "commitAuthor": "Tsz-wo Sze",
      "subchanges": [
        {
          "type": "Yreturntypechange",
          "commitMessage": "HDFS-4499. Fix file/directory/snapshot deletion for file diff.  Contributed by Jing Zhao\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1448504 13f79535-47bb-0310-9956-ffa450edef68\n",
          "commitDate": "20/02/13 7:27 PM",
          "commitName": "f29fa9e820e25730d00a1a00c51c6f11028fb5a7",
          "commitAuthor": "Tsz-wo Sze",
          "commitDateOld": "20/02/13 12:02 PM",
          "commitNameOld": "fac3883188d9c4f1fe188d98f88cb3c83b243bbd",
          "commitAuthorOld": "Tsz-wo Sze",
          "daysBetweenCommits": 0.31,
          "commitsBetweenForRepo": 1,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,6 +1,6 @@\n-        public void process(INode inode) {\n+        public int process(INode inode) {\n           if (inode !\u003d null) {\n-            inode.destroySubtreeAndCollectBlocks(posterior.snapshot,\n-                collectedBlocks);\n+            return inode.destroyAndCollectBlocks(collectedBlocks);\n           }\n+          return 0;\n         }\n\\ No newline at end of file\n",
          "actualSource": "        public int process(INode inode) {\n          if (inode !\u003d null) {\n            return inode.destroyAndCollectBlocks(collectedBlocks);\n          }\n          return 0;\n        }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
          "extendedDetails": {
            "oldValue": "void",
            "newValue": "int"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-4499. Fix file/directory/snapshot deletion for file diff.  Contributed by Jing Zhao\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1448504 13f79535-47bb-0310-9956-ffa450edef68\n",
          "commitDate": "20/02/13 7:27 PM",
          "commitName": "f29fa9e820e25730d00a1a00c51c6f11028fb5a7",
          "commitAuthor": "Tsz-wo Sze",
          "commitDateOld": "20/02/13 12:02 PM",
          "commitNameOld": "fac3883188d9c4f1fe188d98f88cb3c83b243bbd",
          "commitAuthorOld": "Tsz-wo Sze",
          "daysBetweenCommits": 0.31,
          "commitsBetweenForRepo": 1,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,6 +1,6 @@\n-        public void process(INode inode) {\n+        public int process(INode inode) {\n           if (inode !\u003d null) {\n-            inode.destroySubtreeAndCollectBlocks(posterior.snapshot,\n-                collectedBlocks);\n+            return inode.destroyAndCollectBlocks(collectedBlocks);\n           }\n+          return 0;\n         }\n\\ No newline at end of file\n",
          "actualSource": "        public int process(INode inode) {\n          if (inode !\u003d null) {\n            return inode.destroyAndCollectBlocks(collectedBlocks);\n          }\n          return 0;\n        }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
          "extendedDetails": {}
        }
      ]
    },
    "02e6b72ae148fc8c2ba02ef624536b9e48997b31": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4481. Change fsimage to support snapshot file diffs.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1446000 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "13/02/13 4:43 PM",
      "commitName": "02e6b72ae148fc8c2ba02ef624536b9e48997b31",
      "commitAuthor": "Tsz-wo Sze",
      "commitDateOld": "08/02/13 3:19 PM",
      "commitNameOld": "afe77ce53d3cf203690aa419e377f26cbd45a96e",
      "commitAuthorOld": "Tsz-wo Sze",
      "daysBetweenCommits": 5.06,
      "commitsBetweenForRepo": 2,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,6 +1,6 @@\n         public void process(INode inode) {\n-          if (inode !\u003d null \u0026\u0026 inode instanceof INodeFile) {\n-            ((INodeFile)inode).destroySubtreeAndCollectBlocks(null,\n+          if (inode !\u003d null) {\n+            inode.destroySubtreeAndCollectBlocks(posterior.snapshot,\n                 collectedBlocks);\n           }\n         }\n\\ No newline at end of file\n",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null) {\n            inode.destroySubtreeAndCollectBlocks(posterior.snapshot,\n                collectedBlocks);\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
      "extendedDetails": {}
    },
    "e7db60fbfcc222b32d610ffd912683494674ad2f": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4464. Combine collectSubtreeBlocksAndClear with deleteDiffsForSnapshot and rename it to destroySubtreeAndCollectBlocks.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1441680 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "01/02/13 5:53 PM",
      "commitName": "e7db60fbfcc222b32d610ffd912683494674ad2f",
      "commitAuthor": "Tsz-wo Sze",
      "commitDateOld": "29/01/13 3:25 PM",
      "commitNameOld": "6f4fe09687f9d13e3e552eaaa012399a5bf246d3",
      "commitAuthorOld": "Tsz-wo Sze",
      "daysBetweenCommits": 3.1,
      "commitsBetweenForRepo": 16,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,5 +1,6 @@\n         public void process(INode inode) {\n           if (inode !\u003d null \u0026\u0026 inode instanceof INodeFile) {\n-            ((INodeFile)inode).collectSubtreeBlocksAndClear(collectedBlocks);\n+            ((INodeFile)inode).destroySubtreeAndCollectBlocks(null,\n+                collectedBlocks);\n           }\n         }\n\\ No newline at end of file\n",
      "actualSource": "        public void process(INode inode) {\n          if (inode !\u003d null \u0026\u0026 inode instanceof INodeFile) {\n            ((INodeFile)inode).destroySubtreeAndCollectBlocks(null,\n                collectedBlocks);\n          }\n        }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java",
      "extendedDetails": {}
    },
    "00d318378e4b43d36be91b29ae3ef8a879a81e1e": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-4397. Fix a bug in INodeDirectoryWithSnapshot.Diff.combinePostDiff(..) that it may put the wrong node into the deleted list.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1433293 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "14/01/13 10:20 PM",
      "commitName": "00d318378e4b43d36be91b29ae3ef8a879a81e1e",
      "commitAuthor": "Tsz-wo Sze",
      "diff": "@@ -0,0 +1,5 @@\n+          public void process(INode inode) {\n+            if (inode !\u003d null \u0026\u0026 inode instanceof INodeFile) {\n+              ((INodeFile)inode).collectSubtreeBlocksAndClear(collectedBlocks);\n+            }\n+          }\n\\ No newline at end of file\n",
      "actualSource": "          public void process(INode inode) {\n            if (inode !\u003d null \u0026\u0026 inode instanceof INodeFile) {\n              ((INodeFile)inode).collectSubtreeBlocksAndClear(collectedBlocks);\n            }\n          }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/INodeDirectoryWithSnapshot.java"
    }
  }
}