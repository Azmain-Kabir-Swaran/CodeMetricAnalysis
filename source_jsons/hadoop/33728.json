{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "RuncContainerRuntime.java",
  "functionName": "getLocalResources",
  "functionId": "getLocalResources___container-Container",
  "sourceFilePath": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/linux/runtime/RuncContainerRuntime.java",
  "functionStartLine": 565,
  "functionEndLine": 603,
  "numCommitsSeen": 1,
  "timeTaken": 1401,
  "changeHistory": [
    "0e22e9ab83438af37d821cb2f96e31f9a19ace2c"
  ],
  "changeHistoryShort": {
    "0e22e9ab83438af37d821cb2f96e31f9a19ace2c": "Yintroduced"
  },
  "changeHistoryDetails": {
    "0e22e9ab83438af37d821cb2f96e31f9a19ace2c": {
      "type": "Yintroduced",
      "commitMessage": "YARN-9562. Add Java changes for the new RuncContainerRuntime. Contributed by Eric Badger\n",
      "commitDate": "18/11/19 1:56 PM",
      "commitName": "0e22e9ab83438af37d821cb2f96e31f9a19ace2c",
      "commitAuthor": "Eric Badger",
      "diff": "@@ -0,0 +1,39 @@\n+  public Map\u003cString, LocalResource\u003e getLocalResources(\n+      Container container) throws IOException {\n+    Map\u003cString, LocalResource\u003e containerLocalRsrc \u003d\n+        container.getLaunchContext().getLocalResources();\n+    long layerCount \u003d 0;\n+    Map\u003cString, String\u003e environment \u003d\n+        container.getLaunchContext().getEnvironment();\n+    String imageName \u003d environment.get(ENV_RUNC_CONTAINER_IMAGE);\n+    if (imageName \u003d\u003d null || imageName.isEmpty()) {\n+      environment.put(ENV_RUNC_CONTAINER_IMAGE,\n+          defaultRuncImage);\n+      imageName \u003d defaultRuncImage;\n+    }\n+\n+    ImageManifest manifest \u003d\n+        imageTagToManifestPlugin.getManifestFromImageTag(imageName);\n+    LocalResource config \u003d\n+        manifestToResourcesPlugin.getConfigResource(manifest);\n+    List\u003cLocalResource\u003e layers \u003d\n+        manifestToResourcesPlugin.getLayerResources(manifest);\n+\n+    RuncRuntimeObject runcRuntimeObject \u003d\n+        new RuncRuntimeObject(config, layers);\n+    container.setContainerRuntimeData(runcRuntimeObject);\n+\n+    for (LocalResource localRsrc : layers) {\n+      while(containerLocalRsrc.putIfAbsent(\"runc-layer\" +\n+          Long.toString(layerCount), localRsrc) !\u003d null) {\n+        layerCount++;\n+      }\n+    }\n+\n+    while(containerLocalRsrc.putIfAbsent(\"runc-config\" +\n+      Long.toString(layerCount), config) !\u003d null) {\n+      layerCount++;\n+    }\n+\n+    return containerLocalRsrc;\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public Map\u003cString, LocalResource\u003e getLocalResources(\n      Container container) throws IOException {\n    Map\u003cString, LocalResource\u003e containerLocalRsrc \u003d\n        container.getLaunchContext().getLocalResources();\n    long layerCount \u003d 0;\n    Map\u003cString, String\u003e environment \u003d\n        container.getLaunchContext().getEnvironment();\n    String imageName \u003d environment.get(ENV_RUNC_CONTAINER_IMAGE);\n    if (imageName \u003d\u003d null || imageName.isEmpty()) {\n      environment.put(ENV_RUNC_CONTAINER_IMAGE,\n          defaultRuncImage);\n      imageName \u003d defaultRuncImage;\n    }\n\n    ImageManifest manifest \u003d\n        imageTagToManifestPlugin.getManifestFromImageTag(imageName);\n    LocalResource config \u003d\n        manifestToResourcesPlugin.getConfigResource(manifest);\n    List\u003cLocalResource\u003e layers \u003d\n        manifestToResourcesPlugin.getLayerResources(manifest);\n\n    RuncRuntimeObject runcRuntimeObject \u003d\n        new RuncRuntimeObject(config, layers);\n    container.setContainerRuntimeData(runcRuntimeObject);\n\n    for (LocalResource localRsrc : layers) {\n      while(containerLocalRsrc.putIfAbsent(\"runc-layer\" +\n          Long.toString(layerCount), localRsrc) !\u003d null) {\n        layerCount++;\n      }\n    }\n\n    while(containerLocalRsrc.putIfAbsent(\"runc-config\" +\n      Long.toString(layerCount), config) !\u003d null) {\n      layerCount++;\n    }\n\n    return containerLocalRsrc;\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/linux/runtime/RuncContainerRuntime.java"
    }
  }
}