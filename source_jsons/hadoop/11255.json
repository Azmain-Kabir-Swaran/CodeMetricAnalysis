{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "BPOfferService.java",
  "functionName": "shutdownActor",
  "functionId": "shutdownActor___actor-BPServiceActor",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BPOfferService.java",
  "functionStartLine": 465,
  "functionEndLine": 480,
  "numCommitsSeen": 87,
  "timeTaken": 1957,
  "changeHistory": [
    "07860b1c9ee3e1d77d39a52d41c3243fdcc10c45",
    "6c0ccb5989c2053f5a1ebab0dd9fdb7b4019fda8",
    "978a8050e28b2afb193a3e00d82a8475fa4d2428"
  ],
  "changeHistoryShort": {
    "07860b1c9ee3e1d77d39a52d41c3243fdcc10c45": "Ymultichange(Ymodifierchange,Ybodychange)",
    "6c0ccb5989c2053f5a1ebab0dd9fdb7b4019fda8": "Ybodychange",
    "978a8050e28b2afb193a3e00d82a8475fa4d2428": "Ybodychange"
  },
  "changeHistoryDetails": {
    "07860b1c9ee3e1d77d39a52d41c3243fdcc10c45": {
      "type": "Ymultichange(Ymodifierchange,Ybodychange)",
      "commitMessage": "HDFS-6788. Improve synchronization in BPOfferService with read write lock. Contributed by Yongjun Zhang.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1615190 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "01/08/14 11:56 AM",
      "commitName": "07860b1c9ee3e1d77d39a52d41c3243fdcc10c45",
      "commitAuthor": "Andrew Wang",
      "subchanges": [
        {
          "type": "Ymodifierchange",
          "commitMessage": "HDFS-6788. Improve synchronization in BPOfferService with read write lock. Contributed by Yongjun Zhang.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1615190 13f79535-47bb-0310-9956-ffa450edef68\n",
          "commitDate": "01/08/14 11:56 AM",
          "commitName": "07860b1c9ee3e1d77d39a52d41c3243fdcc10c45",
          "commitAuthor": "Andrew Wang",
          "commitDateOld": "22/07/14 12:41 AM",
          "commitNameOld": "25b0e8471ed744578b2d8e3f0debe5477b268e54",
          "commitAuthorOld": "Tsz-wo Sze",
          "daysBetweenCommits": 10.47,
          "commitsBetweenForRepo": 80,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,11 +1,16 @@\n-  synchronized void shutdownActor(BPServiceActor actor) {\n-    if (bpServiceToActive \u003d\u003d actor) {\n-      bpServiceToActive \u003d null;\n-    }\n+  void shutdownActor(BPServiceActor actor) {\n+    writeLock();\n+    try {\n+      if (bpServiceToActive \u003d\u003d actor) {\n+        bpServiceToActive \u003d null;\n+      }\n \n-    bpServices.remove(actor);\n+      bpServices.remove(actor);\n \n-    if (bpServices.isEmpty()) {\n-      dn.shutdownBlockPool(this);\n+      if (bpServices.isEmpty()) {\n+        dn.shutdownBlockPool(this);\n+      }\n+    } finally {\n+      writeUnlock();\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  void shutdownActor(BPServiceActor actor) {\n    writeLock();\n    try {\n      if (bpServiceToActive \u003d\u003d actor) {\n        bpServiceToActive \u003d null;\n      }\n\n      bpServices.remove(actor);\n\n      if (bpServices.isEmpty()) {\n        dn.shutdownBlockPool(this);\n      }\n    } finally {\n      writeUnlock();\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BPOfferService.java",
          "extendedDetails": {
            "oldValue": "[synchronized]",
            "newValue": "[]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-6788. Improve synchronization in BPOfferService with read write lock. Contributed by Yongjun Zhang.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1615190 13f79535-47bb-0310-9956-ffa450edef68\n",
          "commitDate": "01/08/14 11:56 AM",
          "commitName": "07860b1c9ee3e1d77d39a52d41c3243fdcc10c45",
          "commitAuthor": "Andrew Wang",
          "commitDateOld": "22/07/14 12:41 AM",
          "commitNameOld": "25b0e8471ed744578b2d8e3f0debe5477b268e54",
          "commitAuthorOld": "Tsz-wo Sze",
          "daysBetweenCommits": 10.47,
          "commitsBetweenForRepo": 80,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,11 +1,16 @@\n-  synchronized void shutdownActor(BPServiceActor actor) {\n-    if (bpServiceToActive \u003d\u003d actor) {\n-      bpServiceToActive \u003d null;\n-    }\n+  void shutdownActor(BPServiceActor actor) {\n+    writeLock();\n+    try {\n+      if (bpServiceToActive \u003d\u003d actor) {\n+        bpServiceToActive \u003d null;\n+      }\n \n-    bpServices.remove(actor);\n+      bpServices.remove(actor);\n \n-    if (bpServices.isEmpty()) {\n-      dn.shutdownBlockPool(this);\n+      if (bpServices.isEmpty()) {\n+        dn.shutdownBlockPool(this);\n+      }\n+    } finally {\n+      writeUnlock();\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  void shutdownActor(BPServiceActor actor) {\n    writeLock();\n    try {\n      if (bpServiceToActive \u003d\u003d actor) {\n        bpServiceToActive \u003d null;\n      }\n\n      bpServices.remove(actor);\n\n      if (bpServices.isEmpty()) {\n        dn.shutdownBlockPool(this);\n      }\n    } finally {\n      writeUnlock();\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BPOfferService.java",
          "extendedDetails": {}
        }
      ]
    },
    "6c0ccb5989c2053f5a1ebab0dd9fdb7b4019fda8": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-2686. Remove DistributedUpgrade related code. Contributed by Suresh Srinivas\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1375800 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "21/08/12 2:18 PM",
      "commitName": "6c0ccb5989c2053f5a1ebab0dd9fdb7b4019fda8",
      "commitAuthor": "Suresh Srinivas",
      "commitDateOld": "06/07/12 11:59 AM",
      "commitNameOld": "fb95fce24056c0b0aa5b77683c684fe1b68c4f76",
      "commitAuthorOld": "Aaron Myers",
      "daysBetweenCommits": 46.1,
      "commitsBetweenForRepo": 262,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,14 +1,11 @@\n   synchronized void shutdownActor(BPServiceActor actor) {\n     if (bpServiceToActive \u003d\u003d actor) {\n       bpServiceToActive \u003d null;\n     }\n \n     bpServices.remove(actor);\n \n     if (bpServices.isEmpty()) {\n       dn.shutdownBlockPool(this);\n-      \n-      if(upgradeManager !\u003d null)\n-        upgradeManager.shutdownUpgrade();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  synchronized void shutdownActor(BPServiceActor actor) {\n    if (bpServiceToActive \u003d\u003d actor) {\n      bpServiceToActive \u003d null;\n    }\n\n    bpServices.remove(actor);\n\n    if (bpServices.isEmpty()) {\n      dn.shutdownBlockPool(this);\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BPOfferService.java",
      "extendedDetails": {}
    },
    "978a8050e28b2afb193a3e00d82a8475fa4d2428": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-2920. fix remaining TODO items. Contributed by Aaron T. Myers and Todd Lipcon.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1294923 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "28/02/12 5:09 PM",
      "commitName": "978a8050e28b2afb193a3e00d82a8475fa4d2428",
      "commitAuthor": "Aaron Myers",
      "commitDateOld": "13/02/12 1:00 PM",
      "commitNameOld": "db187cf40ee307524c48cededd58710a4dfb4812",
      "commitAuthorOld": "",
      "daysBetweenCommits": 15.17,
      "commitsBetweenForRepo": 110,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,15 +1,14 @@\n   synchronized void shutdownActor(BPServiceActor actor) {\n     if (bpServiceToActive \u003d\u003d actor) {\n       bpServiceToActive \u003d null;\n     }\n \n     bpServices.remove(actor);\n \n-    // TODO: synchronization should be a little better here\n     if (bpServices.isEmpty()) {\n       dn.shutdownBlockPool(this);\n       \n       if(upgradeManager !\u003d null)\n         upgradeManager.shutdownUpgrade();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  synchronized void shutdownActor(BPServiceActor actor) {\n    if (bpServiceToActive \u003d\u003d actor) {\n      bpServiceToActive \u003d null;\n    }\n\n    bpServices.remove(actor);\n\n    if (bpServices.isEmpty()) {\n      dn.shutdownBlockPool(this);\n      \n      if(upgradeManager !\u003d null)\n        upgradeManager.shutdownUpgrade();\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BPOfferService.java",
      "extendedDetails": {}
    }
  }
}