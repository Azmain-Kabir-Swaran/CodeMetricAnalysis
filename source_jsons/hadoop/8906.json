{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "EditLogFileOutputStream.java",
  "functionName": "preallocate",
  "functionId": "preallocate",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java",
  "functionStartLine": 220,
  "functionEndLine": 242,
  "numCommitsSeen": 32,
  "timeTaken": 5330,
  "changeHistory": [
    "18312804e9c86c0ea6a259e288994fea6fa366ef",
    "19dd66a3f616cd8a4527f2adeef911a7d4b3f349",
    "07b85844311b8b01e2edd2ceca8438b30d2872cd",
    "797c8548d054c8dd939a52ea51bde688a2507ad0",
    "6e3ebf4d73f7cc3e49e749d0e79f74a4c6e1bac4",
    "cd7157784e5e5ddc4e77144d042e54dd0d04bac1",
    "d86f3183d93714ba078416af4f609d26376eadb0",
    "a196766ea07775f18ded69bd9e8d239f8cfd3ccc"
  ],
  "changeHistoryShort": {
    "18312804e9c86c0ea6a259e288994fea6fa366ef": "Ybodychange",
    "19dd66a3f616cd8a4527f2adeef911a7d4b3f349": "Ybodychange",
    "07b85844311b8b01e2edd2ceca8438b30d2872cd": "Ybodychange",
    "797c8548d054c8dd939a52ea51bde688a2507ad0": "Ybodychange",
    "6e3ebf4d73f7cc3e49e749d0e79f74a4c6e1bac4": "Ybodychange",
    "cd7157784e5e5ddc4e77144d042e54dd0d04bac1": "Yfilerename",
    "d86f3183d93714ba078416af4f609d26376eadb0": "Yfilerename",
    "a196766ea07775f18ded69bd9e8d239f8cfd3ccc": "Yintroduced"
  },
  "changeHistoryDetails": {
    "18312804e9c86c0ea6a259e288994fea6fa366ef": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-7357. FSNamesystem.checkFileProgress should log file path. Contributed by Tsz Wo Nicholas Sze.\n",
      "commitDate": "05/11/14 10:14 AM",
      "commitName": "18312804e9c86c0ea6a259e288994fea6fa366ef",
      "commitAuthor": "Haohui Mai",
      "commitDateOld": "24/03/14 4:32 PM",
      "commitNameOld": "c2ef7e239eb0e81cf8a3e971378e9e696202de67",
      "commitAuthorOld": "Arpit Agarwal",
      "daysBetweenCommits": 225.78,
      "commitsBetweenForRepo": 1835,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,23 +1,23 @@\n   private void preallocate() throws IOException {\n     long position \u003d fc.position();\n     long size \u003d fc.size();\n     int bufSize \u003d doubleBuf.getReadyBuf().getLength();\n     long need \u003d bufSize - (size - position);\n     if (need \u003c\u003d 0) {\n       return;\n     }\n     long oldSize \u003d size;\n     long total \u003d 0;\n     long fillCapacity \u003d fill.capacity();\n     while (need \u003e 0) {\n       fill.position(0);\n       IOUtils.writeFully(fc, fill, size);\n       need -\u003d fillCapacity;\n       size +\u003d fillCapacity;\n       total +\u003d fillCapacity;\n     }\n-    if(FSNamesystem.LOG.isDebugEnabled()) {\n-      FSNamesystem.LOG.debug(\"Preallocated \" + total + \" bytes at the end of \" +\n+    if(LOG.isDebugEnabled()) {\n+      LOG.debug(\"Preallocated \" + total + \" bytes at the end of \" +\n       \t\t\"the edit log (offset \" + oldSize + \")\");\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void preallocate() throws IOException {\n    long position \u003d fc.position();\n    long size \u003d fc.size();\n    int bufSize \u003d doubleBuf.getReadyBuf().getLength();\n    long need \u003d bufSize - (size - position);\n    if (need \u003c\u003d 0) {\n      return;\n    }\n    long oldSize \u003d size;\n    long total \u003d 0;\n    long fillCapacity \u003d fill.capacity();\n    while (need \u003e 0) {\n      fill.position(0);\n      IOUtils.writeFully(fc, fill, size);\n      need -\u003d fillCapacity;\n      size +\u003d fillCapacity;\n      total +\u003d fillCapacity;\n    }\n    if(LOG.isDebugEnabled()) {\n      LOG.debug(\"Preallocated \" + total + \" bytes at the end of \" +\n      \t\t\"the edit log (offset \" + oldSize + \")\");\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java",
      "extendedDetails": {}
    },
    "19dd66a3f616cd8a4527f2adeef911a7d4b3f349": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-3510.  Editlog pre-allocation is performed prior to writing edits to avoid partial edits case disk out of space. Contributed by Collin McCabe.\n        \n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1355189 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "28/06/12 4:00 PM",
      "commitName": "19dd66a3f616cd8a4527f2adeef911a7d4b3f349",
      "commitAuthor": "Suresh Srinivas",
      "commitDateOld": "12/06/12 7:42 PM",
      "commitNameOld": "07b85844311b8b01e2edd2ceca8438b30d2872cd",
      "commitAuthorOld": "Eli Collins",
      "daysBetweenCommits": 15.85,
      "commitsBetweenForRepo": 58,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,15 +1,23 @@\n   private void preallocate() throws IOException {\n     long position \u003d fc.position();\n-    if (position + 4096 \u003e\u003d fc.size()) {\n-      if(FSNamesystem.LOG.isDebugEnabled()) {\n-        FSNamesystem.LOG.debug(\"Preallocating Edit log, current size \"\n-            + fc.size());\n-      }\n+    long size \u003d fc.size();\n+    int bufSize \u003d doubleBuf.getReadyBuf().getLength();\n+    long need \u003d bufSize - (size - position);\n+    if (need \u003c\u003d 0) {\n+      return;\n+    }\n+    long oldSize \u003d size;\n+    long total \u003d 0;\n+    long fillCapacity \u003d fill.capacity();\n+    while (need \u003e 0) {\n       fill.position(0);\n-      IOUtils.writeFully(fc, fill, position);\n-      if(FSNamesystem.LOG.isDebugEnabled()) {\n-        FSNamesystem.LOG.debug(\"Edit log size is now \" + fc.size() +\n-            \" written \" + fill.capacity() + \" bytes \" + \" at offset \" + position);\n-      }\n+      IOUtils.writeFully(fc, fill, size);\n+      need -\u003d fillCapacity;\n+      size +\u003d fillCapacity;\n+      total +\u003d fillCapacity;\n+    }\n+    if(FSNamesystem.LOG.isDebugEnabled()) {\n+      FSNamesystem.LOG.debug(\"Preallocated \" + total + \" bytes at the end of \" +\n+      \t\t\"the edit log (offset \" + oldSize + \")\");\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void preallocate() throws IOException {\n    long position \u003d fc.position();\n    long size \u003d fc.size();\n    int bufSize \u003d doubleBuf.getReadyBuf().getLength();\n    long need \u003d bufSize - (size - position);\n    if (need \u003c\u003d 0) {\n      return;\n    }\n    long oldSize \u003d size;\n    long total \u003d 0;\n    long fillCapacity \u003d fill.capacity();\n    while (need \u003e 0) {\n      fill.position(0);\n      IOUtils.writeFully(fc, fill, size);\n      need -\u003d fillCapacity;\n      size +\u003d fillCapacity;\n      total +\u003d fillCapacity;\n    }\n    if(FSNamesystem.LOG.isDebugEnabled()) {\n      FSNamesystem.LOG.debug(\"Preallocated \" + total + \" bytes at the end of \" +\n      \t\t\"the edit log (offset \" + oldSize + \")\");\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java",
      "extendedDetails": {}
    },
    "07b85844311b8b01e2edd2ceca8438b30d2872cd": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-3531. EditLogFileOutputStream#preallocate should check for incomplete writes. Contributed by Colin Patrick McCabe\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1349616 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "12/06/12 7:42 PM",
      "commitName": "07b85844311b8b01e2edd2ceca8438b30d2872cd",
      "commitAuthor": "Eli Collins",
      "commitDateOld": "11/06/12 11:22 PM",
      "commitNameOld": "797c8548d054c8dd939a52ea51bde688a2507ad0",
      "commitAuthorOld": "Eli Collins",
      "daysBetweenCommits": 0.85,
      "commitsBetweenForRepo": 10,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,15 +1,15 @@\n   private void preallocate() throws IOException {\n     long position \u003d fc.position();\n     if (position + 4096 \u003e\u003d fc.size()) {\n       if(FSNamesystem.LOG.isDebugEnabled()) {\n         FSNamesystem.LOG.debug(\"Preallocating Edit log, current size \"\n             + fc.size());\n       }\n       fill.position(0);\n-      int written \u003d fc.write(fill, position);\n+      IOUtils.writeFully(fc, fill, position);\n       if(FSNamesystem.LOG.isDebugEnabled()) {\n         FSNamesystem.LOG.debug(\"Edit log size is now \" + fc.size() +\n-            \" written \" + written + \" bytes \" + \" at offset \" + position);\n+            \" written \" + fill.capacity() + \" bytes \" + \" at offset \" + position);\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void preallocate() throws IOException {\n    long position \u003d fc.position();\n    if (position + 4096 \u003e\u003d fc.size()) {\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Preallocating Edit log, current size \"\n            + fc.size());\n      }\n      fill.position(0);\n      IOUtils.writeFully(fc, fill, position);\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Edit log size is now \" + fc.size() +\n            \" written \" + fill.capacity() + \" bytes \" + \" at offset \" + position);\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java",
      "extendedDetails": {}
    },
    "797c8548d054c8dd939a52ea51bde688a2507ad0": {
      "type": "Ybodychange",
      "commitMessage": "Revert HADOOP-8491\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1349133 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "11/06/12 11:22 PM",
      "commitName": "797c8548d054c8dd939a52ea51bde688a2507ad0",
      "commitAuthor": "Eli Collins",
      "commitDateOld": "11/06/12 2:20 PM",
      "commitNameOld": "6e3ebf4d73f7cc3e49e749d0e79f74a4c6e1bac4",
      "commitAuthorOld": "Eli Collins",
      "daysBetweenCommits": 0.38,
      "commitsBetweenForRepo": 6,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,15 +1,15 @@\n   private void preallocate() throws IOException {\n     long position \u003d fc.position();\n     if (position + 4096 \u003e\u003d fc.size()) {\n       if(FSNamesystem.LOG.isDebugEnabled()) {\n         FSNamesystem.LOG.debug(\"Preallocating Edit log, current size \"\n             + fc.size());\n       }\n       fill.position(0);\n-      IOUtils.writeFully(fc, fill, position);\n+      int written \u003d fc.write(fill, position);\n       if(FSNamesystem.LOG.isDebugEnabled()) {\n         FSNamesystem.LOG.debug(\"Edit log size is now \" + fc.size() +\n-            \" written \" + fill.capacity() + \" bytes \" + \" at offset \" + position);\n+            \" written \" + written + \" bytes \" + \" at offset \" + position);\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void preallocate() throws IOException {\n    long position \u003d fc.position();\n    if (position + 4096 \u003e\u003d fc.size()) {\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Preallocating Edit log, current size \"\n            + fc.size());\n      }\n      fill.position(0);\n      int written \u003d fc.write(fill, position);\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Edit log size is now \" + fc.size() +\n            \" written \" + written + \" bytes \" + \" at offset \" + position);\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java",
      "extendedDetails": {}
    },
    "6e3ebf4d73f7cc3e49e749d0e79f74a4c6e1bac4": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-8491. Check for short writes when using FileChannel#write and related methods. Contributed by Colin Patrick McCabe\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1349019 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "11/06/12 2:20 PM",
      "commitName": "6e3ebf4d73f7cc3e49e749d0e79f74a4c6e1bac4",
      "commitAuthor": "Eli Collins",
      "commitDateOld": "14/05/12 5:41 PM",
      "commitNameOld": "95710c15b7a724897bcde826e112df6d4b4fe56b",
      "commitAuthorOld": "Todd Lipcon",
      "daysBetweenCommits": 27.86,
      "commitsBetweenForRepo": 130,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,15 +1,15 @@\n   private void preallocate() throws IOException {\n     long position \u003d fc.position();\n     if (position + 4096 \u003e\u003d fc.size()) {\n       if(FSNamesystem.LOG.isDebugEnabled()) {\n         FSNamesystem.LOG.debug(\"Preallocating Edit log, current size \"\n             + fc.size());\n       }\n       fill.position(0);\n-      int written \u003d fc.write(fill, position);\n+      IOUtils.writeFully(fc, fill, position);\n       if(FSNamesystem.LOG.isDebugEnabled()) {\n         FSNamesystem.LOG.debug(\"Edit log size is now \" + fc.size() +\n-            \" written \" + written + \" bytes \" + \" at offset \" + position);\n+            \" written \" + fill.capacity() + \" bytes \" + \" at offset \" + position);\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void preallocate() throws IOException {\n    long position \u003d fc.position();\n    if (position + 4096 \u003e\u003d fc.size()) {\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Preallocating Edit log, current size \"\n            + fc.size());\n      }\n      fill.position(0);\n      IOUtils.writeFully(fc, fill, position);\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Edit log size is now \" + fc.size() +\n            \" written \" + fill.capacity() + \" bytes \" + \" at offset \" + position);\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java",
      "extendedDetails": {}
    },
    "cd7157784e5e5ddc4e77144d042e54dd0d04bac1": {
      "type": "Yfilerename",
      "commitMessage": "HADOOP-7560. Change src layout to be heirarchical. Contributed by Alejandro Abdelnur.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1161332 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "24/08/11 5:14 PM",
      "commitName": "cd7157784e5e5ddc4e77144d042e54dd0d04bac1",
      "commitAuthor": "Arun Murthy",
      "commitDateOld": "24/08/11 5:06 PM",
      "commitNameOld": "bb0005cfec5fd2861600ff5babd259b48ba18b63",
      "commitAuthorOld": "Arun Murthy",
      "daysBetweenCommits": 0.01,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "",
      "actualSource": "  private void preallocate() throws IOException {\n    long position \u003d fc.position();\n    if (position + 4096 \u003e\u003d fc.size()) {\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Preallocating Edit log, current size \"\n            + fc.size());\n      }\n      fill.position(0);\n      int written \u003d fc.write(fill, position);\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Edit log size is now \" + fc.size() +\n            \" written \" + written + \" bytes \" + \" at offset \" + position);\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java",
      "extendedDetails": {
        "oldPath": "hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java",
        "newPath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java"
      }
    },
    "d86f3183d93714ba078416af4f609d26376eadb0": {
      "type": "Yfilerename",
      "commitMessage": "HDFS-2096. Mavenization of hadoop-hdfs. Contributed by Alejandro Abdelnur.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1159702 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "19/08/11 10:36 AM",
      "commitName": "d86f3183d93714ba078416af4f609d26376eadb0",
      "commitAuthor": "Thomas White",
      "commitDateOld": "19/08/11 10:26 AM",
      "commitNameOld": "6ee5a73e0e91a2ef27753a32c576835e951d8119",
      "commitAuthorOld": "Thomas White",
      "daysBetweenCommits": 0.01,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "",
      "actualSource": "  private void preallocate() throws IOException {\n    long position \u003d fc.position();\n    if (position + 4096 \u003e\u003d fc.size()) {\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Preallocating Edit log, current size \"\n            + fc.size());\n      }\n      fill.position(0);\n      int written \u003d fc.write(fill, position);\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Edit log size is now \" + fc.size() +\n            \" written \" + written + \" bytes \" + \" at offset \" + position);\n      }\n    }\n  }",
      "path": "hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java",
      "extendedDetails": {
        "oldPath": "hdfs/src/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java",
        "newPath": "hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java"
      }
    },
    "a196766ea07775f18ded69bd9e8d239f8cfd3ccc": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-7106. Reorganize SVN layout to combine HDFS, Common, and MR in a single tree (project unsplit)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1134994 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "12/06/11 3:00 PM",
      "commitName": "a196766ea07775f18ded69bd9e8d239f8cfd3ccc",
      "commitAuthor": "Todd Lipcon",
      "diff": "@@ -0,0 +1,15 @@\n+  private void preallocate() throws IOException {\n+    long position \u003d fc.position();\n+    if (position + 4096 \u003e\u003d fc.size()) {\n+      if(FSNamesystem.LOG.isDebugEnabled()) {\n+        FSNamesystem.LOG.debug(\"Preallocating Edit log, current size \"\n+            + fc.size());\n+      }\n+      fill.position(0);\n+      int written \u003d fc.write(fill, position);\n+      if(FSNamesystem.LOG.isDebugEnabled()) {\n+        FSNamesystem.LOG.debug(\"Edit log size is now \" + fc.size() +\n+            \" written \" + written + \" bytes \" + \" at offset \" + position);\n+      }\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  private void preallocate() throws IOException {\n    long position \u003d fc.position();\n    if (position + 4096 \u003e\u003d fc.size()) {\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Preallocating Edit log, current size \"\n            + fc.size());\n      }\n      fill.position(0);\n      int written \u003d fc.write(fill, position);\n      if(FSNamesystem.LOG.isDebugEnabled()) {\n        FSNamesystem.LOG.debug(\"Edit log size is now \" + fc.size() +\n            \" written \" + written + \" bytes \" + \" at offset \" + position);\n      }\n    }\n  }",
      "path": "hdfs/src/java/org/apache/hadoop/hdfs/server/namenode/EditLogFileOutputStream.java"
    }
  }
}