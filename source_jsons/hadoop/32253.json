{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "NodeManager.java",
  "functionName": "serviceStop",
  "functionId": "serviceStop",
  "sourceFilePath": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/NodeManager.java",
  "functionStartLine": 499,
  "functionEndLine": 521,
  "numCommitsSeen": 111,
  "timeTaken": 5095,
  "changeHistory": [
    "0e22e9ab83438af37d821cb2f96e31f9a19ace2c",
    "4530f4500d308c9cefbcc5990769c04bd061ad87",
    "fa5cfc68f37c78b6cf26ce13247b9ff34da806cd",
    "65f395226ba6cc3750a268a308e288b916f8df1e",
    "cfee02b3bdd1117370200c9d8ce216676cff8888",
    "711d77cc54a64b2c3db70bdacc6bf2245c896a4b",
    "66598697a6e777615334ebde5ba7738135da83ae",
    "d3841bd4997a77855ab2abd9cc294eae7d795a5b",
    "0928502029ef141759008997335ea2cd836a7154"
  ],
  "changeHistoryShort": {
    "0e22e9ab83438af37d821cb2f96e31f9a19ace2c": "Ybodychange",
    "4530f4500d308c9cefbcc5990769c04bd061ad87": "Ybodychange",
    "fa5cfc68f37c78b6cf26ce13247b9ff34da806cd": "Ybodychange",
    "65f395226ba6cc3750a268a308e288b916f8df1e": "Ybodychange",
    "cfee02b3bdd1117370200c9d8ce216676cff8888": "Ybodychange",
    "711d77cc54a64b2c3db70bdacc6bf2245c896a4b": "Ybodychange",
    "66598697a6e777615334ebde5ba7738135da83ae": "Ybodychange",
    "d3841bd4997a77855ab2abd9cc294eae7d795a5b": "Ybodychange",
    "0928502029ef141759008997335ea2cd836a7154": "Yintroduced"
  },
  "changeHistoryDetails": {
    "0e22e9ab83438af37d821cb2f96e31f9a19ace2c": {
      "type": "Ybodychange",
      "commitMessage": "YARN-9562. Add Java changes for the new RuncContainerRuntime. Contributed by Eric Badger\n",
      "commitDate": "18/11/19 1:56 PM",
      "commitName": "0e22e9ab83438af37d821cb2f96e31f9a19ace2c",
      "commitAuthor": "Eric Badger",
      "commitDateOld": "30/09/19 11:10 AM",
      "commitNameOld": "4d3c580b03475a6ec9323d11e6875c542f8e3f6d",
      "commitAuthorOld": "Abhishek Modi",
      "daysBetweenCommits": 49.16,
      "commitsBetweenForRepo": 238,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,21 +1,23 @@\n   protected void serviceStop() throws Exception {\n     if (isStopping.getAndSet(true)) {\n       return;\n     }\n     try {\n       super.serviceStop();\n       DefaultMetricsSystem.shutdown();\n \n-      // Cleanup ResourcePluginManager\n       if (null !\u003d context) {\n+        context.getContainerExecutor().stop();\n+\n+        // Cleanup ResourcePluginManager\n         ResourcePluginManager rpm \u003d context.getResourcePluginManager();\n         if (rpm !\u003d null) {\n           rpm.cleanup();\n         }\n       }\n     } finally {\n       // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n       // release of NMLevelDBStore.\n       stopRecoveryStore();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceStop() throws Exception {\n    if (isStopping.getAndSet(true)) {\n      return;\n    }\n    try {\n      super.serviceStop();\n      DefaultMetricsSystem.shutdown();\n\n      if (null !\u003d context) {\n        context.getContainerExecutor().stop();\n\n        // Cleanup ResourcePluginManager\n        ResourcePluginManager rpm \u003d context.getResourcePluginManager();\n        if (rpm !\u003d null) {\n          rpm.cleanup();\n        }\n      }\n    } finally {\n      // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n      // release of NMLevelDBStore.\n      stopRecoveryStore();\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/NodeManager.java",
      "extendedDetails": {}
    },
    "4530f4500d308c9cefbcc5990769c04bd061ad87": {
      "type": "Ybodychange",
      "commitMessage": "YARN-9507. Fix NPE in NodeManager#serviceStop on startup failure. Contributed by Bilwa S T.\n",
      "commitDate": "02/06/19 11:09 PM",
      "commitName": "4530f4500d308c9cefbcc5990769c04bd061ad87",
      "commitAuthor": "Weiwei Yang",
      "commitDateOld": "22/04/19 9:49 AM",
      "commitNameOld": "96e3027e46a953ca995e4b44ef50bc2a30c7e838",
      "commitAuthorOld": "Inigo Goiri",
      "daysBetweenCommits": 41.56,
      "commitsBetweenForRepo": 223,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,19 +1,21 @@\n   protected void serviceStop() throws Exception {\n     if (isStopping.getAndSet(true)) {\n       return;\n     }\n     try {\n       super.serviceStop();\n       DefaultMetricsSystem.shutdown();\n \n       // Cleanup ResourcePluginManager\n-      ResourcePluginManager rpm \u003d context.getResourcePluginManager();\n-      if (rpm !\u003d null) {\n-        rpm.cleanup();\n+      if (null !\u003d context) {\n+        ResourcePluginManager rpm \u003d context.getResourcePluginManager();\n+        if (rpm !\u003d null) {\n+          rpm.cleanup();\n+        }\n       }\n     } finally {\n       // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n       // release of NMLevelDBStore.\n       stopRecoveryStore();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceStop() throws Exception {\n    if (isStopping.getAndSet(true)) {\n      return;\n    }\n    try {\n      super.serviceStop();\n      DefaultMetricsSystem.shutdown();\n\n      // Cleanup ResourcePluginManager\n      if (null !\u003d context) {\n        ResourcePluginManager rpm \u003d context.getResourcePluginManager();\n        if (rpm !\u003d null) {\n          rpm.cleanup();\n        }\n      }\n    } finally {\n      // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n      // release of NMLevelDBStore.\n      stopRecoveryStore();\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/NodeManager.java",
      "extendedDetails": {}
    },
    "fa5cfc68f37c78b6cf26ce13247b9ff34da806cd": {
      "type": "Ybodychange",
      "commitMessage": "YARN-6620. Add support in NodeManager to isolate GPU devices by using CGroups. Contributed by Wangda Tan.\n",
      "commitDate": "11/10/17 11:14 AM",
      "commitName": "fa5cfc68f37c78b6cf26ce13247b9ff34da806cd",
      "commitAuthor": "Sunil G",
      "commitDateOld": "18/09/17 8:16 AM",
      "commitNameOld": "a4f9c7c9247801dd37beec6fc195622af1b884ad",
      "commitAuthorOld": "Jason Lowe",
      "daysBetweenCommits": 23.12,
      "commitsBetweenForRepo": 202,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,13 +1,19 @@\n   protected void serviceStop() throws Exception {\n     if (isStopping.getAndSet(true)) {\n       return;\n     }\n     try {\n       super.serviceStop();\n       DefaultMetricsSystem.shutdown();\n+\n+      // Cleanup ResourcePluginManager\n+      ResourcePluginManager rpm \u003d context.getResourcePluginManager();\n+      if (rpm !\u003d null) {\n+        rpm.cleanup();\n+      }\n     } finally {\n       // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n       // release of NMLevelDBStore.\n       stopRecoveryStore();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceStop() throws Exception {\n    if (isStopping.getAndSet(true)) {\n      return;\n    }\n    try {\n      super.serviceStop();\n      DefaultMetricsSystem.shutdown();\n\n      // Cleanup ResourcePluginManager\n      ResourcePluginManager rpm \u003d context.getResourcePluginManager();\n      if (rpm !\u003d null) {\n        rpm.cleanup();\n      }\n    } finally {\n      // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n      // release of NMLevelDBStore.\n      stopRecoveryStore();\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/NodeManager.java",
      "extendedDetails": {}
    },
    "65f395226ba6cc3750a268a308e288b916f8df1e": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-12321. Make JvmPauseMonitor an AbstractService. (Sunil G via Stevel) [includes HDFS-8947 MAPREDUCE-6462 and YARN-4072]\n",
      "commitDate": "06/12/15 9:43 AM",
      "commitName": "65f395226ba6cc3750a268a308e288b916f8df1e",
      "commitAuthor": "Steve Loughran",
      "commitDateOld": "26/10/15 3:12 AM",
      "commitNameOld": "5acdde4744c131e05db7b4b5f7d684fed7608b99",
      "commitAuthorOld": "Rohith Sharma K S",
      "daysBetweenCommits": 41.31,
      "commitsBetweenForRepo": 307,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,16 +1,13 @@\n   protected void serviceStop() throws Exception {\n     if (isStopping.getAndSet(true)) {\n       return;\n     }\n     try {\n       super.serviceStop();\n       DefaultMetricsSystem.shutdown();\n-      if (pauseMonitor !\u003d null) {\n-        pauseMonitor.stop();\n-      }\n     } finally {\n       // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n       // release of NMLevelDBStore.\n       stopRecoveryStore();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceStop() throws Exception {\n    if (isStopping.getAndSet(true)) {\n      return;\n    }\n    try {\n      super.serviceStop();\n      DefaultMetricsSystem.shutdown();\n    } finally {\n      // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n      // release of NMLevelDBStore.\n      stopRecoveryStore();\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/NodeManager.java",
      "extendedDetails": {}
    },
    "cfee02b3bdd1117370200c9d8ce216676cff8888": {
      "type": "Ybodychange",
      "commitMessage": "YARN-4019. Add JvmPauseMonitor to ResourceManager and NodeManager. Contributed by Robert Kanter.\n",
      "commitDate": "06/08/15 6:49 AM",
      "commitName": "cfee02b3bdd1117370200c9d8ce216676cff8888",
      "commitAuthor": "Junping Du",
      "commitDateOld": "03/08/15 8:53 AM",
      "commitNameOld": "469cfcd695da979e56c83d9303f9bc1f898c08ce",
      "commitAuthorOld": "Jason Lowe",
      "daysBetweenCommits": 2.91,
      "commitsBetweenForRepo": 16,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,13 +1,16 @@\n   protected void serviceStop() throws Exception {\n     if (isStopping.getAndSet(true)) {\n       return;\n     }\n     try {\n       super.serviceStop();\n       DefaultMetricsSystem.shutdown();\n+      if (pauseMonitor !\u003d null) {\n+        pauseMonitor.stop();\n+      }\n     } finally {\n       // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n       // release of NMLevelDBStore.\n       stopRecoveryStore();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceStop() throws Exception {\n    if (isStopping.getAndSet(true)) {\n      return;\n    }\n    try {\n      super.serviceStop();\n      DefaultMetricsSystem.shutdown();\n      if (pauseMonitor !\u003d null) {\n        pauseMonitor.stop();\n      }\n    } finally {\n      // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n      // release of NMLevelDBStore.\n      stopRecoveryStore();\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/NodeManager.java",
      "extendedDetails": {}
    },
    "711d77cc54a64b2c3db70bdacc6bf2245c896a4b": {
      "type": "Ybodychange",
      "commitMessage": "YARN-3641. NodeManager: stopRecoveryStore() shouldn\u0027t be skipped when exceptions happen in stopping NM\u0027s sub-services. Contributed by Junping Du\n",
      "commitDate": "13/05/15 2:06 PM",
      "commitName": "711d77cc54a64b2c3db70bdacc6bf2245c896a4b",
      "commitAuthor": "Jason Lowe",
      "commitDateOld": "04/05/15 3:49 PM",
      "commitNameOld": "71f4de220c74bf2c90630bd0442979d92380d304",
      "commitAuthorOld": "Wangda Tan",
      "daysBetweenCommits": 8.93,
      "commitsBetweenForRepo": 161,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,8 +1,13 @@\n   protected void serviceStop() throws Exception {\n     if (isStopping.getAndSet(true)) {\n       return;\n     }\n-    super.serviceStop();\n-    stopRecoveryStore();\n-    DefaultMetricsSystem.shutdown();\n+    try {\n+      super.serviceStop();\n+      DefaultMetricsSystem.shutdown();\n+    } finally {\n+      // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n+      // release of NMLevelDBStore.\n+      stopRecoveryStore();\n+    }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceStop() throws Exception {\n    if (isStopping.getAndSet(true)) {\n      return;\n    }\n    try {\n      super.serviceStop();\n      DefaultMetricsSystem.shutdown();\n    } finally {\n      // YARN-3641: NM\u0027s services stop get failed shouldn\u0027t block the\n      // release of NMLevelDBStore.\n      stopRecoveryStore();\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/NodeManager.java",
      "extendedDetails": {}
    },
    "66598697a6e777615334ebde5ba7738135da83ae": {
      "type": "Ybodychange",
      "commitMessage": "YARN-1338. Recover localized resource cache state upon nodemanager restart (Contributed by Jason Lowe)\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1598640 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "30/05/14 8:37 AM",
      "commitName": "66598697a6e777615334ebde5ba7738135da83ae",
      "commitAuthor": "Junping Du",
      "commitDateOld": "13/05/14 5:20 PM",
      "commitNameOld": "b29434a5c8df8757e6bcdcf643df2f5756a221d9",
      "commitAuthorOld": "Junping Du",
      "daysBetweenCommits": 16.64,
      "commitsBetweenForRepo": 92,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,7 +1,8 @@\n   protected void serviceStop() throws Exception {\n     if (isStopping.getAndSet(true)) {\n       return;\n     }\n     super.serviceStop();\n+    stopRecoveryStore();\n     DefaultMetricsSystem.shutdown();\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceStop() throws Exception {\n    if (isStopping.getAndSet(true)) {\n      return;\n    }\n    super.serviceStop();\n    stopRecoveryStore();\n    DefaultMetricsSystem.shutdown();\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/NodeManager.java",
      "extendedDetails": {}
    },
    "d3841bd4997a77855ab2abd9cc294eae7d795a5b": {
      "type": "Ybodychange",
      "commitMessage": "YARN-1149. NM throws InvalidStateTransitonException: Invalid event: APPLICATION_LOG_HANDLING_FINISHED at RUNNING. Contributed by Xuan Gong.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1529043 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "03/10/13 5:43 PM",
      "commitName": "d3841bd4997a77855ab2abd9cc294eae7d795a5b",
      "commitAuthor": "Hitesh Shah",
      "commitDateOld": "01/09/13 5:09 PM",
      "commitNameOld": "a759abcd898224c3481c55aa7e424bc286f60b15",
      "commitAuthorOld": "Vinod Kumar Vavilapalli",
      "daysBetweenCommits": 32.02,
      "commitsBetweenForRepo": 186,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,10 +1,7 @@\n   protected void serviceStop() throws Exception {\n     if (isStopping.getAndSet(true)) {\n       return;\n     }\n-    if (context !\u003d null) {\n-      cleanupContainers(NodeManagerEventType.SHUTDOWN);\n-    }\n     super.serviceStop();\n     DefaultMetricsSystem.shutdown();\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceStop() throws Exception {\n    if (isStopping.getAndSet(true)) {\n      return;\n    }\n    super.serviceStop();\n    DefaultMetricsSystem.shutdown();\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/NodeManager.java",
      "extendedDetails": {}
    },
    "0928502029ef141759008997335ea2cd836a7154": {
      "type": "Yintroduced",
      "commitMessage": "YARN-530. Defined Service model strictly, implemented AbstractService for robust subclassing and migrated yarn-common services. Contributed by Steve Loughran.\nYARN-117. Migrated rest of YARN to the new service model. Contributed by Steve Louhran.\nMAPREDUCE-5298. Moved MapReduce services to YARN-530 stricter lifecycle. Contributed by Steve Loughran.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1492718 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "13/06/13 8:54 AM",
      "commitName": "0928502029ef141759008997335ea2cd836a7154",
      "commitAuthor": "Vinod Kumar Vavilapalli",
      "diff": "@@ -0,0 +1,10 @@\n+  protected void serviceStop() throws Exception {\n+    if (isStopping.getAndSet(true)) {\n+      return;\n+    }\n+    if (context !\u003d null) {\n+      cleanupContainers(NodeManagerEventType.SHUTDOWN);\n+    }\n+    super.serviceStop();\n+    DefaultMetricsSystem.shutdown();\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceStop() throws Exception {\n    if (isStopping.getAndSet(true)) {\n      return;\n    }\n    if (context !\u003d null) {\n      cleanupContainers(NodeManagerEventType.SHUTDOWN);\n    }\n    super.serviceStop();\n    DefaultMetricsSystem.shutdown();\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/NodeManager.java"
    }
  }
}