{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "BlockPoolSliceStorage.java",
  "functionName": "clearRollingUpgradeMarkers",
  "functionId": "clearRollingUpgradeMarkers___dnStorageDirs-List__StorageDirectory__",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.java",
  "functionStartLine": 888,
  "functionEndLine": 908,
  "numCommitsSeen": 38,
  "timeTaken": 2127,
  "changeHistory": [
    "b3ae11d59790bb08b81848e9f944db7d3afbbd8a",
    "b668eb91556b8c85c2b4925808ccb1f769031c20",
    "f949f6b54825dac61511a5761837e2fd14437239"
  ],
  "changeHistoryShort": {
    "b3ae11d59790bb08b81848e9f944db7d3afbbd8a": "Ybodychange",
    "b668eb91556b8c85c2b4925808ccb1f769031c20": "Ybodychange",
    "f949f6b54825dac61511a5761837e2fd14437239": "Yintroduced"
  },
  "changeHistoryDetails": {
    "b3ae11d59790bb08b81848e9f944db7d3afbbd8a": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-12997. Move logging to slf4j in BlockPoolSliceStorage and Storage. Contributed by Ajay Kumar.\n",
      "commitDate": "01/02/18 10:45 AM",
      "commitName": "b3ae11d59790bb08b81848e9f944db7d3afbbd8a",
      "commitAuthor": "Xiaoyu Yao",
      "commitDateOld": "15/12/17 5:51 PM",
      "commitNameOld": "8239e3afb31d3c4485817d4b8b8b195b554acbe7",
      "commitAuthorOld": "Virajith Jalaparti",
      "daysBetweenCommits": 47.7,
      "commitsBetweenForRepo": 240,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,21 +1,21 @@\n   public void clearRollingUpgradeMarkers(List\u003cStorageDirectory\u003e dnStorageDirs)\n       throws IOException {\n     for (StorageDirectory sd : dnStorageDirs) {\n       if (sd.getCurrentDir() \u003d\u003d null) {\n         continue;\n       }\n       File bpRoot \u003d getBpRoot(blockpoolID, sd.getCurrentDir());\n       File markerFile \u003d new File(bpRoot, ROLLING_UPGRADE_MARKER_FILE);\n       if (!storagesWithoutRollingUpgradeMarker.contains(bpRoot.toString())) {\n         if (markerFile.exists()) {\n-          LOG.info(\"Deleting \" + markerFile);\n+          LOG.info(\"Deleting {}\", markerFile);\n           doFinalize(sd.getCurrentDir());\n           if (!markerFile.delete()) {\n-            LOG.warn(\"Failed to delete \" + markerFile);\n+            LOG.warn(\"Failed to delete {}\", markerFile);\n           }\n         }\n         storagesWithoutRollingUpgradeMarker.add(bpRoot.toString());\n         storagesWithRollingUpgradeMarker.remove(bpRoot.toString());\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void clearRollingUpgradeMarkers(List\u003cStorageDirectory\u003e dnStorageDirs)\n      throws IOException {\n    for (StorageDirectory sd : dnStorageDirs) {\n      if (sd.getCurrentDir() \u003d\u003d null) {\n        continue;\n      }\n      File bpRoot \u003d getBpRoot(blockpoolID, sd.getCurrentDir());\n      File markerFile \u003d new File(bpRoot, ROLLING_UPGRADE_MARKER_FILE);\n      if (!storagesWithoutRollingUpgradeMarker.contains(bpRoot.toString())) {\n        if (markerFile.exists()) {\n          LOG.info(\"Deleting {}\", markerFile);\n          doFinalize(sd.getCurrentDir());\n          if (!markerFile.delete()) {\n            LOG.warn(\"Failed to delete {}\", markerFile);\n          }\n        }\n        storagesWithoutRollingUpgradeMarker.add(bpRoot.toString());\n        storagesWithRollingUpgradeMarker.remove(bpRoot.toString());\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.java",
      "extendedDetails": {}
    },
    "b668eb91556b8c85c2b4925808ccb1f769031c20": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-10675. Datanode support to read from external stores.\n",
      "commitDate": "15/12/17 5:51 PM",
      "commitName": "b668eb91556b8c85c2b4925808ccb1f769031c20",
      "commitAuthor": "Virajith Jalaparti",
      "commitDateOld": "18/01/17 11:38 PM",
      "commitNameOld": "63320d1daab7ce846bb180623378efe431ad8c52",
      "commitAuthorOld": "Lei Xu",
      "daysBetweenCommits": 330.76,
      "commitsBetweenForRepo": 2183,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,18 +1,21 @@\n   public void clearRollingUpgradeMarkers(List\u003cStorageDirectory\u003e dnStorageDirs)\n       throws IOException {\n     for (StorageDirectory sd : dnStorageDirs) {\n+      if (sd.getCurrentDir() \u003d\u003d null) {\n+        continue;\n+      }\n       File bpRoot \u003d getBpRoot(blockpoolID, sd.getCurrentDir());\n       File markerFile \u003d new File(bpRoot, ROLLING_UPGRADE_MARKER_FILE);\n       if (!storagesWithoutRollingUpgradeMarker.contains(bpRoot.toString())) {\n         if (markerFile.exists()) {\n           LOG.info(\"Deleting \" + markerFile);\n           doFinalize(sd.getCurrentDir());\n           if (!markerFile.delete()) {\n             LOG.warn(\"Failed to delete \" + markerFile);\n           }\n         }\n         storagesWithoutRollingUpgradeMarker.add(bpRoot.toString());\n         storagesWithRollingUpgradeMarker.remove(bpRoot.toString());\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void clearRollingUpgradeMarkers(List\u003cStorageDirectory\u003e dnStorageDirs)\n      throws IOException {\n    for (StorageDirectory sd : dnStorageDirs) {\n      if (sd.getCurrentDir() \u003d\u003d null) {\n        continue;\n      }\n      File bpRoot \u003d getBpRoot(blockpoolID, sd.getCurrentDir());\n      File markerFile \u003d new File(bpRoot, ROLLING_UPGRADE_MARKER_FILE);\n      if (!storagesWithoutRollingUpgradeMarker.contains(bpRoot.toString())) {\n        if (markerFile.exists()) {\n          LOG.info(\"Deleting \" + markerFile);\n          doFinalize(sd.getCurrentDir());\n          if (!markerFile.delete()) {\n            LOG.warn(\"Failed to delete \" + markerFile);\n          }\n        }\n        storagesWithoutRollingUpgradeMarker.add(bpRoot.toString());\n        storagesWithRollingUpgradeMarker.remove(bpRoot.toString());\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.java",
      "extendedDetails": {}
    },
    "f949f6b54825dac61511a5761837e2fd14437239": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-6981. Fix DN upgrade with layout version change. (Arpit Agarwal)\n",
      "commitDate": "08/09/14 9:20 PM",
      "commitName": "f949f6b54825dac61511a5761837e2fd14437239",
      "commitAuthor": "arp",
      "diff": "@@ -0,0 +1,18 @@\n+  public void clearRollingUpgradeMarkers(List\u003cStorageDirectory\u003e dnStorageDirs)\n+      throws IOException {\n+    for (StorageDirectory sd : dnStorageDirs) {\n+      File bpRoot \u003d getBpRoot(blockpoolID, sd.getCurrentDir());\n+      File markerFile \u003d new File(bpRoot, ROLLING_UPGRADE_MARKER_FILE);\n+      if (!storagesWithoutRollingUpgradeMarker.contains(bpRoot.toString())) {\n+        if (markerFile.exists()) {\n+          LOG.info(\"Deleting \" + markerFile);\n+          doFinalize(sd.getCurrentDir());\n+          if (!markerFile.delete()) {\n+            LOG.warn(\"Failed to delete \" + markerFile);\n+          }\n+        }\n+        storagesWithoutRollingUpgradeMarker.add(bpRoot.toString());\n+        storagesWithRollingUpgradeMarker.remove(bpRoot.toString());\n+      }\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public void clearRollingUpgradeMarkers(List\u003cStorageDirectory\u003e dnStorageDirs)\n      throws IOException {\n    for (StorageDirectory sd : dnStorageDirs) {\n      File bpRoot \u003d getBpRoot(blockpoolID, sd.getCurrentDir());\n      File markerFile \u003d new File(bpRoot, ROLLING_UPGRADE_MARKER_FILE);\n      if (!storagesWithoutRollingUpgradeMarker.contains(bpRoot.toString())) {\n        if (markerFile.exists()) {\n          LOG.info(\"Deleting \" + markerFile);\n          doFinalize(sd.getCurrentDir());\n          if (!markerFile.delete()) {\n            LOG.warn(\"Failed to delete \" + markerFile);\n          }\n        }\n        storagesWithoutRollingUpgradeMarker.add(bpRoot.toString());\n        storagesWithRollingUpgradeMarker.remove(bpRoot.toString());\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.java"
    }
  }
}