{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "AzureBlobFileSystemStore.java",
  "functionName": "modifyAclEntries",
  "functionId": "modifyAclEntries___path-Path(modifiers-final)__aclSpec-List__AclEntry__(modifiers-final)",
  "sourceFilePath": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java",
  "functionStartLine": 890,
  "functionEndLine": 930,
  "numCommitsSeen": 48,
  "timeTaken": 4634,
  "changeHistory": [
    "b214bbd2d92a0c02b71d352dba85f3b87317933c",
    "b033c681e4fc3ee1a38caa807e130aee481d99d5",
    "43a91f820a5fce75ea69f78a62331bdc58e09a37",
    "1f1655028eede24197705a594b6ef19e6737db35",
    "668817a6cefa6025ddfe082ed71d7d317d811381",
    "fa8cd1bf28f5b81849ba351a2d7225fbc580350d",
    "a8302e398c2ca4b0deff062c0e921053351b688e",
    "724c15007beb9ca36f2f37c829f1daa366d95bbf",
    "9c1e4e81399913f180131f4faa95604087c6d962"
  ],
  "changeHistoryShort": {
    "b214bbd2d92a0c02b71d352dba85f3b87317933c": "Ybodychange",
    "b033c681e4fc3ee1a38caa807e130aee481d99d5": "Ybodychange",
    "43a91f820a5fce75ea69f78a62331bdc58e09a37": "Ybodychange",
    "1f1655028eede24197705a594b6ef19e6737db35": "Ybodychange",
    "668817a6cefa6025ddfe082ed71d7d317d811381": "Ybodychange",
    "fa8cd1bf28f5b81849ba351a2d7225fbc580350d": "Ybodychange",
    "a8302e398c2ca4b0deff062c0e921053351b688e": "Ybodychange",
    "724c15007beb9ca36f2f37c829f1daa366d95bbf": "Ybodychange",
    "9c1e4e81399913f180131f4faa95604087c6d962": "Yintroduced"
  },
  "changeHistoryDetails": {
    "b214bbd2d92a0c02b71d352dba85f3b87317933c": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-16916: ABFS: Delegation SAS generator for integration with Ranger\n\nContributed by Thomas Marquardt.\n\nDETAILS:\n\nPreviously we had a SASGenerator class which generated Service SAS, but we need to add DelegationSASGenerator.\nI separated SASGenerator into a base class and two subclasses ServiceSASGenerator and DelegationSASGenreator.  The\ncode in ServiceSASGenerator is copied from SASGenerator but the DelegationSASGenrator code is new.  The\nDelegationSASGenerator code demonstrates how to use Delegation SAS with minimal permissions, as would be used\nby an authorization service such as Apache Ranger.  Adding this to the tests helps us lock in this behavior.\n\nAdded a MockDelegationSASTokenProvider for testing User Delegation SAS.\n\nFixed the ITestAzureBlobFileSystemCheckAccess tests to assume oauth client ID so that they are ignored when that\nis not configured.\n\nTo improve performance, AbfsInputStream/AbfsOutputStream re-use SAS tokens until the expiry is within 120 seconds.\nAfter this a new SAS will be requested.  The default period of 120 seconds can be changed using the configuration\nsetting \"fs.azure.sas.token.renew.period.for.streams\".\n\nThe SASTokenProvider operation names were updated to correspond better with the ADLS Gen2 REST API, since these\noperations must be provided tokens with appropriate SAS parameters to succeed.\n\nSupport for the version 2.0 AAD authentication endpoint was added to AzureADAuthenticator.\n\nThe getFileStatus method was mistakenly calling the ADLS Gen2 Get Properties API which requires read permission\nwhile the getFileStatus call only requires execute permission.  ADLS Gen2 Get Status API is supposed to be used\nfor this purpose, so the underlying AbfsClient.getPathStatus API was updated with a includeProperties\nparameter which is set to false for getFileStatus and true for getXAttr.\n\nAdded SASTokenProvider support for delete recursive.\n\nFixed bugs in AzureBlobFileSystem where public methods were not validating the Path by calling makeQualified.  This is\nnecessary to avoid passing null paths and to convert relative paths into absolute paths.\n\nCanonicalized the path used for root path internally so that root path can be used with SAS tokens, which requires\nthat the path in the URL and the path in the SAS token match.  Internally the code was using\n\"//\" instead of \"/\" for the root path, sometimes.  Also related to this, the AzureBlobFileSystemStore.getRelativePath\nAPI was updated so that we no longer remove and then add back a preceding forward / to paths.\n\nTo run ITestAzureBlobFileSystemDelegationSAS tests follow the instructions in testing_azure.md under the heading\n\"To run Delegation SAS test cases\".  You also need to set \"fs.azure.enable.check.access\" to true.\n\nTEST RESULTS:\n\nnamespace.enabled\u003dtrue\nauth.type\u003dSharedKey\n-------------------\n$mvn -T 1C -Dparallel-tests\u003dabfs -Dscale -DtestsThreadCount\u003d8 clean verify\nTests run: 63, Failures: 0, Errors: 0, Skipped: 0\nTests run: 432, Failures: 0, Errors: 0, Skipped: 41\nTests run: 206, Failures: 0, Errors: 0, Skipped: 24\n\nnamespace.enabled\u003dfalse\nauth.type\u003dSharedKey\n-------------------\n$mvn -T 1C -Dparallel-tests\u003dabfs -Dscale -DtestsThreadCount\u003d8 clean verify\nTests run: 63, Failures: 0, Errors: 0, Skipped: 0\nTests run: 432, Failures: 0, Errors: 0, Skipped: 244\nTests run: 206, Failures: 0, Errors: 0, Skipped: 24\n\nnamespace.enabled\u003dtrue\nauth.type\u003dSharedKey\nsas.token.provider.type\u003dMockDelegationSASTokenProvider\nenable.check.access\u003dtrue\n-------------------\n$mvn -T 1C -Dparallel-tests\u003dabfs -Dscale -DtestsThreadCount\u003d8 clean verify\nTests run: 63, Failures: 0, Errors: 0, Skipped: 0\nTests run: 432, Failures: 0, Errors: 0, Skipped: 33\nTests run: 206, Failures: 0, Errors: 0, Skipped: 24\n\nnamespace.enabled\u003dtrue\nauth.type\u003dOAuth\n-------------------\n$mvn -T 1C -Dparallel-tests\u003dabfs -Dscale -DtestsThreadCount\u003d8 clean verify\nTests run: 63, Failures: 0, Errors: 0, Skipped: 0\nTests run: 432, Failures: 0, Errors: 1, Skipped: 74\nTests run: 206, Failures: 0, Errors: 0, Skipped: 140\n",
      "commitDate": "12/05/20 11:35 AM",
      "commitName": "b214bbd2d92a0c02b71d352dba85f3b87317933c",
      "commitAuthor": "Thomas Marquardt",
      "commitDateOld": "23/04/20 5:46 PM",
      "commitNameOld": "30ef8d0f1a1463931fe581a46c739dad4c8260e4",
      "commitAuthorOld": "bilaharith",
      "daysBetweenCommits": 18.74,
      "commitsBetweenForRepo": 65,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,39 +1,41 @@\n   public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n           AzureBlobFileSystemException {\n     if (!getIsNamespaceEnabled()) {\n       throw new UnsupportedOperationException(\n           \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n     }\n \n     try (AbfsPerfInfo perfInfoGet \u003d startTracking(\"modifyAclEntries\", \"getAclStatus\")) {\n \n       LOG.debug(\n               \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n               client.getFileSystem(),\n               path.toString(),\n               AclEntry.aclSpecToString(aclSpec));\n \n       identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n       final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n       boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n \n-      final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n+      String relativePath \u003d getRelativePath(path);\n+\n+      final AbfsRestOperation op \u003d client.getAclStatus(relativePath, useUpn);\n       perfInfoGet.registerResult(op.getResult());\n       final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n \n       final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n \n       AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n \n       perfInfoGet.registerSuccess(true).finishTracking();\n \n       try (AbfsPerfInfo perfInfoSet \u003d startTracking(\"modifyAclEntries\", \"setAcl\")) {\n         final AbfsRestOperation setAclOp\n-                \u003d client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n+                \u003d client.setAcl(relativePath,\n                 AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n         perfInfoSet.registerResult(setAclOp.getResult())\n                 .registerSuccess(true)\n                 .registerAggregates(perfInfoGet.getTrackingStart(), GET_SET_AGGREGATE_COUNT);\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n          AzureBlobFileSystemException {\n    if (!getIsNamespaceEnabled()) {\n      throw new UnsupportedOperationException(\n          \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n    }\n\n    try (AbfsPerfInfo perfInfoGet \u003d startTracking(\"modifyAclEntries\", \"getAclStatus\")) {\n\n      LOG.debug(\n              \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n              client.getFileSystem(),\n              path.toString(),\n              AclEntry.aclSpecToString(aclSpec));\n\n      identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n      final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n      boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n\n      String relativePath \u003d getRelativePath(path);\n\n      final AbfsRestOperation op \u003d client.getAclStatus(relativePath, useUpn);\n      perfInfoGet.registerResult(op.getResult());\n      final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n\n      final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n\n      AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n\n      perfInfoGet.registerSuccess(true).finishTracking();\n\n      try (AbfsPerfInfo perfInfoSet \u003d startTracking(\"modifyAclEntries\", \"setAcl\")) {\n        final AbfsRestOperation setAclOp\n                \u003d client.setAcl(relativePath,\n                AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n        perfInfoSet.registerResult(setAclOp.getResult())\n                .registerSuccess(true)\n                .registerAggregates(perfInfoGet.getTrackingStart(), GET_SET_AGGREGATE_COUNT);\n      }\n    }\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java",
      "extendedDetails": {}
    },
    "b033c681e4fc3ee1a38caa807e130aee481d99d5": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-16612. Track Azure Blob File System client-perceived latency\n\nContributed by Jeetesh Mangwani.\n\nThis add the ability to track the end-to-end performance of ADLS Gen 2 REST APIs by measuring latency in the Hadoop ABFS driver.\nThe latency information is sent back to the ADLS Gen 2 REST API endpoints in the subsequent requests.\n",
      "commitDate": "19/11/19 9:00 AM",
      "commitName": "b033c681e4fc3ee1a38caa807e130aee481d99d5",
      "commitAuthor": "Jeetesh Mangwani",
      "commitDateOld": "28/09/19 8:39 PM",
      "commitNameOld": "c0edc848a8e71b5e2a1586a589bbf2ac8685040d",
      "commitAuthorOld": "Sneha Vijayarajan",
      "daysBetweenCommits": 51.56,
      "commitsBetweenForRepo": 252,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,27 +1,39 @@\n   public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n           AzureBlobFileSystemException {\n     if (!getIsNamespaceEnabled()) {\n       throw new UnsupportedOperationException(\n           \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n     }\n \n-    LOG.debug(\n-            \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n-            client.getFileSystem(),\n-            path.toString(),\n-            AclEntry.aclSpecToString(aclSpec));\n+    try (AbfsPerfInfo perfInfoGet \u003d startTracking(\"modifyAclEntries\", \"getAclStatus\")) {\n \n-    identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n-    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n-    boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n+      LOG.debug(\n+              \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n+              client.getFileSystem(),\n+              path.toString(),\n+              AclEntry.aclSpecToString(aclSpec));\n \n-    final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n-    final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n+      identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n+      final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n+      boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n \n-    final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n+      final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n+      perfInfoGet.registerResult(op.getResult());\n+      final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n \n-    AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n+      final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n \n-    client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n-        AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n+      AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n+\n+      perfInfoGet.registerSuccess(true).finishTracking();\n+\n+      try (AbfsPerfInfo perfInfoSet \u003d startTracking(\"modifyAclEntries\", \"setAcl\")) {\n+        final AbfsRestOperation setAclOp\n+                \u003d client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n+                AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n+        perfInfoSet.registerResult(setAclOp.getResult())\n+                .registerSuccess(true)\n+                .registerAggregates(perfInfoGet.getTrackingStart(), GET_SET_AGGREGATE_COUNT);\n+      }\n+    }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n          AzureBlobFileSystemException {\n    if (!getIsNamespaceEnabled()) {\n      throw new UnsupportedOperationException(\n          \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n    }\n\n    try (AbfsPerfInfo perfInfoGet \u003d startTracking(\"modifyAclEntries\", \"getAclStatus\")) {\n\n      LOG.debug(\n              \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n              client.getFileSystem(),\n              path.toString(),\n              AclEntry.aclSpecToString(aclSpec));\n\n      identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n      final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n      boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n\n      final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n      perfInfoGet.registerResult(op.getResult());\n      final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n\n      final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n\n      AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n\n      perfInfoGet.registerSuccess(true).finishTracking();\n\n      try (AbfsPerfInfo perfInfoSet \u003d startTracking(\"modifyAclEntries\", \"setAcl\")) {\n        final AbfsRestOperation setAclOp\n                \u003d client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n                AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n        perfInfoSet.registerResult(setAclOp.getResult())\n                .registerSuccess(true)\n                .registerAggregates(perfInfoGet.getTrackingStart(), GET_SET_AGGREGATE_COUNT);\n      }\n    }\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java",
      "extendedDetails": {}
    },
    "43a91f820a5fce75ea69f78a62331bdc58e09a37": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-16315. ABFS: transform full UPN for named user in AclStatus\n\nContributed by Da Zhou\n\nChange-Id: Ibc78322415fcbeff89c06c8586c53f5695550290\n",
      "commitDate": "09/08/19 4:38 AM",
      "commitName": "43a91f820a5fce75ea69f78a62331bdc58e09a37",
      "commitAuthor": "Da Zhou",
      "commitDateOld": "08/08/19 11:08 AM",
      "commitNameOld": "5840df86d7a9e79007745688313f1d799d89189b",
      "commitAuthorOld": "bilaharith",
      "daysBetweenCommits": 0.73,
      "commitsBetweenForRepo": 18,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,27 +1,27 @@\n   public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n           AzureBlobFileSystemException {\n     if (!getIsNamespaceEnabled()) {\n       throw new UnsupportedOperationException(\n           \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n     }\n \n     LOG.debug(\n             \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n             client.getFileSystem(),\n             path.toString(),\n             AclEntry.aclSpecToString(aclSpec));\n \n-    final List\u003cAclEntry\u003e transformedAclEntries \u003d identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n-    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(transformedAclEntries));\n+    identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n+    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n     boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n \n     final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n     final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n \n     final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n \n     AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n \n     client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n         AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n          AzureBlobFileSystemException {\n    if (!getIsNamespaceEnabled()) {\n      throw new UnsupportedOperationException(\n          \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n    }\n\n    LOG.debug(\n            \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n            client.getFileSystem(),\n            path.toString(),\n            AclEntry.aclSpecToString(aclSpec));\n\n    identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n    boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n\n    final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n    final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n\n    final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n\n    AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n\n    client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n        AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java",
      "extendedDetails": {}
    },
    "1f1655028eede24197705a594b6ef19e6737db35": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-15954. ABFS: Enable owner and group conversion for MSI and login user using OAuth.\n\nContributed by Da Zhou and Junhua Gu.\n",
      "commitDate": "07/02/19 1:58 PM",
      "commitName": "1f1655028eede24197705a594b6ef19e6737db35",
      "commitAuthor": "Da Zhou",
      "commitDateOld": "07/02/19 1:57 PM",
      "commitNameOld": "668817a6cefa6025ddfe082ed71d7d317d811381",
      "commitAuthorOld": "Steve Loughran",
      "daysBetweenCommits": 0.0,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,25 +1,27 @@\n   public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n           AzureBlobFileSystemException {\n     if (!getIsNamespaceEnabled()) {\n       throw new UnsupportedOperationException(\n           \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n     }\n \n     LOG.debug(\n             \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n             client.getFileSystem(),\n             path.toString(),\n             AclEntry.aclSpecToString(aclSpec));\n-    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n+\n+    final List\u003cAclEntry\u003e transformedAclEntries \u003d identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n+    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(transformedAclEntries));\n     boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n \n     final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n     final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n \n     final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n \n     AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n \n     client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n         AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n          AzureBlobFileSystemException {\n    if (!getIsNamespaceEnabled()) {\n      throw new UnsupportedOperationException(\n          \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n    }\n\n    LOG.debug(\n            \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n            client.getFileSystem(),\n            path.toString(),\n            AclEntry.aclSpecToString(aclSpec));\n\n    final List\u003cAclEntry\u003e transformedAclEntries \u003d identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(transformedAclEntries));\n    boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n\n    final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n    final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n\n    final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n\n    AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n\n    client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n        AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java",
      "extendedDetails": {}
    },
    "668817a6cefa6025ddfe082ed71d7d317d811381": {
      "type": "Ybodychange",
      "commitMessage": "Revert \"HADOOP-15954. ABFS: Enable owner and group conversion for MSI and login user using OAuth.\"\n\n(accidentally mixed in two patches)\n\nThis reverts commit fa8cd1bf28f5b81849ba351a2d7225fbc580350d.\n",
      "commitDate": "07/02/19 1:57 PM",
      "commitName": "668817a6cefa6025ddfe082ed71d7d317d811381",
      "commitAuthor": "Steve Loughran",
      "commitDateOld": "05/02/19 11:23 AM",
      "commitNameOld": "fa8cd1bf28f5b81849ba351a2d7225fbc580350d",
      "commitAuthorOld": "Da Zhou",
      "daysBetweenCommits": 2.11,
      "commitsBetweenForRepo": 17,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,27 +1,25 @@\n   public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n           AzureBlobFileSystemException {\n     if (!getIsNamespaceEnabled()) {\n       throw new UnsupportedOperationException(\n           \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n     }\n \n     LOG.debug(\n             \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n             client.getFileSystem(),\n             path.toString(),\n             AclEntry.aclSpecToString(aclSpec));\n-\n-    final List\u003cAclEntry\u003e transformedAclEntries \u003d identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n-    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(transformedAclEntries));\n+    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n     boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n \n     final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n     final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n \n     final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n \n     AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n \n     client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n         AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n          AzureBlobFileSystemException {\n    if (!getIsNamespaceEnabled()) {\n      throw new UnsupportedOperationException(\n          \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n    }\n\n    LOG.debug(\n            \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n            client.getFileSystem(),\n            path.toString(),\n            AclEntry.aclSpecToString(aclSpec));\n    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n    boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n\n    final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n    final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n\n    final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n\n    AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n\n    client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n        AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java",
      "extendedDetails": {}
    },
    "fa8cd1bf28f5b81849ba351a2d7225fbc580350d": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-15954. ABFS: Enable owner and group conversion for MSI and login user using OAuth.\n\nContributed by Da Zhou and Junhua Gu.\n",
      "commitDate": "05/02/19 11:23 AM",
      "commitName": "fa8cd1bf28f5b81849ba351a2d7225fbc580350d",
      "commitAuthor": "Da Zhou",
      "commitDateOld": "22/01/19 8:40 AM",
      "commitNameOld": "00ad9e23e88d1e1b1f887b6c9473a7a924a95a97",
      "commitAuthorOld": "Da Zhou",
      "daysBetweenCommits": 14.11,
      "commitsBetweenForRepo": 97,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,25 +1,27 @@\n   public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n           AzureBlobFileSystemException {\n     if (!getIsNamespaceEnabled()) {\n       throw new UnsupportedOperationException(\n           \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n     }\n \n     LOG.debug(\n             \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n             client.getFileSystem(),\n             path.toString(),\n             AclEntry.aclSpecToString(aclSpec));\n-    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n+\n+    final List\u003cAclEntry\u003e transformedAclEntries \u003d identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n+    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(transformedAclEntries));\n     boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n \n     final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n     final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n \n     final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n \n     AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n \n     client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n         AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n          AzureBlobFileSystemException {\n    if (!getIsNamespaceEnabled()) {\n      throw new UnsupportedOperationException(\n          \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n    }\n\n    LOG.debug(\n            \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n            client.getFileSystem(),\n            path.toString(),\n            AclEntry.aclSpecToString(aclSpec));\n\n    final List\u003cAclEntry\u003e transformedAclEntries \u003d identityTransformer.transformAclEntriesForSetRequest(aclSpec);\n    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(transformedAclEntries));\n    boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n\n    final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n    final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n\n    final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n\n    AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n\n    client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n        AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java",
      "extendedDetails": {}
    },
    "a8302e398c2ca4b0deff062c0e921053351b688e": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-15872. ABFS: Update to target 2018-11-09 REST version for ADLS Gen 2.\n\nContributed by Junhua Gu and Da Zhou.\n",
      "commitDate": "23/11/18 6:17 AM",
      "commitName": "a8302e398c2ca4b0deff062c0e921053351b688e",
      "commitAuthor": "Da Zhou",
      "commitDateOld": "13/11/18 1:46 PM",
      "commitNameOld": "a13be203b7877ba56ef63aac4a2e65d4e1a4adbc",
      "commitAuthorOld": "Da Zhou",
      "daysBetweenCommits": 9.69,
      "commitsBetweenForRepo": 79,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,25 +1,25 @@\n   public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n           AzureBlobFileSystemException {\n     if (!getIsNamespaceEnabled()) {\n       throw new UnsupportedOperationException(\n           \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n     }\n \n     LOG.debug(\n             \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n             client.getFileSystem(),\n             path.toString(),\n             AclEntry.aclSpecToString(aclSpec));\n-\n     final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n+    boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n \n-    final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true));\n+    final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n     final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n \n     final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n \n     AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n \n     client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n         AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n          AzureBlobFileSystemException {\n    if (!getIsNamespaceEnabled()) {\n      throw new UnsupportedOperationException(\n          \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n    }\n\n    LOG.debug(\n            \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n            client.getFileSystem(),\n            path.toString(),\n            AclEntry.aclSpecToString(aclSpec));\n    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n    boolean useUpn \u003d AbfsAclHelper.isUpnFormatAclEntries(modifyAclEntries);\n\n    final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true), useUpn);\n    final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n\n    final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n\n    AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n\n    client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n        AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java",
      "extendedDetails": {}
    },
    "724c15007beb9ca36f2f37c829f1daa366d95bbf": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-15846. ABFS: fix mask related bugs in setAcl, modifyAclEntries and removeAclEntries.\n\nContributed by Junhua Gu.\n\n(cherry picked from commit 66715005f9e8f4f25faa352a06d142b75a029f0e)\n",
      "commitDate": "08/11/18 9:21 AM",
      "commitName": "724c15007beb9ca36f2f37c829f1daa366d95bbf",
      "commitAuthor": "Junhua Gu",
      "commitDateOld": "03/10/18 4:52 AM",
      "commitNameOld": "7051bd78b17b2666c2fa0f61823920285a060a76",
      "commitAuthorOld": "Steve Loughran",
      "daysBetweenCommits": 36.23,
      "commitsBetweenForRepo": 351,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,35 +1,25 @@\n   public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n           AzureBlobFileSystemException {\n     if (!getIsNamespaceEnabled()) {\n       throw new UnsupportedOperationException(\n           \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n     }\n \n     LOG.debug(\n             \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n             client.getFileSystem(),\n             path.toString(),\n             AclEntry.aclSpecToString(aclSpec));\n \n     final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n \n     final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true));\n     final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n \n     final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n \n-    for (Map.Entry\u003cString, String\u003e modifyAclEntry : modifyAclEntries.entrySet()) {\n-      aclEntries.put(modifyAclEntry.getKey(), modifyAclEntry.getValue());\n-    }\n-\n-    if (!modifyAclEntries.containsKey(AbfsHttpConstants.ACCESS_MASK)) {\n-      aclEntries.remove(AbfsHttpConstants.ACCESS_MASK);\n-    }\n-\n-    if (!modifyAclEntries.containsKey(AbfsHttpConstants.DEFAULT_MASK)) {\n-      aclEntries.remove(AbfsHttpConstants.DEFAULT_MASK);\n-    }\n+    AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n \n     client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n         AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n          AzureBlobFileSystemException {\n    if (!getIsNamespaceEnabled()) {\n      throw new UnsupportedOperationException(\n          \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n    }\n\n    LOG.debug(\n            \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n            client.getFileSystem(),\n            path.toString(),\n            AclEntry.aclSpecToString(aclSpec));\n\n    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n\n    final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true));\n    final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n\n    final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n\n    AbfsAclHelper.modifyAclEntriesInternal(aclEntries, modifyAclEntries);\n\n    client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n        AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java",
      "extendedDetails": {}
    },
    "9c1e4e81399913f180131f4faa95604087c6d962": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-15661. ABFS: Add support for ACL.\nContributed by Junhua Gu and Da Zhou.\n",
      "commitDate": "17/09/18 12:54 PM",
      "commitName": "9c1e4e81399913f180131f4faa95604087c6d962",
      "commitAuthor": "Thomas Marquardt",
      "diff": "@@ -0,0 +1,35 @@\n+  public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n+          AzureBlobFileSystemException {\n+    if (!getIsNamespaceEnabled()) {\n+      throw new UnsupportedOperationException(\n+          \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n+    }\n+\n+    LOG.debug(\n+            \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n+            client.getFileSystem(),\n+            path.toString(),\n+            AclEntry.aclSpecToString(aclSpec));\n+\n+    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n+\n+    final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true));\n+    final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n+\n+    final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n+\n+    for (Map.Entry\u003cString, String\u003e modifyAclEntry : modifyAclEntries.entrySet()) {\n+      aclEntries.put(modifyAclEntry.getKey(), modifyAclEntry.getValue());\n+    }\n+\n+    if (!modifyAclEntries.containsKey(AbfsHttpConstants.ACCESS_MASK)) {\n+      aclEntries.remove(AbfsHttpConstants.ACCESS_MASK);\n+    }\n+\n+    if (!modifyAclEntries.containsKey(AbfsHttpConstants.DEFAULT_MASK)) {\n+      aclEntries.remove(AbfsHttpConstants.DEFAULT_MASK);\n+    }\n+\n+    client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n+        AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public void modifyAclEntries(final Path path, final List\u003cAclEntry\u003e aclSpec) throws\n          AzureBlobFileSystemException {\n    if (!getIsNamespaceEnabled()) {\n      throw new UnsupportedOperationException(\n          \"This operation is only valid for storage accounts with the hierarchical namespace enabled.\");\n    }\n\n    LOG.debug(\n            \"modifyAclEntries filesystem: {} path: {} aclSpec: {}\",\n            client.getFileSystem(),\n            path.toString(),\n            AclEntry.aclSpecToString(aclSpec));\n\n    final Map\u003cString, String\u003e modifyAclEntries \u003d AbfsAclHelper.deserializeAclSpec(AclEntry.aclSpecToString(aclSpec));\n\n    final AbfsRestOperation op \u003d client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true));\n    final String eTag \u003d op.getResult().getResponseHeader(HttpHeaderConfigurations.ETAG);\n\n    final Map\u003cString, String\u003e aclEntries \u003d AbfsAclHelper.deserializeAclSpec(op.getResult().getResponseHeader(HttpHeaderConfigurations.X_MS_ACL));\n\n    for (Map.Entry\u003cString, String\u003e modifyAclEntry : modifyAclEntries.entrySet()) {\n      aclEntries.put(modifyAclEntry.getKey(), modifyAclEntry.getValue());\n    }\n\n    if (!modifyAclEntries.containsKey(AbfsHttpConstants.ACCESS_MASK)) {\n      aclEntries.remove(AbfsHttpConstants.ACCESS_MASK);\n    }\n\n    if (!modifyAclEntries.containsKey(AbfsHttpConstants.DEFAULT_MASK)) {\n      aclEntries.remove(AbfsHttpConstants.DEFAULT_MASK);\n    }\n\n    client.setAcl(AbfsHttpConstants.FORWARD_SLASH + getRelativePath(path, true),\n        AbfsAclHelper.serializeAclSpec(aclEntries), eTag);\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java"
    }
  }
}