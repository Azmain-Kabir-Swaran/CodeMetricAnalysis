{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "NNStorage.java",
  "functionName": "attemptRestoreRemovedStorage",
  "functionId": "attemptRestoreRemovedStorage",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
  "functionStartLine": 241,
  "functionEndLine": 262,
  "numCommitsSeen": 68,
  "timeTaken": 6969,
  "changeHistory": [
    "b3ae11d59790bb08b81848e9f944db7d3afbbd8a",
    "b09a03cd7d26cf96ec26a81ba11f00778241eb3e",
    "38128baff40ee137376968f025e75827a4227ee7",
    "3704e091a8d6c4181dfb29ac9d950e997b1170c0",
    "e2091275dc26745c4e919cd767283d32608a1817",
    "fb30240b87500c1b3c9f8036bb9e6712ec8e2655",
    "cd7157784e5e5ddc4e77144d042e54dd0d04bac1",
    "d86f3183d93714ba078416af4f609d26376eadb0",
    "28e6a4e44a3e920dcaf858f9a74a6358226b3a63",
    "a196766ea07775f18ded69bd9e8d239f8cfd3ccc"
  ],
  "changeHistoryShort": {
    "b3ae11d59790bb08b81848e9f944db7d3afbbd8a": "Ybodychange",
    "b09a03cd7d26cf96ec26a81ba11f00778241eb3e": "Ybodychange",
    "38128baff40ee137376968f025e75827a4227ee7": "Ybodychange",
    "3704e091a8d6c4181dfb29ac9d950e997b1170c0": "Ybodychange",
    "e2091275dc26745c4e919cd767283d32608a1817": "Ybodychange",
    "fb30240b87500c1b3c9f8036bb9e6712ec8e2655": "Ybodychange",
    "cd7157784e5e5ddc4e77144d042e54dd0d04bac1": "Yfilerename",
    "d86f3183d93714ba078416af4f609d26376eadb0": "Yfilerename",
    "28e6a4e44a3e920dcaf858f9a74a6358226b3a63": "Ybodychange",
    "a196766ea07775f18ded69bd9e8d239f8cfd3ccc": "Yintroduced"
  },
  "changeHistoryDetails": {
    "b3ae11d59790bb08b81848e9f944db7d3afbbd8a": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-12997. Move logging to slf4j in BlockPoolSliceStorage and Storage. Contributed by Ajay Kumar.\n",
      "commitDate": "01/02/18 10:45 AM",
      "commitName": "b3ae11d59790bb08b81848e9f944db7d3afbbd8a",
      "commitAuthor": "Xiaoyu Yao",
      "commitDateOld": "15/12/17 5:51 PM",
      "commitNameOld": "b668eb91556b8c85c2b4925808ccb1f769031c20",
      "commitAuthorOld": "Virajith Jalaparti",
      "daysBetweenCommits": 47.7,
      "commitsBetweenForRepo": 277,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,22 +1,22 @@\n   void attemptRestoreRemovedStorage() {\n     // if directory is \"alive\" - copy the images there...\n     if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0) {\n       return; //nothing to restore\n     }\n     /* We don\u0027t want more than one thread trying to restore at a time */\n     synchronized (this.restorationLock) {\n       LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n-               \"storage. removedStorages size \u003d \" + removedStorageDirs.size());\n+               \"storage. removedStorages size \u003d {}\", removedStorageDirs.size());\n       for (StorageDirectory sd : this.removedStorageDirs) {\n         File root \u003d sd.getRoot();\n-        LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n-            \"; type\u003d\" + sd.getStorageDirType()\n-            + \";canwrite\u003d\" + FileUtil.canWrite(root));\n+        LOG.info(\"currently disabled dir {}; type\u003d{} ;canwrite\u003d{}\", root\n+                .getAbsolutePath(), sd.getStorageDirType(),\n+            FileUtil.canWrite(root));\n         if (root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n-          LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n+          LOG.info(\"restoring dir {}\", sd.getRoot().getAbsolutePath());\n           this.addStorageDir(sd); // restore\n           this.removedStorageDirs.remove(sd);\n         }\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void attemptRestoreRemovedStorage() {\n    // if directory is \"alive\" - copy the images there...\n    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0) {\n      return; //nothing to restore\n    }\n    /* We don\u0027t want more than one thread trying to restore at a time */\n    synchronized (this.restorationLock) {\n      LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n               \"storage. removedStorages size \u003d {}\", removedStorageDirs.size());\n      for (StorageDirectory sd : this.removedStorageDirs) {\n        File root \u003d sd.getRoot();\n        LOG.info(\"currently disabled dir {}; type\u003d{} ;canwrite\u003d{}\", root\n                .getAbsolutePath(), sd.getStorageDirType(),\n            FileUtil.canWrite(root));\n        if (root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n          LOG.info(\"restoring dir {}\", sd.getRoot().getAbsolutePath());\n          this.addStorageDir(sd); // restore\n          this.removedStorageDirs.remove(sd);\n        }\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
      "extendedDetails": {}
    },
    "b09a03cd7d26cf96ec26a81ba11f00778241eb3e": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-10862. Typos in 4 log messages. Contributed by Mehran Hassani.\n",
      "commitDate": "16/09/16 12:08 AM",
      "commitName": "b09a03cd7d26cf96ec26a81ba11f00778241eb3e",
      "commitAuthor": "Akira Ajisaka",
      "commitDateOld": "20/07/16 10:44 AM",
      "commitNameOld": "38128baff40ee137376968f025e75827a4227ee7",
      "commitAuthorOld": "Akira Ajisaka",
      "daysBetweenCommits": 57.56,
      "commitsBetweenForRepo": 364,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,22 +1,22 @@\n   void attemptRestoreRemovedStorage() {\n     // if directory is \"alive\" - copy the images there...\n     if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0) {\n       return; //nothing to restore\n     }\n     /* We don\u0027t want more than one thread trying to restore at a time */\n     synchronized (this.restorationLock) {\n       LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n-               \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n+               \"storage. removedStorages size \u003d \" + removedStorageDirs.size());\n       for (StorageDirectory sd : this.removedStorageDirs) {\n         File root \u003d sd.getRoot();\n         LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n             \"; type\u003d\" + sd.getStorageDirType()\n             + \";canwrite\u003d\" + FileUtil.canWrite(root));\n         if (root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n           LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n           this.addStorageDir(sd); // restore\n           this.removedStorageDirs.remove(sd);\n         }\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void attemptRestoreRemovedStorage() {\n    // if directory is \"alive\" - copy the images there...\n    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0) {\n      return; //nothing to restore\n    }\n    /* We don\u0027t want more than one thread trying to restore at a time */\n    synchronized (this.restorationLock) {\n      LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n               \"storage. removedStorages size \u003d \" + removedStorageDirs.size());\n      for (StorageDirectory sd : this.removedStorageDirs) {\n        File root \u003d sd.getRoot();\n        LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n            \"; type\u003d\" + sd.getStorageDirType()\n            + \";canwrite\u003d\" + FileUtil.canWrite(root));\n        if (root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n          LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n          this.addStorageDir(sd); // restore\n          this.removedStorageDirs.remove(sd);\n        }\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
      "extendedDetails": {}
    },
    "38128baff40ee137376968f025e75827a4227ee7": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-10425. Clean up NNStorage and TestSaveNamespace. Contributed by Andras Bokor.\n",
      "commitDate": "20/07/16 10:44 AM",
      "commitName": "38128baff40ee137376968f025e75827a4227ee7",
      "commitAuthor": "Akira Ajisaka",
      "commitDateOld": "18/05/16 2:13 PM",
      "commitNameOld": "010e6ac328855bad59f138b6aeaec535272f448c",
      "commitAuthorOld": "Andrew Wang",
      "daysBetweenCommits": 62.85,
      "commitsBetweenForRepo": 537,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,24 +1,22 @@\n   void attemptRestoreRemovedStorage() {\n     // if directory is \"alive\" - copy the images there...\n-    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n+    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0) {\n       return; //nothing to restore\n-\n+    }\n     /* We don\u0027t want more than one thread trying to restore at a time */\n     synchronized (this.restorationLock) {\n       LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n                \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n-      for(Iterator\u003cStorageDirectory\u003e it\n-            \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n-        StorageDirectory sd \u003d it.next();\n+      for (StorageDirectory sd : this.removedStorageDirs) {\n         File root \u003d sd.getRoot();\n         LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n-                 \"; type\u003d\"+sd.getStorageDirType() \n-                 + \";canwrite\u003d\"+FileUtil.canWrite(root));\n-        if(root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n+            \"; type\u003d\" + sd.getStorageDirType()\n+            + \";canwrite\u003d\" + FileUtil.canWrite(root));\n+        if (root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n           LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n           this.addStorageDir(sd); // restore\n           this.removedStorageDirs.remove(sd);\n         }\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void attemptRestoreRemovedStorage() {\n    // if directory is \"alive\" - copy the images there...\n    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0) {\n      return; //nothing to restore\n    }\n    /* We don\u0027t want more than one thread trying to restore at a time */\n    synchronized (this.restorationLock) {\n      LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n               \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n      for (StorageDirectory sd : this.removedStorageDirs) {\n        File root \u003d sd.getRoot();\n        LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n            \"; type\u003d\" + sd.getStorageDirType()\n            + \";canwrite\u003d\" + FileUtil.canWrite(root));\n        if (root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n          LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n          this.addStorageDir(sd); // restore\n          this.removedStorageDirs.remove(sd);\n        }\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
      "extendedDetails": {}
    },
    "3704e091a8d6c4181dfb29ac9d950e997b1170c0": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4610. Use common utils FileUtil#setReadable/Writable/Executable and FileUtil#canRead/Write/Execute. Contrbitued by Ivan Mitic.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1477427 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "29/04/13 5:35 PM",
      "commitName": "3704e091a8d6c4181dfb29ac9d950e997b1170c0",
      "commitAuthor": "Suresh Srinivas",
      "commitDateOld": "29/04/13 3:40 PM",
      "commitNameOld": "e2091275dc26745c4e919cd767283d32608a1817",
      "commitAuthorOld": "Suresh Srinivas",
      "daysBetweenCommits": 0.08,
      "commitsBetweenForRepo": 3,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,24 +1,24 @@\n   void attemptRestoreRemovedStorage() {\n     // if directory is \"alive\" - copy the images there...\n     if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n       return; //nothing to restore\n \n     /* We don\u0027t want more than one thread trying to restore at a time */\n     synchronized (this.restorationLock) {\n       LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n                \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n       for(Iterator\u003cStorageDirectory\u003e it\n             \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n         StorageDirectory sd \u003d it.next();\n         File root \u003d sd.getRoot();\n         LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n                  \"; type\u003d\"+sd.getStorageDirType() \n-                 + \";canwrite\u003d\"+root.canWrite());\n-        if(root.exists() \u0026\u0026 root.canWrite()) {\n+                 + \";canwrite\u003d\"+FileUtil.canWrite(root));\n+        if(root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n           LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n           this.addStorageDir(sd); // restore\n           this.removedStorageDirs.remove(sd);\n         }\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void attemptRestoreRemovedStorage() {\n    // if directory is \"alive\" - copy the images there...\n    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n      return; //nothing to restore\n\n    /* We don\u0027t want more than one thread trying to restore at a time */\n    synchronized (this.restorationLock) {\n      LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n               \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n      for(Iterator\u003cStorageDirectory\u003e it\n            \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n        StorageDirectory sd \u003d it.next();\n        File root \u003d sd.getRoot();\n        LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n                 \"; type\u003d\"+sd.getStorageDirType() \n                 + \";canwrite\u003d\"+FileUtil.canWrite(root));\n        if(root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n          LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n          this.addStorageDir(sd); // restore\n          this.removedStorageDirs.remove(sd);\n        }\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
      "extendedDetails": {}
    },
    "e2091275dc26745c4e919cd767283d32608a1817": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4610. Reverting the patch Jenkins build is not run.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1477396 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "29/04/13 3:40 PM",
      "commitName": "e2091275dc26745c4e919cd767283d32608a1817",
      "commitAuthor": "Suresh Srinivas",
      "commitDateOld": "29/04/13 3:26 PM",
      "commitNameOld": "fb30240b87500c1b3c9f8036bb9e6712ec8e2655",
      "commitAuthorOld": "Suresh Srinivas",
      "daysBetweenCommits": 0.01,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,24 +1,24 @@\n   void attemptRestoreRemovedStorage() {\n     // if directory is \"alive\" - copy the images there...\n     if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n       return; //nothing to restore\n \n     /* We don\u0027t want more than one thread trying to restore at a time */\n     synchronized (this.restorationLock) {\n       LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n                \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n       for(Iterator\u003cStorageDirectory\u003e it\n             \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n         StorageDirectory sd \u003d it.next();\n         File root \u003d sd.getRoot();\n         LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n                  \"; type\u003d\"+sd.getStorageDirType() \n-                 + \";canwrite\u003d\"+FileUtil.canWrite(root));\n-        if(root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n+                 + \";canwrite\u003d\"+root.canWrite());\n+        if(root.exists() \u0026\u0026 root.canWrite()) {\n           LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n           this.addStorageDir(sd); // restore\n           this.removedStorageDirs.remove(sd);\n         }\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void attemptRestoreRemovedStorage() {\n    // if directory is \"alive\" - copy the images there...\n    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n      return; //nothing to restore\n\n    /* We don\u0027t want more than one thread trying to restore at a time */\n    synchronized (this.restorationLock) {\n      LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n               \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n      for(Iterator\u003cStorageDirectory\u003e it\n            \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n        StorageDirectory sd \u003d it.next();\n        File root \u003d sd.getRoot();\n        LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n                 \"; type\u003d\"+sd.getStorageDirType() \n                 + \";canwrite\u003d\"+root.canWrite());\n        if(root.exists() \u0026\u0026 root.canWrite()) {\n          LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n          this.addStorageDir(sd); // restore\n          this.removedStorageDirs.remove(sd);\n        }\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
      "extendedDetails": {}
    },
    "fb30240b87500c1b3c9f8036bb9e6712ec8e2655": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4610. Use common utils FileUtil#setReadable/Writable/Executable \u0026 FileUtil#canRead/Write/Execute. Contributed by Ivan Mitic.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1477385 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "29/04/13 3:26 PM",
      "commitName": "fb30240b87500c1b3c9f8036bb9e6712ec8e2655",
      "commitAuthor": "Suresh Srinivas",
      "commitDateOld": "04/02/13 1:29 PM",
      "commitNameOld": "a8e39feed2642dbfedb8fd22648904ad4bb6af97",
      "commitAuthorOld": "Aaron Myers",
      "daysBetweenCommits": 84.04,
      "commitsBetweenForRepo": 426,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,24 +1,24 @@\n   void attemptRestoreRemovedStorage() {\n     // if directory is \"alive\" - copy the images there...\n     if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n       return; //nothing to restore\n \n     /* We don\u0027t want more than one thread trying to restore at a time */\n     synchronized (this.restorationLock) {\n       LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n                \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n       for(Iterator\u003cStorageDirectory\u003e it\n             \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n         StorageDirectory sd \u003d it.next();\n         File root \u003d sd.getRoot();\n         LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n                  \"; type\u003d\"+sd.getStorageDirType() \n-                 + \";canwrite\u003d\"+root.canWrite());\n-        if(root.exists() \u0026\u0026 root.canWrite()) {\n+                 + \";canwrite\u003d\"+FileUtil.canWrite(root));\n+        if(root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n           LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n           this.addStorageDir(sd); // restore\n           this.removedStorageDirs.remove(sd);\n         }\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void attemptRestoreRemovedStorage() {\n    // if directory is \"alive\" - copy the images there...\n    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n      return; //nothing to restore\n\n    /* We don\u0027t want more than one thread trying to restore at a time */\n    synchronized (this.restorationLock) {\n      LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n               \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n      for(Iterator\u003cStorageDirectory\u003e it\n            \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n        StorageDirectory sd \u003d it.next();\n        File root \u003d sd.getRoot();\n        LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n                 \"; type\u003d\"+sd.getStorageDirType() \n                 + \";canwrite\u003d\"+FileUtil.canWrite(root));\n        if(root.exists() \u0026\u0026 FileUtil.canWrite(root)) {\n          LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n          this.addStorageDir(sd); // restore\n          this.removedStorageDirs.remove(sd);\n        }\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
      "extendedDetails": {}
    },
    "cd7157784e5e5ddc4e77144d042e54dd0d04bac1": {
      "type": "Yfilerename",
      "commitMessage": "HADOOP-7560. Change src layout to be heirarchical. Contributed by Alejandro Abdelnur.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1161332 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "24/08/11 5:14 PM",
      "commitName": "cd7157784e5e5ddc4e77144d042e54dd0d04bac1",
      "commitAuthor": "Arun Murthy",
      "commitDateOld": "24/08/11 5:06 PM",
      "commitNameOld": "bb0005cfec5fd2861600ff5babd259b48ba18b63",
      "commitAuthorOld": "Arun Murthy",
      "daysBetweenCommits": 0.01,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "",
      "actualSource": "  void attemptRestoreRemovedStorage() {\n    // if directory is \"alive\" - copy the images there...\n    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n      return; //nothing to restore\n\n    /* We don\u0027t want more than one thread trying to restore at a time */\n    synchronized (this.restorationLock) {\n      LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n               \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n      for(Iterator\u003cStorageDirectory\u003e it\n            \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n        StorageDirectory sd \u003d it.next();\n        File root \u003d sd.getRoot();\n        LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n                 \"; type\u003d\"+sd.getStorageDirType() \n                 + \";canwrite\u003d\"+root.canWrite());\n        if(root.exists() \u0026\u0026 root.canWrite()) {\n          LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n          this.addStorageDir(sd); // restore\n          this.removedStorageDirs.remove(sd);\n        }\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
      "extendedDetails": {
        "oldPath": "hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
        "newPath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java"
      }
    },
    "d86f3183d93714ba078416af4f609d26376eadb0": {
      "type": "Yfilerename",
      "commitMessage": "HDFS-2096. Mavenization of hadoop-hdfs. Contributed by Alejandro Abdelnur.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1159702 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "19/08/11 10:36 AM",
      "commitName": "d86f3183d93714ba078416af4f609d26376eadb0",
      "commitAuthor": "Thomas White",
      "commitDateOld": "19/08/11 10:26 AM",
      "commitNameOld": "6ee5a73e0e91a2ef27753a32c576835e951d8119",
      "commitAuthorOld": "Thomas White",
      "daysBetweenCommits": 0.01,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "",
      "actualSource": "  void attemptRestoreRemovedStorage() {\n    // if directory is \"alive\" - copy the images there...\n    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n      return; //nothing to restore\n\n    /* We don\u0027t want more than one thread trying to restore at a time */\n    synchronized (this.restorationLock) {\n      LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n               \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n      for(Iterator\u003cStorageDirectory\u003e it\n            \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n        StorageDirectory sd \u003d it.next();\n        File root \u003d sd.getRoot();\n        LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n                 \"; type\u003d\"+sd.getStorageDirType() \n                 + \";canwrite\u003d\"+root.canWrite());\n        if(root.exists() \u0026\u0026 root.canWrite()) {\n          LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n          this.addStorageDir(sd); // restore\n          this.removedStorageDirs.remove(sd);\n        }\n      }\n    }\n  }",
      "path": "hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
      "extendedDetails": {
        "oldPath": "hdfs/src/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
        "newPath": "hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java"
      }
    },
    "28e6a4e44a3e920dcaf858f9a74a6358226b3a63": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-1073. Redesign the NameNode\u0027s storage layout for image checkpoints and edit logs to introduce transaction IDs and be more robust. Contributed by Todd Lipcon and Ivan Kelly.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1152295 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "29/07/11 9:28 AM",
      "commitName": "28e6a4e44a3e920dcaf858f9a74a6358226b3a63",
      "commitAuthor": "Todd Lipcon",
      "commitDateOld": "27/07/11 8:19 PM",
      "commitNameOld": "ffbe9e5972bf3eee9037e2602c1330e0dc744646",
      "commitAuthorOld": "Eli Collins",
      "daysBetweenCommits": 1.55,
      "commitsBetweenForRepo": 6,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,37 +1,24 @@\n   void attemptRestoreRemovedStorage() {\n     // if directory is \"alive\" - copy the images there...\n     if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n       return; //nothing to restore\n \n     /* We don\u0027t want more than one thread trying to restore at a time */\n     synchronized (this.restorationLock) {\n       LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n                \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n       for(Iterator\u003cStorageDirectory\u003e it\n             \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n         StorageDirectory sd \u003d it.next();\n         File root \u003d sd.getRoot();\n         LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n                  \"; type\u003d\"+sd.getStorageDirType() \n                  + \";canwrite\u003d\"+root.canWrite());\n-        try {\n-          \n-          if(root.exists() \u0026\u0026 root.canWrite()) {\n-            // when we try to restore we just need to remove all the data\n-            // without saving current in-memory state (which could\u0027ve changed).\n-            sd.clearDirectory();\n-            \n-            LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n-            for (NNStorageListener listener : listeners) {\n-              listener.directoryAvailable(sd);\n-            }\n-            \n-            this.addStorageDir(sd); // restore\n-            this.removedStorageDirs.remove(sd);\n-          }\n-        } catch(IOException e) {\n-          LOG.warn(\"failed to restore \" + sd.getRoot().getAbsolutePath(), e);\n+        if(root.exists() \u0026\u0026 root.canWrite()) {\n+          LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n+          this.addStorageDir(sd); // restore\n+          this.removedStorageDirs.remove(sd);\n         }\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void attemptRestoreRemovedStorage() {\n    // if directory is \"alive\" - copy the images there...\n    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n      return; //nothing to restore\n\n    /* We don\u0027t want more than one thread trying to restore at a time */\n    synchronized (this.restorationLock) {\n      LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n               \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n      for(Iterator\u003cStorageDirectory\u003e it\n            \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n        StorageDirectory sd \u003d it.next();\n        File root \u003d sd.getRoot();\n        LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n                 \"; type\u003d\"+sd.getStorageDirType() \n                 + \";canwrite\u003d\"+root.canWrite());\n        if(root.exists() \u0026\u0026 root.canWrite()) {\n          LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n          this.addStorageDir(sd); // restore\n          this.removedStorageDirs.remove(sd);\n        }\n      }\n    }\n  }",
      "path": "hdfs/src/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java",
      "extendedDetails": {}
    },
    "a196766ea07775f18ded69bd9e8d239f8cfd3ccc": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-7106. Reorganize SVN layout to combine HDFS, Common, and MR in a single tree (project unsplit)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1134994 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "12/06/11 3:00 PM",
      "commitName": "a196766ea07775f18ded69bd9e8d239f8cfd3ccc",
      "commitAuthor": "Todd Lipcon",
      "diff": "@@ -0,0 +1,37 @@\n+  void attemptRestoreRemovedStorage() {\n+    // if directory is \"alive\" - copy the images there...\n+    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n+      return; //nothing to restore\n+\n+    /* We don\u0027t want more than one thread trying to restore at a time */\n+    synchronized (this.restorationLock) {\n+      LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n+               \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n+      for(Iterator\u003cStorageDirectory\u003e it\n+            \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n+        StorageDirectory sd \u003d it.next();\n+        File root \u003d sd.getRoot();\n+        LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n+                 \"; type\u003d\"+sd.getStorageDirType() \n+                 + \";canwrite\u003d\"+root.canWrite());\n+        try {\n+          \n+          if(root.exists() \u0026\u0026 root.canWrite()) {\n+            // when we try to restore we just need to remove all the data\n+            // without saving current in-memory state (which could\u0027ve changed).\n+            sd.clearDirectory();\n+            \n+            LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n+            for (NNStorageListener listener : listeners) {\n+              listener.directoryAvailable(sd);\n+            }\n+            \n+            this.addStorageDir(sd); // restore\n+            this.removedStorageDirs.remove(sd);\n+          }\n+        } catch(IOException e) {\n+          LOG.warn(\"failed to restore \" + sd.getRoot().getAbsolutePath(), e);\n+        }\n+      }\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  void attemptRestoreRemovedStorage() {\n    // if directory is \"alive\" - copy the images there...\n    if(!restoreFailedStorage || removedStorageDirs.size() \u003d\u003d 0)\n      return; //nothing to restore\n\n    /* We don\u0027t want more than one thread trying to restore at a time */\n    synchronized (this.restorationLock) {\n      LOG.info(\"NNStorage.attemptRestoreRemovedStorage: check removed(failed) \"+\n               \"storarge. removedStorages size \u003d \" + removedStorageDirs.size());\n      for(Iterator\u003cStorageDirectory\u003e it\n            \u003d this.removedStorageDirs.iterator(); it.hasNext();) {\n        StorageDirectory sd \u003d it.next();\n        File root \u003d sd.getRoot();\n        LOG.info(\"currently disabled dir \" + root.getAbsolutePath() +\n                 \"; type\u003d\"+sd.getStorageDirType() \n                 + \";canwrite\u003d\"+root.canWrite());\n        try {\n          \n          if(root.exists() \u0026\u0026 root.canWrite()) {\n            // when we try to restore we just need to remove all the data\n            // without saving current in-memory state (which could\u0027ve changed).\n            sd.clearDirectory();\n            \n            LOG.info(\"restoring dir \" + sd.getRoot().getAbsolutePath());\n            for (NNStorageListener listener : listeners) {\n              listener.directoryAvailable(sd);\n            }\n            \n            this.addStorageDir(sd); // restore\n            this.removedStorageDirs.remove(sd);\n          }\n        } catch(IOException e) {\n          LOG.warn(\"failed to restore \" + sd.getRoot().getAbsolutePath(), e);\n        }\n      }\n    }\n  }",
      "path": "hdfs/src/java/org/apache/hadoop/hdfs/server/namenode/NNStorage.java"
    }
  }
}