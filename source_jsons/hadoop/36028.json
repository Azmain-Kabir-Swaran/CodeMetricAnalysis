{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "AdminService.java",
  "functionName": "addToClusterNodeLabels",
  "functionId": "addToClusterNodeLabels___request-AddToClusterNodeLabelsRequest",
  "sourceFilePath": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/AdminService.java",
  "functionStartLine": 796,
  "functionEndLine": 815,
  "numCommitsSeen": 78,
  "timeTaken": 2618,
  "changeHistory": [
    "e3153284288d6cfa7a28511dfefe1c8a7d6b4eda",
    "c63afdbe14df7359841aa4b213252a8a275e8c4b",
    "40ee4bff65b2bfdabfd16ee7d9be3382a0476565",
    "82567664988b673f1b819a42a4baf31cb0dcb331"
  ],
  "changeHistoryShort": {
    "e3153284288d6cfa7a28511dfefe1c8a7d6b4eda": "Ybodychange",
    "c63afdbe14df7359841aa4b213252a8a275e8c4b": "Ybodychange",
    "40ee4bff65b2bfdabfd16ee7d9be3382a0476565": "Ybodychange",
    "82567664988b673f1b819a42a4baf31cb0dcb331": "Yintroduced"
  },
  "changeHistoryDetails": {
    "e3153284288d6cfa7a28511dfefe1c8a7d6b4eda": {
      "type": "Ybodychange",
      "commitMessage": "YARN-6102. RMActiveService context to be updated with new RMContext on failover. Contributed by Rohith Sharma K S.\n",
      "commitDate": "23/07/17 11:09 PM",
      "commitName": "e3153284288d6cfa7a28511dfefe1c8a7d6b4eda",
      "commitAuthor": "Sunil G",
      "commitDateOld": "09/05/17 2:44 PM",
      "commitNameOld": "166be0ee95d5ef976f074342656b289b41a11ccd",
      "commitAuthorOld": "Karthik Kambatla",
      "daysBetweenCommits": 75.35,
      "commitsBetweenForRepo": 358,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,20 +1,20 @@\n   public AddToClusterNodeLabelsResponse addToClusterNodeLabels(AddToClusterNodeLabelsRequest request)\n       throws YarnException, IOException {\n     final String operation \u003d \"addToClusterNodeLabels\";\n     final String msg \u003d \"add labels.\";\n     UserGroupInformation user \u003d checkAcls(operation);\n \n     checkRMStatus(user.getShortUserName(), operation, msg);\n \n     AddToClusterNodeLabelsResponse response \u003d\n         recordFactory.newRecordInstance(AddToClusterNodeLabelsResponse.class);\n     try {\n-      rmContext.getNodeLabelManager()\n+      rm.getRMContext().getNodeLabelManager()\n           .addToCluserNodeLabels(request.getNodeLabels());\n       RMAuditLogger.logSuccess(user.getShortUserName(), operation,\n           \"AdminService\");\n       return response;\n     } catch (IOException ioe) {\n       throw logAndWrapException(ioe, user.getShortUserName(), operation, msg);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public AddToClusterNodeLabelsResponse addToClusterNodeLabels(AddToClusterNodeLabelsRequest request)\n      throws YarnException, IOException {\n    final String operation \u003d \"addToClusterNodeLabels\";\n    final String msg \u003d \"add labels.\";\n    UserGroupInformation user \u003d checkAcls(operation);\n\n    checkRMStatus(user.getShortUserName(), operation, msg);\n\n    AddToClusterNodeLabelsResponse response \u003d\n        recordFactory.newRecordInstance(AddToClusterNodeLabelsResponse.class);\n    try {\n      rm.getRMContext().getNodeLabelManager()\n          .addToCluserNodeLabels(request.getNodeLabels());\n      RMAuditLogger.logSuccess(user.getShortUserName(), operation,\n          \"AdminService\");\n      return response;\n    } catch (IOException ioe) {\n      throw logAndWrapException(ioe, user.getShortUserName(), operation, msg);\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/AdminService.java",
      "extendedDetails": {}
    },
    "c63afdbe14df7359841aa4b213252a8a275e8c4b": {
      "type": "Ybodychange",
      "commitMessage": "YARN-4883. Make consistent operation name in AdminService. Contributed by Kai Sasaki.\n",
      "commitDate": "20/07/16 4:51 PM",
      "commitName": "c63afdbe14df7359841aa4b213252a8a275e8c4b",
      "commitAuthor": "Akira Ajisaka",
      "commitDateOld": "09/04/16 10:31 AM",
      "commitNameOld": "ff95fd547b3030529983fa4e701ac728c54ab63a",
      "commitAuthorOld": "Karthik Kambatla",
      "daysBetweenCommits": 102.26,
      "commitsBetweenForRepo": 794,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,19 +1,19 @@\n   public AddToClusterNodeLabelsResponse addToClusterNodeLabels(AddToClusterNodeLabelsRequest request)\n       throws YarnException, IOException {\n-    String argName \u003d \"addToClusterNodeLabels\";\n+    final String operation \u003d \"addToClusterNodeLabels\";\n     final String msg \u003d \"add labels.\";\n-    UserGroupInformation user \u003d checkAcls(argName);\n+    UserGroupInformation user \u003d checkAcls(operation);\n \n-    checkRMStatus(user.getShortUserName(), argName, msg);\n+    checkRMStatus(user.getShortUserName(), operation, msg);\n \n     AddToClusterNodeLabelsResponse response \u003d\n         recordFactory.newRecordInstance(AddToClusterNodeLabelsResponse.class);\n     try {\n       rmContext.getNodeLabelManager().addToCluserNodeLabels(request.getNodeLabels());\n       RMAuditLogger\n-          .logSuccess(user.getShortUserName(), argName, \"AdminService\");\n+          .logSuccess(user.getShortUserName(), operation, \"AdminService\");\n       return response;\n     } catch (IOException ioe) {\n-      throw logAndWrapException(ioe, user.getShortUserName(), argName, msg);\n+      throw logAndWrapException(ioe, user.getShortUserName(), operation, msg);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public AddToClusterNodeLabelsResponse addToClusterNodeLabels(AddToClusterNodeLabelsRequest request)\n      throws YarnException, IOException {\n    final String operation \u003d \"addToClusterNodeLabels\";\n    final String msg \u003d \"add labels.\";\n    UserGroupInformation user \u003d checkAcls(operation);\n\n    checkRMStatus(user.getShortUserName(), operation, msg);\n\n    AddToClusterNodeLabelsResponse response \u003d\n        recordFactory.newRecordInstance(AddToClusterNodeLabelsResponse.class);\n    try {\n      rmContext.getNodeLabelManager().addToCluserNodeLabels(request.getNodeLabels());\n      RMAuditLogger\n          .logSuccess(user.getShortUserName(), operation, \"AdminService\");\n      return response;\n    } catch (IOException ioe) {\n      throw logAndWrapException(ioe, user.getShortUserName(), operation, msg);\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/AdminService.java",
      "extendedDetails": {}
    },
    "40ee4bff65b2bfdabfd16ee7d9be3382a0476565": {
      "type": "Ybodychange",
      "commitMessage": "YARN-2993. Several fixes (missing acl check, error log msg ...) and some refinement in AdminService. (Contributed by Yi Liu)\n",
      "commitDate": "26/12/14 6:59 AM",
      "commitName": "40ee4bff65b2bfdabfd16ee7d9be3382a0476565",
      "commitAuthor": "Junping Du",
      "commitDateOld": "30/10/14 10:59 PM",
      "commitNameOld": "e0233c16ebd06bb3aabeb523cd17259008e243ef",
      "commitAuthorOld": "Vinod Kumar Vavilapalli",
      "daysBetweenCommits": 56.37,
      "commitsBetweenForRepo": 427,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,26 +1,19 @@\n   public AddToClusterNodeLabelsResponse addToClusterNodeLabels(AddToClusterNodeLabelsRequest request)\n       throws YarnException, IOException {\n     String argName \u003d \"addToClusterNodeLabels\";\n+    final String msg \u003d \"add labels.\";\n     UserGroupInformation user \u003d checkAcls(argName);\n \n-    if (!isRMActive()) {\n-      RMAuditLogger.logFailure(user.getShortUserName(), argName,\n-          adminAcl.toString(), \"AdminService\",\n-          \"ResourceManager is not active. Can not add labels.\");\n-      throwStandbyException();\n-    }\n+    checkRMStatus(user.getShortUserName(), argName, msg);\n \n     AddToClusterNodeLabelsResponse response \u003d\n         recordFactory.newRecordInstance(AddToClusterNodeLabelsResponse.class);\n     try {\n       rmContext.getNodeLabelManager().addToCluserNodeLabels(request.getNodeLabels());\n       RMAuditLogger\n           .logSuccess(user.getShortUserName(), argName, \"AdminService\");\n       return response;\n     } catch (IOException ioe) {\n-      LOG.info(\"Exception add labels\", ioe);\n-      RMAuditLogger.logFailure(user.getShortUserName(), argName,\n-          adminAcl.toString(), \"AdminService\", \"Exception add label\");\n-      throw RPCUtil.getRemoteException(ioe);\n+      throw logAndWrapException(ioe, user.getShortUserName(), argName, msg);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public AddToClusterNodeLabelsResponse addToClusterNodeLabels(AddToClusterNodeLabelsRequest request)\n      throws YarnException, IOException {\n    String argName \u003d \"addToClusterNodeLabels\";\n    final String msg \u003d \"add labels.\";\n    UserGroupInformation user \u003d checkAcls(argName);\n\n    checkRMStatus(user.getShortUserName(), argName, msg);\n\n    AddToClusterNodeLabelsResponse response \u003d\n        recordFactory.newRecordInstance(AddToClusterNodeLabelsResponse.class);\n    try {\n      rmContext.getNodeLabelManager().addToCluserNodeLabels(request.getNodeLabels());\n      RMAuditLogger\n          .logSuccess(user.getShortUserName(), argName, \"AdminService\");\n      return response;\n    } catch (IOException ioe) {\n      throw logAndWrapException(ioe, user.getShortUserName(), argName, msg);\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/AdminService.java",
      "extendedDetails": {}
    },
    "82567664988b673f1b819a42a4baf31cb0dcb331": {
      "type": "Yintroduced",
      "commitMessage": "YARN-2504. Enhanced RM Admin CLI to support management of node-labels. Contribyted by Wangda Tan.\n",
      "commitDate": "18/10/14 12:07 PM",
      "commitName": "82567664988b673f1b819a42a4baf31cb0dcb331",
      "commitAuthor": "Vinod Kumar Vavilapalli",
      "diff": "@@ -0,0 +1,26 @@\n+  public AddToClusterNodeLabelsResponse addToClusterNodeLabels(AddToClusterNodeLabelsRequest request)\n+      throws YarnException, IOException {\n+    String argName \u003d \"addToClusterNodeLabels\";\n+    UserGroupInformation user \u003d checkAcls(argName);\n+\n+    if (!isRMActive()) {\n+      RMAuditLogger.logFailure(user.getShortUserName(), argName,\n+          adminAcl.toString(), \"AdminService\",\n+          \"ResourceManager is not active. Can not add labels.\");\n+      throwStandbyException();\n+    }\n+\n+    AddToClusterNodeLabelsResponse response \u003d\n+        recordFactory.newRecordInstance(AddToClusterNodeLabelsResponse.class);\n+    try {\n+      rmContext.getNodeLabelManager().addToCluserNodeLabels(request.getNodeLabels());\n+      RMAuditLogger\n+          .logSuccess(user.getShortUserName(), argName, \"AdminService\");\n+      return response;\n+    } catch (IOException ioe) {\n+      LOG.info(\"Exception add labels\", ioe);\n+      RMAuditLogger.logFailure(user.getShortUserName(), argName,\n+          adminAcl.toString(), \"AdminService\", \"Exception add label\");\n+      throw RPCUtil.getRemoteException(ioe);\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public AddToClusterNodeLabelsResponse addToClusterNodeLabels(AddToClusterNodeLabelsRequest request)\n      throws YarnException, IOException {\n    String argName \u003d \"addToClusterNodeLabels\";\n    UserGroupInformation user \u003d checkAcls(argName);\n\n    if (!isRMActive()) {\n      RMAuditLogger.logFailure(user.getShortUserName(), argName,\n          adminAcl.toString(), \"AdminService\",\n          \"ResourceManager is not active. Can not add labels.\");\n      throwStandbyException();\n    }\n\n    AddToClusterNodeLabelsResponse response \u003d\n        recordFactory.newRecordInstance(AddToClusterNodeLabelsResponse.class);\n    try {\n      rmContext.getNodeLabelManager().addToCluserNodeLabels(request.getNodeLabels());\n      RMAuditLogger\n          .logSuccess(user.getShortUserName(), argName, \"AdminService\");\n      return response;\n    } catch (IOException ioe) {\n      LOG.info(\"Exception add labels\", ioe);\n      RMAuditLogger.logFailure(user.getShortUserName(), argName,\n          adminAcl.toString(), \"AdminService\", \"Exception add label\");\n      throw RPCUtil.getRemoteException(ioe);\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/AdminService.java"
    }
  }
}