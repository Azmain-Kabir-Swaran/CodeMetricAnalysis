{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "CGroupsHandlerImpl.java",
  "functionName": "initializePreMountedCGroupController",
  "functionId": "initializePreMountedCGroupController___controller-CGroupController",
  "sourceFilePath": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/linux/resources/CGroupsHandlerImpl.java",
  "functionStartLine": 384,
  "functionEndLine": 438,
  "numCommitsSeen": 25,
  "timeTaken": 2596,
  "changeHistory": [
    "a2f680493f040704e2b85108e286731ee3860a52",
    "e6f13fe5d1df8918ffc680d18f9d5576f38893a6"
  ],
  "changeHistoryShort": {
    "a2f680493f040704e2b85108e286731ee3860a52": "Ymultichange(Ymodifierchange,Ybodychange)",
    "e6f13fe5d1df8918ffc680d18f9d5576f38893a6": "Yintroduced"
  },
  "changeHistoryDetails": {
    "a2f680493f040704e2b85108e286731ee3860a52": {
      "type": "Ymultichange(Ymodifierchange,Ybodychange)",
      "commitMessage": "YARN-5301. NM mount cpu cgroups failed on some systems\n(Contributed by Miklos Szegedi via Daniel Templeton)\n",
      "commitDate": "09/05/17 12:05 PM",
      "commitName": "a2f680493f040704e2b85108e286731ee3860a52",
      "commitAuthor": "Daniel Templeton",
      "subchanges": [
        {
          "type": "Ymodifierchange",
          "commitMessage": "YARN-5301. NM mount cpu cgroups failed on some systems\n(Contributed by Miklos Szegedi via Daniel Templeton)\n",
          "commitDate": "09/05/17 12:05 PM",
          "commitName": "a2f680493f040704e2b85108e286731ee3860a52",
          "commitAuthor": "Daniel Templeton",
          "commitDateOld": "24/04/17 11:37 AM",
          "commitNameOld": "8ac50e1322cb3f84bd998635924d85846aa47c94",
          "commitAuthorOld": "Haibo Chen",
          "daysBetweenCommits": 15.02,
          "commitsBetweenForRepo": 91,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,44 +1,55 @@\n-  public void initializePreMountedCGroupController(CGroupController controller)\n+  private void initializePreMountedCGroupController(CGroupController controller)\n       throws ResourceHandlerException {\n     // Check permissions to cgroup hierarchy and\n     // create YARN cgroup if it does not exist, yet\n-    File rootHierarchy \u003d new File(getControllerPath(controller));\n+    String controllerPath \u003d getControllerPath(controller);\n+\n+    if (controllerPath \u003d\u003d null) {\n+      throw new ResourceHandlerException(\n+          String.format(\"Controller %s not mounted.\"\n+                  + \" You either need to mount it with %s\"\n+                  + \" or mount cgroups before launching Yarn\",\n+              controller.getName(), YarnConfiguration.\n+                  NM_LINUX_CONTAINER_CGROUPS_MOUNT));\n+    }\n+\n+    File rootHierarchy \u003d new File(controllerPath);\n     File yarnHierarchy \u003d new File(rootHierarchy, cGroupPrefix);\n     String subsystemName \u003d controller.getName();\n \n     LOG.info(\"Initializing mounted controller \" + controller.getName() + \" \" +\n         \"at \" + yarnHierarchy);\n \n     if (!rootHierarchy.exists()) {\n       throw new ResourceHandlerException(getErrorWithDetails(\n               \"Cgroups mount point does not exist or not accessible\",\n               subsystemName,\n               rootHierarchy.getAbsolutePath()\n           ));\n     } else if (!yarnHierarchy.exists()) {\n       LOG.info(\"Yarn control group does not exist. Creating \" +\n           yarnHierarchy.getAbsolutePath());\n       try {\n         if (!yarnHierarchy.mkdir()) {\n           // Unexpected: we just checked that it was missing\n           throw new ResourceHandlerException(getErrorWithDetails(\n                   \"Unexpected: Cannot create yarn cgroup\",\n                   subsystemName,\n                   yarnHierarchy.getAbsolutePath()\n               ));\n         }\n       } catch (SecurityException e) {\n         throw new ResourceHandlerException(getErrorWithDetails(\n                 \"No permissions to create yarn cgroup\",\n                 subsystemName,\n                 yarnHierarchy.getAbsolutePath()\n             ), e);\n       }\n     } else if (!FileUtil.canWrite(yarnHierarchy)) {\n       throw new ResourceHandlerException(getErrorWithDetails(\n               \"Yarn control group not writable\",\n               subsystemName,\n               yarnHierarchy.getAbsolutePath()\n           ));\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void initializePreMountedCGroupController(CGroupController controller)\n      throws ResourceHandlerException {\n    // Check permissions to cgroup hierarchy and\n    // create YARN cgroup if it does not exist, yet\n    String controllerPath \u003d getControllerPath(controller);\n\n    if (controllerPath \u003d\u003d null) {\n      throw new ResourceHandlerException(\n          String.format(\"Controller %s not mounted.\"\n                  + \" You either need to mount it with %s\"\n                  + \" or mount cgroups before launching Yarn\",\n              controller.getName(), YarnConfiguration.\n                  NM_LINUX_CONTAINER_CGROUPS_MOUNT));\n    }\n\n    File rootHierarchy \u003d new File(controllerPath);\n    File yarnHierarchy \u003d new File(rootHierarchy, cGroupPrefix);\n    String subsystemName \u003d controller.getName();\n\n    LOG.info(\"Initializing mounted controller \" + controller.getName() + \" \" +\n        \"at \" + yarnHierarchy);\n\n    if (!rootHierarchy.exists()) {\n      throw new ResourceHandlerException(getErrorWithDetails(\n              \"Cgroups mount point does not exist or not accessible\",\n              subsystemName,\n              rootHierarchy.getAbsolutePath()\n          ));\n    } else if (!yarnHierarchy.exists()) {\n      LOG.info(\"Yarn control group does not exist. Creating \" +\n          yarnHierarchy.getAbsolutePath());\n      try {\n        if (!yarnHierarchy.mkdir()) {\n          // Unexpected: we just checked that it was missing\n          throw new ResourceHandlerException(getErrorWithDetails(\n                  \"Unexpected: Cannot create yarn cgroup\",\n                  subsystemName,\n                  yarnHierarchy.getAbsolutePath()\n              ));\n        }\n      } catch (SecurityException e) {\n        throw new ResourceHandlerException(getErrorWithDetails(\n                \"No permissions to create yarn cgroup\",\n                subsystemName,\n                yarnHierarchy.getAbsolutePath()\n            ), e);\n      }\n    } else if (!FileUtil.canWrite(yarnHierarchy)) {\n      throw new ResourceHandlerException(getErrorWithDetails(\n              \"Yarn control group not writable\",\n              subsystemName,\n              yarnHierarchy.getAbsolutePath()\n          ));\n    }\n  }",
          "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/linux/resources/CGroupsHandlerImpl.java",
          "extendedDetails": {
            "oldValue": "[public]",
            "newValue": "[private]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "YARN-5301. NM mount cpu cgroups failed on some systems\n(Contributed by Miklos Szegedi via Daniel Templeton)\n",
          "commitDate": "09/05/17 12:05 PM",
          "commitName": "a2f680493f040704e2b85108e286731ee3860a52",
          "commitAuthor": "Daniel Templeton",
          "commitDateOld": "24/04/17 11:37 AM",
          "commitNameOld": "8ac50e1322cb3f84bd998635924d85846aa47c94",
          "commitAuthorOld": "Haibo Chen",
          "daysBetweenCommits": 15.02,
          "commitsBetweenForRepo": 91,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,44 +1,55 @@\n-  public void initializePreMountedCGroupController(CGroupController controller)\n+  private void initializePreMountedCGroupController(CGroupController controller)\n       throws ResourceHandlerException {\n     // Check permissions to cgroup hierarchy and\n     // create YARN cgroup if it does not exist, yet\n-    File rootHierarchy \u003d new File(getControllerPath(controller));\n+    String controllerPath \u003d getControllerPath(controller);\n+\n+    if (controllerPath \u003d\u003d null) {\n+      throw new ResourceHandlerException(\n+          String.format(\"Controller %s not mounted.\"\n+                  + \" You either need to mount it with %s\"\n+                  + \" or mount cgroups before launching Yarn\",\n+              controller.getName(), YarnConfiguration.\n+                  NM_LINUX_CONTAINER_CGROUPS_MOUNT));\n+    }\n+\n+    File rootHierarchy \u003d new File(controllerPath);\n     File yarnHierarchy \u003d new File(rootHierarchy, cGroupPrefix);\n     String subsystemName \u003d controller.getName();\n \n     LOG.info(\"Initializing mounted controller \" + controller.getName() + \" \" +\n         \"at \" + yarnHierarchy);\n \n     if (!rootHierarchy.exists()) {\n       throw new ResourceHandlerException(getErrorWithDetails(\n               \"Cgroups mount point does not exist or not accessible\",\n               subsystemName,\n               rootHierarchy.getAbsolutePath()\n           ));\n     } else if (!yarnHierarchy.exists()) {\n       LOG.info(\"Yarn control group does not exist. Creating \" +\n           yarnHierarchy.getAbsolutePath());\n       try {\n         if (!yarnHierarchy.mkdir()) {\n           // Unexpected: we just checked that it was missing\n           throw new ResourceHandlerException(getErrorWithDetails(\n                   \"Unexpected: Cannot create yarn cgroup\",\n                   subsystemName,\n                   yarnHierarchy.getAbsolutePath()\n               ));\n         }\n       } catch (SecurityException e) {\n         throw new ResourceHandlerException(getErrorWithDetails(\n                 \"No permissions to create yarn cgroup\",\n                 subsystemName,\n                 yarnHierarchy.getAbsolutePath()\n             ), e);\n       }\n     } else if (!FileUtil.canWrite(yarnHierarchy)) {\n       throw new ResourceHandlerException(getErrorWithDetails(\n               \"Yarn control group not writable\",\n               subsystemName,\n               yarnHierarchy.getAbsolutePath()\n           ));\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void initializePreMountedCGroupController(CGroupController controller)\n      throws ResourceHandlerException {\n    // Check permissions to cgroup hierarchy and\n    // create YARN cgroup if it does not exist, yet\n    String controllerPath \u003d getControllerPath(controller);\n\n    if (controllerPath \u003d\u003d null) {\n      throw new ResourceHandlerException(\n          String.format(\"Controller %s not mounted.\"\n                  + \" You either need to mount it with %s\"\n                  + \" or mount cgroups before launching Yarn\",\n              controller.getName(), YarnConfiguration.\n                  NM_LINUX_CONTAINER_CGROUPS_MOUNT));\n    }\n\n    File rootHierarchy \u003d new File(controllerPath);\n    File yarnHierarchy \u003d new File(rootHierarchy, cGroupPrefix);\n    String subsystemName \u003d controller.getName();\n\n    LOG.info(\"Initializing mounted controller \" + controller.getName() + \" \" +\n        \"at \" + yarnHierarchy);\n\n    if (!rootHierarchy.exists()) {\n      throw new ResourceHandlerException(getErrorWithDetails(\n              \"Cgroups mount point does not exist or not accessible\",\n              subsystemName,\n              rootHierarchy.getAbsolutePath()\n          ));\n    } else if (!yarnHierarchy.exists()) {\n      LOG.info(\"Yarn control group does not exist. Creating \" +\n          yarnHierarchy.getAbsolutePath());\n      try {\n        if (!yarnHierarchy.mkdir()) {\n          // Unexpected: we just checked that it was missing\n          throw new ResourceHandlerException(getErrorWithDetails(\n                  \"Unexpected: Cannot create yarn cgroup\",\n                  subsystemName,\n                  yarnHierarchy.getAbsolutePath()\n              ));\n        }\n      } catch (SecurityException e) {\n        throw new ResourceHandlerException(getErrorWithDetails(\n                \"No permissions to create yarn cgroup\",\n                subsystemName,\n                yarnHierarchy.getAbsolutePath()\n            ), e);\n      }\n    } else if (!FileUtil.canWrite(yarnHierarchy)) {\n      throw new ResourceHandlerException(getErrorWithDetails(\n              \"Yarn control group not writable\",\n              subsystemName,\n              yarnHierarchy.getAbsolutePath()\n          ));\n    }\n  }",
          "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/linux/resources/CGroupsHandlerImpl.java",
          "extendedDetails": {}
        }
      ]
    },
    "e6f13fe5d1df8918ffc680d18f9d5576f38893a6": {
      "type": "Yintroduced",
      "commitMessage": "YARN-5849. Automatically create YARN control group for pre-mounted cgroups (Contributed by Miklos Szegedi via Daniel Templeton)\n",
      "commitDate": "11/01/17 4:00 PM",
      "commitName": "e6f13fe5d1df8918ffc680d18f9d5576f38893a6",
      "commitAuthor": "Daniel Templeton",
      "diff": "@@ -0,0 +1,44 @@\n+  public void initializePreMountedCGroupController(CGroupController controller)\n+      throws ResourceHandlerException {\n+    // Check permissions to cgroup hierarchy and\n+    // create YARN cgroup if it does not exist, yet\n+    File rootHierarchy \u003d new File(getControllerPath(controller));\n+    File yarnHierarchy \u003d new File(rootHierarchy, cGroupPrefix);\n+    String subsystemName \u003d controller.getName();\n+\n+    LOG.info(\"Initializing mounted controller \" + controller.getName() + \" \" +\n+        \"at \" + yarnHierarchy);\n+\n+    if (!rootHierarchy.exists()) {\n+      throw new ResourceHandlerException(getErrorWithDetails(\n+              \"Cgroups mount point does not exist or not accessible\",\n+              subsystemName,\n+              rootHierarchy.getAbsolutePath()\n+          ));\n+    } else if (!yarnHierarchy.exists()) {\n+      LOG.info(\"Yarn control group does not exist. Creating \" +\n+          yarnHierarchy.getAbsolutePath());\n+      try {\n+        if (!yarnHierarchy.mkdir()) {\n+          // Unexpected: we just checked that it was missing\n+          throw new ResourceHandlerException(getErrorWithDetails(\n+                  \"Unexpected: Cannot create yarn cgroup\",\n+                  subsystemName,\n+                  yarnHierarchy.getAbsolutePath()\n+              ));\n+        }\n+      } catch (SecurityException e) {\n+        throw new ResourceHandlerException(getErrorWithDetails(\n+                \"No permissions to create yarn cgroup\",\n+                subsystemName,\n+                yarnHierarchy.getAbsolutePath()\n+            ), e);\n+      }\n+    } else if (!FileUtil.canWrite(yarnHierarchy)) {\n+      throw new ResourceHandlerException(getErrorWithDetails(\n+              \"Yarn control group not writable\",\n+              subsystemName,\n+              yarnHierarchy.getAbsolutePath()\n+          ));\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public void initializePreMountedCGroupController(CGroupController controller)\n      throws ResourceHandlerException {\n    // Check permissions to cgroup hierarchy and\n    // create YARN cgroup if it does not exist, yet\n    File rootHierarchy \u003d new File(getControllerPath(controller));\n    File yarnHierarchy \u003d new File(rootHierarchy, cGroupPrefix);\n    String subsystemName \u003d controller.getName();\n\n    LOG.info(\"Initializing mounted controller \" + controller.getName() + \" \" +\n        \"at \" + yarnHierarchy);\n\n    if (!rootHierarchy.exists()) {\n      throw new ResourceHandlerException(getErrorWithDetails(\n              \"Cgroups mount point does not exist or not accessible\",\n              subsystemName,\n              rootHierarchy.getAbsolutePath()\n          ));\n    } else if (!yarnHierarchy.exists()) {\n      LOG.info(\"Yarn control group does not exist. Creating \" +\n          yarnHierarchy.getAbsolutePath());\n      try {\n        if (!yarnHierarchy.mkdir()) {\n          // Unexpected: we just checked that it was missing\n          throw new ResourceHandlerException(getErrorWithDetails(\n                  \"Unexpected: Cannot create yarn cgroup\",\n                  subsystemName,\n                  yarnHierarchy.getAbsolutePath()\n              ));\n        }\n      } catch (SecurityException e) {\n        throw new ResourceHandlerException(getErrorWithDetails(\n                \"No permissions to create yarn cgroup\",\n                subsystemName,\n                yarnHierarchy.getAbsolutePath()\n            ), e);\n      }\n    } else if (!FileUtil.canWrite(yarnHierarchy)) {\n      throw new ResourceHandlerException(getErrorWithDetails(\n              \"Yarn control group not writable\",\n              subsystemName,\n              yarnHierarchy.getAbsolutePath()\n          ));\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/linux/resources/CGroupsHandlerImpl.java"
    }
  }
}