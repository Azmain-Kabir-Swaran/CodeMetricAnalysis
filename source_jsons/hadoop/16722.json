{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "MountTableRefresherThread.java",
  "functionName": "run",
  "functionId": "run",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/MountTableRefresherThread.java",
  "functionStartLine": 64,
  "functionEndLine": 82,
  "numCommitsSeen": 2,
  "timeTaken": 1289,
  "changeHistory": [
    "8e6227441ab31f3ad37998f76faa131e11b0cfe9",
    "8f6f9d9c8398567064c9369f48213db63f45538c"
  ],
  "changeHistoryShort": {
    "8e6227441ab31f3ad37998f76faa131e11b0cfe9": "Ybodychange",
    "8f6f9d9c8398567064c9369f48213db63f45538c": "Yintroduced"
  },
  "changeHistoryDetails": {
    "8e6227441ab31f3ad37998f76faa131e11b0cfe9": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-15218. RBF: MountTableRefresherService failed to refresh other router MountTableEntries in secure mode. Contributed by Surendra Singh Lilhore.\n",
      "commitDate": "18/04/20 7:37 AM",
      "commitName": "8e6227441ab31f3ad37998f76faa131e11b0cfe9",
      "commitAuthor": "Surendra Singh Lilhore",
      "commitDateOld": "24/06/19 9:33 AM",
      "commitNameOld": "8f6f9d9c8398567064c9369f48213db63f45538c",
      "commitAuthorOld": "Yiqun Lin",
      "daysBetweenCommits": 298.92,
      "commitsBetweenForRepo": 1609,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,13 +1,19 @@\n   public void run() {\n     try {\n-      RefreshMountTableEntriesResponse refreshMountTableEntries \u003d\n-          manager.refreshMountTableEntries(\n-              RefreshMountTableEntriesRequest.newInstance());\n-      success \u003d refreshMountTableEntries.getResult();\n+      SecurityUtil.doAsLoginUser(() -\u003e {\n+        if (UserGroupInformation.isSecurityEnabled()) {\n+          UserGroupInformation.getLoginUser().checkTGTAndReloginFromKeytab();\n+        }\n+        RefreshMountTableEntriesResponse refreshMountTableEntries \u003d manager\n+            .refreshMountTableEntries(\n+                RefreshMountTableEntriesRequest.newInstance());\n+        success \u003d refreshMountTableEntries.getResult();\n+        return true;\n+      });\n     } catch (IOException e) {\n       LOG.error(\"Failed to refresh mount table entries cache at router {}\",\n           adminAddress, e);\n     } finally {\n       countDownLatch.countDown();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void run() {\n    try {\n      SecurityUtil.doAsLoginUser(() -\u003e {\n        if (UserGroupInformation.isSecurityEnabled()) {\n          UserGroupInformation.getLoginUser().checkTGTAndReloginFromKeytab();\n        }\n        RefreshMountTableEntriesResponse refreshMountTableEntries \u003d manager\n            .refreshMountTableEntries(\n                RefreshMountTableEntriesRequest.newInstance());\n        success \u003d refreshMountTableEntries.getResult();\n        return true;\n      });\n    } catch (IOException e) {\n      LOG.error(\"Failed to refresh mount table entries cache at router {}\",\n          adminAddress, e);\n    } finally {\n      countDownLatch.countDown();\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/MountTableRefresherThread.java",
      "extendedDetails": {}
    },
    "8f6f9d9c8398567064c9369f48213db63f45538c": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-13443. RBF: Update mount table cache immediately after changing (add/update/remove) mount table entries. Contributed by Mohammad Arshad.\n",
      "commitDate": "24/06/19 9:33 AM",
      "commitName": "8f6f9d9c8398567064c9369f48213db63f45538c",
      "commitAuthor": "Yiqun Lin",
      "diff": "@@ -0,0 +1,13 @@\n+  public void run() {\n+    try {\n+      RefreshMountTableEntriesResponse refreshMountTableEntries \u003d\n+          manager.refreshMountTableEntries(\n+              RefreshMountTableEntriesRequest.newInstance());\n+      success \u003d refreshMountTableEntries.getResult();\n+    } catch (IOException e) {\n+      LOG.error(\"Failed to refresh mount table entries cache at router {}\",\n+          adminAddress, e);\n+    } finally {\n+      countDownLatch.countDown();\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public void run() {\n    try {\n      RefreshMountTableEntriesResponse refreshMountTableEntries \u003d\n          manager.refreshMountTableEntries(\n              RefreshMountTableEntriesRequest.newInstance());\n      success \u003d refreshMountTableEntries.getResult();\n    } catch (IOException e) {\n      LOG.error(\"Failed to refresh mount table entries cache at router {}\",\n          adminAddress, e);\n    } finally {\n      countDownLatch.countDown();\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/MountTableRefresherThread.java"
    }
  }
}