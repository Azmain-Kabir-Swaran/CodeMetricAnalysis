{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "CustomTokenProviderAdapter.java",
  "functionName": "refreshToken",
  "functionId": "refreshToken",
  "sourceFilePath": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/CustomTokenProviderAdapter.java",
  "functionStartLine": 58,
  "functionEndLine": 104,
  "numCommitsSeen": 4,
  "timeTaken": 1310,
  "changeHistory": [
    "3d69383c26649e272ce591061c919b8c96ee7cfc",
    "9149b9703e3ab09abdc087db129e82ad3f4cefa1"
  ],
  "changeHistoryShort": {
    "3d69383c26649e272ce591061c919b8c96ee7cfc": "Ybodychange",
    "9149b9703e3ab09abdc087db129e82ad3f4cefa1": "Yintroduced"
  },
  "changeHistoryDetails": {
    "3d69383c26649e272ce591061c919b8c96ee7cfc": {
      "type": "Ybodychange",
      "commitMessage": "Hadoop 16857. ABFS: Stop CustomTokenProvider retry logic to depend on AbfsRestOp retry policy\n\nContributed by Sneha Vijayarajan",
      "commitDate": "21/04/20 9:39 PM",
      "commitName": "3d69383c26649e272ce591061c919b8c96ee7cfc",
      "commitAuthor": "Sneha Vijayarajan",
      "commitDateOld": "28/02/19 6:22 AM",
      "commitNameOld": "65f60e56b082faf92e1cd3daee2569d8fc669c67",
      "commitAuthorOld": "Steve Loughran",
      "daysBetweenCommits": 418.6,
      "commitsBetweenForRepo": 2422,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,9 +1,47 @@\n   protected AzureADToken refreshToken() throws IOException {\n     LOG.debug(\"AADToken: refreshing custom based token\");\n \n     AzureADToken azureADToken \u003d new AzureADToken();\n-    azureADToken.setAccessToken(adaptee.getAccessToken());\n+\n+    String accessToken \u003d null;\n+\n+    Exception ex;\n+    boolean succeeded \u003d false;\n+    // Custom token providers should have their own retry policies,\n+    // Providing a linear retry option for the the retry count\n+    // mentioned in config \"fs.azure.custom.token.fetch.retry.count\"\n+    int retryCount \u003d fetchTokenRetryCount;\n+    do {\n+      ex \u003d null;\n+      try {\n+        accessToken \u003d adaptee.getAccessToken();\n+        LOG.trace(\"CustomTokenProvider Access token fetch was successful with retry count {}\",\n+            (fetchTokenRetryCount - retryCount));\n+      } catch (Exception e) {\n+        LOG.debug(\"CustomTokenProvider Access token fetch failed with retry count {}\",\n+            (fetchTokenRetryCount - retryCount));\n+        ex \u003d e;\n+      }\n+\n+      succeeded \u003d (ex \u003d\u003d null);\n+      retryCount--;\n+    } while (!succeeded \u0026\u0026 (retryCount) \u003e\u003d 0);\n+\n+    if (!succeeded) {\n+      HttpException httpEx \u003d new HttpException(\n+          -1,\n+          \"\",\n+          String.format(\"CustomTokenProvider getAccessToken threw %s : %s\",\n+              ex.getClass().getTypeName(), ex.getMessage()),\n+          \"\",\n+          \"\",\n+          \"\"\n+      );\n+      throw httpEx;\n+    }\n+\n+    azureADToken.setAccessToken(accessToken);\n     azureADToken.setExpiry(adaptee.getExpiryTime());\n \n     return azureADToken;\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected AzureADToken refreshToken() throws IOException {\n    LOG.debug(\"AADToken: refreshing custom based token\");\n\n    AzureADToken azureADToken \u003d new AzureADToken();\n\n    String accessToken \u003d null;\n\n    Exception ex;\n    boolean succeeded \u003d false;\n    // Custom token providers should have their own retry policies,\n    // Providing a linear retry option for the the retry count\n    // mentioned in config \"fs.azure.custom.token.fetch.retry.count\"\n    int retryCount \u003d fetchTokenRetryCount;\n    do {\n      ex \u003d null;\n      try {\n        accessToken \u003d adaptee.getAccessToken();\n        LOG.trace(\"CustomTokenProvider Access token fetch was successful with retry count {}\",\n            (fetchTokenRetryCount - retryCount));\n      } catch (Exception e) {\n        LOG.debug(\"CustomTokenProvider Access token fetch failed with retry count {}\",\n            (fetchTokenRetryCount - retryCount));\n        ex \u003d e;\n      }\n\n      succeeded \u003d (ex \u003d\u003d null);\n      retryCount--;\n    } while (!succeeded \u0026\u0026 (retryCount) \u003e\u003d 0);\n\n    if (!succeeded) {\n      HttpException httpEx \u003d new HttpException(\n          -1,\n          \"\",\n          String.format(\"CustomTokenProvider getAccessToken threw %s : %s\",\n              ex.getClass().getTypeName(), ex.getMessage()),\n          \"\",\n          \"\",\n          \"\"\n      );\n      throw httpEx;\n    }\n\n    azureADToken.setAccessToken(accessToken);\n    azureADToken.setExpiry(adaptee.getExpiryTime());\n\n    return azureADToken;\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/CustomTokenProviderAdapter.java",
      "extendedDetails": {}
    },
    "9149b9703e3ab09abdc087db129e82ad3f4cefa1": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-15660. ABFS: Add support for OAuth\nContributed by Da Zhou, Rajeev Bansal, and Junhua Gu.\n",
      "commitDate": "17/09/18 12:54 PM",
      "commitName": "9149b9703e3ab09abdc087db129e82ad3f4cefa1",
      "commitAuthor": "Thomas Marquardt",
      "diff": "@@ -0,0 +1,9 @@\n+  protected AzureADToken refreshToken() throws IOException {\n+    LOG.debug(\"AADToken: refreshing custom based token\");\n+\n+    AzureADToken azureADToken \u003d new AzureADToken();\n+    azureADToken.setAccessToken(adaptee.getAccessToken());\n+    azureADToken.setExpiry(adaptee.getExpiryTime());\n+\n+    return azureADToken;\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  protected AzureADToken refreshToken() throws IOException {\n    LOG.debug(\"AADToken: refreshing custom based token\");\n\n    AzureADToken azureADToken \u003d new AzureADToken();\n    azureADToken.setAccessToken(adaptee.getAccessToken());\n    azureADToken.setExpiry(adaptee.getExpiryTime());\n\n    return azureADToken;\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/CustomTokenProviderAdapter.java"
    }
  }
}