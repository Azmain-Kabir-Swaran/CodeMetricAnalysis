{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "ErasureCodingPolicyManager.java",
  "functionName": "enableDefaultPolicy",
  "functionId": "enableDefaultPolicy___conf-Configuration",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/ErasureCodingPolicyManager.java",
  "functionStartLine": 494,
  "functionEndLine": 516,
  "numCommitsSeen": 34,
  "timeTaken": 1283,
  "changeHistory": [
    "8d99648c203004045a9339ad27258092969145d6"
  ],
  "changeHistoryShort": {
    "8d99648c203004045a9339ad27258092969145d6": "Yintroduced"
  },
  "changeHistoryDetails": {
    "8d99648c203004045a9339ad27258092969145d6": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-14039. ec -listPolicies doesn\u0027t show correct state for the default policy when the default is not RS(6,3). Contributed by Kitti Nanasi.\n\nSigned-off-by: Xiao Chen \u003cxiao@apache.org\u003e\n",
      "commitDate": "08/11/18 10:01 AM",
      "commitName": "8d99648c203004045a9339ad27258092969145d6",
      "commitAuthor": "Kitti Nanasi",
      "diff": "@@ -0,0 +1,23 @@\n+  private void enableDefaultPolicy(Configuration conf) throws IOException {\n+    defaultPolicyName \u003d conf.getTrimmed(\n+        DFSConfigKeys.DFS_NAMENODE_EC_SYSTEM_DEFAULT_POLICY,\n+        DFSConfigKeys.DFS_NAMENODE_EC_SYSTEM_DEFAULT_POLICY_DEFAULT);\n+    if (!defaultPolicyName.isEmpty()) {\n+      final ErasureCodingPolicyInfo info \u003d\n+          policiesByName.get(defaultPolicyName);\n+      if (info \u003d\u003d null) {\n+        String names \u003d policiesByName.values()\n+            .stream().map((pi) -\u003e pi.getPolicy().getName())\n+            .collect(Collectors.joining(\", \"));\n+        String msg \u003d String.format(\"EC policy \u0027%s\u0027 specified at %s is not a \"\n+                + \"valid policy. Please choose from list of available \"\n+                + \"policies: [%s]\",\n+            defaultPolicyName,\n+            DFSConfigKeys.DFS_NAMENODE_EC_SYSTEM_DEFAULT_POLICY,\n+            names);\n+        throw new IOException(msg);\n+      }\n+      info.setState(ErasureCodingPolicyState.ENABLED);\n+      enabledPoliciesByName.put(info.getPolicy().getName(), info.getPolicy());\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  private void enableDefaultPolicy(Configuration conf) throws IOException {\n    defaultPolicyName \u003d conf.getTrimmed(\n        DFSConfigKeys.DFS_NAMENODE_EC_SYSTEM_DEFAULT_POLICY,\n        DFSConfigKeys.DFS_NAMENODE_EC_SYSTEM_DEFAULT_POLICY_DEFAULT);\n    if (!defaultPolicyName.isEmpty()) {\n      final ErasureCodingPolicyInfo info \u003d\n          policiesByName.get(defaultPolicyName);\n      if (info \u003d\u003d null) {\n        String names \u003d policiesByName.values()\n            .stream().map((pi) -\u003e pi.getPolicy().getName())\n            .collect(Collectors.joining(\", \"));\n        String msg \u003d String.format(\"EC policy \u0027%s\u0027 specified at %s is not a \"\n                + \"valid policy. Please choose from list of available \"\n                + \"policies: [%s]\",\n            defaultPolicyName,\n            DFSConfigKeys.DFS_NAMENODE_EC_SYSTEM_DEFAULT_POLICY,\n            names);\n        throw new IOException(msg);\n      }\n      info.setState(ErasureCodingPolicyState.ENABLED);\n      enabledPoliciesByName.put(info.getPolicy().getName(), info.getPolicy());\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/ErasureCodingPolicyManager.java"
    }
  }
}