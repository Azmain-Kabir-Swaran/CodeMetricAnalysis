{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "CosNFileSystem.java",
  "functionName": "listStatus",
  "functionId": "listStatus___f-Path",
  "sourceFilePath": "hadoop-cloud-storage-project/hadoop-cos/src/main/java/org/apache/hadoop/fs/cosn/CosNFileSystem.java",
  "functionStartLine": 412,
  "functionEndLine": 454,
  "numCommitsSeen": 1,
  "timeTaken": 375,
  "changeHistory": [
    "8a9ede5cff816b66afc37e7c9d2b33aee48795d2"
  ],
  "changeHistoryShort": {
    "8a9ede5cff816b66afc37e7c9d2b33aee48795d2": "Yintroduced"
  },
  "changeHistoryDetails": {
    "8a9ede5cff816b66afc37e7c9d2b33aee48795d2": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-15616. Incorporate Tencent Cloud COS File System Implementation. Contributed by Yang Yu.\n",
      "commitDate": "27/09/19 1:53 AM",
      "commitName": "8a9ede5cff816b66afc37e7c9d2b33aee48795d2",
      "commitAuthor": "Sammi Chen",
      "diff": "@@ -0,0 +1,43 @@\n+  public FileStatus[] listStatus(Path f) throws IOException {\n+    Path absolutePath \u003d makeAbsolute(f);\n+    String key \u003d pathToKey(absolutePath);\n+\n+    if (key.length() \u003e 0) {\n+      FileStatus fileStatus \u003d this.getFileStatus(f);\n+      if (fileStatus.isFile()) {\n+        return new FileStatus[]{fileStatus};\n+      }\n+    }\n+\n+    if (!key.endsWith(PATH_DELIMITER)) {\n+      key +\u003d PATH_DELIMITER;\n+    }\n+\n+    URI pathUri \u003d absolutePath.toUri();\n+    Set\u003cFileStatus\u003e status \u003d new TreeSet\u003c\u003e();\n+    String priorLastKey \u003d null;\n+    do {\n+      PartialListing listing \u003d store.list(\n+          key, Constants.COS_MAX_LISTING_LENGTH, priorLastKey, false);\n+      for (FileMetadata fileMetadata : listing.getFiles()) {\n+        Path subPath \u003d keyToPath(fileMetadata.getKey());\n+        if (fileMetadata.getKey().equals(key)) {\n+          // this is just the directory we have been asked to list.\n+          LOG.debug(\"The file list contains the COS key [{}] to be listed.\",\n+              key);\n+        } else {\n+          status.add(newFile(fileMetadata, subPath));\n+        }\n+      }\n+\n+      for (FileMetadata commonPrefix : listing.getCommonPrefixes()) {\n+        Path subPath \u003d keyToPath(commonPrefix.getKey());\n+        String relativePath \u003d pathUri.relativize(subPath.toUri()).getPath();\n+        status.add(\n+            newDirectory(commonPrefix, new Path(absolutePath, relativePath)));\n+      }\n+      priorLastKey \u003d listing.getPriorLastKey();\n+    } while (priorLastKey !\u003d null);\n+\n+    return status.toArray(new FileStatus[status.size()]);\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public FileStatus[] listStatus(Path f) throws IOException {\n    Path absolutePath \u003d makeAbsolute(f);\n    String key \u003d pathToKey(absolutePath);\n\n    if (key.length() \u003e 0) {\n      FileStatus fileStatus \u003d this.getFileStatus(f);\n      if (fileStatus.isFile()) {\n        return new FileStatus[]{fileStatus};\n      }\n    }\n\n    if (!key.endsWith(PATH_DELIMITER)) {\n      key +\u003d PATH_DELIMITER;\n    }\n\n    URI pathUri \u003d absolutePath.toUri();\n    Set\u003cFileStatus\u003e status \u003d new TreeSet\u003c\u003e();\n    String priorLastKey \u003d null;\n    do {\n      PartialListing listing \u003d store.list(\n          key, Constants.COS_MAX_LISTING_LENGTH, priorLastKey, false);\n      for (FileMetadata fileMetadata : listing.getFiles()) {\n        Path subPath \u003d keyToPath(fileMetadata.getKey());\n        if (fileMetadata.getKey().equals(key)) {\n          // this is just the directory we have been asked to list.\n          LOG.debug(\"The file list contains the COS key [{}] to be listed.\",\n              key);\n        } else {\n          status.add(newFile(fileMetadata, subPath));\n        }\n      }\n\n      for (FileMetadata commonPrefix : listing.getCommonPrefixes()) {\n        Path subPath \u003d keyToPath(commonPrefix.getKey());\n        String relativePath \u003d pathUri.relativize(subPath.toUri()).getPath();\n        status.add(\n            newDirectory(commonPrefix, new Path(absolutePath, relativePath)));\n      }\n      priorLastKey \u003d listing.getPriorLastKey();\n    } while (priorLastKey !\u003d null);\n\n    return status.toArray(new FileStatus[status.size()]);\n  }",
      "path": "hadoop-cloud-storage-project/hadoop-cos/src/main/java/org/apache/hadoop/fs/cosn/CosNFileSystem.java"
    }
  }
}