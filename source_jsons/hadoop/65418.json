{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "S3Guard.java",
  "functionName": "putWithTtl",
  "functionId": "putWithTtl___ms-MetadataStore__dirMeta-DirListingMetadata__unchangedEntries-List__Path__(modifiers-final)__timeProvider-ITtlTimeProvider(modifiers-final)__operationState-BulkOperationState(annotations-@Nullable__modifiers-final)",
  "sourceFilePath": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3Guard.java",
  "functionStartLine": 816,
  "functionEndLine": 827,
  "numCommitsSeen": 57,
  "timeTaken": 4549,
  "changeHistory": [
    "7f40e6688a5716fca53e1090d8347a43064d6d43",
    "e02eb24e0a9139418120027b694492e0738df20a",
    "f9cc9e162175444efe9d5b07ecb9a795f750ca3c",
    "046b8768af8a07a9e10ce43f538d6ac16e7fa5f3"
  ],
  "changeHistoryShort": {
    "7f40e6688a5716fca53e1090d8347a43064d6d43": "Ymultichange(Yparameterchange,Ybodychange)",
    "e02eb24e0a9139418120027b694492e0738df20a": "Ymultichange(Yparameterchange,Ybodychange,Yparametermetachange)",
    "f9cc9e162175444efe9d5b07ecb9a795f750ca3c": "Ybodychange",
    "046b8768af8a07a9e10ce43f538d6ac16e7fa5f3": "Yintroduced"
  },
  "changeHistoryDetails": {
    "7f40e6688a5716fca53e1090d8347a43064d6d43": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HADOOP-16746. mkdirs and s3guard Authoritative mode.\n\nContributed by Steve Loughran.\n\nThis fixes two problems with S3Guard authoritative mode and\nthe auth directory flags which are stored in DynamoDB.\n\n1. mkdirs was creating dir markers without the auth bit,\n   forcing needless scans on newly created directories and\n   files subsequently added; it was only with the first listStatus call\n   on that directory that the dir would be marked as authoritative -even\n   though it would be complete already.\n\n2. listStatus(path) would reset the authoritative status bit of all\n   child directories even if they were already marked as authoritative.\n\nIssue #2 is possibly the most expensive, as any treewalk using listStatus\n(e.g globfiles) would clear the auth bit for all child directories before\nlisting them. And this would happen every single time...\nessentially you weren\u0027t getting authoritative directory listings.\n\nFor the curious, that the major bug was actually found during testing\n-we\u0027d all missed it during reviews.\n\nA lesson there: the better the tests the fewer the bugs.\n\nMaybe also: something obvious and significant can get by code reviews.\n\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/BulkOperationState.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/DynamoDBMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/MetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/NullMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3Guard.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/ITestS3GuardWriteBack.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/auth/ITestRestrictedReadAccess.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/impl/TestPartialDeleteFailures.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestDynamoDBMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestDynamoDBMetadataStoreAuthoritativeMode.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestDynamoDBMetadataStoreScale.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardFsck.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/MetadataStoreTestBase.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/TestS3Guard.java\n\nChange-Id: Ic3ffda13f2af2430afedd50fd657b595c83e90a7\n",
      "commitDate": "25/01/20 10:35 AM",
      "commitName": "7f40e6688a5716fca53e1090d8347a43064d6d43",
      "commitAuthor": "Steve Loughran",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HADOOP-16746. mkdirs and s3guard Authoritative mode.\n\nContributed by Steve Loughran.\n\nThis fixes two problems with S3Guard authoritative mode and\nthe auth directory flags which are stored in DynamoDB.\n\n1. mkdirs was creating dir markers without the auth bit,\n   forcing needless scans on newly created directories and\n   files subsequently added; it was only with the first listStatus call\n   on that directory that the dir would be marked as authoritative -even\n   though it would be complete already.\n\n2. listStatus(path) would reset the authoritative status bit of all\n   child directories even if they were already marked as authoritative.\n\nIssue #2 is possibly the most expensive, as any treewalk using listStatus\n(e.g globfiles) would clear the auth bit for all child directories before\nlisting them. And this would happen every single time...\nessentially you weren\u0027t getting authoritative directory listings.\n\nFor the curious, that the major bug was actually found during testing\n-we\u0027d all missed it during reviews.\n\nA lesson there: the better the tests the fewer the bugs.\n\nMaybe also: something obvious and significant can get by code reviews.\n\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/BulkOperationState.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/DynamoDBMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/MetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/NullMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3Guard.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/ITestS3GuardWriteBack.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/auth/ITestRestrictedReadAccess.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/impl/TestPartialDeleteFailures.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestDynamoDBMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestDynamoDBMetadataStoreAuthoritativeMode.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestDynamoDBMetadataStoreScale.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardFsck.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/MetadataStoreTestBase.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/TestS3Guard.java\n\nChange-Id: Ic3ffda13f2af2430afedd50fd657b595c83e90a7\n",
          "commitDate": "25/01/20 10:35 AM",
          "commitName": "7f40e6688a5716fca53e1090d8347a43064d6d43",
          "commitAuthor": "Steve Loughran",
          "commitDateOld": "10/01/20 3:11 AM",
          "commitNameOld": "49df83899543586bbcaf80f01399ade031cf68b0",
          "commitAuthorOld": "Steve Loughran",
          "daysBetweenCommits": 15.31,
          "commitsBetweenForRepo": 55,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,10 +1,12 @@\n-  public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n+  public static void putWithTtl(MetadataStore ms,\n+      DirListingMetadata dirMeta,\n+      final List\u003cPath\u003e unchangedEntries,\n       final ITtlTimeProvider timeProvider,\n       @Nullable final BulkOperationState operationState)\n       throws IOException {\n     long now \u003d timeProvider.getNow();\n     dirMeta.setLastUpdated(now);\n     dirMeta.getListing()\n         .forEach(pm -\u003e pm.setLastUpdated(now));\n-    ms.put(dirMeta, operationState);\n+    ms.put(dirMeta, unchangedEntries, operationState);\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public static void putWithTtl(MetadataStore ms,\n      DirListingMetadata dirMeta,\n      final List\u003cPath\u003e unchangedEntries,\n      final ITtlTimeProvider timeProvider,\n      @Nullable final BulkOperationState operationState)\n      throws IOException {\n    long now \u003d timeProvider.getNow();\n    dirMeta.setLastUpdated(now);\n    dirMeta.getListing()\n        .forEach(pm -\u003e pm.setLastUpdated(now));\n    ms.put(dirMeta, unchangedEntries, operationState);\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3Guard.java",
          "extendedDetails": {
            "oldValue": "[ms-MetadataStore, dirMeta-DirListingMetadata, timeProvider-ITtlTimeProvider(modifiers-final), operationState-BulkOperationState(annotations-@Nullable__modifiers-final)]",
            "newValue": "[ms-MetadataStore, dirMeta-DirListingMetadata, unchangedEntries-List\u003cPath\u003e(modifiers-final), timeProvider-ITtlTimeProvider(modifiers-final), operationState-BulkOperationState(annotations-@Nullable__modifiers-final)]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HADOOP-16746. mkdirs and s3guard Authoritative mode.\n\nContributed by Steve Loughran.\n\nThis fixes two problems with S3Guard authoritative mode and\nthe auth directory flags which are stored in DynamoDB.\n\n1. mkdirs was creating dir markers without the auth bit,\n   forcing needless scans on newly created directories and\n   files subsequently added; it was only with the first listStatus call\n   on that directory that the dir would be marked as authoritative -even\n   though it would be complete already.\n\n2. listStatus(path) would reset the authoritative status bit of all\n   child directories even if they were already marked as authoritative.\n\nIssue #2 is possibly the most expensive, as any treewalk using listStatus\n(e.g globfiles) would clear the auth bit for all child directories before\nlisting them. And this would happen every single time...\nessentially you weren\u0027t getting authoritative directory listings.\n\nFor the curious, that the major bug was actually found during testing\n-we\u0027d all missed it during reviews.\n\nA lesson there: the better the tests the fewer the bugs.\n\nMaybe also: something obvious and significant can get by code reviews.\n\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/S3AFileSystem.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/BulkOperationState.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/DynamoDBMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/MetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/NullMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3Guard.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/ITestS3GuardWriteBack.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/auth/ITestRestrictedReadAccess.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/impl/TestPartialDeleteFailures.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestDynamoDBMetadataStore.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestDynamoDBMetadataStoreAuthoritativeMode.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestDynamoDBMetadataStoreScale.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardFsck.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/MetadataStoreTestBase.java\n\tmodified:   hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/TestS3Guard.java\n\nChange-Id: Ic3ffda13f2af2430afedd50fd657b595c83e90a7\n",
          "commitDate": "25/01/20 10:35 AM",
          "commitName": "7f40e6688a5716fca53e1090d8347a43064d6d43",
          "commitAuthor": "Steve Loughran",
          "commitDateOld": "10/01/20 3:11 AM",
          "commitNameOld": "49df83899543586bbcaf80f01399ade031cf68b0",
          "commitAuthorOld": "Steve Loughran",
          "daysBetweenCommits": 15.31,
          "commitsBetweenForRepo": 55,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,10 +1,12 @@\n-  public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n+  public static void putWithTtl(MetadataStore ms,\n+      DirListingMetadata dirMeta,\n+      final List\u003cPath\u003e unchangedEntries,\n       final ITtlTimeProvider timeProvider,\n       @Nullable final BulkOperationState operationState)\n       throws IOException {\n     long now \u003d timeProvider.getNow();\n     dirMeta.setLastUpdated(now);\n     dirMeta.getListing()\n         .forEach(pm -\u003e pm.setLastUpdated(now));\n-    ms.put(dirMeta, operationState);\n+    ms.put(dirMeta, unchangedEntries, operationState);\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public static void putWithTtl(MetadataStore ms,\n      DirListingMetadata dirMeta,\n      final List\u003cPath\u003e unchangedEntries,\n      final ITtlTimeProvider timeProvider,\n      @Nullable final BulkOperationState operationState)\n      throws IOException {\n    long now \u003d timeProvider.getNow();\n    dirMeta.setLastUpdated(now);\n    dirMeta.getListing()\n        .forEach(pm -\u003e pm.setLastUpdated(now));\n    ms.put(dirMeta, unchangedEntries, operationState);\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3Guard.java",
          "extendedDetails": {}
        }
      ]
    },
    "e02eb24e0a9139418120027b694492e0738df20a": {
      "type": "Ymultichange(Yparameterchange,Ybodychange,Yparametermetachange)",
      "commitMessage": "HADOOP-15183. S3Guard store becomes inconsistent after partial failure of rename.\n\nContributed by Steve Loughran.\n\nChange-Id: I825b0bc36be960475d2d259b1cdab45ae1bb78eb\n",
      "commitDate": "20/06/19 1:56 AM",
      "commitName": "e02eb24e0a9139418120027b694492e0738df20a",
      "commitAuthor": "Steve Loughran",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HADOOP-15183. S3Guard store becomes inconsistent after partial failure of rename.\n\nContributed by Steve Loughran.\n\nChange-Id: I825b0bc36be960475d2d259b1cdab45ae1bb78eb\n",
          "commitDate": "20/06/19 1:56 AM",
          "commitName": "e02eb24e0a9139418120027b694492e0738df20a",
          "commitAuthor": "Steve Loughran",
          "commitDateOld": "16/06/19 9:05 AM",
          "commitNameOld": "f9cc9e162175444efe9d5b07ecb9a795f750ca3c",
          "commitAuthorOld": "Gabor Bota",
          "daysBetweenCommits": 3.7,
          "commitsBetweenForRepo": 44,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,8 +1,10 @@\n   public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n-      ITtlTimeProvider timeProvider)\n+      final ITtlTimeProvider timeProvider,\n+      @Nullable final BulkOperationState operationState)\n       throws IOException {\n-    dirMeta.setLastUpdated(timeProvider.getNow());\n+    long now \u003d timeProvider.getNow();\n+    dirMeta.setLastUpdated(now);\n     dirMeta.getListing()\n-        .forEach(pm -\u003e pm.setLastUpdated(timeProvider.getNow()));\n-    ms.put(dirMeta);\n+        .forEach(pm -\u003e pm.setLastUpdated(now));\n+    ms.put(dirMeta, operationState);\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n      final ITtlTimeProvider timeProvider,\n      @Nullable final BulkOperationState operationState)\n      throws IOException {\n    long now \u003d timeProvider.getNow();\n    dirMeta.setLastUpdated(now);\n    dirMeta.getListing()\n        .forEach(pm -\u003e pm.setLastUpdated(now));\n    ms.put(dirMeta, operationState);\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3Guard.java",
          "extendedDetails": {
            "oldValue": "[ms-MetadataStore, dirMeta-DirListingMetadata, timeProvider-ITtlTimeProvider]",
            "newValue": "[ms-MetadataStore, dirMeta-DirListingMetadata, timeProvider-ITtlTimeProvider(modifiers-final), operationState-BulkOperationState(annotations-@Nullable__modifiers-final)]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HADOOP-15183. S3Guard store becomes inconsistent after partial failure of rename.\n\nContributed by Steve Loughran.\n\nChange-Id: I825b0bc36be960475d2d259b1cdab45ae1bb78eb\n",
          "commitDate": "20/06/19 1:56 AM",
          "commitName": "e02eb24e0a9139418120027b694492e0738df20a",
          "commitAuthor": "Steve Loughran",
          "commitDateOld": "16/06/19 9:05 AM",
          "commitNameOld": "f9cc9e162175444efe9d5b07ecb9a795f750ca3c",
          "commitAuthorOld": "Gabor Bota",
          "daysBetweenCommits": 3.7,
          "commitsBetweenForRepo": 44,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,8 +1,10 @@\n   public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n-      ITtlTimeProvider timeProvider)\n+      final ITtlTimeProvider timeProvider,\n+      @Nullable final BulkOperationState operationState)\n       throws IOException {\n-    dirMeta.setLastUpdated(timeProvider.getNow());\n+    long now \u003d timeProvider.getNow();\n+    dirMeta.setLastUpdated(now);\n     dirMeta.getListing()\n-        .forEach(pm -\u003e pm.setLastUpdated(timeProvider.getNow()));\n-    ms.put(dirMeta);\n+        .forEach(pm -\u003e pm.setLastUpdated(now));\n+    ms.put(dirMeta, operationState);\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n      final ITtlTimeProvider timeProvider,\n      @Nullable final BulkOperationState operationState)\n      throws IOException {\n    long now \u003d timeProvider.getNow();\n    dirMeta.setLastUpdated(now);\n    dirMeta.getListing()\n        .forEach(pm -\u003e pm.setLastUpdated(now));\n    ms.put(dirMeta, operationState);\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3Guard.java",
          "extendedDetails": {}
        },
        {
          "type": "Yparametermetachange",
          "commitMessage": "HADOOP-15183. S3Guard store becomes inconsistent after partial failure of rename.\n\nContributed by Steve Loughran.\n\nChange-Id: I825b0bc36be960475d2d259b1cdab45ae1bb78eb\n",
          "commitDate": "20/06/19 1:56 AM",
          "commitName": "e02eb24e0a9139418120027b694492e0738df20a",
          "commitAuthor": "Steve Loughran",
          "commitDateOld": "16/06/19 9:05 AM",
          "commitNameOld": "f9cc9e162175444efe9d5b07ecb9a795f750ca3c",
          "commitAuthorOld": "Gabor Bota",
          "daysBetweenCommits": 3.7,
          "commitsBetweenForRepo": 44,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,8 +1,10 @@\n   public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n-      ITtlTimeProvider timeProvider)\n+      final ITtlTimeProvider timeProvider,\n+      @Nullable final BulkOperationState operationState)\n       throws IOException {\n-    dirMeta.setLastUpdated(timeProvider.getNow());\n+    long now \u003d timeProvider.getNow();\n+    dirMeta.setLastUpdated(now);\n     dirMeta.getListing()\n-        .forEach(pm -\u003e pm.setLastUpdated(timeProvider.getNow()));\n-    ms.put(dirMeta);\n+        .forEach(pm -\u003e pm.setLastUpdated(now));\n+    ms.put(dirMeta, operationState);\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n      final ITtlTimeProvider timeProvider,\n      @Nullable final BulkOperationState operationState)\n      throws IOException {\n    long now \u003d timeProvider.getNow();\n    dirMeta.setLastUpdated(now);\n    dirMeta.getListing()\n        .forEach(pm -\u003e pm.setLastUpdated(now));\n    ms.put(dirMeta, operationState);\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3Guard.java",
          "extendedDetails": {
            "oldValue": "[ms-MetadataStore, dirMeta-DirListingMetadata, timeProvider-ITtlTimeProvider]",
            "newValue": "[ms-MetadataStore, dirMeta-DirListingMetadata, timeProvider-ITtlTimeProvider(modifiers-final), operationState-BulkOperationState(annotations-@Nullable__modifiers-final)]"
          }
        }
      ]
    },
    "f9cc9e162175444efe9d5b07ecb9a795f750ca3c": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-16279. S3Guard: Implement time-based (TTL) expiry for entries (and tombstones).\n\nContributed by Gabor Bota.\n\nChange-Id: I73a2d2861901dedfe7a0e783b310fbb95e7c1af9\n",
      "commitDate": "16/06/19 9:05 AM",
      "commitName": "f9cc9e162175444efe9d5b07ecb9a795f750ca3c",
      "commitAuthor": "Gabor Bota",
      "commitDateOld": "19/05/19 2:29 PM",
      "commitNameOld": "a36274d69947648dbe82721220cc5240ec5d396d",
      "commitAuthorOld": "Ben Roling",
      "daysBetweenCommits": 27.77,
      "commitsBetweenForRepo": 198,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,6 +1,8 @@\n   public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n       ITtlTimeProvider timeProvider)\n       throws IOException {\n     dirMeta.setLastUpdated(timeProvider.getNow());\n+    dirMeta.getListing()\n+        .forEach(pm -\u003e pm.setLastUpdated(timeProvider.getNow()));\n     ms.put(dirMeta);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n      ITtlTimeProvider timeProvider)\n      throws IOException {\n    dirMeta.setLastUpdated(timeProvider.getNow());\n    dirMeta.getListing()\n        .forEach(pm -\u003e pm.setLastUpdated(timeProvider.getNow()));\n    ms.put(dirMeta);\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3Guard.java",
      "extendedDetails": {}
    },
    "046b8768af8a07a9e10ce43f538d6ac16e7fa5f3": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-15621 S3Guard: Implement time-based (TTL) expiry for Authoritative Directory Listing. Contributed by Gabor Bota\n",
      "commitDate": "02/10/18 9:22 PM",
      "commitName": "046b8768af8a07a9e10ce43f538d6ac16e7fa5f3",
      "commitAuthor": "Aaron Fabbri",
      "diff": "@@ -0,0 +1,6 @@\n+  public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n+      ITtlTimeProvider timeProvider)\n+      throws IOException {\n+    dirMeta.setLastUpdated(timeProvider.getNow());\n+    ms.put(dirMeta);\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public static void putWithTtl(MetadataStore ms, DirListingMetadata dirMeta,\n      ITtlTimeProvider timeProvider)\n      throws IOException {\n    dirMeta.setLastUpdated(timeProvider.getNow());\n    ms.put(dirMeta);\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3Guard.java"
    }
  }
}