{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "Balancer.java",
  "functionName": "computeMaxSize2Move",
  "functionId": "computeMaxSize2Move___capacity-long(modifiers-final)__remaining-long(modifiers-final)__utilizationDiff-double(modifiers-final)__max-long(modifiers-final)",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Balancer.java",
  "functionStartLine": 432,
  "functionEndLine": 440,
  "numCommitsSeen": 217,
  "timeTaken": 3797,
  "changeHistory": [
    "51a00964da0e399718d1cec25ff692a32d7642b7",
    "b56daff6a186599764b046248565918b894ec116",
    "a7a7768341f1b7d3a8f2686e2f4d00c57f2e1d4f",
    "b8597e6a10b2e8df1bee4e8ce0c8be345f7e007d"
  ],
  "changeHistoryShort": {
    "51a00964da0e399718d1cec25ff692a32d7642b7": "Ymultichange(Yparameterchange,Ybodychange)",
    "b56daff6a186599764b046248565918b894ec116": "Ymultichange(Yparameterchange,Ybodychange)",
    "a7a7768341f1b7d3a8f2686e2f4d00c57f2e1d4f": "Ybodychange",
    "b8597e6a10b2e8df1bee4e8ce0c8be345f7e007d": "Yintroduced"
  },
  "changeHistoryDetails": {
    "51a00964da0e399718d1cec25ff692a32d7642b7": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HDFS-8278. When computing max-size-to-move in Balancer, count only the storage with remaining \u003e\u003d default block size.\n",
      "commitDate": "17/08/15 5:55 PM",
      "commitName": "51a00964da0e399718d1cec25ff692a32d7642b7",
      "commitAuthor": "Tsz-Wo Nicholas Sze",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HDFS-8278. When computing max-size-to-move in Balancer, count only the storage with remaining \u003e\u003d default block size.\n",
          "commitDate": "17/08/15 5:55 PM",
          "commitName": "51a00964da0e399718d1cec25ff692a32d7642b7",
          "commitAuthor": "Tsz-Wo Nicholas Sze",
          "commitDateOld": "14/08/15 1:03 PM",
          "commitNameOld": "2bc0a4f299fbd8035e29f62ce9cd22e209a62805",
          "commitAuthorOld": "Tsz-Wo Nicholas Sze",
          "daysBetweenCommits": 3.2,
          "commitsBetweenForRepo": 13,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,9 +1,9 @@\n   private static long computeMaxSize2Move(final long capacity, final long remaining,\n-      final double utilizationDiff, final double threshold, final long max) {\n-    final double diff \u003d Math.min(threshold, Math.abs(utilizationDiff));\n+      final double utilizationDiff, final long max) {\n+    final double diff \u003d Math.abs(utilizationDiff);\n     long maxSizeToMove \u003d percentage2bytes(diff, capacity);\n     if (utilizationDiff \u003c 0) {\n       maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n     }\n     return Math.min(max, maxSizeToMove);\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private static long computeMaxSize2Move(final long capacity, final long remaining,\n      final double utilizationDiff, final long max) {\n    final double diff \u003d Math.abs(utilizationDiff);\n    long maxSizeToMove \u003d percentage2bytes(diff, capacity);\n    if (utilizationDiff \u003c 0) {\n      maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n    }\n    return Math.min(max, maxSizeToMove);\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Balancer.java",
          "extendedDetails": {
            "oldValue": "[capacity-long(modifiers-final), remaining-long(modifiers-final), utilizationDiff-double(modifiers-final), threshold-double(modifiers-final), max-long(modifiers-final)]",
            "newValue": "[capacity-long(modifiers-final), remaining-long(modifiers-final), utilizationDiff-double(modifiers-final), max-long(modifiers-final)]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-8278. When computing max-size-to-move in Balancer, count only the storage with remaining \u003e\u003d default block size.\n",
          "commitDate": "17/08/15 5:55 PM",
          "commitName": "51a00964da0e399718d1cec25ff692a32d7642b7",
          "commitAuthor": "Tsz-Wo Nicholas Sze",
          "commitDateOld": "14/08/15 1:03 PM",
          "commitNameOld": "2bc0a4f299fbd8035e29f62ce9cd22e209a62805",
          "commitAuthorOld": "Tsz-Wo Nicholas Sze",
          "daysBetweenCommits": 3.2,
          "commitsBetweenForRepo": 13,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,9 +1,9 @@\n   private static long computeMaxSize2Move(final long capacity, final long remaining,\n-      final double utilizationDiff, final double threshold, final long max) {\n-    final double diff \u003d Math.min(threshold, Math.abs(utilizationDiff));\n+      final double utilizationDiff, final long max) {\n+    final double diff \u003d Math.abs(utilizationDiff);\n     long maxSizeToMove \u003d percentage2bytes(diff, capacity);\n     if (utilizationDiff \u003c 0) {\n       maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n     }\n     return Math.min(max, maxSizeToMove);\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private static long computeMaxSize2Move(final long capacity, final long remaining,\n      final double utilizationDiff, final long max) {\n    final double diff \u003d Math.abs(utilizationDiff);\n    long maxSizeToMove \u003d percentage2bytes(diff, capacity);\n    if (utilizationDiff \u003c 0) {\n      maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n    }\n    return Math.min(max, maxSizeToMove);\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Balancer.java",
          "extendedDetails": {}
        }
      ]
    },
    "b56daff6a186599764b046248565918b894ec116": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HDFS-8818. Changes the global moveExecutor to per datanode executors and changes MAX_SIZE_TO_MOVE to be configurable.\n",
      "commitDate": "10/08/15 4:52 PM",
      "commitName": "b56daff6a186599764b046248565918b894ec116",
      "commitAuthor": "Tsz-Wo Nicholas Sze",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HDFS-8818. Changes the global moveExecutor to per datanode executors and changes MAX_SIZE_TO_MOVE to be configurable.\n",
          "commitDate": "10/08/15 4:52 PM",
          "commitName": "b56daff6a186599764b046248565918b894ec116",
          "commitAuthor": "Tsz-Wo Nicholas Sze",
          "commitDateOld": "10/06/15 1:42 PM",
          "commitNameOld": "a7a7768341f1b7d3a8f2686e2f4d00c57f2e1d4f",
          "commitAuthorOld": "Andrew Wang",
          "daysBetweenCommits": 61.13,
          "commitsBetweenForRepo": 359,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,9 +1,9 @@\n   private static long computeMaxSize2Move(final long capacity, final long remaining,\n-      final double utilizationDiff, final double threshold) {\n+      final double utilizationDiff, final double threshold, final long max) {\n     final double diff \u003d Math.min(threshold, Math.abs(utilizationDiff));\n     long maxSizeToMove \u003d percentage2bytes(diff, capacity);\n     if (utilizationDiff \u003c 0) {\n       maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n     }\n-    return Math.min(MAX_SIZE_TO_MOVE, maxSizeToMove);\n+    return Math.min(max, maxSizeToMove);\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private static long computeMaxSize2Move(final long capacity, final long remaining,\n      final double utilizationDiff, final double threshold, final long max) {\n    final double diff \u003d Math.min(threshold, Math.abs(utilizationDiff));\n    long maxSizeToMove \u003d percentage2bytes(diff, capacity);\n    if (utilizationDiff \u003c 0) {\n      maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n    }\n    return Math.min(max, maxSizeToMove);\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Balancer.java",
          "extendedDetails": {
            "oldValue": "[capacity-long(modifiers-final), remaining-long(modifiers-final), utilizationDiff-double(modifiers-final), threshold-double(modifiers-final)]",
            "newValue": "[capacity-long(modifiers-final), remaining-long(modifiers-final), utilizationDiff-double(modifiers-final), threshold-double(modifiers-final), max-long(modifiers-final)]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-8818. Changes the global moveExecutor to per datanode executors and changes MAX_SIZE_TO_MOVE to be configurable.\n",
          "commitDate": "10/08/15 4:52 PM",
          "commitName": "b56daff6a186599764b046248565918b894ec116",
          "commitAuthor": "Tsz-Wo Nicholas Sze",
          "commitDateOld": "10/06/15 1:42 PM",
          "commitNameOld": "a7a7768341f1b7d3a8f2686e2f4d00c57f2e1d4f",
          "commitAuthorOld": "Andrew Wang",
          "daysBetweenCommits": 61.13,
          "commitsBetweenForRepo": 359,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,9 +1,9 @@\n   private static long computeMaxSize2Move(final long capacity, final long remaining,\n-      final double utilizationDiff, final double threshold) {\n+      final double utilizationDiff, final double threshold, final long max) {\n     final double diff \u003d Math.min(threshold, Math.abs(utilizationDiff));\n     long maxSizeToMove \u003d percentage2bytes(diff, capacity);\n     if (utilizationDiff \u003c 0) {\n       maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n     }\n-    return Math.min(MAX_SIZE_TO_MOVE, maxSizeToMove);\n+    return Math.min(max, maxSizeToMove);\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private static long computeMaxSize2Move(final long capacity, final long remaining,\n      final double utilizationDiff, final double threshold, final long max) {\n    final double diff \u003d Math.min(threshold, Math.abs(utilizationDiff));\n    long maxSizeToMove \u003d percentage2bytes(diff, capacity);\n    if (utilizationDiff \u003c 0) {\n      maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n    }\n    return Math.min(max, maxSizeToMove);\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Balancer.java",
          "extendedDetails": {}
        }
      ]
    },
    "a7a7768341f1b7d3a8f2686e2f4d00c57f2e1d4f": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-8549. Abort the balancer if an upgrade is in progress.\n",
      "commitDate": "10/06/15 1:42 PM",
      "commitName": "a7a7768341f1b7d3a8f2686e2f4d00c57f2e1d4f",
      "commitAuthor": "Andrew Wang",
      "commitDateOld": "20/03/15 12:02 PM",
      "commitNameOld": "75ead273bea8a7dad61c4f99c3a16cab2697c498",
      "commitAuthorOld": "Kihwal Lee",
      "daysBetweenCommits": 82.07,
      "commitsBetweenForRepo": 760,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,9 +1,9 @@\n   private static long computeMaxSize2Move(final long capacity, final long remaining,\n       final double utilizationDiff, final double threshold) {\n     final double diff \u003d Math.min(threshold, Math.abs(utilizationDiff));\n-    long maxSizeToMove \u003d precentage2bytes(diff, capacity);\n+    long maxSizeToMove \u003d percentage2bytes(diff, capacity);\n     if (utilizationDiff \u003c 0) {\n       maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n     }\n     return Math.min(MAX_SIZE_TO_MOVE, maxSizeToMove);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private static long computeMaxSize2Move(final long capacity, final long remaining,\n      final double utilizationDiff, final double threshold) {\n    final double diff \u003d Math.min(threshold, Math.abs(utilizationDiff));\n    long maxSizeToMove \u003d percentage2bytes(diff, capacity);\n    if (utilizationDiff \u003c 0) {\n      maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n    }\n    return Math.min(MAX_SIZE_TO_MOVE, maxSizeToMove);\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Balancer.java",
      "extendedDetails": {}
    },
    "b8597e6a10b2e8df1bee4e8ce0c8be345f7e007d": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-6685. Balancer should preserve storage type of replicas.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1615015 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "31/07/14 6:05 PM",
      "commitName": "b8597e6a10b2e8df1bee4e8ce0c8be345f7e007d",
      "commitAuthor": "Tsz-wo Sze",
      "diff": "@@ -0,0 +1,9 @@\n+  private static long computeMaxSize2Move(final long capacity, final long remaining,\n+      final double utilizationDiff, final double threshold) {\n+    final double diff \u003d Math.min(threshold, Math.abs(utilizationDiff));\n+    long maxSizeToMove \u003d precentage2bytes(diff, capacity);\n+    if (utilizationDiff \u003c 0) {\n+      maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n+    }\n+    return Math.min(MAX_SIZE_TO_MOVE, maxSizeToMove);\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  private static long computeMaxSize2Move(final long capacity, final long remaining,\n      final double utilizationDiff, final double threshold) {\n    final double diff \u003d Math.min(threshold, Math.abs(utilizationDiff));\n    long maxSizeToMove \u003d precentage2bytes(diff, capacity);\n    if (utilizationDiff \u003c 0) {\n      maxSizeToMove \u003d Math.min(remaining, maxSizeToMove);\n    }\n    return Math.min(MAX_SIZE_TO_MOVE, maxSizeToMove);\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Balancer.java"
    }
  }
}