{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "StoragePolicySatisfier.java",
  "functionName": "stopGracefully",
  "functionId": "stopGracefully",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/sps/StoragePolicySatisfier.java",
  "functionStartLine": 189,
  "functionEndLine": 208,
  "numCommitsSeen": 76,
  "timeTaken": 10444,
  "changeHistory": [
    "4402f3f8557527d5c6cdad6f5bdcbd707b8cbf52",
    "8d4f74e7339abc77dc0daa162d7bd2814bd79b3d",
    "78420719eb1f138c6f10558befb7bc8ebcc28a54",
    "0e820f16af309cc8476edba448dd548686431133",
    "11a08a7e8f727449f17d1e31855996353b2975fe",
    "c00be444634b34eb8d29cdd723397a9a2a6392d6",
    "e34331c31d68cb22891db48011db5b36ad178af1",
    "5179d99b7e1faeac1ce041967480115913d9f795",
    "cd5262aba00aa51b905aaac95e201d4d48f2480d",
    "047526b4c27909f78313e1ed6216de85c6137f14",
    "1438da494424193e330f24edef823bbd60dc37d2"
  ],
  "changeHistoryShort": {
    "4402f3f8557527d5c6cdad6f5bdcbd707b8cbf52": "Ybodychange",
    "8d4f74e7339abc77dc0daa162d7bd2814bd79b3d": "Ybodychange",
    "78420719eb1f138c6f10558befb7bc8ebcc28a54": "Yfilerename",
    "0e820f16af309cc8476edba448dd548686431133": "Ybodychange",
    "11a08a7e8f727449f17d1e31855996353b2975fe": "Ymultichange(Yrename,Yparameterchange,Ybodychange)",
    "c00be444634b34eb8d29cdd723397a9a2a6392d6": "Ybodychange",
    "e34331c31d68cb22891db48011db5b36ad178af1": "Ymultichange(Yparameterchange,Ybodychange)",
    "5179d99b7e1faeac1ce041967480115913d9f795": "Ymultichange(Ymodifierchange,Ybodychange)",
    "cd5262aba00aa51b905aaac95e201d4d48f2480d": "Ybodychange",
    "047526b4c27909f78313e1ed6216de85c6137f14": "Ybodychange",
    "1438da494424193e330f24edef823bbd60dc37d2": "Yintroduced"
  },
  "changeHistoryDetails": {
    "4402f3f8557527d5c6cdad6f5bdcbd707b8cbf52": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-13097: [SPS]: Fix the branch review comments(Part1). Contributed by Surendra Singh.\n",
      "commitDate": "12/08/18 3:06 AM",
      "commitName": "4402f3f8557527d5c6cdad6f5bdcbd707b8cbf52",
      "commitAuthor": "Uma Maheswara Rao G",
      "commitDateOld": "12/08/18 3:06 AM",
      "commitNameOld": "d3de4fb2a084cbadab8ef91f11aa7732d3b0f308",
      "commitAuthorOld": "Surendra Singh Lilhore",
      "daysBetweenCommits": 0.0,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,17 +1,20 @@\n   public synchronized void stopGracefully() {\n     if (isRunning) {\n-      disable(true);\n+      stop(false);\n     }\n \n     if (this.storageMovementsMonitor !\u003d null) {\n       this.storageMovementsMonitor.stopGracefully();\n     }\n \n-    if (storagePolicySatisfierThread \u003d\u003d null) {\n-      return;\n-    }\n-    try {\n-      storagePolicySatisfierThread.join(3000);\n-    } catch (InterruptedException ie) {\n+    if (storagePolicySatisfierThread !\u003d null) {\n+      try {\n+        storagePolicySatisfierThread.join(3000);\n+      } catch (InterruptedException ie) {\n+        if (LOG.isDebugEnabled()) {\n+          LOG.debug(\"Interrupted Exception while waiting to join sps thread,\"\n+              + \" ignoring it\", ie);\n+        }\n+      }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public synchronized void stopGracefully() {\n    if (isRunning) {\n      stop(false);\n    }\n\n    if (this.storageMovementsMonitor !\u003d null) {\n      this.storageMovementsMonitor.stopGracefully();\n    }\n\n    if (storagePolicySatisfierThread !\u003d null) {\n      try {\n        storagePolicySatisfierThread.join(3000);\n      } catch (InterruptedException ie) {\n        if (LOG.isDebugEnabled()) {\n          LOG.debug(\"Interrupted Exception while waiting to join sps thread,\"\n              + \" ignoring it\", ie);\n        }\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/sps/StoragePolicySatisfier.java",
      "extendedDetails": {}
    },
    "8d4f74e7339abc77dc0daa162d7bd2814bd79b3d": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-12911. [SPS]: Modularize the SPS code and expose necessary interfaces for external/internal implementations. Contributed by Uma Maheswara Rao G\n",
      "commitDate": "12/08/18 3:06 AM",
      "commitName": "8d4f74e7339abc77dc0daa162d7bd2814bd79b3d",
      "commitAuthor": "Rakesh Radhakrishnan",
      "commitDateOld": "12/08/18 3:06 AM",
      "commitNameOld": "05d4daf6ba3e5bd40f46e8003ee12fc7c613453d",
      "commitAuthorOld": "Surendra Singh Lilhore",
      "daysBetweenCommits": 0.0,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,14 +1,17 @@\n   public synchronized void stopGracefully() {\n     if (isRunning) {\n       disable(true);\n     }\n-    this.storageMovementsMonitor.stopGracefully();\n+\n+    if (this.storageMovementsMonitor !\u003d null) {\n+      this.storageMovementsMonitor.stopGracefully();\n+    }\n \n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public synchronized void stopGracefully() {\n    if (isRunning) {\n      disable(true);\n    }\n\n    if (this.storageMovementsMonitor !\u003d null) {\n      this.storageMovementsMonitor.stopGracefully();\n    }\n\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/sps/StoragePolicySatisfier.java",
      "extendedDetails": {}
    },
    "78420719eb1f138c6f10558befb7bc8ebcc28a54": {
      "type": "Yfilerename",
      "commitMessage": "HDFS-12955: [SPS]: Move SPS classes to a separate package. Contributed by Rakesh R.\n",
      "commitDate": "12/08/18 3:06 AM",
      "commitName": "78420719eb1f138c6f10558befb7bc8ebcc28a54",
      "commitAuthor": "Uma Maheswara Rao G",
      "commitDateOld": "12/08/18 3:06 AM",
      "commitNameOld": "c561cb316e365ef674784cd6cf0b12c0fbc271a3",
      "commitAuthorOld": "Surendra Singh Lilhore",
      "daysBetweenCommits": 0.0,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "",
      "actualSource": "  public synchronized void stopGracefully() {\n    if (isRunning) {\n      disable(true);\n    }\n    this.storageMovementsMonitor.stopGracefully();\n\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/sps/StoragePolicySatisfier.java",
      "extendedDetails": {
        "oldPath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
        "newPath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/sps/StoragePolicySatisfier.java"
      }
    },
    "0e820f16af309cc8476edba448dd548686431133": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-12214: [SPS]: Fix review comments of StoragePolicySatisfier feature. Contributed by Rakesh R.\n",
      "commitDate": "12/08/18 3:06 AM",
      "commitName": "0e820f16af309cc8476edba448dd548686431133",
      "commitAuthor": "Uma Maheswara Rao G",
      "commitDateOld": "12/08/18 3:06 AM",
      "commitNameOld": "4bcf61c696909342f1a238f614d4471c4b6fbad0",
      "commitAuthorOld": "Uma Maheswara Rao G",
      "daysBetweenCommits": 0.0,
      "commitsBetweenForRepo": 2,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,13 +1,13 @@\n   public synchronized void stopGracefully() {\n     if (isRunning) {\n-      deactivate(true);\n+      disable(true);\n     }\n     this.storageMovementsMonitor.stopGracefully();\n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public synchronized void stopGracefully() {\n    if (isRunning) {\n      disable(true);\n    }\n    this.storageMovementsMonitor.stopGracefully();\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
      "extendedDetails": {}
    },
    "11a08a7e8f727449f17d1e31855996353b2975fe": {
      "type": "Ymultichange(Yrename,Yparameterchange,Ybodychange)",
      "commitMessage": "HDFS-11338: [SPS]: Fix timeout issue in unit tests caused by longger NN down time. Contributed by Wei Zhou and Rakesh R\n",
      "commitDate": "12/08/18 3:05 AM",
      "commitName": "11a08a7e8f727449f17d1e31855996353b2975fe",
      "commitAuthor": "Uma Maheswara Rao G",
      "subchanges": [
        {
          "type": "Yrename",
          "commitMessage": "HDFS-11338: [SPS]: Fix timeout issue in unit tests caused by longger NN down time. Contributed by Wei Zhou and Rakesh R\n",
          "commitDate": "12/08/18 3:05 AM",
          "commitName": "11a08a7e8f727449f17d1e31855996353b2975fe",
          "commitAuthor": "Uma Maheswara Rao G",
          "commitDateOld": "12/08/18 3:05 AM",
          "commitNameOld": "c00be444634b34eb8d29cdd723397a9a2a6392d6",
          "commitAuthorOld": "Uma Maheswara Rao G",
          "daysBetweenCommits": 0.0,
          "commitsBetweenForRepo": 1,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,20 +1,13 @@\n-  public synchronized void stop(boolean reconfigStop) {\n-    isRunning \u003d false;\n+  public synchronized void stopGracefully() {\n+    if (isRunning) {\n+      deactivate(true);\n+    }\n+    this.storageMovementsMonitor.stopGracefully();\n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n-    storagePolicySatisfierThread.interrupt();\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n-    this.storageMovementsMonitor.stop();\n-    if (reconfigStop) {\n-      LOG.info(\"Stopping StoragePolicySatisfier, as admin requested to \"\n-          + \"deactivate it.\");\n-      this.clearQueuesWithNotification();\n-      this.blockManager.getDatanodeManager().addDropSPSWorkCommandsToAllDNs();\n-    } else {\n-      LOG.info(\"Stopping StoragePolicySatisfier.\");\n-    }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public synchronized void stopGracefully() {\n    if (isRunning) {\n      deactivate(true);\n    }\n    this.storageMovementsMonitor.stopGracefully();\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
          "extendedDetails": {
            "oldValue": "stop",
            "newValue": "stopGracefully"
          }
        },
        {
          "type": "Yparameterchange",
          "commitMessage": "HDFS-11338: [SPS]: Fix timeout issue in unit tests caused by longger NN down time. Contributed by Wei Zhou and Rakesh R\n",
          "commitDate": "12/08/18 3:05 AM",
          "commitName": "11a08a7e8f727449f17d1e31855996353b2975fe",
          "commitAuthor": "Uma Maheswara Rao G",
          "commitDateOld": "12/08/18 3:05 AM",
          "commitNameOld": "c00be444634b34eb8d29cdd723397a9a2a6392d6",
          "commitAuthorOld": "Uma Maheswara Rao G",
          "daysBetweenCommits": 0.0,
          "commitsBetweenForRepo": 1,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,20 +1,13 @@\n-  public synchronized void stop(boolean reconfigStop) {\n-    isRunning \u003d false;\n+  public synchronized void stopGracefully() {\n+    if (isRunning) {\n+      deactivate(true);\n+    }\n+    this.storageMovementsMonitor.stopGracefully();\n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n-    storagePolicySatisfierThread.interrupt();\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n-    this.storageMovementsMonitor.stop();\n-    if (reconfigStop) {\n-      LOG.info(\"Stopping StoragePolicySatisfier, as admin requested to \"\n-          + \"deactivate it.\");\n-      this.clearQueuesWithNotification();\n-      this.blockManager.getDatanodeManager().addDropSPSWorkCommandsToAllDNs();\n-    } else {\n-      LOG.info(\"Stopping StoragePolicySatisfier.\");\n-    }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public synchronized void stopGracefully() {\n    if (isRunning) {\n      deactivate(true);\n    }\n    this.storageMovementsMonitor.stopGracefully();\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
          "extendedDetails": {
            "oldValue": "[reconfigStop-boolean]",
            "newValue": "[]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-11338: [SPS]: Fix timeout issue in unit tests caused by longger NN down time. Contributed by Wei Zhou and Rakesh R\n",
          "commitDate": "12/08/18 3:05 AM",
          "commitName": "11a08a7e8f727449f17d1e31855996353b2975fe",
          "commitAuthor": "Uma Maheswara Rao G",
          "commitDateOld": "12/08/18 3:05 AM",
          "commitNameOld": "c00be444634b34eb8d29cdd723397a9a2a6392d6",
          "commitAuthorOld": "Uma Maheswara Rao G",
          "daysBetweenCommits": 0.0,
          "commitsBetweenForRepo": 1,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,20 +1,13 @@\n-  public synchronized void stop(boolean reconfigStop) {\n-    isRunning \u003d false;\n+  public synchronized void stopGracefully() {\n+    if (isRunning) {\n+      deactivate(true);\n+    }\n+    this.storageMovementsMonitor.stopGracefully();\n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n-    storagePolicySatisfierThread.interrupt();\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n-    this.storageMovementsMonitor.stop();\n-    if (reconfigStop) {\n-      LOG.info(\"Stopping StoragePolicySatisfier, as admin requested to \"\n-          + \"deactivate it.\");\n-      this.clearQueuesWithNotification();\n-      this.blockManager.getDatanodeManager().addDropSPSWorkCommandsToAllDNs();\n-    } else {\n-      LOG.info(\"Stopping StoragePolicySatisfier.\");\n-    }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public synchronized void stopGracefully() {\n    if (isRunning) {\n      deactivate(true);\n    }\n    this.storageMovementsMonitor.stopGracefully();\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
          "extendedDetails": {}
        }
      ]
    },
    "c00be444634b34eb8d29cdd723397a9a2a6392d6": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-11336: [SPS]: Remove xAttrs when movements done or SPS disabled. Contributed by Yuanbo Liu.\n",
      "commitDate": "12/08/18 3:05 AM",
      "commitName": "c00be444634b34eb8d29cdd723397a9a2a6392d6",
      "commitAuthor": "Uma Maheswara Rao G",
      "commitDateOld": "12/08/18 3:05 AM",
      "commitNameOld": "9b15f5418dbb49de57922f00858cb6fb0b61826e",
      "commitAuthorOld": "Rakesh Radhakrishnan",
      "daysBetweenCommits": 0.0,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,22 +1,20 @@\n   public synchronized void stop(boolean reconfigStop) {\n     isRunning \u003d false;\n-    if (reconfigStop) {\n-      LOG.info(\"Stopping StoragePolicySatisfier, as admin requested to \"\n-          + \"deactivate it.\");\n-    } else {\n-      LOG.info(\"Stopping StoragePolicySatisfier.\");\n-    }\n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n     storagePolicySatisfierThread.interrupt();\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n     this.storageMovementsMonitor.stop();\n     if (reconfigStop) {\n-      this.clearQueues();\n+      LOG.info(\"Stopping StoragePolicySatisfier, as admin requested to \"\n+          + \"deactivate it.\");\n+      this.clearQueuesWithNotification();\n       this.blockManager.getDatanodeManager().addDropSPSWorkCommandsToAllDNs();\n+    } else {\n+      LOG.info(\"Stopping StoragePolicySatisfier.\");\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public synchronized void stop(boolean reconfigStop) {\n    isRunning \u003d false;\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    storagePolicySatisfierThread.interrupt();\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n    this.storageMovementsMonitor.stop();\n    if (reconfigStop) {\n      LOG.info(\"Stopping StoragePolicySatisfier, as admin requested to \"\n          + \"deactivate it.\");\n      this.clearQueuesWithNotification();\n      this.blockManager.getDatanodeManager().addDropSPSWorkCommandsToAllDNs();\n    } else {\n      LOG.info(\"Stopping StoragePolicySatisfier.\");\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
      "extendedDetails": {}
    },
    "e34331c31d68cb22891db48011db5b36ad178af1": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HDFS-11243. [SPS]: Add a protocol command from NN to DN for dropping the SPS work and queues. Contributed by Uma Maheswara Rao G\n",
      "commitDate": "12/08/18 3:05 AM",
      "commitName": "e34331c31d68cb22891db48011db5b36ad178af1",
      "commitAuthor": "Rakesh Radhakrishnan",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HDFS-11243. [SPS]: Add a protocol command from NN to DN for dropping the SPS work and queues. Contributed by Uma Maheswara Rao G\n",
          "commitDate": "12/08/18 3:05 AM",
          "commitName": "e34331c31d68cb22891db48011db5b36ad178af1",
          "commitAuthor": "Rakesh Radhakrishnan",
          "commitDateOld": "12/08/18 3:05 AM",
          "commitNameOld": "f8fc96a66ea3cbd41a3915c4546ff816451cf9db",
          "commitAuthorOld": "Rakesh Radhakrishnan",
          "daysBetweenCommits": 0.0,
          "commitsBetweenForRepo": 1,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,14 +1,22 @@\n-  public synchronized void stop() {\n+  public synchronized void stop(boolean reconfigStop) {\n     isRunning \u003d false;\n-    LOG.info(\"Stopping StoragePolicySatisfier.\");\n+    if (reconfigStop) {\n+      LOG.info(\"Stopping StoragePolicySatisfier, as admin requested to \"\n+          + \"deactivate it.\");\n+    } else {\n+      LOG.info(\"Stopping StoragePolicySatisfier.\");\n+    }\n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n     storagePolicySatisfierThread.interrupt();\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n     this.storageMovementsMonitor.stop();\n-    this.clearQueues();\n+    if (reconfigStop) {\n+      this.clearQueues();\n+      this.blockManager.getDatanodeManager().addDropSPSWorkCommandsToAllDNs();\n+    }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public synchronized void stop(boolean reconfigStop) {\n    isRunning \u003d false;\n    if (reconfigStop) {\n      LOG.info(\"Stopping StoragePolicySatisfier, as admin requested to \"\n          + \"deactivate it.\");\n    } else {\n      LOG.info(\"Stopping StoragePolicySatisfier.\");\n    }\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    storagePolicySatisfierThread.interrupt();\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n    this.storageMovementsMonitor.stop();\n    if (reconfigStop) {\n      this.clearQueues();\n      this.blockManager.getDatanodeManager().addDropSPSWorkCommandsToAllDNs();\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
          "extendedDetails": {
            "oldValue": "[]",
            "newValue": "[reconfigStop-boolean]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-11243. [SPS]: Add a protocol command from NN to DN for dropping the SPS work and queues. Contributed by Uma Maheswara Rao G\n",
          "commitDate": "12/08/18 3:05 AM",
          "commitName": "e34331c31d68cb22891db48011db5b36ad178af1",
          "commitAuthor": "Rakesh Radhakrishnan",
          "commitDateOld": "12/08/18 3:05 AM",
          "commitNameOld": "f8fc96a66ea3cbd41a3915c4546ff816451cf9db",
          "commitAuthorOld": "Rakesh Radhakrishnan",
          "daysBetweenCommits": 0.0,
          "commitsBetweenForRepo": 1,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,14 +1,22 @@\n-  public synchronized void stop() {\n+  public synchronized void stop(boolean reconfigStop) {\n     isRunning \u003d false;\n-    LOG.info(\"Stopping StoragePolicySatisfier.\");\n+    if (reconfigStop) {\n+      LOG.info(\"Stopping StoragePolicySatisfier, as admin requested to \"\n+          + \"deactivate it.\");\n+    } else {\n+      LOG.info(\"Stopping StoragePolicySatisfier.\");\n+    }\n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n     storagePolicySatisfierThread.interrupt();\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n     this.storageMovementsMonitor.stop();\n-    this.clearQueues();\n+    if (reconfigStop) {\n+      this.clearQueues();\n+      this.blockManager.getDatanodeManager().addDropSPSWorkCommandsToAllDNs();\n+    }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public synchronized void stop(boolean reconfigStop) {\n    isRunning \u003d false;\n    if (reconfigStop) {\n      LOG.info(\"Stopping StoragePolicySatisfier, as admin requested to \"\n          + \"deactivate it.\");\n    } else {\n      LOG.info(\"Stopping StoragePolicySatisfier.\");\n    }\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    storagePolicySatisfierThread.interrupt();\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n    this.storageMovementsMonitor.stop();\n    if (reconfigStop) {\n      this.clearQueues();\n      this.blockManager.getDatanodeManager().addDropSPSWorkCommandsToAllDNs();\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
          "extendedDetails": {}
        }
      ]
    },
    "5179d99b7e1faeac1ce041967480115913d9f795": {
      "type": "Ymultichange(Ymodifierchange,Ybodychange)",
      "commitMessage": "HDFS-11123. [SPS] Make storage policy satisfier daemon work on/off dynamically. Contributed by Uma Maheswara Rao G\n",
      "commitDate": "12/08/18 3:05 AM",
      "commitName": "5179d99b7e1faeac1ce041967480115913d9f795",
      "commitAuthor": "Rakesh Radhakrishnan",
      "subchanges": [
        {
          "type": "Ymodifierchange",
          "commitMessage": "HDFS-11123. [SPS] Make storage policy satisfier daemon work on/off dynamically. Contributed by Uma Maheswara Rao G\n",
          "commitDate": "12/08/18 3:05 AM",
          "commitName": "5179d99b7e1faeac1ce041967480115913d9f795",
          "commitAuthor": "Rakesh Radhakrishnan",
          "commitDateOld": "12/08/18 3:05 AM",
          "commitNameOld": "cd5262aba00aa51b905aaac95e201d4d48f2480d",
          "commitAuthorOld": "Rakesh Radhakrishnan",
          "daysBetweenCommits": 0.0,
          "commitsBetweenForRepo": 1,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,12 +1,14 @@\n-  public void stop() {\n+  public synchronized void stop() {\n     isRunning \u003d false;\n+    LOG.info(\"Stopping StoragePolicySatisfier.\");\n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n     storagePolicySatisfierThread.interrupt();\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n     this.storageMovementsMonitor.stop();\n+    this.clearQueues();\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public synchronized void stop() {\n    isRunning \u003d false;\n    LOG.info(\"Stopping StoragePolicySatisfier.\");\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    storagePolicySatisfierThread.interrupt();\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n    this.storageMovementsMonitor.stop();\n    this.clearQueues();\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
          "extendedDetails": {
            "oldValue": "[public]",
            "newValue": "[public, synchronized]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-11123. [SPS] Make storage policy satisfier daemon work on/off dynamically. Contributed by Uma Maheswara Rao G\n",
          "commitDate": "12/08/18 3:05 AM",
          "commitName": "5179d99b7e1faeac1ce041967480115913d9f795",
          "commitAuthor": "Rakesh Radhakrishnan",
          "commitDateOld": "12/08/18 3:05 AM",
          "commitNameOld": "cd5262aba00aa51b905aaac95e201d4d48f2480d",
          "commitAuthorOld": "Rakesh Radhakrishnan",
          "daysBetweenCommits": 0.0,
          "commitsBetweenForRepo": 1,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,12 +1,14 @@\n-  public void stop() {\n+  public synchronized void stop() {\n     isRunning \u003d false;\n+    LOG.info(\"Stopping StoragePolicySatisfier.\");\n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n     storagePolicySatisfierThread.interrupt();\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n     this.storageMovementsMonitor.stop();\n+    this.clearQueues();\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public synchronized void stop() {\n    isRunning \u003d false;\n    LOG.info(\"Stopping StoragePolicySatisfier.\");\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    storagePolicySatisfierThread.interrupt();\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n    this.storageMovementsMonitor.stop();\n    this.clearQueues();\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
          "extendedDetails": {}
        }
      ]
    },
    "cd5262aba00aa51b905aaac95e201d4d48f2480d": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-10885. [SPS]: Mover tool should not be allowed to run when Storage Policy Satisfier is on. Contributed by Wei Zhou\n",
      "commitDate": "12/08/18 3:05 AM",
      "commitName": "cd5262aba00aa51b905aaac95e201d4d48f2480d",
      "commitAuthor": "Rakesh Radhakrishnan",
      "commitDateOld": "12/08/18 3:05 AM",
      "commitNameOld": "b07291e176c489c2eec3da1850b790b8ba691a3e",
      "commitAuthorOld": "Rakesh Radhakrishnan",
      "daysBetweenCommits": 0.0,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,11 +1,12 @@\n   public void stop() {\n+    isRunning \u003d false;\n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n     storagePolicySatisfierThread.interrupt();\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n     this.storageMovementsMonitor.stop();\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void stop() {\n    isRunning \u003d false;\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    storagePolicySatisfierThread.interrupt();\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n    this.storageMovementsMonitor.stop();\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
      "extendedDetails": {}
    },
    "047526b4c27909f78313e1ed6216de85c6137f14": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-11029. [SPS]:Provide retry mechanism for the blocks which were failed while moving its storage at DNs. Contributed by Uma Maheswara Rao G\n",
      "commitDate": "12/08/18 3:05 AM",
      "commitName": "047526b4c27909f78313e1ed6216de85c6137f14",
      "commitAuthor": "Rakesh Radhakrishnan",
      "commitDateOld": "12/08/18 3:05 AM",
      "commitNameOld": "0f2d1ddc2c41c8db800c58cabb150e71804fe23a",
      "commitAuthorOld": "Rakesh Radhakrishnan",
      "daysBetweenCommits": 0.0,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,10 +1,11 @@\n   public void stop() {\n     if (storagePolicySatisfierThread \u003d\u003d null) {\n       return;\n     }\n     storagePolicySatisfierThread.interrupt();\n     try {\n       storagePolicySatisfierThread.join(3000);\n     } catch (InterruptedException ie) {\n     }\n+    this.storageMovementsMonitor.stop();\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void stop() {\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    storagePolicySatisfierThread.interrupt();\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n    this.storageMovementsMonitor.stop();\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java",
      "extendedDetails": {}
    },
    "1438da494424193e330f24edef823bbd60dc37d2": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-10800: [SPS]: Daemon thread in Namenode to find blocks placed in other storage than what the policy specifies. Contributed by Uma Maheswara Rao G\n",
      "commitDate": "12/08/18 3:05 AM",
      "commitName": "1438da494424193e330f24edef823bbd60dc37d2",
      "commitAuthor": "Uma Maheswara Rao G",
      "diff": "@@ -0,0 +1,10 @@\n+  public void stop() {\n+    if (storagePolicySatisfierThread \u003d\u003d null) {\n+      return;\n+    }\n+    storagePolicySatisfierThread.interrupt();\n+    try {\n+      storagePolicySatisfierThread.join(3000);\n+    } catch (InterruptedException ie) {\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public void stop() {\n    if (storagePolicySatisfierThread \u003d\u003d null) {\n      return;\n    }\n    storagePolicySatisfierThread.interrupt();\n    try {\n      storagePolicySatisfierThread.join(3000);\n    } catch (InterruptedException ie) {\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/StoragePolicySatisfier.java"
    }
  }
}