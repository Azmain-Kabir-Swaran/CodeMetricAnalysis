{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "INodeFile.java",
  "functionName": "getStoragePolicyID",
  "functionId": "getStoragePolicyID",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INodeFile.java",
  "functionStartLine": 579,
  "functionEndLine": 602,
  "numCommitsSeen": 163,
  "timeTaken": 3151,
  "changeHistory": [
    "17eae9ebb30a3b106c4f6ae0c5374a3ab83abd8a",
    "5c97db07fb306842f49d73a67a90cecec19a7833",
    "72f6bd4893dcf10d6dad24753f9be99505a87a1f",
    "073bbd805c6680f47bbfcc6e8efd708ad729bca4"
  ],
  "changeHistoryShort": {
    "17eae9ebb30a3b106c4f6ae0c5374a3ab83abd8a": "Ybodychange",
    "5c97db07fb306842f49d73a67a90cecec19a7833": "Ybodychange",
    "72f6bd4893dcf10d6dad24753f9be99505a87a1f": "Ybodychange",
    "073bbd805c6680f47bbfcc6e8efd708ad729bca4": "Ybodychange"
  },
  "changeHistoryDetails": {
    "17eae9ebb30a3b106c4f6ae0c5374a3ab83abd8a": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-10473: Allow only suitable storage policies to be set on striped files. Contributed by Uma Maheswara Rao G\n",
      "commitDate": "22/06/16 11:17 AM",
      "commitName": "17eae9ebb30a3b106c4f6ae0c5374a3ab83abd8a",
      "commitAuthor": "Uma Maheswara Rao G",
      "commitDateOld": "08/03/16 10:30 PM",
      "commitNameOld": "7600e3c48ff2043654dbe9f415a186a336b5ea6c",
      "commitAuthorOld": "Zhe Zhang",
      "daysBetweenCommits": 105.49,
      "commitsBetweenForRepo": 652,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,8 +1,24 @@\n   public byte getStoragePolicyID() {\n     byte id \u003d getLocalStoragePolicyID();\n     if (id \u003d\u003d BLOCK_STORAGE_POLICY_ID_UNSPECIFIED) {\n-      return this.getParent() !\u003d null ?\n+      id \u003d this.getParent() !\u003d null ?\n           this.getParent().getStoragePolicyID() : id;\n     }\n+\n+    // For Striped EC files, we support only suitable policies. Current\n+    // supported policies are HOT, COLD, ALL_SSD.\n+    // If the file was set with any other policies, then we just treat policy as\n+    // BLOCK_STORAGE_POLICY_ID_UNSPECIFIED.\n+    if (isStriped() \u0026\u0026 id !\u003d BLOCK_STORAGE_POLICY_ID_UNSPECIFIED\n+        \u0026\u0026 !ErasureCodingPolicyManager\n+            .checkStoragePolicySuitableForECStripedMode(id)) {\n+      id \u003d HdfsConstants.BLOCK_STORAGE_POLICY_ID_UNSPECIFIED;\n+      if (LOG.isDebugEnabled()) {\n+        LOG.debug(\"The current effective storage policy id : \" + id\n+            + \" is not suitable for striped mode EC file : \" + getName()\n+            + \". So, just returning unspecified storage policy id\");\n+      }\n+    }\n+\n     return id;\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public byte getStoragePolicyID() {\n    byte id \u003d getLocalStoragePolicyID();\n    if (id \u003d\u003d BLOCK_STORAGE_POLICY_ID_UNSPECIFIED) {\n      id \u003d this.getParent() !\u003d null ?\n          this.getParent().getStoragePolicyID() : id;\n    }\n\n    // For Striped EC files, we support only suitable policies. Current\n    // supported policies are HOT, COLD, ALL_SSD.\n    // If the file was set with any other policies, then we just treat policy as\n    // BLOCK_STORAGE_POLICY_ID_UNSPECIFIED.\n    if (isStriped() \u0026\u0026 id !\u003d BLOCK_STORAGE_POLICY_ID_UNSPECIFIED\n        \u0026\u0026 !ErasureCodingPolicyManager\n            .checkStoragePolicySuitableForECStripedMode(id)) {\n      id \u003d HdfsConstants.BLOCK_STORAGE_POLICY_ID_UNSPECIFIED;\n      if (LOG.isDebugEnabled()) {\n        LOG.debug(\"The current effective storage policy id : \" + id\n            + \" is not suitable for striped mode EC file : \" + getName()\n            + \". So, just returning unspecified storage policy id\");\n      }\n    }\n\n    return id;\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INodeFile.java",
      "extendedDetails": {}
    },
    "5c97db07fb306842f49d73a67a90cecec19a7833": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-8169. Move LocatedBlocks and related classes to hdfs-client. Contributed by Haohui Mai.\n",
      "commitDate": "20/04/15 12:36 AM",
      "commitName": "5c97db07fb306842f49d73a67a90cecec19a7833",
      "commitAuthor": "Haohui Mai",
      "commitDateOld": "02/04/15 9:20 PM",
      "commitNameOld": "72f6bd4893dcf10d6dad24753f9be99505a87a1f",
      "commitAuthorOld": "Jing Zhao",
      "daysBetweenCommits": 17.14,
      "commitsBetweenForRepo": 120,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,8 +1,8 @@\n   public byte getStoragePolicyID() {\n     byte id \u003d getLocalStoragePolicyID();\n-    if (id \u003d\u003d ID_UNSPECIFIED) {\n+    if (id \u003d\u003d BLOCK_STORAGE_POLICY_ID_UNSPECIFIED) {\n       return this.getParent() !\u003d null ?\n           this.getParent().getStoragePolicyID() : id;\n     }\n     return id;\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public byte getStoragePolicyID() {\n    byte id \u003d getLocalStoragePolicyID();\n    if (id \u003d\u003d BLOCK_STORAGE_POLICY_ID_UNSPECIFIED) {\n      return this.getParent() !\u003d null ?\n          this.getParent().getStoragePolicyID() : id;\n    }\n    return id;\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INodeFile.java",
      "extendedDetails": {}
    },
    "72f6bd4893dcf10d6dad24753f9be99505a87a1f": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-7811. Avoid recursive call getStoragePolicyID in INodeFile#computeQuotaUsage. Contributed by Xiaoyu Yao and Jing Zhao.\n",
      "commitDate": "02/04/15 9:20 PM",
      "commitName": "72f6bd4893dcf10d6dad24753f9be99505a87a1f",
      "commitAuthor": "Jing Zhao",
      "commitDateOld": "26/03/15 10:24 AM",
      "commitNameOld": "3d0708bdb0a75af3d87bbac9f6c4ffbcabab98ca",
      "commitAuthorOld": "Arpit Agarwal",
      "daysBetweenCommits": 7.46,
      "commitsBetweenForRepo": 70,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,8 +1,8 @@\n   public byte getStoragePolicyID() {\n     byte id \u003d getLocalStoragePolicyID();\n-    if (id \u003d\u003d BlockStoragePolicySuite.ID_UNSPECIFIED) {\n+    if (id \u003d\u003d ID_UNSPECIFIED) {\n       return this.getParent() !\u003d null ?\n           this.getParent().getStoragePolicyID() : id;\n     }\n     return id;\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public byte getStoragePolicyID() {\n    byte id \u003d getLocalStoragePolicyID();\n    if (id \u003d\u003d ID_UNSPECIFIED) {\n      return this.getParent() !\u003d null ?\n          this.getParent().getStoragePolicyID() : id;\n    }\n    return id;\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INodeFile.java",
      "extendedDetails": {}
    },
    "073bbd805c6680f47bbfcc6e8efd708ad729bca4": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-7081. Add new DistributedFileSystem API for getting all the existing storage policies. Contributed by Jing Zhao.\n",
      "commitDate": "24/09/14 10:05 AM",
      "commitName": "073bbd805c6680f47bbfcc6e8efd708ad729bca4",
      "commitAuthor": "Jing Zhao",
      "commitDateOld": "01/09/14 5:56 PM",
      "commitNameOld": "3e2a0b5446bce51871ab3e1262a0ac6bd365e94f",
      "commitAuthorOld": "Jing Zhao",
      "daysBetweenCommits": 22.67,
      "commitsBetweenForRepo": 246,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,8 +1,8 @@\n   public byte getStoragePolicyID() {\n     byte id \u003d getLocalStoragePolicyID();\n-    if (id \u003d\u003d BlockStoragePolicy.ID_UNSPECIFIED) {\n+    if (id \u003d\u003d BlockStoragePolicySuite.ID_UNSPECIFIED) {\n       return this.getParent() !\u003d null ?\n           this.getParent().getStoragePolicyID() : id;\n     }\n     return id;\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public byte getStoragePolicyID() {\n    byte id \u003d getLocalStoragePolicyID();\n    if (id \u003d\u003d BlockStoragePolicySuite.ID_UNSPECIFIED) {\n      return this.getParent() !\u003d null ?\n          this.getParent().getStoragePolicyID() : id;\n    }\n    return id;\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INodeFile.java",
      "extendedDetails": {}
    }
  }
}