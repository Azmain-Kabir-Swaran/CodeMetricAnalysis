{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "FpgaNodeResourceUpdateHandler.java",
  "functionName": "updateConfiguredResource",
  "functionId": "updateConfiguredResource___res-Resource",
  "sourceFilePath": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/resourceplugin/fpga/FpgaNodeResourceUpdateHandler.java",
  "functionStartLine": 48,
  "functionEndLine": 73,
  "numCommitsSeen": 4,
  "timeTaken": 1274,
  "changeHistory": [
    "56f1e131ecb9f53dcc2596807f8dec2d2b95bb51",
    "7225ec0ceb49ae8f5588484297a20f07ec047420"
  ],
  "changeHistoryShort": {
    "56f1e131ecb9f53dcc2596807f8dec2d2b95bb51": "Ybodychange",
    "7225ec0ceb49ae8f5588484297a20f07ec047420": "Yintroduced"
  },
  "changeHistoryDetails": {
    "56f1e131ecb9f53dcc2596807f8dec2d2b95bb51": {
      "type": "Ybodychange",
      "commitMessage": "YARN-9270. Minor cleanup in TestFpgaDiscoverer. Contributed by Peter Bacsko.\n",
      "commitDate": "29/03/19 10:58 AM",
      "commitName": "56f1e131ecb9f53dcc2596807f8dec2d2b95bb51",
      "commitAuthor": "Devaraj K",
      "commitDateOld": "08/03/19 4:09 AM",
      "commitNameOld": "de15a66d782094632abd09222b87a01bab8e0f5e",
      "commitAuthorOld": "Sunil G",
      "daysBetweenCommits": 21.24,
      "commitsBetweenForRepo": 155,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,26 +1,26 @@\n   public void updateConfiguredResource(Resource res) throws YarnException {\n     LOG.info(\"Initializing configured FPGA resources for the NodeManager.\");\n-    List\u003cFpgaResourceAllocator.FpgaDevice\u003e list \u003d FpgaDiscoverer.getInstance().getCurrentFpgaInfo();\n+    List\u003cFpgaDevice\u003e list \u003d fpgaDiscoverer.getCurrentFpgaInfo();\n     List\u003cInteger\u003e minors \u003d new LinkedList\u003c\u003e();\n-    for (FpgaResourceAllocator.FpgaDevice device : list) {\n+    for (FpgaDevice device : list) {\n       minors.add(device.getMinor());\n     }\n     if (minors.isEmpty()) {\n       LOG.info(\"Didn\u0027t find any usable FPGAs on the NodeManager.\");\n       return;\n     }\n     long count \u003d minors.size();\n \n     Map\u003cString, ResourceInformation\u003e configuredResourceTypes \u003d\n         ResourceUtils.getResourceTypes();\n     if (!configuredResourceTypes.containsKey(FPGA_URI)) {\n       throw new YarnException(\"Wrong configurations, found \" + count +\n           \" usable FPGAs, however \" + FPGA_URI\n           + \" resource-type is not configured inside\"\n           + \" resource-types.xml, please configure it to enable FPGA feature or\"\n           + \" remove \" + FPGA_URI + \" from \"\n           + YarnConfiguration.NM_RESOURCE_PLUGINS);\n     }\n \n     res.setResourceValue(FPGA_URI, count);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void updateConfiguredResource(Resource res) throws YarnException {\n    LOG.info(\"Initializing configured FPGA resources for the NodeManager.\");\n    List\u003cFpgaDevice\u003e list \u003d fpgaDiscoverer.getCurrentFpgaInfo();\n    List\u003cInteger\u003e minors \u003d new LinkedList\u003c\u003e();\n    for (FpgaDevice device : list) {\n      minors.add(device.getMinor());\n    }\n    if (minors.isEmpty()) {\n      LOG.info(\"Didn\u0027t find any usable FPGAs on the NodeManager.\");\n      return;\n    }\n    long count \u003d minors.size();\n\n    Map\u003cString, ResourceInformation\u003e configuredResourceTypes \u003d\n        ResourceUtils.getResourceTypes();\n    if (!configuredResourceTypes.containsKey(FPGA_URI)) {\n      throw new YarnException(\"Wrong configurations, found \" + count +\n          \" usable FPGAs, however \" + FPGA_URI\n          + \" resource-type is not configured inside\"\n          + \" resource-types.xml, please configure it to enable FPGA feature or\"\n          + \" remove \" + FPGA_URI + \" from \"\n          + YarnConfiguration.NM_RESOURCE_PLUGINS);\n    }\n\n    res.setResourceValue(FPGA_URI, count);\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/resourceplugin/fpga/FpgaNodeResourceUpdateHandler.java",
      "extendedDetails": {}
    },
    "7225ec0ceb49ae8f5588484297a20f07ec047420": {
      "type": "Yintroduced",
      "commitMessage": "YARN-6507. Add support in NodeManager to isolate FPGA devices with CGroups. (Zhankun Tang via wangda)\n\nChange-Id: Ic9afd841805f1035423915a0b0add5f3ba96cf9d\n",
      "commitDate": "01/12/17 10:50 AM",
      "commitName": "7225ec0ceb49ae8f5588484297a20f07ec047420",
      "commitAuthor": "Wangda Tan",
      "diff": "@@ -0,0 +1,26 @@\n+  public void updateConfiguredResource(Resource res) throws YarnException {\n+    LOG.info(\"Initializing configured FPGA resources for the NodeManager.\");\n+    List\u003cFpgaResourceAllocator.FpgaDevice\u003e list \u003d FpgaDiscoverer.getInstance().getCurrentFpgaInfo();\n+    List\u003cInteger\u003e minors \u003d new LinkedList\u003c\u003e();\n+    for (FpgaResourceAllocator.FpgaDevice device : list) {\n+      minors.add(device.getMinor());\n+    }\n+    if (minors.isEmpty()) {\n+      LOG.info(\"Didn\u0027t find any usable FPGAs on the NodeManager.\");\n+      return;\n+    }\n+    long count \u003d minors.size();\n+\n+    Map\u003cString, ResourceInformation\u003e configuredResourceTypes \u003d\n+        ResourceUtils.getResourceTypes();\n+    if (!configuredResourceTypes.containsKey(FPGA_URI)) {\n+      throw new YarnException(\"Wrong configurations, found \" + count +\n+          \" usable FPGAs, however \" + FPGA_URI\n+          + \" resource-type is not configured inside\"\n+          + \" resource-types.xml, please configure it to enable FPGA feature or\"\n+          + \" remove \" + FPGA_URI + \" from \"\n+          + YarnConfiguration.NM_RESOURCE_PLUGINS);\n+    }\n+\n+    res.setResourceValue(FPGA_URI, count);\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public void updateConfiguredResource(Resource res) throws YarnException {\n    LOG.info(\"Initializing configured FPGA resources for the NodeManager.\");\n    List\u003cFpgaResourceAllocator.FpgaDevice\u003e list \u003d FpgaDiscoverer.getInstance().getCurrentFpgaInfo();\n    List\u003cInteger\u003e minors \u003d new LinkedList\u003c\u003e();\n    for (FpgaResourceAllocator.FpgaDevice device : list) {\n      minors.add(device.getMinor());\n    }\n    if (minors.isEmpty()) {\n      LOG.info(\"Didn\u0027t find any usable FPGAs on the NodeManager.\");\n      return;\n    }\n    long count \u003d minors.size();\n\n    Map\u003cString, ResourceInformation\u003e configuredResourceTypes \u003d\n        ResourceUtils.getResourceTypes();\n    if (!configuredResourceTypes.containsKey(FPGA_URI)) {\n      throw new YarnException(\"Wrong configurations, found \" + count +\n          \" usable FPGAs, however \" + FPGA_URI\n          + \" resource-type is not configured inside\"\n          + \" resource-types.xml, please configure it to enable FPGA feature or\"\n          + \" remove \" + FPGA_URI + \" from \"\n          + YarnConfiguration.NM_RESOURCE_PLUGINS);\n    }\n\n    res.setResourceValue(FPGA_URI, count);\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/resourceplugin/fpga/FpgaNodeResourceUpdateHandler.java"
    }
  }
}