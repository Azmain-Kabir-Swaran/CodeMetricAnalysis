{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "SlidingWindowRetryPolicy.java",
  "functionName": "updateRetryContext",
  "functionId": "updateRetryContext___retryContext-RetryContext",
  "sourceFilePath": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/container/SlidingWindowRetryPolicy.java",
  "functionStartLine": 92,
  "functionEndLine": 113,
  "numCommitsSeen": 5,
  "timeTaken": 3377,
  "changeHistory": [
    "135941e00d762a417c3b4cc524cdc59b0d1810b1",
    "a5b27b3c678ad2f5cb8dbfa1b60ef5cd365f8bde"
  ],
  "changeHistoryShort": {
    "135941e00d762a417c3b4cc524cdc59b0d1810b1": "Ymultichange(Yparameterchange,Ymodifierchange,Ybodychange)",
    "a5b27b3c678ad2f5cb8dbfa1b60ef5cd365f8bde": "Yintroduced"
  },
  "changeHistoryDetails": {
    "135941e00d762a417c3b4cc524cdc59b0d1810b1": {
      "type": "Ymultichange(Yparameterchange,Ymodifierchange,Ybodychange)",
      "commitMessage": "YARN-8362.  Bugfix logic in container retries in node manager.\n            Contributed by Chandni Singh\n",
      "commitDate": "29/05/18 1:56 PM",
      "commitName": "135941e00d762a417c3b4cc524cdc59b0d1810b1",
      "commitAuthor": "Eric Yang",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "YARN-8362.  Bugfix logic in container retries in node manager.\n            Contributed by Chandni Singh\n",
          "commitDate": "29/05/18 1:56 PM",
          "commitName": "135941e00d762a417c3b4cc524cdc59b0d1810b1",
          "commitAuthor": "Eric Yang",
          "commitDateOld": "13/03/18 5:55 PM",
          "commitNameOld": "a5b27b3c678ad2f5cb8dbfa1b60ef5cd365f8bde",
          "commitAuthorOld": "Wangda Tan",
          "daysBetweenCommits": 76.83,
          "commitsBetweenForRepo": 1179,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,8 +1,22 @@\n-  private void updateRetryContext(RetryContext retryContext,\n-      int pendingRetries) {\n-    retryContext.setRemainingRetries(pendingRetries - 1);\n-    if (retryContext.containerRetryContext.getFailuresValidityInterval()\n-        \u003e 0) {\n-      retryContext.getRestartTimes().add(clock.getTime());\n+  protected void updateRetryContext(RetryContext retryContext) {\n+    if (retryContext.containerRetryContext.getFailuresValidityInterval() \u003e 0) {\n+      ContainerRetryContext containerRC \u003d retryContext.containerRetryContext;\n+      Iterator\u003cLong\u003e iterator \u003d retryContext.getRestartTimes().iterator();\n+      long currentTime \u003d clock.getTime();\n+\n+      while (iterator.hasNext()) {\n+        long restartTime \u003d iterator.next();\n+        if (currentTime - restartTime\n+            \u003e containerRC.getFailuresValidityInterval()) {\n+          iterator.remove();\n+        } else {\n+          break;\n+        }\n+      }\n+      retryContext.setRemainingRetries(containerRC.getMaxRetries() -\n+          retryContext.restartTimes.size());\n+      retryContext.getRestartTimes().add(currentTime);\n+    } else {\n+      retryContext.remainingRetries--;\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  protected void updateRetryContext(RetryContext retryContext) {\n    if (retryContext.containerRetryContext.getFailuresValidityInterval() \u003e 0) {\n      ContainerRetryContext containerRC \u003d retryContext.containerRetryContext;\n      Iterator\u003cLong\u003e iterator \u003d retryContext.getRestartTimes().iterator();\n      long currentTime \u003d clock.getTime();\n\n      while (iterator.hasNext()) {\n        long restartTime \u003d iterator.next();\n        if (currentTime - restartTime\n            \u003e containerRC.getFailuresValidityInterval()) {\n          iterator.remove();\n        } else {\n          break;\n        }\n      }\n      retryContext.setRemainingRetries(containerRC.getMaxRetries() -\n          retryContext.restartTimes.size());\n      retryContext.getRestartTimes().add(currentTime);\n    } else {\n      retryContext.remainingRetries--;\n    }\n  }",
          "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/container/SlidingWindowRetryPolicy.java",
          "extendedDetails": {
            "oldValue": "[retryContext-RetryContext, pendingRetries-int]",
            "newValue": "[retryContext-RetryContext]"
          }
        },
        {
          "type": "Ymodifierchange",
          "commitMessage": "YARN-8362.  Bugfix logic in container retries in node manager.\n            Contributed by Chandni Singh\n",
          "commitDate": "29/05/18 1:56 PM",
          "commitName": "135941e00d762a417c3b4cc524cdc59b0d1810b1",
          "commitAuthor": "Eric Yang",
          "commitDateOld": "13/03/18 5:55 PM",
          "commitNameOld": "a5b27b3c678ad2f5cb8dbfa1b60ef5cd365f8bde",
          "commitAuthorOld": "Wangda Tan",
          "daysBetweenCommits": 76.83,
          "commitsBetweenForRepo": 1179,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,8 +1,22 @@\n-  private void updateRetryContext(RetryContext retryContext,\n-      int pendingRetries) {\n-    retryContext.setRemainingRetries(pendingRetries - 1);\n-    if (retryContext.containerRetryContext.getFailuresValidityInterval()\n-        \u003e 0) {\n-      retryContext.getRestartTimes().add(clock.getTime());\n+  protected void updateRetryContext(RetryContext retryContext) {\n+    if (retryContext.containerRetryContext.getFailuresValidityInterval() \u003e 0) {\n+      ContainerRetryContext containerRC \u003d retryContext.containerRetryContext;\n+      Iterator\u003cLong\u003e iterator \u003d retryContext.getRestartTimes().iterator();\n+      long currentTime \u003d clock.getTime();\n+\n+      while (iterator.hasNext()) {\n+        long restartTime \u003d iterator.next();\n+        if (currentTime - restartTime\n+            \u003e containerRC.getFailuresValidityInterval()) {\n+          iterator.remove();\n+        } else {\n+          break;\n+        }\n+      }\n+      retryContext.setRemainingRetries(containerRC.getMaxRetries() -\n+          retryContext.restartTimes.size());\n+      retryContext.getRestartTimes().add(currentTime);\n+    } else {\n+      retryContext.remainingRetries--;\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  protected void updateRetryContext(RetryContext retryContext) {\n    if (retryContext.containerRetryContext.getFailuresValidityInterval() \u003e 0) {\n      ContainerRetryContext containerRC \u003d retryContext.containerRetryContext;\n      Iterator\u003cLong\u003e iterator \u003d retryContext.getRestartTimes().iterator();\n      long currentTime \u003d clock.getTime();\n\n      while (iterator.hasNext()) {\n        long restartTime \u003d iterator.next();\n        if (currentTime - restartTime\n            \u003e containerRC.getFailuresValidityInterval()) {\n          iterator.remove();\n        } else {\n          break;\n        }\n      }\n      retryContext.setRemainingRetries(containerRC.getMaxRetries() -\n          retryContext.restartTimes.size());\n      retryContext.getRestartTimes().add(currentTime);\n    } else {\n      retryContext.remainingRetries--;\n    }\n  }",
          "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/container/SlidingWindowRetryPolicy.java",
          "extendedDetails": {
            "oldValue": "[private]",
            "newValue": "[protected]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "YARN-8362.  Bugfix logic in container retries in node manager.\n            Contributed by Chandni Singh\n",
          "commitDate": "29/05/18 1:56 PM",
          "commitName": "135941e00d762a417c3b4cc524cdc59b0d1810b1",
          "commitAuthor": "Eric Yang",
          "commitDateOld": "13/03/18 5:55 PM",
          "commitNameOld": "a5b27b3c678ad2f5cb8dbfa1b60ef5cd365f8bde",
          "commitAuthorOld": "Wangda Tan",
          "daysBetweenCommits": 76.83,
          "commitsBetweenForRepo": 1179,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,8 +1,22 @@\n-  private void updateRetryContext(RetryContext retryContext,\n-      int pendingRetries) {\n-    retryContext.setRemainingRetries(pendingRetries - 1);\n-    if (retryContext.containerRetryContext.getFailuresValidityInterval()\n-        \u003e 0) {\n-      retryContext.getRestartTimes().add(clock.getTime());\n+  protected void updateRetryContext(RetryContext retryContext) {\n+    if (retryContext.containerRetryContext.getFailuresValidityInterval() \u003e 0) {\n+      ContainerRetryContext containerRC \u003d retryContext.containerRetryContext;\n+      Iterator\u003cLong\u003e iterator \u003d retryContext.getRestartTimes().iterator();\n+      long currentTime \u003d clock.getTime();\n+\n+      while (iterator.hasNext()) {\n+        long restartTime \u003d iterator.next();\n+        if (currentTime - restartTime\n+            \u003e containerRC.getFailuresValidityInterval()) {\n+          iterator.remove();\n+        } else {\n+          break;\n+        }\n+      }\n+      retryContext.setRemainingRetries(containerRC.getMaxRetries() -\n+          retryContext.restartTimes.size());\n+      retryContext.getRestartTimes().add(currentTime);\n+    } else {\n+      retryContext.remainingRetries--;\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  protected void updateRetryContext(RetryContext retryContext) {\n    if (retryContext.containerRetryContext.getFailuresValidityInterval() \u003e 0) {\n      ContainerRetryContext containerRC \u003d retryContext.containerRetryContext;\n      Iterator\u003cLong\u003e iterator \u003d retryContext.getRestartTimes().iterator();\n      long currentTime \u003d clock.getTime();\n\n      while (iterator.hasNext()) {\n        long restartTime \u003d iterator.next();\n        if (currentTime - restartTime\n            \u003e containerRC.getFailuresValidityInterval()) {\n          iterator.remove();\n        } else {\n          break;\n        }\n      }\n      retryContext.setRemainingRetries(containerRC.getMaxRetries() -\n          retryContext.restartTimes.size());\n      retryContext.getRestartTimes().add(currentTime);\n    } else {\n      retryContext.remainingRetries--;\n    }\n  }",
          "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/container/SlidingWindowRetryPolicy.java",
          "extendedDetails": {}
        }
      ]
    },
    "a5b27b3c678ad2f5cb8dbfa1b60ef5cd365f8bde": {
      "type": "Yintroduced",
      "commitMessage": "YARN-5015. Support sliding window retry capability for container restart. (Chandni Singh via wangda)\n\nChange-Id: I07addd3e4ba8d98456ee2ff1d5c540a38fe61dea\n",
      "commitDate": "13/03/18 5:55 PM",
      "commitName": "a5b27b3c678ad2f5cb8dbfa1b60ef5cd365f8bde",
      "commitAuthor": "Wangda Tan",
      "diff": "@@ -0,0 +1,8 @@\n+  private void updateRetryContext(RetryContext retryContext,\n+      int pendingRetries) {\n+    retryContext.setRemainingRetries(pendingRetries - 1);\n+    if (retryContext.containerRetryContext.getFailuresValidityInterval()\n+        \u003e 0) {\n+      retryContext.getRestartTimes().add(clock.getTime());\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  private void updateRetryContext(RetryContext retryContext,\n      int pendingRetries) {\n    retryContext.setRemainingRetries(pendingRetries - 1);\n    if (retryContext.containerRetryContext.getFailuresValidityInterval()\n        \u003e 0) {\n      retryContext.getRestartTimes().add(clock.getTime());\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/container/SlidingWindowRetryPolicy.java"
    }
  }
}