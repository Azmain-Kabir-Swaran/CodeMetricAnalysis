{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "FSImageFormat.java",
  "functionName": "load",
  "functionId": "load___file-File__requireSameLayoutVersion-boolean",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormat.java",
  "functionStartLine": 215,
  "functionEndLine": 237,
  "numCommitsSeen": 218,
  "timeTaken": 4549,
  "changeHistory": [
    "7a3188d054481b9bd563e337901e93476303ce7f",
    "eca1a4bfe952fc184fe90dde50bac9b0e5293568",
    "18620649f96d9e378fb7ea40de216284a9d525c7",
    "a2edb11b68ae01a44092cb14ac2717a6aad93305"
  ],
  "changeHistoryShort": {
    "7a3188d054481b9bd563e337901e93476303ce7f": "Ybodychange",
    "eca1a4bfe952fc184fe90dde50bac9b0e5293568": "Ybodychange",
    "18620649f96d9e378fb7ea40de216284a9d525c7": "Ymultichange(Yparameterchange,Ybodychange)",
    "a2edb11b68ae01a44092cb14ac2717a6aad93305": "Yintroduced"
  },
  "changeHistoryDetails": {
    "7a3188d054481b9bd563e337901e93476303ce7f": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-16282. Avoid FileStream to improve performance. Contributed by Ayush Saxena.\n",
      "commitDate": "02/05/19 12:58 PM",
      "commitName": "7a3188d054481b9bd563e337901e93476303ce7f",
      "commitAuthor": "Giovanni Matteo Fumarola",
      "commitDateOld": "06/09/18 2:48 PM",
      "commitNameOld": "eca1a4bfe952fc184fe90dde50bac9b0e5293568",
      "commitAuthorOld": "Giovanni Matteo Fumarola",
      "daysBetweenCommits": 237.92,
      "commitsBetweenForRepo": 1864,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,23 +1,23 @@\n     public void load(File file, boolean requireSameLayoutVersion)\n         throws IOException {\n       Preconditions.checkState(impl \u003d\u003d null, \"Image already loaded!\");\n \n-      FileInputStream is \u003d null;\n+      InputStream is \u003d null;\n       try {\n-        is \u003d new FileInputStream(file);\n+        is \u003d Files.newInputStream(file.toPath());\n         byte[] magic \u003d new byte[FSImageUtil.MAGIC_HEADER.length];\n         IOUtils.readFully(is, magic, 0, magic.length);\n         if (Arrays.equals(magic, FSImageUtil.MAGIC_HEADER)) {\n           FSImageFormatProtobuf.Loader loader \u003d new FSImageFormatProtobuf.Loader(\n               conf, fsn, requireSameLayoutVersion);\n           impl \u003d loader;\n           loader.load(file);\n         } else {\n           Loader loader \u003d new Loader(conf, fsn);\n           impl \u003d loader;\n           loader.load(file);\n         }\n       } finally {\n         IOUtils.cleanupWithLogger(LOG, is);\n       }\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void load(File file, boolean requireSameLayoutVersion)\n        throws IOException {\n      Preconditions.checkState(impl \u003d\u003d null, \"Image already loaded!\");\n\n      InputStream is \u003d null;\n      try {\n        is \u003d Files.newInputStream(file.toPath());\n        byte[] magic \u003d new byte[FSImageUtil.MAGIC_HEADER.length];\n        IOUtils.readFully(is, magic, 0, magic.length);\n        if (Arrays.equals(magic, FSImageUtil.MAGIC_HEADER)) {\n          FSImageFormatProtobuf.Loader loader \u003d new FSImageFormatProtobuf.Loader(\n              conf, fsn, requireSameLayoutVersion);\n          impl \u003d loader;\n          loader.load(file);\n        } else {\n          Loader loader \u003d new Loader(conf, fsn);\n          impl \u003d loader;\n          loader.load(file);\n        }\n      } finally {\n        IOUtils.cleanupWithLogger(LOG, is);\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormat.java",
      "extendedDetails": {}
    },
    "eca1a4bfe952fc184fe90dde50bac9b0e5293568": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-13695. Move logging to slf4j in HDFS package. Contributed by Ian Pickering.\n",
      "commitDate": "06/09/18 2:48 PM",
      "commitName": "eca1a4bfe952fc184fe90dde50bac9b0e5293568",
      "commitAuthor": "Giovanni Matteo Fumarola",
      "commitDateOld": "27/02/17 5:07 PM",
      "commitNameOld": "55c07bbed2f475f7b584a86112ee1b6fe0221e98",
      "commitAuthorOld": "Andrew Wang",
      "daysBetweenCommits": 555.86,
      "commitsBetweenForRepo": 4412,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,23 +1,23 @@\n     public void load(File file, boolean requireSameLayoutVersion)\n         throws IOException {\n       Preconditions.checkState(impl \u003d\u003d null, \"Image already loaded!\");\n \n       FileInputStream is \u003d null;\n       try {\n         is \u003d new FileInputStream(file);\n         byte[] magic \u003d new byte[FSImageUtil.MAGIC_HEADER.length];\n         IOUtils.readFully(is, magic, 0, magic.length);\n         if (Arrays.equals(magic, FSImageUtil.MAGIC_HEADER)) {\n           FSImageFormatProtobuf.Loader loader \u003d new FSImageFormatProtobuf.Loader(\n               conf, fsn, requireSameLayoutVersion);\n           impl \u003d loader;\n           loader.load(file);\n         } else {\n           Loader loader \u003d new Loader(conf, fsn);\n           impl \u003d loader;\n           loader.load(file);\n         }\n       } finally {\n-        IOUtils.cleanup(LOG, is);\n+        IOUtils.cleanupWithLogger(LOG, is);\n       }\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void load(File file, boolean requireSameLayoutVersion)\n        throws IOException {\n      Preconditions.checkState(impl \u003d\u003d null, \"Image already loaded!\");\n\n      FileInputStream is \u003d null;\n      try {\n        is \u003d new FileInputStream(file);\n        byte[] magic \u003d new byte[FSImageUtil.MAGIC_HEADER.length];\n        IOUtils.readFully(is, magic, 0, magic.length);\n        if (Arrays.equals(magic, FSImageUtil.MAGIC_HEADER)) {\n          FSImageFormatProtobuf.Loader loader \u003d new FSImageFormatProtobuf.Loader(\n              conf, fsn, requireSameLayoutVersion);\n          impl \u003d loader;\n          loader.load(file);\n        } else {\n          Loader loader \u003d new Loader(conf, fsn);\n          impl \u003d loader;\n          loader.load(file);\n        }\n      } finally {\n        IOUtils.cleanupWithLogger(LOG, is);\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormat.java",
      "extendedDetails": {}
    },
    "18620649f96d9e378fb7ea40de216284a9d525c7": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HDFS-7185. The active NameNode will not accept an fsimage sent from the standby during rolling upgrade. Contributed by Jing Zhao.\n",
      "commitDate": "15/10/14 10:27 AM",
      "commitName": "18620649f96d9e378fb7ea40de216284a9d525c7",
      "commitAuthor": "Jing Zhao",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HDFS-7185. The active NameNode will not accept an fsimage sent from the standby during rolling upgrade. Contributed by Jing Zhao.\n",
          "commitDate": "15/10/14 10:27 AM",
          "commitName": "18620649f96d9e378fb7ea40de216284a9d525c7",
          "commitAuthor": "Jing Zhao",
          "commitDateOld": "29/09/14 10:27 PM",
          "commitNameOld": "bb84f1fccb18c6c7373851e05d2451d55e908242",
          "commitAuthorOld": "arp",
          "daysBetweenCommits": 15.5,
          "commitsBetweenForRepo": 140,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,23 +1,23 @@\n-    public void load(File file) throws IOException {\n+    public void load(File file, boolean requireSameLayoutVersion)\n+        throws IOException {\n       Preconditions.checkState(impl \u003d\u003d null, \"Image already loaded!\");\n \n       FileInputStream is \u003d null;\n       try {\n         is \u003d new FileInputStream(file);\n         byte[] magic \u003d new byte[FSImageUtil.MAGIC_HEADER.length];\n         IOUtils.readFully(is, magic, 0, magic.length);\n         if (Arrays.equals(magic, FSImageUtil.MAGIC_HEADER)) {\n           FSImageFormatProtobuf.Loader loader \u003d new FSImageFormatProtobuf.Loader(\n-              conf, fsn);\n+              conf, fsn, requireSameLayoutVersion);\n           impl \u003d loader;\n           loader.load(file);\n         } else {\n           Loader loader \u003d new Loader(conf, fsn);\n           impl \u003d loader;\n           loader.load(file);\n         }\n-\n       } finally {\n         IOUtils.cleanup(LOG, is);\n       }\n     }\n\\ No newline at end of file\n",
          "actualSource": "    public void load(File file, boolean requireSameLayoutVersion)\n        throws IOException {\n      Preconditions.checkState(impl \u003d\u003d null, \"Image already loaded!\");\n\n      FileInputStream is \u003d null;\n      try {\n        is \u003d new FileInputStream(file);\n        byte[] magic \u003d new byte[FSImageUtil.MAGIC_HEADER.length];\n        IOUtils.readFully(is, magic, 0, magic.length);\n        if (Arrays.equals(magic, FSImageUtil.MAGIC_HEADER)) {\n          FSImageFormatProtobuf.Loader loader \u003d new FSImageFormatProtobuf.Loader(\n              conf, fsn, requireSameLayoutVersion);\n          impl \u003d loader;\n          loader.load(file);\n        } else {\n          Loader loader \u003d new Loader(conf, fsn);\n          impl \u003d loader;\n          loader.load(file);\n        }\n      } finally {\n        IOUtils.cleanup(LOG, is);\n      }\n    }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormat.java",
          "extendedDetails": {
            "oldValue": "[file-File]",
            "newValue": "[file-File, requireSameLayoutVersion-boolean]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-7185. The active NameNode will not accept an fsimage sent from the standby during rolling upgrade. Contributed by Jing Zhao.\n",
          "commitDate": "15/10/14 10:27 AM",
          "commitName": "18620649f96d9e378fb7ea40de216284a9d525c7",
          "commitAuthor": "Jing Zhao",
          "commitDateOld": "29/09/14 10:27 PM",
          "commitNameOld": "bb84f1fccb18c6c7373851e05d2451d55e908242",
          "commitAuthorOld": "arp",
          "daysBetweenCommits": 15.5,
          "commitsBetweenForRepo": 140,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,23 +1,23 @@\n-    public void load(File file) throws IOException {\n+    public void load(File file, boolean requireSameLayoutVersion)\n+        throws IOException {\n       Preconditions.checkState(impl \u003d\u003d null, \"Image already loaded!\");\n \n       FileInputStream is \u003d null;\n       try {\n         is \u003d new FileInputStream(file);\n         byte[] magic \u003d new byte[FSImageUtil.MAGIC_HEADER.length];\n         IOUtils.readFully(is, magic, 0, magic.length);\n         if (Arrays.equals(magic, FSImageUtil.MAGIC_HEADER)) {\n           FSImageFormatProtobuf.Loader loader \u003d new FSImageFormatProtobuf.Loader(\n-              conf, fsn);\n+              conf, fsn, requireSameLayoutVersion);\n           impl \u003d loader;\n           loader.load(file);\n         } else {\n           Loader loader \u003d new Loader(conf, fsn);\n           impl \u003d loader;\n           loader.load(file);\n         }\n-\n       } finally {\n         IOUtils.cleanup(LOG, is);\n       }\n     }\n\\ No newline at end of file\n",
          "actualSource": "    public void load(File file, boolean requireSameLayoutVersion)\n        throws IOException {\n      Preconditions.checkState(impl \u003d\u003d null, \"Image already loaded!\");\n\n      FileInputStream is \u003d null;\n      try {\n        is \u003d new FileInputStream(file);\n        byte[] magic \u003d new byte[FSImageUtil.MAGIC_HEADER.length];\n        IOUtils.readFully(is, magic, 0, magic.length);\n        if (Arrays.equals(magic, FSImageUtil.MAGIC_HEADER)) {\n          FSImageFormatProtobuf.Loader loader \u003d new FSImageFormatProtobuf.Loader(\n              conf, fsn, requireSameLayoutVersion);\n          impl \u003d loader;\n          loader.load(file);\n        } else {\n          Loader loader \u003d new Loader(conf, fsn);\n          impl \u003d loader;\n          loader.load(file);\n        }\n      } finally {\n        IOUtils.cleanup(LOG, is);\n      }\n    }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormat.java",
          "extendedDetails": {}
        }
      ]
    },
    "a2edb11b68ae01a44092cb14ac2717a6aad93305": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-5698. Use protobuf to serialize / deserialize FSImage. Contributed by Haohui Mai.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1566359 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "09/02/14 11:18 AM",
      "commitName": "a2edb11b68ae01a44092cb14ac2717a6aad93305",
      "commitAuthor": "Jing Zhao",
      "diff": "@@ -0,0 +1,23 @@\n+    public void load(File file) throws IOException {\n+      Preconditions.checkState(impl \u003d\u003d null, \"Image already loaded!\");\n+\n+      FileInputStream is \u003d null;\n+      try {\n+        is \u003d new FileInputStream(file);\n+        byte[] magic \u003d new byte[FSImageUtil.MAGIC_HEADER.length];\n+        IOUtils.readFully(is, magic, 0, magic.length);\n+        if (Arrays.equals(magic, FSImageUtil.MAGIC_HEADER)) {\n+          FSImageFormatProtobuf.Loader loader \u003d new FSImageFormatProtobuf.Loader(\n+              conf, fsn);\n+          impl \u003d loader;\n+          loader.load(file);\n+        } else {\n+          Loader loader \u003d new Loader(conf, fsn);\n+          impl \u003d loader;\n+          loader.load(file);\n+        }\n+\n+      } finally {\n+        IOUtils.cleanup(LOG, is);\n+      }\n+    }\n\\ No newline at end of file\n",
      "actualSource": "    public void load(File file) throws IOException {\n      Preconditions.checkState(impl \u003d\u003d null, \"Image already loaded!\");\n\n      FileInputStream is \u003d null;\n      try {\n        is \u003d new FileInputStream(file);\n        byte[] magic \u003d new byte[FSImageUtil.MAGIC_HEADER.length];\n        IOUtils.readFully(is, magic, 0, magic.length);\n        if (Arrays.equals(magic, FSImageUtil.MAGIC_HEADER)) {\n          FSImageFormatProtobuf.Loader loader \u003d new FSImageFormatProtobuf.Loader(\n              conf, fsn);\n          impl \u003d loader;\n          loader.load(file);\n        } else {\n          Loader loader \u003d new Loader(conf, fsn);\n          impl \u003d loader;\n          loader.load(file);\n        }\n\n      } finally {\n        IOUtils.cleanup(LOG, is);\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormat.java"
    }
  }
}