{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "BlockManagerSafeMode.java",
  "functionName": "doConsistencyCheck",
  "functionId": "doConsistencyCheck",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManagerSafeMode.java",
  "functionStartLine": 596,
  "functionEndLine": 613,
  "numCommitsSeen": 663,
  "timeTaken": 36916,
  "changeHistory": [
    "a49cc74b4c72195dee1dfb6f9548e5e411dff553"
  ],
  "changeHistoryShort": {
    "a49cc74b4c72195dee1dfb6f9548e5e411dff553": "Ymultichange(Ymovefromfile,Ybodychange)"
  },
  "changeHistoryDetails": {
    "a49cc74b4c72195dee1dfb6f9548e5e411dff553": {
      "type": "Ymultichange(Ymovefromfile,Ybodychange)",
      "commitMessage": "HDFS-9129. Move the safemode block count into BlockManager. Contributed by Mingliang Liu.\n",
      "commitDate": "01/12/15 4:09 PM",
      "commitName": "a49cc74b4c72195dee1dfb6f9548e5e411dff553",
      "commitAuthor": "Jing Zhao",
      "subchanges": [
        {
          "type": "Ymovefromfile",
          "commitMessage": "HDFS-9129. Move the safemode block count into BlockManager. Contributed by Mingliang Liu.\n",
          "commitDate": "01/12/15 4:09 PM",
          "commitName": "a49cc74b4c72195dee1dfb6f9548e5e411dff553",
          "commitAuthor": "Jing Zhao",
          "commitDateOld": "01/12/15 1:32 PM",
          "commitNameOld": "58f6f54eeac779428ac995d196b60ffb90563f97",
          "commitAuthorOld": "Arpit Agarwal",
          "daysBetweenCommits": 0.11,
          "commitsBetweenForRepo": 1,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,18 +1,18 @@\n-    private void doConsistencyCheck() {\n-      boolean assertsOn \u003d false;\n-      assert assertsOn \u003d true; // set to true if asserts are on\n-      if (!assertsOn) return;\n-      \n-      if (blockTotal \u003d\u003d -1 \u0026\u0026 blockSafe \u003d\u003d -1) {\n-        return; // manual safe mode\n-      }\n-      int activeBlocks \u003d blockManager.getActiveBlockCount();\n-      if ((blockTotal !\u003d activeBlocks) \u0026\u0026\n+  private void doConsistencyCheck() {\n+    boolean assertsOn \u003d false;\n+    assert assertsOn \u003d true; // set to true if asserts are on\n+    if (!assertsOn) {\n+      return;\n+    }\n+\n+    int activeBlocks \u003d blockManager.getActiveBlockCount();\n+    synchronized (this) {\n+      if (blockTotal !\u003d activeBlocks \u0026\u0026\n           !(blockSafe \u003e\u003d 0 \u0026\u0026 blockSafe \u003c\u003d blockTotal)) {\n-        throw new AssertionError(\n-            \" SafeMode: Inconsistent filesystem state: \"\n-        + \"SafeMode data: blockTotal\u003d\" + blockTotal\n-        + \" blockSafe\u003d\" + blockSafe + \"; \"\n-        + \"BlockManager data: active\u003d\"  + activeBlocks);\n+        LOG.warn(\"SafeMode is in inconsistent filesystem state. \" +\n+            \"BlockManagerSafeMode data: blockTotal\u003d{}, blockSafe\u003d{}; \" +\n+            \"BlockManager data: activeBlocks\u003d{}\",\n+            blockTotal, blockSafe, activeBlocks);\n       }\n-    }\n\\ No newline at end of file\n+    }\n+  }\n\\ No newline at end of file\n",
          "actualSource": "  private void doConsistencyCheck() {\n    boolean assertsOn \u003d false;\n    assert assertsOn \u003d true; // set to true if asserts are on\n    if (!assertsOn) {\n      return;\n    }\n\n    int activeBlocks \u003d blockManager.getActiveBlockCount();\n    synchronized (this) {\n      if (blockTotal !\u003d activeBlocks \u0026\u0026\n          !(blockSafe \u003e\u003d 0 \u0026\u0026 blockSafe \u003c\u003d blockTotal)) {\n        LOG.warn(\"SafeMode is in inconsistent filesystem state. \" +\n            \"BlockManagerSafeMode data: blockTotal\u003d{}, blockSafe\u003d{}; \" +\n            \"BlockManager data: activeBlocks\u003d{}\",\n            blockTotal, blockSafe, activeBlocks);\n      }\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManagerSafeMode.java",
          "extendedDetails": {
            "oldPath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java",
            "newPath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManagerSafeMode.java",
            "oldMethodName": "doConsistencyCheck",
            "newMethodName": "doConsistencyCheck"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-9129. Move the safemode block count into BlockManager. Contributed by Mingliang Liu.\n",
          "commitDate": "01/12/15 4:09 PM",
          "commitName": "a49cc74b4c72195dee1dfb6f9548e5e411dff553",
          "commitAuthor": "Jing Zhao",
          "commitDateOld": "01/12/15 1:32 PM",
          "commitNameOld": "58f6f54eeac779428ac995d196b60ffb90563f97",
          "commitAuthorOld": "Arpit Agarwal",
          "daysBetweenCommits": 0.11,
          "commitsBetweenForRepo": 1,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,18 +1,18 @@\n-    private void doConsistencyCheck() {\n-      boolean assertsOn \u003d false;\n-      assert assertsOn \u003d true; // set to true if asserts are on\n-      if (!assertsOn) return;\n-      \n-      if (blockTotal \u003d\u003d -1 \u0026\u0026 blockSafe \u003d\u003d -1) {\n-        return; // manual safe mode\n-      }\n-      int activeBlocks \u003d blockManager.getActiveBlockCount();\n-      if ((blockTotal !\u003d activeBlocks) \u0026\u0026\n+  private void doConsistencyCheck() {\n+    boolean assertsOn \u003d false;\n+    assert assertsOn \u003d true; // set to true if asserts are on\n+    if (!assertsOn) {\n+      return;\n+    }\n+\n+    int activeBlocks \u003d blockManager.getActiveBlockCount();\n+    synchronized (this) {\n+      if (blockTotal !\u003d activeBlocks \u0026\u0026\n           !(blockSafe \u003e\u003d 0 \u0026\u0026 blockSafe \u003c\u003d blockTotal)) {\n-        throw new AssertionError(\n-            \" SafeMode: Inconsistent filesystem state: \"\n-        + \"SafeMode data: blockTotal\u003d\" + blockTotal\n-        + \" blockSafe\u003d\" + blockSafe + \"; \"\n-        + \"BlockManager data: active\u003d\"  + activeBlocks);\n+        LOG.warn(\"SafeMode is in inconsistent filesystem state. \" +\n+            \"BlockManagerSafeMode data: blockTotal\u003d{}, blockSafe\u003d{}; \" +\n+            \"BlockManager data: activeBlocks\u003d{}\",\n+            blockTotal, blockSafe, activeBlocks);\n       }\n-    }\n\\ No newline at end of file\n+    }\n+  }\n\\ No newline at end of file\n",
          "actualSource": "  private void doConsistencyCheck() {\n    boolean assertsOn \u003d false;\n    assert assertsOn \u003d true; // set to true if asserts are on\n    if (!assertsOn) {\n      return;\n    }\n\n    int activeBlocks \u003d blockManager.getActiveBlockCount();\n    synchronized (this) {\n      if (blockTotal !\u003d activeBlocks \u0026\u0026\n          !(blockSafe \u003e\u003d 0 \u0026\u0026 blockSafe \u003c\u003d blockTotal)) {\n        LOG.warn(\"SafeMode is in inconsistent filesystem state. \" +\n            \"BlockManagerSafeMode data: blockTotal\u003d{}, blockSafe\u003d{}; \" +\n            \"BlockManager data: activeBlocks\u003d{}\",\n            blockTotal, blockSafe, activeBlocks);\n      }\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManagerSafeMode.java",
          "extendedDetails": {}
        }
      ]
    }
  }
}