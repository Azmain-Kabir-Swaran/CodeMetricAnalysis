{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "NMLeveldbStateStoreService.java",
  "functionName": "cleanupKeysWithPrefix",
  "functionId": "cleanupKeysWithPrefix___prefix-String",
  "sourceFilePath": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/recovery/NMLeveldbStateStoreService.java",
  "functionStartLine": 1455,
  "functionEndLine": 1487,
  "numCommitsSeen": 43,
  "timeTaken": 2286,
  "changeHistory": [
    "2064ca015d1584263aac0cc20c60b925a3aff612",
    "3150ae8108a1fc40a67926be6254824c1e37cb38"
  ],
  "changeHistoryShort": {
    "2064ca015d1584263aac0cc20c60b925a3aff612": "Ybodychange",
    "3150ae8108a1fc40a67926be6254824c1e37cb38": "Yintroduced"
  },
  "changeHistoryDetails": {
    "2064ca015d1584263aac0cc20c60b925a3aff612": {
      "type": "Ybodychange",
      "commitMessage": "YARN-9349.  Changed logging to use slf4j api.\n            Contributed by Prabhu Joseph\n",
      "commitDate": "15/03/19 4:20 PM",
      "commitName": "2064ca015d1584263aac0cc20c60b925a3aff612",
      "commitAuthor": "Eric Yang",
      "commitDateOld": "13/09/18 11:28 AM",
      "commitNameOld": "250b50018e8c94d8ca83ff981b01f26bb68c0842",
      "commitAuthorOld": "Jason Lowe",
      "daysBetweenCommits": 183.2,
      "commitsBetweenForRepo": 1474,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,35 +1,33 @@\n   private void cleanupKeysWithPrefix(String prefix) throws IOException {\n     WriteBatch batch \u003d null;\n     LeveldbIterator iter \u003d null;\n     try {\n       iter \u003d new LeveldbIterator(db);\n       try {\n         batch \u003d db.createWriteBatch();\n         iter.seek(bytes(prefix));\n         while (iter.hasNext()) {\n           byte[] key \u003d iter.next().getKey();\n           String keyStr \u003d asString(key);\n           if (!keyStr.startsWith(prefix)) {\n             break;\n           }\n           batch.delete(key);\n-          if (LOG.isDebugEnabled()) {\n-            LOG.debug(\"cleanup \" + keyStr + \" from leveldb\");\n-          }\n+          LOG.debug(\"cleanup {} from leveldb\", keyStr);\n         }\n         db.write(batch);\n       } catch (DBException e) {\n         throw new IOException(e);\n       } finally {\n         if (batch !\u003d null) {\n           batch.close();\n         }\n       }\n     } catch (DBException e) {\n       throw new IOException(e);\n     } finally {\n       if (iter !\u003d null) {\n         iter.close();\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void cleanupKeysWithPrefix(String prefix) throws IOException {\n    WriteBatch batch \u003d null;\n    LeveldbIterator iter \u003d null;\n    try {\n      iter \u003d new LeveldbIterator(db);\n      try {\n        batch \u003d db.createWriteBatch();\n        iter.seek(bytes(prefix));\n        while (iter.hasNext()) {\n          byte[] key \u003d iter.next().getKey();\n          String keyStr \u003d asString(key);\n          if (!keyStr.startsWith(prefix)) {\n            break;\n          }\n          batch.delete(key);\n          LOG.debug(\"cleanup {} from leveldb\", keyStr);\n        }\n        db.write(batch);\n      } catch (DBException e) {\n        throw new IOException(e);\n      } finally {\n        if (batch !\u003d null) {\n          batch.close();\n        }\n      }\n    } catch (DBException e) {\n      throw new IOException(e);\n    } finally {\n      if (iter !\u003d null) {\n        iter.close();\n      }\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/recovery/NMLeveldbStateStoreService.java",
      "extendedDetails": {}
    },
    "3150ae8108a1fc40a67926be6254824c1e37cb38": {
      "type": "Yintroduced",
      "commitMessage": "YARN-4924. NM recovery race can lead to container not cleaned up. Contributed by sandflee\n",
      "commitDate": "14/04/16 12:17 PM",
      "commitName": "3150ae8108a1fc40a67926be6254824c1e37cb38",
      "commitAuthor": "Jason Lowe",
      "diff": "@@ -0,0 +1,35 @@\n+  private void cleanupKeysWithPrefix(String prefix) throws IOException {\n+    WriteBatch batch \u003d null;\n+    LeveldbIterator iter \u003d null;\n+    try {\n+      iter \u003d new LeveldbIterator(db);\n+      try {\n+        batch \u003d db.createWriteBatch();\n+        iter.seek(bytes(prefix));\n+        while (iter.hasNext()) {\n+          byte[] key \u003d iter.next().getKey();\n+          String keyStr \u003d asString(key);\n+          if (!keyStr.startsWith(prefix)) {\n+            break;\n+          }\n+          batch.delete(key);\n+          if (LOG.isDebugEnabled()) {\n+            LOG.debug(\"cleanup \" + keyStr + \" from leveldb\");\n+          }\n+        }\n+        db.write(batch);\n+      } catch (DBException e) {\n+        throw new IOException(e);\n+      } finally {\n+        if (batch !\u003d null) {\n+          batch.close();\n+        }\n+      }\n+    } catch (DBException e) {\n+      throw new IOException(e);\n+    } finally {\n+      if (iter !\u003d null) {\n+        iter.close();\n+      }\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  private void cleanupKeysWithPrefix(String prefix) throws IOException {\n    WriteBatch batch \u003d null;\n    LeveldbIterator iter \u003d null;\n    try {\n      iter \u003d new LeveldbIterator(db);\n      try {\n        batch \u003d db.createWriteBatch();\n        iter.seek(bytes(prefix));\n        while (iter.hasNext()) {\n          byte[] key \u003d iter.next().getKey();\n          String keyStr \u003d asString(key);\n          if (!keyStr.startsWith(prefix)) {\n            break;\n          }\n          batch.delete(key);\n          if (LOG.isDebugEnabled()) {\n            LOG.debug(\"cleanup \" + keyStr + \" from leveldb\");\n          }\n        }\n        db.write(batch);\n      } catch (DBException e) {\n        throw new IOException(e);\n      } finally {\n        if (batch !\u003d null) {\n          batch.close();\n        }\n      }\n    } catch (DBException e) {\n      throw new IOException(e);\n    } finally {\n      if (iter !\u003d null) {\n        iter.close();\n      }\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/recovery/NMLeveldbStateStoreService.java"
    }
  }
}