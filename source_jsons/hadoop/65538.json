{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "S3GuardFsck.java",
  "functionName": "compareAuthoritativeDirectoryFlag",
  "functionId": "compareAuthoritativeDirectoryFlag___comparePairs-List__ComparePair____currentDirPath-Path__s3DirListing-List__FileStatus__",
  "sourceFilePath": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3GuardFsck.java",
  "functionStartLine": 181,
  "functionEndLine": 204,
  "numCommitsSeen": 4,
  "timeTaken": 854,
  "changeHistory": [
    "4e273a31f66013b7c20e8114451f5bc6c741f2cc"
  ],
  "changeHistoryShort": {
    "4e273a31f66013b7c20e8114451f5bc6c741f2cc": "Yintroduced"
  },
  "changeHistoryDetails": {
    "4e273a31f66013b7c20e8114451f5bc6c741f2cc": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-16423. S3Guard fsck: Check metadata consistency between S3 and metadatastore (log) (#1208). Contributed by Gabor Bota.\n\nChange-Id: I6bbb331b6c0a41c61043e482b95504fda8a50596",
      "commitDate": "12/09/19 4:12 AM",
      "commitName": "4e273a31f66013b7c20e8114451f5bc6c741f2cc",
      "commitAuthor": "Gabor Bota",
      "diff": "@@ -0,0 +1,24 @@\n+  private void compareAuthoritativeDirectoryFlag(List\u003cComparePair\u003e comparePairs,\n+      Path currentDirPath, List\u003cFileStatus\u003e s3DirListing) throws IOException {\n+    final DirListingMetadata msDirListing \u003d\n+        metadataStore.listChildren(currentDirPath);\n+    if (msDirListing !\u003d null \u0026\u0026 msDirListing.isAuthoritative()) {\n+      ComparePair cP \u003d new ComparePair(s3DirListing, msDirListing);\n+\n+      if (s3DirListing.size() !\u003d msDirListing.numEntries()) {\n+        cP.violations.add(Violation.AUTHORITATIVE_DIRECTORY_CONTENT_MISMATCH);\n+      } else {\n+        final Set\u003cPath\u003e msPaths \u003d msDirListing.getListing().stream()\n+                .map(pm -\u003e pm.getFileStatus().getPath()).collect(toSet());\n+        final Set\u003cPath\u003e s3Paths \u003d s3DirListing.stream()\n+                .map(pm -\u003e pm.getPath()).collect(toSet());\n+        if (!s3Paths.equals(msPaths)) {\n+          cP.violations.add(Violation.AUTHORITATIVE_DIRECTORY_CONTENT_MISMATCH);\n+        }\n+      }\n+\n+      if (cP.containsViolation()) {\n+        comparePairs.add(cP);\n+      }\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  private void compareAuthoritativeDirectoryFlag(List\u003cComparePair\u003e comparePairs,\n      Path currentDirPath, List\u003cFileStatus\u003e s3DirListing) throws IOException {\n    final DirListingMetadata msDirListing \u003d\n        metadataStore.listChildren(currentDirPath);\n    if (msDirListing !\u003d null \u0026\u0026 msDirListing.isAuthoritative()) {\n      ComparePair cP \u003d new ComparePair(s3DirListing, msDirListing);\n\n      if (s3DirListing.size() !\u003d msDirListing.numEntries()) {\n        cP.violations.add(Violation.AUTHORITATIVE_DIRECTORY_CONTENT_MISMATCH);\n      } else {\n        final Set\u003cPath\u003e msPaths \u003d msDirListing.getListing().stream()\n                .map(pm -\u003e pm.getFileStatus().getPath()).collect(toSet());\n        final Set\u003cPath\u003e s3Paths \u003d s3DirListing.stream()\n                .map(pm -\u003e pm.getPath()).collect(toSet());\n        if (!s3Paths.equals(msPaths)) {\n          cP.violations.add(Violation.AUTHORITATIVE_DIRECTORY_CONTENT_MISMATCH);\n        }\n      }\n\n      if (cP.containsViolation()) {\n        comparePairs.add(cP);\n      }\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/S3GuardFsck.java"
    }
  }
}