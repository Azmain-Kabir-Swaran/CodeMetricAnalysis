{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "DFSClient.java",
  "functionName": "initThreadsNumForStripedReads",
  "functionId": "initThreadsNumForStripedReads___numThreads-int",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DFSClient.java",
  "functionStartLine": 3081,
  "functionEndLine": 3096,
  "numCommitsSeen": 125,
  "timeTaken": 4886,
  "changeHistory": [
    "2e43c28e01fe006210e71aab179527669f6412ed",
    "441378e7e4609d89b7181dacc8ba92b253a962df",
    "89a8edc0149e3f31a5ade9a0927c4b6332cf6b1a",
    "b59206190e6f773fc223bcb81774a09715551367"
  ],
  "changeHistoryShort": {
    "2e43c28e01fe006210e71aab179527669f6412ed": "Ybodychange",
    "441378e7e4609d89b7181dacc8ba92b253a962df": "Ybodychange",
    "89a8edc0149e3f31a5ade9a0927c4b6332cf6b1a": "Ybodychange",
    "b59206190e6f773fc223bcb81774a09715551367": "Ymultichange(Yparameterchange,Ybodychange)"
  },
  "changeHistoryDetails": {
    "2e43c28e01fe006210e71aab179527669f6412ed": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-11696. Fix warnings from Spotbugs in hadoop-hdfs. Contributed by Yiqun Lin.\n",
      "commitDate": "15/08/17 1:48 AM",
      "commitName": "2e43c28e01fe006210e71aab179527669f6412ed",
      "commitAuthor": "Yiqun Lin",
      "commitDateOld": "28/07/17 12:51 AM",
      "commitNameOld": "369f731264d77617452e4074d15404bd62ec6093",
      "commitAuthorOld": "Wei-Chiu Chuang",
      "daysBetweenCommits": 18.04,
      "commitsBetweenForRepo": 176,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,13 +1,16 @@\n   private void initThreadsNumForStripedReads(int numThreads) {\n     assert numThreads \u003e 0;\n     if (STRIPED_READ_THREAD_POOL !\u003d null) {\n       return;\n     }\n     synchronized (DFSClient.class) {\n       if (STRIPED_READ_THREAD_POOL \u003d\u003d null) {\n-        STRIPED_READ_THREAD_POOL \u003d DFSUtilClient.getThreadPoolExecutor(1,\n+        // Only after thread pool is fully constructed then save it to\n+        // volatile field.\n+        ThreadPoolExecutor threadPool \u003d DFSUtilClient.getThreadPoolExecutor(1,\n             numThreads, 60, \"StripedRead-\", true);\n-        STRIPED_READ_THREAD_POOL.allowCoreThreadTimeOut(true);\n+        threadPool.allowCoreThreadTimeOut(true);\n+        STRIPED_READ_THREAD_POOL \u003d threadPool;\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void initThreadsNumForStripedReads(int numThreads) {\n    assert numThreads \u003e 0;\n    if (STRIPED_READ_THREAD_POOL !\u003d null) {\n      return;\n    }\n    synchronized (DFSClient.class) {\n      if (STRIPED_READ_THREAD_POOL \u003d\u003d null) {\n        // Only after thread pool is fully constructed then save it to\n        // volatile field.\n        ThreadPoolExecutor threadPool \u003d DFSUtilClient.getThreadPoolExecutor(1,\n            numThreads, 60, \"StripedRead-\", true);\n        threadPool.allowCoreThreadTimeOut(true);\n        STRIPED_READ_THREAD_POOL \u003d threadPool;\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DFSClient.java",
      "extendedDetails": {}
    },
    "441378e7e4609d89b7181dacc8ba92b253a962df": {
      "type": "Ybodychange",
      "commitMessage": "Revert \"HDFS-11696. Fix warnings from Spotbugs in hadoop-hdfs. Contributed by Yiqun Lin.\"\n\nThis reverts commit 89a8edc0149e3f31a5ade9a0927c4b6332cf6b1a.\n\n Conflicts:\n\thadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/DFSAdmin.java\n",
      "commitDate": "29/06/17 1:54 PM",
      "commitName": "441378e7e4609d89b7181dacc8ba92b253a962df",
      "commitAuthor": "Andrew Wang",
      "commitDateOld": "28/06/17 10:54 AM",
      "commitNameOld": "f99b6d19de77c6e730fed8444f8848a7e63d6130",
      "commitAuthorOld": "Wei-Chiu Chuang",
      "daysBetweenCommits": 1.12,
      "commitsBetweenForRepo": 13,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,16 +1,13 @@\n   private void initThreadsNumForStripedReads(int numThreads) {\n     assert numThreads \u003e 0;\n     if (STRIPED_READ_THREAD_POOL !\u003d null) {\n       return;\n     }\n     synchronized (DFSClient.class) {\n       if (STRIPED_READ_THREAD_POOL \u003d\u003d null) {\n-        // Only after thread pool is fully constructed then save it to\n-        // volatile field.\n-        ThreadPoolExecutor threadPool \u003d DFSUtilClient.getThreadPoolExecutor(1,\n+        STRIPED_READ_THREAD_POOL \u003d DFSUtilClient.getThreadPoolExecutor(1,\n             numThreads, 60, \"StripedRead-\", true);\n-        threadPool.allowCoreThreadTimeOut(true);\n-        STRIPED_READ_THREAD_POOL \u003d threadPool;\n+        STRIPED_READ_THREAD_POOL.allowCoreThreadTimeOut(true);\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void initThreadsNumForStripedReads(int numThreads) {\n    assert numThreads \u003e 0;\n    if (STRIPED_READ_THREAD_POOL !\u003d null) {\n      return;\n    }\n    synchronized (DFSClient.class) {\n      if (STRIPED_READ_THREAD_POOL \u003d\u003d null) {\n        STRIPED_READ_THREAD_POOL \u003d DFSUtilClient.getThreadPoolExecutor(1,\n            numThreads, 60, \"StripedRead-\", true);\n        STRIPED_READ_THREAD_POOL.allowCoreThreadTimeOut(true);\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DFSClient.java",
      "extendedDetails": {}
    },
    "89a8edc0149e3f31a5ade9a0927c4b6332cf6b1a": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-11696. Fix warnings from Spotbugs in hadoop-hdfs. Contributed by Yiqun Lin.\n",
      "commitDate": "16/05/17 9:41 AM",
      "commitName": "89a8edc0149e3f31a5ade9a0927c4b6332cf6b1a",
      "commitAuthor": "Akira Ajisaka",
      "commitDateOld": "08/05/17 6:27 AM",
      "commitNameOld": "cef2815cf48154fe82f44082dcbdce6373c81284",
      "commitAuthorOld": "Kihwal Lee",
      "daysBetweenCommits": 8.13,
      "commitsBetweenForRepo": 46,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,13 +1,16 @@\n   private void initThreadsNumForStripedReads(int numThreads) {\n     assert numThreads \u003e 0;\n     if (STRIPED_READ_THREAD_POOL !\u003d null) {\n       return;\n     }\n     synchronized (DFSClient.class) {\n       if (STRIPED_READ_THREAD_POOL \u003d\u003d null) {\n-        STRIPED_READ_THREAD_POOL \u003d DFSUtilClient.getThreadPoolExecutor(1,\n+        // Only after thread pool is fully constructed then save it to\n+        // volatile field.\n+        ThreadPoolExecutor threadPool \u003d DFSUtilClient.getThreadPoolExecutor(1,\n             numThreads, 60, \"StripedRead-\", true);\n-        STRIPED_READ_THREAD_POOL.allowCoreThreadTimeOut(true);\n+        threadPool.allowCoreThreadTimeOut(true);\n+        STRIPED_READ_THREAD_POOL \u003d threadPool;\n       }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void initThreadsNumForStripedReads(int numThreads) {\n    assert numThreads \u003e 0;\n    if (STRIPED_READ_THREAD_POOL !\u003d null) {\n      return;\n    }\n    synchronized (DFSClient.class) {\n      if (STRIPED_READ_THREAD_POOL \u003d\u003d null) {\n        // Only after thread pool is fully constructed then save it to\n        // volatile field.\n        ThreadPoolExecutor threadPool \u003d DFSUtilClient.getThreadPoolExecutor(1,\n            numThreads, 60, \"StripedRead-\", true);\n        threadPool.allowCoreThreadTimeOut(true);\n        STRIPED_READ_THREAD_POOL \u003d threadPool;\n      }\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DFSClient.java",
      "extendedDetails": {}
    },
    "b59206190e6f773fc223bcb81774a09715551367": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HDFS-10909. De-duplicate code in ErasureCodingWorker#initializeStripedReadThreadPool and DFSClient#initThreadsNumForStripedReads. (Manoj Govindassamy via lei)\n",
      "commitDate": "02/11/16 4:45 PM",
      "commitName": "b59206190e6f773fc223bcb81774a09715551367",
      "commitAuthor": "Lei Xu",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HDFS-10909. De-duplicate code in ErasureCodingWorker#initializeStripedReadThreadPool and DFSClient#initThreadsNumForStripedReads. (Manoj Govindassamy via lei)\n",
          "commitDate": "02/11/16 4:45 PM",
          "commitName": "b59206190e6f773fc223bcb81774a09715551367",
          "commitAuthor": "Lei Xu",
          "commitDateOld": "30/09/16 6:44 AM",
          "commitNameOld": "0670149c88852cd7c4d6774bff06c7c588558739",
          "commitAuthorOld": "Kihwal Lee",
          "daysBetweenCommits": 33.42,
          "commitsBetweenForRepo": 290,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,33 +1,13 @@\n-  private void initThreadsNumForStripedReads(int num) {\n-    assert num \u003e 0;\n+  private void initThreadsNumForStripedReads(int numThreads) {\n+    assert numThreads \u003e 0;\n     if (STRIPED_READ_THREAD_POOL !\u003d null) {\n       return;\n     }\n     synchronized (DFSClient.class) {\n       if (STRIPED_READ_THREAD_POOL \u003d\u003d null) {\n-        STRIPED_READ_THREAD_POOL \u003d new ThreadPoolExecutor(1, num, 60,\n-            TimeUnit.SECONDS, new SynchronousQueue\u003cRunnable\u003e(),\n-            new Daemon.DaemonFactory() {\n-              private final AtomicInteger threadIndex \u003d new AtomicInteger(0);\n-\n-              @Override\n-              public Thread newThread(Runnable r) {\n-                Thread t \u003d super.newThread(r);\n-                t.setName(\"stripedRead-\" + threadIndex.getAndIncrement());\n-                return t;\n-              }\n-            },\n-            new ThreadPoolExecutor.CallerRunsPolicy() {\n-              @Override\n-              public void rejectedExecution(Runnable runnable,\n-                  ThreadPoolExecutor e) {\n-                LOG.info(\"Execution for striped reading rejected, \"\n-                    + \"Executing in current thread\");\n-                // will run in the current thread\n-                super.rejectedExecution(runnable, e);\n-              }\n-            });\n+        STRIPED_READ_THREAD_POOL \u003d DFSUtilClient.getThreadPoolExecutor(1,\n+            numThreads, 60, \"StripedRead-\", true);\n         STRIPED_READ_THREAD_POOL.allowCoreThreadTimeOut(true);\n       }\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void initThreadsNumForStripedReads(int numThreads) {\n    assert numThreads \u003e 0;\n    if (STRIPED_READ_THREAD_POOL !\u003d null) {\n      return;\n    }\n    synchronized (DFSClient.class) {\n      if (STRIPED_READ_THREAD_POOL \u003d\u003d null) {\n        STRIPED_READ_THREAD_POOL \u003d DFSUtilClient.getThreadPoolExecutor(1,\n            numThreads, 60, \"StripedRead-\", true);\n        STRIPED_READ_THREAD_POOL.allowCoreThreadTimeOut(true);\n      }\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DFSClient.java",
          "extendedDetails": {
            "oldValue": "[num-int]",
            "newValue": "[numThreads-int]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-10909. De-duplicate code in ErasureCodingWorker#initializeStripedReadThreadPool and DFSClient#initThreadsNumForStripedReads. (Manoj Govindassamy via lei)\n",
          "commitDate": "02/11/16 4:45 PM",
          "commitName": "b59206190e6f773fc223bcb81774a09715551367",
          "commitAuthor": "Lei Xu",
          "commitDateOld": "30/09/16 6:44 AM",
          "commitNameOld": "0670149c88852cd7c4d6774bff06c7c588558739",
          "commitAuthorOld": "Kihwal Lee",
          "daysBetweenCommits": 33.42,
          "commitsBetweenForRepo": 290,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,33 +1,13 @@\n-  private void initThreadsNumForStripedReads(int num) {\n-    assert num \u003e 0;\n+  private void initThreadsNumForStripedReads(int numThreads) {\n+    assert numThreads \u003e 0;\n     if (STRIPED_READ_THREAD_POOL !\u003d null) {\n       return;\n     }\n     synchronized (DFSClient.class) {\n       if (STRIPED_READ_THREAD_POOL \u003d\u003d null) {\n-        STRIPED_READ_THREAD_POOL \u003d new ThreadPoolExecutor(1, num, 60,\n-            TimeUnit.SECONDS, new SynchronousQueue\u003cRunnable\u003e(),\n-            new Daemon.DaemonFactory() {\n-              private final AtomicInteger threadIndex \u003d new AtomicInteger(0);\n-\n-              @Override\n-              public Thread newThread(Runnable r) {\n-                Thread t \u003d super.newThread(r);\n-                t.setName(\"stripedRead-\" + threadIndex.getAndIncrement());\n-                return t;\n-              }\n-            },\n-            new ThreadPoolExecutor.CallerRunsPolicy() {\n-              @Override\n-              public void rejectedExecution(Runnable runnable,\n-                  ThreadPoolExecutor e) {\n-                LOG.info(\"Execution for striped reading rejected, \"\n-                    + \"Executing in current thread\");\n-                // will run in the current thread\n-                super.rejectedExecution(runnable, e);\n-              }\n-            });\n+        STRIPED_READ_THREAD_POOL \u003d DFSUtilClient.getThreadPoolExecutor(1,\n+            numThreads, 60, \"StripedRead-\", true);\n         STRIPED_READ_THREAD_POOL.allowCoreThreadTimeOut(true);\n       }\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void initThreadsNumForStripedReads(int numThreads) {\n    assert numThreads \u003e 0;\n    if (STRIPED_READ_THREAD_POOL !\u003d null) {\n      return;\n    }\n    synchronized (DFSClient.class) {\n      if (STRIPED_READ_THREAD_POOL \u003d\u003d null) {\n        STRIPED_READ_THREAD_POOL \u003d DFSUtilClient.getThreadPoolExecutor(1,\n            numThreads, 60, \"StripedRead-\", true);\n        STRIPED_READ_THREAD_POOL.allowCoreThreadTimeOut(true);\n      }\n    }\n  }",
          "path": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DFSClient.java",
          "extendedDetails": {}
        }
      ]
    }
  }
}