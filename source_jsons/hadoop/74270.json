{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "RestCsrfPreventionFilter.java",
  "functionName": "doFilter",
  "functionId": "doFilter___request-ServletRequest__response-ServletResponse__chain-FilterChain(modifiers-final)",
  "sourceFilePath": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/http/RestCsrfPreventionFilter.java",
  "functionStartLine": 205,
  "functionEndLine": 211,
  "numCommitsSeen": 6,
  "timeTaken": 1812,
  "changeHistory": [
    "5d1889a66d91608d34ca9411fb6e9161e637e9d3",
    "a37e423e8407c42988577d87907d13ce0432dda1",
    "da77f423d142c4dda8810d4668edde3c7d2999e8",
    "06f4ac0ccdc623283106f258644148d5e003f75c"
  ],
  "changeHistoryShort": {
    "5d1889a66d91608d34ca9411fb6e9161e637e9d3": "Ymultichange(Ybodychange,Yparametermetachange)",
    "a37e423e8407c42988577d87907d13ce0432dda1": "Ybodychange",
    "da77f423d142c4dda8810d4668edde3c7d2999e8": "Yfilerename",
    "06f4ac0ccdc623283106f258644148d5e003f75c": "Yintroduced"
  },
  "changeHistoryDetails": {
    "5d1889a66d91608d34ca9411fb6e9161e637e9d3": {
      "type": "Ymultichange(Ybodychange,Yparametermetachange)",
      "commitMessage": "HDFS-9711. Integrate CSRF prevention filter in WebHDFS. Contributed by Chris Nauroth.\n",
      "commitDate": "18/02/16 10:07 AM",
      "commitName": "5d1889a66d91608d34ca9411fb6e9161e637e9d3",
      "commitAuthor": "cnauroth",
      "subchanges": [
        {
          "type": "Ybodychange",
          "commitMessage": "HDFS-9711. Integrate CSRF prevention filter in WebHDFS. Contributed by Chris Nauroth.\n",
          "commitDate": "18/02/16 10:07 AM",
          "commitName": "5d1889a66d91608d34ca9411fb6e9161e637e9d3",
          "commitAuthor": "cnauroth",
          "commitDateOld": "05/02/16 2:38 PM",
          "commitNameOld": "a37e423e8407c42988577d87907d13ce0432dda1",
          "commitAuthorOld": "cnauroth",
          "daysBetweenCommits": 12.81,
          "commitsBetweenForRepo": 84,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,13 +1,7 @@\n   public void doFilter(ServletRequest request, ServletResponse response,\n-      FilterChain chain) throws IOException, ServletException {\n-    HttpServletRequest httpRequest \u003d (HttpServletRequest)request;\n-    if (!isBrowser(httpRequest.getHeader(HEADER_USER_AGENT)) ||\n-        methodsToIgnore.contains(httpRequest.getMethod()) ||\n-        httpRequest.getHeader(headerName) !\u003d null) {\n-      chain.doFilter(request, response);\n-    } else {\n-      ((HttpServletResponse)response).sendError(\n-          HttpServletResponse.SC_BAD_REQUEST,\n-          \"Missing Required Header for CSRF Vulnerability Protection\");\n-    }\n+      final FilterChain chain) throws IOException, ServletException {\n+    final HttpServletRequest httpRequest \u003d (HttpServletRequest)request;\n+    final HttpServletResponse httpResponse \u003d (HttpServletResponse)response;\n+    handleHttpInteraction(new ServletFilterHttpInteraction(httpRequest,\n+        httpResponse, chain));\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public void doFilter(ServletRequest request, ServletResponse response,\n      final FilterChain chain) throws IOException, ServletException {\n    final HttpServletRequest httpRequest \u003d (HttpServletRequest)request;\n    final HttpServletResponse httpResponse \u003d (HttpServletResponse)response;\n    handleHttpInteraction(new ServletFilterHttpInteraction(httpRequest,\n        httpResponse, chain));\n  }",
          "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/http/RestCsrfPreventionFilter.java",
          "extendedDetails": {}
        },
        {
          "type": "Yparametermetachange",
          "commitMessage": "HDFS-9711. Integrate CSRF prevention filter in WebHDFS. Contributed by Chris Nauroth.\n",
          "commitDate": "18/02/16 10:07 AM",
          "commitName": "5d1889a66d91608d34ca9411fb6e9161e637e9d3",
          "commitAuthor": "cnauroth",
          "commitDateOld": "05/02/16 2:38 PM",
          "commitNameOld": "a37e423e8407c42988577d87907d13ce0432dda1",
          "commitAuthorOld": "cnauroth",
          "daysBetweenCommits": 12.81,
          "commitsBetweenForRepo": 84,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,13 +1,7 @@\n   public void doFilter(ServletRequest request, ServletResponse response,\n-      FilterChain chain) throws IOException, ServletException {\n-    HttpServletRequest httpRequest \u003d (HttpServletRequest)request;\n-    if (!isBrowser(httpRequest.getHeader(HEADER_USER_AGENT)) ||\n-        methodsToIgnore.contains(httpRequest.getMethod()) ||\n-        httpRequest.getHeader(headerName) !\u003d null) {\n-      chain.doFilter(request, response);\n-    } else {\n-      ((HttpServletResponse)response).sendError(\n-          HttpServletResponse.SC_BAD_REQUEST,\n-          \"Missing Required Header for CSRF Vulnerability Protection\");\n-    }\n+      final FilterChain chain) throws IOException, ServletException {\n+    final HttpServletRequest httpRequest \u003d (HttpServletRequest)request;\n+    final HttpServletResponse httpResponse \u003d (HttpServletResponse)response;\n+    handleHttpInteraction(new ServletFilterHttpInteraction(httpRequest,\n+        httpResponse, chain));\n   }\n\\ No newline at end of file\n",
          "actualSource": "  public void doFilter(ServletRequest request, ServletResponse response,\n      final FilterChain chain) throws IOException, ServletException {\n    final HttpServletRequest httpRequest \u003d (HttpServletRequest)request;\n    final HttpServletResponse httpResponse \u003d (HttpServletResponse)response;\n    handleHttpInteraction(new ServletFilterHttpInteraction(httpRequest,\n        httpResponse, chain));\n  }",
          "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/http/RestCsrfPreventionFilter.java",
          "extendedDetails": {
            "oldValue": "[request-ServletRequest, response-ServletResponse, chain-FilterChain]",
            "newValue": "[request-ServletRequest, response-ServletResponse, chain-FilterChain(modifiers-final)]"
          }
        }
      ]
    },
    "a37e423e8407c42988577d87907d13ce0432dda1": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-12758. Extend CSRF Filter with UserAgent Checks. Contributed by Larry McCay.\n",
      "commitDate": "05/02/16 2:38 PM",
      "commitName": "a37e423e8407c42988577d87907d13ce0432dda1",
      "commitAuthor": "cnauroth",
      "commitDateOld": "16/01/16 7:47 AM",
      "commitNameOld": "da77f423d142c4dda8810d4668edde3c7d2999e8",
      "commitAuthorOld": "cnauroth",
      "daysBetweenCommits": 20.29,
      "commitsBetweenForRepo": 147,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,12 +1,13 @@\n   public void doFilter(ServletRequest request, ServletResponse response,\n       FilterChain chain) throws IOException, ServletException {\n     HttpServletRequest httpRequest \u003d (HttpServletRequest)request;\n-    if (methodsToIgnore.contains(httpRequest.getMethod()) ||\n+    if (!isBrowser(httpRequest.getHeader(HEADER_USER_AGENT)) ||\n+        methodsToIgnore.contains(httpRequest.getMethod()) ||\n         httpRequest.getHeader(headerName) !\u003d null) {\n       chain.doFilter(request, response);\n     } else {\n       ((HttpServletResponse)response).sendError(\n           HttpServletResponse.SC_BAD_REQUEST,\n-          \"Missing Required Header for Vulnerability Protection\");\n+          \"Missing Required Header for CSRF Vulnerability Protection\");\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void doFilter(ServletRequest request, ServletResponse response,\n      FilterChain chain) throws IOException, ServletException {\n    HttpServletRequest httpRequest \u003d (HttpServletRequest)request;\n    if (!isBrowser(httpRequest.getHeader(HEADER_USER_AGENT)) ||\n        methodsToIgnore.contains(httpRequest.getMethod()) ||\n        httpRequest.getHeader(headerName) !\u003d null) {\n      chain.doFilter(request, response);\n    } else {\n      ((HttpServletResponse)response).sendError(\n          HttpServletResponse.SC_BAD_REQUEST,\n          \"Missing Required Header for CSRF Vulnerability Protection\");\n    }\n  }",
      "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/http/RestCsrfPreventionFilter.java",
      "extendedDetails": {}
    },
    "da77f423d142c4dda8810d4668edde3c7d2999e8": {
      "type": "Yfilerename",
      "commitMessage": "HADOOP-12691. Move files to correct location.\n",
      "commitDate": "16/01/16 7:47 AM",
      "commitName": "da77f423d142c4dda8810d4668edde3c7d2999e8",
      "commitAuthor": "cnauroth",
      "commitDateOld": "16/01/16 7:44 AM",
      "commitNameOld": "995f06f2684cd30efc5d12d924dda42879232099",
      "commitAuthorOld": "Tsz-Wo Nicholas Sze",
      "daysBetweenCommits": 0.0,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "",
      "actualSource": "  public void doFilter(ServletRequest request, ServletResponse response,\n      FilterChain chain) throws IOException, ServletException {\n    HttpServletRequest httpRequest \u003d (HttpServletRequest)request;\n    if (methodsToIgnore.contains(httpRequest.getMethod()) ||\n        httpRequest.getHeader(headerName) !\u003d null) {\n      chain.doFilter(request, response);\n    } else {\n      ((HttpServletResponse)response).sendError(\n          HttpServletResponse.SC_BAD_REQUEST,\n          \"Missing Required Header for Vulnerability Protection\");\n    }\n  }",
      "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/http/RestCsrfPreventionFilter.java",
      "extendedDetails": {
        "oldPath": "hadoop-common/src/main/java/org/apache/hadoop/security/http/RestCsrfPreventionFilter.java",
        "newPath": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/http/RestCsrfPreventionFilter.java"
      }
    },
    "06f4ac0ccdc623283106f258644148d5e003f75c": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-12691. Add CSRF Filter for REST APIs to Hadoop Common. Contributed by Larry McCay.\n",
      "commitDate": "14/01/16 11:56 AM",
      "commitName": "06f4ac0ccdc623283106f258644148d5e003f75c",
      "commitAuthor": "cnauroth",
      "diff": "@@ -0,0 +1,12 @@\n+  public void doFilter(ServletRequest request, ServletResponse response,\n+      FilterChain chain) throws IOException, ServletException {\n+    HttpServletRequest httpRequest \u003d (HttpServletRequest)request;\n+    if (methodsToIgnore.contains(httpRequest.getMethod()) ||\n+        httpRequest.getHeader(headerName) !\u003d null) {\n+      chain.doFilter(request, response);\n+    } else {\n+      ((HttpServletResponse)response).sendError(\n+          HttpServletResponse.SC_BAD_REQUEST,\n+          \"Missing Required Header for Vulnerability Protection\");\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public void doFilter(ServletRequest request, ServletResponse response,\n      FilterChain chain) throws IOException, ServletException {\n    HttpServletRequest httpRequest \u003d (HttpServletRequest)request;\n    if (methodsToIgnore.contains(httpRequest.getMethod()) ||\n        httpRequest.getHeader(headerName) !\u003d null) {\n      chain.doFilter(request, response);\n    } else {\n      ((HttpServletResponse)response).sendError(\n          HttpServletResponse.SC_BAD_REQUEST,\n          \"Missing Required Header for Vulnerability Protection\");\n    }\n  }",
      "path": "hadoop-common/src/main/java/org/apache/hadoop/security/http/RestCsrfPreventionFilter.java"
    }
  }
}