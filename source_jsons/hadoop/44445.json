{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "ApplicationMaster.java",
  "functionName": "parsePlacementSpecs",
  "functionId": "parsePlacementSpecs___decodedSpec-String__globalNumOfContainers-int",
  "sourceFilePath": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/main/java/org/apache/hadoop/yarn/applications/distributedshell/ApplicationMaster.java",
  "functionStartLine": 748,
  "functionEndLine": 764,
  "numCommitsSeen": 322,
  "timeTaken": 3992,
  "changeHistory": [
    "33d8327cffdc483b538aec3022fd8730b85babdb",
    "67ae81f0e0ac7f107261ee15f2eb4d189e3b1983",
    "a08c048832d68c203fbdfce8d9f0e7dcccb02a55",
    "e60f51299dba360d13aa39f9ab714fdfc666b532"
  ],
  "changeHistoryShort": {
    "33d8327cffdc483b538aec3022fd8730b85babdb": "Ymultichange(Yparameterchange,Ybodychange)",
    "67ae81f0e0ac7f107261ee15f2eb4d189e3b1983": "Ymultichange(Yparameterchange,Ybodychange)",
    "a08c048832d68c203fbdfce8d9f0e7dcccb02a55": "Ybodychange",
    "e60f51299dba360d13aa39f9ab714fdfc666b532": "Yintroduced"
  },
  "changeHistoryDetails": {
    "33d8327cffdc483b538aec3022fd8730b85babdb": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "YARN-8715. Make allocation tags in the placement spec optional for node-attributes. Contributed by Weiwei Yang.\n",
      "commitDate": "16/09/18 9:37 PM",
      "commitName": "33d8327cffdc483b538aec3022fd8730b85babdb",
      "commitAuthor": "Sunil G",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "YARN-8715. Make allocation tags in the placement spec optional for node-attributes. Contributed by Weiwei Yang.\n",
          "commitDate": "16/09/18 9:37 PM",
          "commitName": "33d8327cffdc483b538aec3022fd8730b85babdb",
          "commitAuthor": "Sunil G",
          "commitDateOld": "12/09/18 3:31 AM",
          "commitNameOld": "67ae81f0e0ac7f107261ee15f2eb4d189e3b1983",
          "commitAuthorOld": "Naganarasimha",
          "daysBetweenCommits": 4.75,
          "commitsBetweenForRepo": 51,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,9 +1,17 @@\n-  private void parsePlacementSpecs(String decodedSpec) {\n+  private void parsePlacementSpecs(String decodedSpec,\n+      int globalNumOfContainers) {\n     Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n         PlacementSpec.parse(decodedSpec);\n     this.placementSpecs \u003d new HashMap\u003c\u003e();\n     for (PlacementSpec pSpec : pSpecs.values()) {\n+      // Use global num of containers when the spec doesn\u0027t specify\n+      // source tags. This is allowed when using node-attribute constraints.\n+      if (Strings.isNullOrEmpty(pSpec.sourceTag)\n+          \u0026\u0026 pSpec.getNumContainers() \u003d\u003d 0\n+          \u0026\u0026 globalNumOfContainers \u003e 0) {\n+        pSpec.setNumContainers(globalNumOfContainers);\n+      }\n       this.numTotalContainers +\u003d pSpec.getNumContainers();\n       this.placementSpecs.put(pSpec.sourceTag, pSpec);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void parsePlacementSpecs(String decodedSpec,\n      int globalNumOfContainers) {\n    Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n        PlacementSpec.parse(decodedSpec);\n    this.placementSpecs \u003d new HashMap\u003c\u003e();\n    for (PlacementSpec pSpec : pSpecs.values()) {\n      // Use global num of containers when the spec doesn\u0027t specify\n      // source tags. This is allowed when using node-attribute constraints.\n      if (Strings.isNullOrEmpty(pSpec.sourceTag)\n          \u0026\u0026 pSpec.getNumContainers() \u003d\u003d 0\n          \u0026\u0026 globalNumOfContainers \u003e 0) {\n        pSpec.setNumContainers(globalNumOfContainers);\n      }\n      this.numTotalContainers +\u003d pSpec.getNumContainers();\n      this.placementSpecs.put(pSpec.sourceTag, pSpec);\n    }\n  }",
          "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/main/java/org/apache/hadoop/yarn/applications/distributedshell/ApplicationMaster.java",
          "extendedDetails": {
            "oldValue": "[decodedSpec-String]",
            "newValue": "[decodedSpec-String, globalNumOfContainers-int]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "YARN-8715. Make allocation tags in the placement spec optional for node-attributes. Contributed by Weiwei Yang.\n",
          "commitDate": "16/09/18 9:37 PM",
          "commitName": "33d8327cffdc483b538aec3022fd8730b85babdb",
          "commitAuthor": "Sunil G",
          "commitDateOld": "12/09/18 3:31 AM",
          "commitNameOld": "67ae81f0e0ac7f107261ee15f2eb4d189e3b1983",
          "commitAuthorOld": "Naganarasimha",
          "daysBetweenCommits": 4.75,
          "commitsBetweenForRepo": 51,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,9 +1,17 @@\n-  private void parsePlacementSpecs(String decodedSpec) {\n+  private void parsePlacementSpecs(String decodedSpec,\n+      int globalNumOfContainers) {\n     Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n         PlacementSpec.parse(decodedSpec);\n     this.placementSpecs \u003d new HashMap\u003c\u003e();\n     for (PlacementSpec pSpec : pSpecs.values()) {\n+      // Use global num of containers when the spec doesn\u0027t specify\n+      // source tags. This is allowed when using node-attribute constraints.\n+      if (Strings.isNullOrEmpty(pSpec.sourceTag)\n+          \u0026\u0026 pSpec.getNumContainers() \u003d\u003d 0\n+          \u0026\u0026 globalNumOfContainers \u003e 0) {\n+        pSpec.setNumContainers(globalNumOfContainers);\n+      }\n       this.numTotalContainers +\u003d pSpec.getNumContainers();\n       this.placementSpecs.put(pSpec.sourceTag, pSpec);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void parsePlacementSpecs(String decodedSpec,\n      int globalNumOfContainers) {\n    Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n        PlacementSpec.parse(decodedSpec);\n    this.placementSpecs \u003d new HashMap\u003c\u003e();\n    for (PlacementSpec pSpec : pSpecs.values()) {\n      // Use global num of containers when the spec doesn\u0027t specify\n      // source tags. This is allowed when using node-attribute constraints.\n      if (Strings.isNullOrEmpty(pSpec.sourceTag)\n          \u0026\u0026 pSpec.getNumContainers() \u003d\u003d 0\n          \u0026\u0026 globalNumOfContainers \u003e 0) {\n        pSpec.setNumContainers(globalNumOfContainers);\n      }\n      this.numTotalContainers +\u003d pSpec.getNumContainers();\n      this.placementSpecs.put(pSpec.sourceTag, pSpec);\n    }\n  }",
          "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/main/java/org/apache/hadoop/yarn/applications/distributedshell/ApplicationMaster.java",
          "extendedDetails": {}
        }
      ]
    },
    "67ae81f0e0ac7f107261ee15f2eb4d189e3b1983": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "YARN-7863. Modify placement constraints to support node attributes. Contributed by Sunil Govindan.\n",
      "commitDate": "12/09/18 3:31 AM",
      "commitName": "67ae81f0e0ac7f107261ee15f2eb4d189e3b1983",
      "commitAuthor": "Naganarasimha",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "YARN-7863. Modify placement constraints to support node attributes. Contributed by Sunil Govindan.\n",
          "commitDate": "12/09/18 3:31 AM",
          "commitName": "67ae81f0e0ac7f107261ee15f2eb4d189e3b1983",
          "commitAuthor": "Naganarasimha",
          "commitDateOld": "02/09/18 1:05 AM",
          "commitNameOld": "eed8415dc18fa7415ebd105350bd0532b3b1b6bb",
          "commitAuthorOld": "bibinchundatt",
          "daysBetweenCommits": 10.1,
          "commitsBetweenForRepo": 93,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,16 +1,9 @@\n-  private void parsePlacementSpecs(String placementSpecifications) {\n-    // Client sends placement spec in encoded format\n-    Base64.Decoder decoder \u003d Base64.getDecoder();\n-    byte[] decodedBytes \u003d decoder.decode(\n-        placementSpecifications.getBytes(StandardCharsets.UTF_8));\n-    String decodedSpec \u003d new String(decodedBytes, StandardCharsets.UTF_8);\n-    LOG.info(\"Decode placement spec: \" + decodedSpec);\n+  private void parsePlacementSpecs(String decodedSpec) {\n     Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n         PlacementSpec.parse(decodedSpec);\n     this.placementSpecs \u003d new HashMap\u003c\u003e();\n-    this.numTotalContainers \u003d 0;\n     for (PlacementSpec pSpec : pSpecs.values()) {\n-      this.numTotalContainers +\u003d pSpec.numContainers;\n+      this.numTotalContainers +\u003d pSpec.getNumContainers();\n       this.placementSpecs.put(pSpec.sourceTag, pSpec);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void parsePlacementSpecs(String decodedSpec) {\n    Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n        PlacementSpec.parse(decodedSpec);\n    this.placementSpecs \u003d new HashMap\u003c\u003e();\n    for (PlacementSpec pSpec : pSpecs.values()) {\n      this.numTotalContainers +\u003d pSpec.getNumContainers();\n      this.placementSpecs.put(pSpec.sourceTag, pSpec);\n    }\n  }",
          "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/main/java/org/apache/hadoop/yarn/applications/distributedshell/ApplicationMaster.java",
          "extendedDetails": {
            "oldValue": "[placementSpecifications-String]",
            "newValue": "[decodedSpec-String]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "YARN-7863. Modify placement constraints to support node attributes. Contributed by Sunil Govindan.\n",
          "commitDate": "12/09/18 3:31 AM",
          "commitName": "67ae81f0e0ac7f107261ee15f2eb4d189e3b1983",
          "commitAuthor": "Naganarasimha",
          "commitDateOld": "02/09/18 1:05 AM",
          "commitNameOld": "eed8415dc18fa7415ebd105350bd0532b3b1b6bb",
          "commitAuthorOld": "bibinchundatt",
          "daysBetweenCommits": 10.1,
          "commitsBetweenForRepo": 93,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,16 +1,9 @@\n-  private void parsePlacementSpecs(String placementSpecifications) {\n-    // Client sends placement spec in encoded format\n-    Base64.Decoder decoder \u003d Base64.getDecoder();\n-    byte[] decodedBytes \u003d decoder.decode(\n-        placementSpecifications.getBytes(StandardCharsets.UTF_8));\n-    String decodedSpec \u003d new String(decodedBytes, StandardCharsets.UTF_8);\n-    LOG.info(\"Decode placement spec: \" + decodedSpec);\n+  private void parsePlacementSpecs(String decodedSpec) {\n     Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n         PlacementSpec.parse(decodedSpec);\n     this.placementSpecs \u003d new HashMap\u003c\u003e();\n-    this.numTotalContainers \u003d 0;\n     for (PlacementSpec pSpec : pSpecs.values()) {\n-      this.numTotalContainers +\u003d pSpec.numContainers;\n+      this.numTotalContainers +\u003d pSpec.getNumContainers();\n       this.placementSpecs.put(pSpec.sourceTag, pSpec);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void parsePlacementSpecs(String decodedSpec) {\n    Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n        PlacementSpec.parse(decodedSpec);\n    this.placementSpecs \u003d new HashMap\u003c\u003e();\n    for (PlacementSpec pSpec : pSpecs.values()) {\n      this.numTotalContainers +\u003d pSpec.getNumContainers();\n      this.placementSpecs.put(pSpec.sourceTag, pSpec);\n    }\n  }",
          "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/main/java/org/apache/hadoop/yarn/applications/distributedshell/ApplicationMaster.java",
          "extendedDetails": {}
        }
      ]
    },
    "a08c048832d68c203fbdfce8d9f0e7dcccb02a55": {
      "type": "Ybodychange",
      "commitMessage": "YARN-7838. Support AND/OR constraints in Distributed Shell. Contributed by Weiwei Yang.\n",
      "commitDate": "10/02/18 10:20 PM",
      "commitName": "a08c048832d68c203fbdfce8d9f0e7dcccb02a55",
      "commitAuthor": "Weiwei Yang",
      "commitDateOld": "31/01/18 1:30 AM",
      "commitNameOld": "e60f51299dba360d13aa39f9ab714fdfc666b532",
      "commitAuthorOld": "Wangda Tan",
      "daysBetweenCommits": 10.87,
      "commitsBetweenForRepo": 71,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,10 +1,16 @@\n   private void parsePlacementSpecs(String placementSpecifications) {\n+    // Client sends placement spec in encoded format\n+    Base64.Decoder decoder \u003d Base64.getDecoder();\n+    byte[] decodedBytes \u003d decoder.decode(\n+        placementSpecifications.getBytes(StandardCharsets.UTF_8));\n+    String decodedSpec \u003d new String(decodedBytes, StandardCharsets.UTF_8);\n+    LOG.info(\"Decode placement spec: \" + decodedSpec);\n     Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n-        PlacementSpec.parse(placementSpecifications);\n+        PlacementSpec.parse(decodedSpec);\n     this.placementSpecs \u003d new HashMap\u003c\u003e();\n     this.numTotalContainers \u003d 0;\n     for (PlacementSpec pSpec : pSpecs.values()) {\n       this.numTotalContainers +\u003d pSpec.numContainers;\n       this.placementSpecs.put(pSpec.sourceTag, pSpec);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void parsePlacementSpecs(String placementSpecifications) {\n    // Client sends placement spec in encoded format\n    Base64.Decoder decoder \u003d Base64.getDecoder();\n    byte[] decodedBytes \u003d decoder.decode(\n        placementSpecifications.getBytes(StandardCharsets.UTF_8));\n    String decodedSpec \u003d new String(decodedBytes, StandardCharsets.UTF_8);\n    LOG.info(\"Decode placement spec: \" + decodedSpec);\n    Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n        PlacementSpec.parse(decodedSpec);\n    this.placementSpecs \u003d new HashMap\u003c\u003e();\n    this.numTotalContainers \u003d 0;\n    for (PlacementSpec pSpec : pSpecs.values()) {\n      this.numTotalContainers +\u003d pSpec.numContainers;\n      this.placementSpecs.put(pSpec.sourceTag, pSpec);\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/main/java/org/apache/hadoop/yarn/applications/distributedshell/ApplicationMaster.java",
      "extendedDetails": {}
    },
    "e60f51299dba360d13aa39f9ab714fdfc666b532": {
      "type": "Yintroduced",
      "commitMessage": "YARN-7745. Allow DistributedShell to take a placement specification for containers it wants to launch. (Arun Suresh via wangda)\n\nChange-Id: Ided146d662e944a8a4692e5d6885f23fd9bbcad5\n",
      "commitDate": "31/01/18 1:30 AM",
      "commitName": "e60f51299dba360d13aa39f9ab714fdfc666b532",
      "commitAuthor": "Wangda Tan",
      "diff": "@@ -0,0 +1,10 @@\n+  private void parsePlacementSpecs(String placementSpecifications) {\n+    Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n+        PlacementSpec.parse(placementSpecifications);\n+    this.placementSpecs \u003d new HashMap\u003c\u003e();\n+    this.numTotalContainers \u003d 0;\n+    for (PlacementSpec pSpec : pSpecs.values()) {\n+      this.numTotalContainers +\u003d pSpec.numContainers;\n+      this.placementSpecs.put(pSpec.sourceTag, pSpec);\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  private void parsePlacementSpecs(String placementSpecifications) {\n    Map\u003cString, PlacementSpec\u003e pSpecs \u003d\n        PlacementSpec.parse(placementSpecifications);\n    this.placementSpecs \u003d new HashMap\u003c\u003e();\n    this.numTotalContainers \u003d 0;\n    for (PlacementSpec pSpec : pSpecs.values()) {\n      this.numTotalContainers +\u003d pSpec.numContainers;\n      this.placementSpecs.put(pSpec.sourceTag, pSpec);\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/main/java/org/apache/hadoop/yarn/applications/distributedshell/ApplicationMaster.java"
    }
  }
}