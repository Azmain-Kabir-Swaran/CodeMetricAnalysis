{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "INode.java",
  "functionName": "addDeleteBlock",
  "functionId": "addDeleteBlock___toDelete-BlockInfo",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INode.java",
  "functionStartLine": 1093,
  "functionEndLine": 1108,
  "numCommitsSeen": 236,
  "timeTaken": 4633,
  "changeHistory": [
    "8d898ab25f1c2032a07c9bbd96ba3d0c4eb5be87",
    "60fd0d7fd73198fd610e59d1a4cd007c5fcc7205",
    "972782d9568e0849484c027f27c1638ba50ec56e",
    "6e3fcffe291faec40fa9214f4880a35a952836c4",
    "08ac06283a3e9bf0d49d873823aabd419b08e41f",
    "afe77ce53d3cf203690aa419e377f26cbd45a96e",
    "8a577a16f96437d87ad764dedbdc67d4c184b8d9",
    "1734215a10fd93e38849ed0235b5e026b7f50f83"
  ],
  "changeHistoryShort": {
    "8d898ab25f1c2032a07c9bbd96ba3d0c4eb5be87": "Ybodychange",
    "60fd0d7fd73198fd610e59d1a4cd007c5fcc7205": "Ybodychange",
    "972782d9568e0849484c027f27c1638ba50ec56e": "Ybodychange",
    "6e3fcffe291faec40fa9214f4880a35a952836c4": "Yparameterchange",
    "08ac06283a3e9bf0d49d873823aabd419b08e41f": "Ybodychange",
    "afe77ce53d3cf203690aa419e377f26cbd45a96e": "Ybodychange",
    "8a577a16f96437d87ad764dedbdc67d4c184b8d9": "Ybodychange",
    "1734215a10fd93e38849ed0235b5e026b7f50f83": "Yintroduced"
  },
  "changeHistoryDetails": {
    "8d898ab25f1c2032a07c9bbd96ba3d0c4eb5be87": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-12884. BlockUnderConstructionFeature.truncateBlock should be of type BlockInfo. Contributed by chencan.",
      "commitDate": "21/03/18 4:46 PM",
      "commitName": "8d898ab25f1c2032a07c9bbd96ba3d0c4eb5be87",
      "commitAuthor": "Konstantin V Shvachko",
      "commitDateOld": "14/03/18 9:42 AM",
      "commitNameOld": "4c57fb0cd9344290a9f4f6422c1457d69465eec7",
      "commitAuthorOld": "Arpit Agarwal",
      "daysBetweenCommits": 7.29,
      "commitsBetweenForRepo": 41,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,17 +1,16 @@\n     public void addDeleteBlock(BlockInfo toDelete) {\n       assert toDelete !\u003d null : \"toDelete is null\";\n       toDelete.delete();\n       toDeleteList.add(toDelete);\n       // If the file is being truncated\n       // the copy-on-truncate block should also be collected for deletion\n       BlockUnderConstructionFeature uc \u003d toDelete.getUnderConstructionFeature();\n       if(uc \u003d\u003d null) {\n         return;\n       }\n-      Block truncateBlock \u003d uc.getTruncateBlock();\n+      BlockInfo truncateBlock \u003d uc.getTruncateBlock();\n       if(truncateBlock \u003d\u003d null || truncateBlock.equals(toDelete)) {\n         return;\n       }\n-      assert truncateBlock instanceof BlockInfo : \"should be BlockInfo\";\n-      addDeleteBlock((BlockInfo) truncateBlock);\n+      addDeleteBlock(truncateBlock);\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void addDeleteBlock(BlockInfo toDelete) {\n      assert toDelete !\u003d null : \"toDelete is null\";\n      toDelete.delete();\n      toDeleteList.add(toDelete);\n      // If the file is being truncated\n      // the copy-on-truncate block should also be collected for deletion\n      BlockUnderConstructionFeature uc \u003d toDelete.getUnderConstructionFeature();\n      if(uc \u003d\u003d null) {\n        return;\n      }\n      BlockInfo truncateBlock \u003d uc.getTruncateBlock();\n      if(truncateBlock \u003d\u003d null || truncateBlock.equals(toDelete)) {\n        return;\n      }\n      addDeleteBlock(truncateBlock);\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INode.java",
      "extendedDetails": {}
    },
    "60fd0d7fd73198fd610e59d1a4cd007c5fcc7205": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-12638. Delete copy-on-truncate block along with the original block, when deleting a file being truncated. Contributed by Konstantin Shvachko.",
      "commitDate": "30/11/17 6:18 PM",
      "commitName": "60fd0d7fd73198fd610e59d1a4cd007c5fcc7205",
      "commitAuthor": "Konstantin V Shvachko",
      "commitDateOld": "29/08/17 9:30 PM",
      "commitNameOld": "f3661fd08e03440d02452b46ba3ae3cff2b75ba7",
      "commitAuthorOld": "Xiao Chen",
      "daysBetweenCommits": 92.91,
      "commitsBetweenForRepo": 824,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,5 +1,17 @@\n     public void addDeleteBlock(BlockInfo toDelete) {\n       assert toDelete !\u003d null : \"toDelete is null\";\n       toDelete.delete();\n       toDeleteList.add(toDelete);\n+      // If the file is being truncated\n+      // the copy-on-truncate block should also be collected for deletion\n+      BlockUnderConstructionFeature uc \u003d toDelete.getUnderConstructionFeature();\n+      if(uc \u003d\u003d null) {\n+        return;\n+      }\n+      Block truncateBlock \u003d uc.getTruncateBlock();\n+      if(truncateBlock \u003d\u003d null || truncateBlock.equals(toDelete)) {\n+        return;\n+      }\n+      assert truncateBlock instanceof BlockInfo : \"should be BlockInfo\";\n+      addDeleteBlock((BlockInfo) truncateBlock);\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void addDeleteBlock(BlockInfo toDelete) {\n      assert toDelete !\u003d null : \"toDelete is null\";\n      toDelete.delete();\n      toDeleteList.add(toDelete);\n      // If the file is being truncated\n      // the copy-on-truncate block should also be collected for deletion\n      BlockUnderConstructionFeature uc \u003d toDelete.getUnderConstructionFeature();\n      if(uc \u003d\u003d null) {\n        return;\n      }\n      Block truncateBlock \u003d uc.getTruncateBlock();\n      if(truncateBlock \u003d\u003d null || truncateBlock.equals(toDelete)) {\n        return;\n      }\n      assert truncateBlock instanceof BlockInfo : \"should be BlockInfo\";\n      addDeleteBlock((BlockInfo) truncateBlock);\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INode.java",
      "extendedDetails": {}
    },
    "972782d9568e0849484c027f27c1638ba50ec56e": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-9754. Avoid unnecessary getBlockCollection calls in BlockManager. Contributed by Jing Zhao.\n",
      "commitDate": "12/02/16 11:07 AM",
      "commitName": "972782d9568e0849484c027f27c1638ba50ec56e",
      "commitAuthor": "Jing Zhao",
      "commitDateOld": "16/10/15 8:12 AM",
      "commitNameOld": "52ac73f344e822e41457582f82abb4f35eba9dec",
      "commitAuthorOld": "Harsh J",
      "daysBetweenCommits": 119.16,
      "commitsBetweenForRepo": 814,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,4 +1,5 @@\n     public void addDeleteBlock(BlockInfo toDelete) {\n       assert toDelete !\u003d null : \"toDelete is null\";\n+      toDelete.delete();\n       toDeleteList.add(toDelete);\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void addDeleteBlock(BlockInfo toDelete) {\n      assert toDelete !\u003d null : \"toDelete is null\";\n      toDelete.delete();\n      toDeleteList.add(toDelete);\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INode.java",
      "extendedDetails": {}
    },
    "6e3fcffe291faec40fa9214f4880a35a952836c4": {
      "type": "Yparameterchange",
      "commitMessage": "HDFS-8608. Merge HDFS-7912 to trunk and branch-2 (track BlockInfo instead of Block in UnderReplicatedBlocks and PendingReplicationBlocks). Contributed by Zhe Zhang.\n",
      "commitDate": "17/06/15 8:05 AM",
      "commitName": "6e3fcffe291faec40fa9214f4880a35a952836c4",
      "commitAuthor": "Andrew Wang",
      "commitDateOld": "13/05/15 9:50 PM",
      "commitNameOld": "b2c85db86c9a62b0a03ee87547265077f664970a",
      "commitAuthorOld": "Haohui Mai",
      "daysBetweenCommits": 34.43,
      "commitsBetweenForRepo": 247,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,4 +1,4 @@\n-    public void addDeleteBlock(Block toDelete) {\n+    public void addDeleteBlock(BlockInfo toDelete) {\n       assert toDelete !\u003d null : \"toDelete is null\";\n       toDeleteList.add(toDelete);\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void addDeleteBlock(BlockInfo toDelete) {\n      assert toDelete !\u003d null : \"toDelete is null\";\n      toDeleteList.add(toDelete);\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INode.java",
      "extendedDetails": {
        "oldValue": "[toDelete-Block]",
        "newValue": "[toDelete-BlockInfo]"
      }
    },
    "08ac06283a3e9bf0d49d873823aabd419b08e41f": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-7056. Snapshot support for truncate. Contributed by Konstantin Shvachko and Plamen Jeliazkov.",
      "commitDate": "13/01/15 12:24 AM",
      "commitName": "08ac06283a3e9bf0d49d873823aabd419b08e41f",
      "commitAuthor": "Konstantin V Shvachko",
      "commitDateOld": "17/12/14 10:32 AM",
      "commitNameOld": "4281c96e24739387bc2084f819c0176d0051a5e9",
      "commitAuthorOld": "Colin Patrick Mccabe",
      "daysBetweenCommits": 26.58,
      "commitsBetweenForRepo": 116,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,5 +1,4 @@\n     public void addDeleteBlock(Block toDelete) {\n-      if (toDelete !\u003d null) {\n-        toDeleteList.add(toDelete);\n-      }\n+      assert toDelete !\u003d null : \"toDelete is null\";\n+      toDeleteList.add(toDelete);\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void addDeleteBlock(Block toDelete) {\n      assert toDelete !\u003d null : \"toDelete is null\";\n      toDeleteList.add(toDelete);\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INode.java",
      "extendedDetails": {}
    },
    "afe77ce53d3cf203690aa419e377f26cbd45a96e": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4480. Eliminate the file snapshot circular linked list.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1444280 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "08/02/13 3:19 PM",
      "commitName": "afe77ce53d3cf203690aa419e377f26cbd45a96e",
      "commitAuthor": "Tsz-wo Sze",
      "commitDateOld": "07/02/13 6:18 PM",
      "commitNameOld": "4f7d921324c7fa9623c34688e3f2aa57fbfcb8b3",
      "commitAuthorOld": "Tsz-wo Sze",
      "daysBetweenCommits": 0.88,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,5 +1,5 @@\n     public void addDeleteBlock(Block toDelete) {\n       if (toDelete !\u003d null) {\n-        updateMap.put(toDelete, null);\n+        toDeleteList.add(toDelete);\n       }\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void addDeleteBlock(Block toDelete) {\n      if (toDelete !\u003d null) {\n        toDeleteList.add(toDelete);\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INode.java",
      "extendedDetails": {}
    },
    "8a577a16f96437d87ad764dedbdc67d4c184b8d9": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-4150.  Update the inode in the block map when a snapshotted file or a snapshot file is deleted. Contributed by Jing Zhao\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-2802@1406763 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "07/11/12 11:30 AM",
      "commitName": "8a577a16f96437d87ad764dedbdc67d4c184b8d9",
      "commitAuthor": "Tsz-wo Sze",
      "commitDateOld": "06/11/12 1:11 PM",
      "commitNameOld": "92c440c1158bb3939006d208ad1cda23bd532168",
      "commitAuthorOld": "",
      "daysBetweenCommits": 0.93,
      "commitsBetweenForRepo": 5,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,5 +1,5 @@\n     public void addDeleteBlock(Block toDelete) {\n       if (toDelete !\u003d null) {\n-        toDeleteList.add(toDelete);\n+        updateMap.put(toDelete, null);\n       }\n     }\n\\ No newline at end of file\n",
      "actualSource": "    public void addDeleteBlock(Block toDelete) {\n      if (toDelete !\u003d null) {\n        updateMap.put(toDelete, null);\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INode.java",
      "extendedDetails": {}
    },
    "1734215a10fd93e38849ed0235b5e026b7f50f83": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-4152. Add a new class BlocksMapUpdateInfo for the parameter in INode.collectSubtreeBlocksAndClear(..). Contributed by Jing Zhao \n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1406326 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "06/11/12 1:04 PM",
      "commitName": "1734215a10fd93e38849ed0235b5e026b7f50f83",
      "commitAuthor": "Tsz-wo Sze",
      "diff": "@@ -0,0 +1,5 @@\n+    public void addDeleteBlock(Block toDelete) {\n+      if (toDelete !\u003d null) {\n+        toDeleteList.add(toDelete);\n+      }\n+    }\n\\ No newline at end of file\n",
      "actualSource": "    public void addDeleteBlock(Block toDelete) {\n      if (toDelete !\u003d null) {\n        toDeleteList.add(toDelete);\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/INode.java"
    }
  }
}