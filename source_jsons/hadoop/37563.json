{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "RMDelegationTokenSecretManager.java",
  "functionName": "updateStoredToken",
  "functionId": "updateStoredToken___id-RMDelegationTokenIdentifier__renewDate-long",
  "sourceFilePath": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/security/RMDelegationTokenSecretManager.java",
  "functionStartLine": 134,
  "functionEndLine": 147,
  "numCommitsSeen": 9,
  "timeTaken": 2300,
  "changeHistory": [
    "a2c7a73e33045ce42cce19aacbe45c0421a61994",
    "722ee841948db1f246f0056acec9a1ac464fe1f9",
    "562a701945be3a672f9cb5a52cc6db2c1589ba2b",
    "ce56616037fc160ba875b496bdc369411bb873be",
    "29902cd53c2dd6f0b2c44fef14fe9cdbaf183895"
  ],
  "changeHistoryShort": {
    "a2c7a73e33045ce42cce19aacbe45c0421a61994": "Ybodychange",
    "722ee841948db1f246f0056acec9a1ac464fe1f9": "Ybodychange",
    "562a701945be3a672f9cb5a52cc6db2c1589ba2b": "Ybodychange",
    "ce56616037fc160ba875b496bdc369411bb873be": "Ybodychange",
    "29902cd53c2dd6f0b2c44fef14fe9cdbaf183895": "Yintroduced"
  },
  "changeHistoryDetails": {
    "a2c7a73e33045ce42cce19aacbe45c0421a61994": {
      "type": "Ybodychange",
      "commitMessage": "YARN-6647. RM can crash during transitionToStandby due to InterruptedException. Contributed by Bibin A Chundatt\n",
      "commitDate": "28/11/17 9:15 AM",
      "commitName": "a2c7a73e33045ce42cce19aacbe45c0421a61994",
      "commitAuthor": "Jason Lowe",
      "commitDateOld": "10/09/17 9:58 PM",
      "commitNameOld": "722ee841948db1f246f0056acec9a1ac464fe1f9",
      "commitAuthorOld": "Sunil G",
      "daysBetweenCommits": 78.51,
      "commitsBetweenForRepo": 668,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,12 +1,14 @@\n   protected void updateStoredToken(RMDelegationTokenIdentifier id,\n       long renewDate) {\n     try {\n       LOG.info(\"updating RMDelegation token with sequence number: \"\n           + id.getSequenceNumber());\n       rm.getRMContext().getStateStore().updateRMDelegationToken(id, renewDate);\n     } catch (Exception e) {\n-      LOG.error(\"Error in updating persisted RMDelegationToken\" +\n-                \" with sequence number: \" + id.getSequenceNumber());\n-      ExitUtil.terminate(1, e);\n+      if (!shouldIgnoreException(e)) {\n+        LOG.error(\"Error in updating persisted RMDelegationToken\"\n+            + \" with sequence number: \" + id.getSequenceNumber());\n+        ExitUtil.terminate(1, e);\n+      }\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void updateStoredToken(RMDelegationTokenIdentifier id,\n      long renewDate) {\n    try {\n      LOG.info(\"updating RMDelegation token with sequence number: \"\n          + id.getSequenceNumber());\n      rm.getRMContext().getStateStore().updateRMDelegationToken(id, renewDate);\n    } catch (Exception e) {\n      if (!shouldIgnoreException(e)) {\n        LOG.error(\"Error in updating persisted RMDelegationToken\"\n            + \" with sequence number: \" + id.getSequenceNumber());\n        ExitUtil.terminate(1, e);\n      }\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/security/RMDelegationTokenSecretManager.java",
      "extendedDetails": {}
    },
    "722ee841948db1f246f0056acec9a1ac464fe1f9": {
      "type": "Ybodychange",
      "commitMessage": "YARN-7163. RMContext need not to be injected to webapp and other Always Running services. Contributed by Rohith Sharma K S.\n",
      "commitDate": "10/09/17 9:58 PM",
      "commitName": "722ee841948db1f246f0056acec9a1ac464fe1f9",
      "commitAuthor": "Sunil G",
      "commitDateOld": "11/05/15 5:27 AM",
      "commitNameOld": "7e543c27fa2881aa65967be384a6203bd5b2304f",
      "commitAuthorOld": "Junping Du",
      "daysBetweenCommits": 853.69,
      "commitsBetweenForRepo": 5818,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,12 +1,12 @@\n   protected void updateStoredToken(RMDelegationTokenIdentifier id,\n       long renewDate) {\n     try {\n       LOG.info(\"updating RMDelegation token with sequence number: \"\n           + id.getSequenceNumber());\n-      rmContext.getStateStore().updateRMDelegationToken(id, renewDate);\n+      rm.getRMContext().getStateStore().updateRMDelegationToken(id, renewDate);\n     } catch (Exception e) {\n       LOG.error(\"Error in updating persisted RMDelegationToken\" +\n                 \" with sequence number: \" + id.getSequenceNumber());\n       ExitUtil.terminate(1, e);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void updateStoredToken(RMDelegationTokenIdentifier id,\n      long renewDate) {\n    try {\n      LOG.info(\"updating RMDelegation token with sequence number: \"\n          + id.getSequenceNumber());\n      rm.getRMContext().getStateStore().updateRMDelegationToken(id, renewDate);\n    } catch (Exception e) {\n      LOG.error(\"Error in updating persisted RMDelegationToken\" +\n                \" with sequence number: \" + id.getSequenceNumber());\n      ExitUtil.terminate(1, e);\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/security/RMDelegationTokenSecretManager.java",
      "extendedDetails": {}
    },
    "562a701945be3a672f9cb5a52cc6db2c1589ba2b": {
      "type": "Ybodychange",
      "commitMessage": "YARN-2958. Made RMStateStore not update the last sequence number when updating the delegation token. Contributed by Varun Saxena.\n",
      "commitDate": "05/01/15 1:33 PM",
      "commitName": "562a701945be3a672f9cb5a52cc6db2c1589ba2b",
      "commitAuthor": "Zhijie Shen",
      "commitDateOld": "15/07/14 4:00 PM",
      "commitNameOld": "030580387a4d8d97560a93da2fd7494b4366e3b6",
      "commitAuthorOld": "Vinod Kumar Vavilapalli",
      "daysBetweenCommits": 173.94,
      "commitsBetweenForRepo": 1508,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,13 +1,12 @@\n   protected void updateStoredToken(RMDelegationTokenIdentifier id,\n       long renewDate) {\n     try {\n       LOG.info(\"updating RMDelegation token with sequence number: \"\n           + id.getSequenceNumber());\n-      rmContext.getStateStore().updateRMDelegationTokenAndSequenceNumber(id,\n-        renewDate, id.getSequenceNumber());\n+      rmContext.getStateStore().updateRMDelegationToken(id, renewDate);\n     } catch (Exception e) {\n-      LOG.error(\"Error in updating persisted RMDelegationToken with sequence number: \"\n-            + id.getSequenceNumber());\n+      LOG.error(\"Error in updating persisted RMDelegationToken\" +\n+                \" with sequence number: \" + id.getSequenceNumber());\n       ExitUtil.terminate(1, e);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void updateStoredToken(RMDelegationTokenIdentifier id,\n      long renewDate) {\n    try {\n      LOG.info(\"updating RMDelegation token with sequence number: \"\n          + id.getSequenceNumber());\n      rmContext.getStateStore().updateRMDelegationToken(id, renewDate);\n    } catch (Exception e) {\n      LOG.error(\"Error in updating persisted RMDelegationToken\" +\n                \" with sequence number: \" + id.getSequenceNumber());\n      ExitUtil.terminate(1, e);\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/security/RMDelegationTokenSecretManager.java",
      "extendedDetails": {}
    },
    "ce56616037fc160ba875b496bdc369411bb873be": {
      "type": "Ybodychange",
      "commitMessage": "YARN-1776. Fixed DelegationToken renewal to survive RM failover. Contributed by Zhijie Shen\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1580154 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "21/03/14 9:12 PM",
      "commitName": "ce56616037fc160ba875b496bdc369411bb873be",
      "commitAuthor": "Jian He",
      "commitDateOld": "29/05/13 9:14 PM",
      "commitNameOld": "29902cd53c2dd6f0b2c44fef14fe9cdbaf183895",
      "commitAuthorOld": "Vinod Kumar Vavilapalli",
      "daysBetweenCommits": 296.0,
      "commitsBetweenForRepo": 2029,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,15 +1,13 @@\n   protected void updateStoredToken(RMDelegationTokenIdentifier id,\n       long renewDate) {\n     try {\n       LOG.info(\"updating RMDelegation token with sequence number: \"\n           + id.getSequenceNumber());\n-      rmContext.getStateStore().removeRMDelegationToken(id,\n-        delegationTokenSequenceNumber);\n-      rmContext.getStateStore().storeRMDelegationTokenAndSequenceNumber(id,\n+      rmContext.getStateStore().updateRMDelegationTokenAndSequenceNumber(id,\n         renewDate, id.getSequenceNumber());\n     } catch (Exception e) {\n       LOG.error(\"Error in updating persisted RMDelegationToken with sequence number: \"\n             + id.getSequenceNumber());\n       ExitUtil.terminate(1, e);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void updateStoredToken(RMDelegationTokenIdentifier id,\n      long renewDate) {\n    try {\n      LOG.info(\"updating RMDelegation token with sequence number: \"\n          + id.getSequenceNumber());\n      rmContext.getStateStore().updateRMDelegationTokenAndSequenceNumber(id,\n        renewDate, id.getSequenceNumber());\n    } catch (Exception e) {\n      LOG.error(\"Error in updating persisted RMDelegationToken with sequence number: \"\n            + id.getSequenceNumber());\n      ExitUtil.terminate(1, e);\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/security/RMDelegationTokenSecretManager.java",
      "extendedDetails": {}
    },
    "29902cd53c2dd6f0b2c44fef14fe9cdbaf183895": {
      "type": "Yintroduced",
      "commitMessage": "YARN-638. Modified ResourceManager to restore RMDelegationTokens after restarting. Contributed by Jian He.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1487720 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "29/05/13 9:14 PM",
      "commitName": "29902cd53c2dd6f0b2c44fef14fe9cdbaf183895",
      "commitAuthor": "Vinod Kumar Vavilapalli",
      "diff": "@@ -0,0 +1,15 @@\n+  protected void updateStoredToken(RMDelegationTokenIdentifier id,\n+      long renewDate) {\n+    try {\n+      LOG.info(\"updating RMDelegation token with sequence number: \"\n+          + id.getSequenceNumber());\n+      rmContext.getStateStore().removeRMDelegationToken(id,\n+        delegationTokenSequenceNumber);\n+      rmContext.getStateStore().storeRMDelegationTokenAndSequenceNumber(id,\n+        renewDate, id.getSequenceNumber());\n+    } catch (Exception e) {\n+      LOG.error(\"Error in updating persisted RMDelegationToken with sequence number: \"\n+            + id.getSequenceNumber());\n+      ExitUtil.terminate(1, e);\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  protected void updateStoredToken(RMDelegationTokenIdentifier id,\n      long renewDate) {\n    try {\n      LOG.info(\"updating RMDelegation token with sequence number: \"\n          + id.getSequenceNumber());\n      rmContext.getStateStore().removeRMDelegationToken(id,\n        delegationTokenSequenceNumber);\n      rmContext.getStateStore().storeRMDelegationTokenAndSequenceNumber(id,\n        renewDate, id.getSequenceNumber());\n    } catch (Exception e) {\n      LOG.error(\"Error in updating persisted RMDelegationToken with sequence number: \"\n            + id.getSequenceNumber());\n      ExitUtil.terminate(1, e);\n    }\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/security/RMDelegationTokenSecretManager.java"
    }
  }
}