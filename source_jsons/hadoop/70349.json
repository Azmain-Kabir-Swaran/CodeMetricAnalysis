{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "NativeAzureFileSystem.java",
  "functionName": "performAuthCheck",
  "functionId": "performAuthCheck___requestingAccessForPath-Path__accessType-WasbAuthorizationOperations__operation-String__originalPath-Path",
  "sourceFilePath": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
  "functionStartLine": 1560,
  "functionEndLine": 1576,
  "numCommitsSeen": 142,
  "timeTaken": 4033,
  "changeHistory": [
    "89bb8bfe582ba85566cede321b233bb642f1c675",
    "b415c6fe743242acf1d1d3eb7ea7091d90d2c0d4",
    "0cab57223e3f54be17a5f27cefdb6d1da1b073e5",
    "8e15e240597f821968e14893eabfea39815de207",
    "686823529be09bea2a6cecb3503ef722017475bc"
  ],
  "changeHistoryShort": {
    "89bb8bfe582ba85566cede321b233bb642f1c675": "Ybodychange",
    "b415c6fe743242acf1d1d3eb7ea7091d90d2c0d4": "Ymultichange(Yparameterchange,Ybodychange)",
    "0cab57223e3f54be17a5f27cefdb6d1da1b073e5": "Ymultichange(Yparameterchange,Ybodychange)",
    "8e15e240597f821968e14893eabfea39815de207": "Ybodychange",
    "686823529be09bea2a6cecb3503ef722017475bc": "Yintroduced"
  },
  "changeHistoryDetails": {
    "89bb8bfe582ba85566cede321b233bb642f1c675": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-14442. Owner support for ranger-wasb integration. Contributed by Varada Hemeswari\n",
      "commitDate": "26/05/17 5:54 PM",
      "commitName": "89bb8bfe582ba85566cede321b233bb642f1c675",
      "commitAuthor": "Mingliang Liu",
      "commitDateOld": "16/05/17 11:22 AM",
      "commitNameOld": "b415c6fe743242acf1d1d3eb7ea7091d90d2c0d4",
      "commitAuthorOld": "Mingliang Liu",
      "daysBetweenCommits": 10.27,
      "commitsBetweenForRepo": 65,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,15 +1,17 @@\n   private void performAuthCheck(Path requestingAccessForPath, WasbAuthorizationOperations accessType,\n       String operation, Path originalPath) throws WasbAuthorizationException, IOException {\n \n     if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null) {\n \n       requestingAccessForPath \u003d requestingAccessForPath.makeQualified(getUri(), getWorkingDirectory());\n       originalPath \u003d originalPath.makeQualified(getUri(), getWorkingDirectory());\n \n-      if (!this.authorizer.authorize(requestingAccessForPath.toString(), accessType.toString())) {\n+      String owner \u003d getOwnerForPath(requestingAccessForPath);\n+\n+      if (!this.authorizer.authorize(requestingAccessForPath.toString(), accessType.toString(), owner)) {\n         throw new WasbAuthorizationException(operation\n             + \" operation for Path : \" + originalPath.toString() + \" not allowed\");\n       }\n \n-    }\n+   }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void performAuthCheck(Path requestingAccessForPath, WasbAuthorizationOperations accessType,\n      String operation, Path originalPath) throws WasbAuthorizationException, IOException {\n\n    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null) {\n\n      requestingAccessForPath \u003d requestingAccessForPath.makeQualified(getUri(), getWorkingDirectory());\n      originalPath \u003d originalPath.makeQualified(getUri(), getWorkingDirectory());\n\n      String owner \u003d getOwnerForPath(requestingAccessForPath);\n\n      if (!this.authorizer.authorize(requestingAccessForPath.toString(), accessType.toString(), owner)) {\n        throw new WasbAuthorizationException(operation\n            + \" operation for Path : \" + originalPath.toString() + \" not allowed\");\n      }\n\n   }\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
      "extendedDetails": {}
    },
    "b415c6fe743242acf1d1d3eb7ea7091d90d2c0d4": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HADOOP-14416. Path starting with \u0027wasb:///\u0027 not resolved correctly while authorizing with WASB-Ranger. Contributed by Sivaguru Sankaridurg\n",
      "commitDate": "16/05/17 11:22 AM",
      "commitName": "b415c6fe743242acf1d1d3eb7ea7091d90d2c0d4",
      "commitAuthor": "Mingliang Liu",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HADOOP-14416. Path starting with \u0027wasb:///\u0027 not resolved correctly while authorizing with WASB-Ranger. Contributed by Sivaguru Sankaridurg\n",
          "commitDate": "16/05/17 11:22 AM",
          "commitName": "b415c6fe743242acf1d1d3eb7ea7091d90d2c0d4",
          "commitAuthor": "Mingliang Liu",
          "commitDateOld": "10/05/17 3:05 PM",
          "commitNameOld": "eed731496f63537350206274af09d2118b116a17",
          "commitAuthorOld": "Mingliang Liu",
          "daysBetweenCommits": 5.85,
          "commitsBetweenForRepo": 20,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,9 +1,15 @@\n-  private void performAuthCheck(String requestingAccessForPath, WasbAuthorizationOperations accessType,\n-      String operation, String originalPath) throws WasbAuthorizationException, IOException {\n+  private void performAuthCheck(Path requestingAccessForPath, WasbAuthorizationOperations accessType,\n+      String operation, Path originalPath) throws WasbAuthorizationException, IOException {\n \n-    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null \u0026\u0026\n-        !this.authorizer.authorize(requestingAccessForPath, accessType.toString())) {\n-      throw new WasbAuthorizationException(operation\n-          + \" operation for Path : \" + originalPath + \" not allowed\");\n+    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null) {\n+\n+      requestingAccessForPath \u003d requestingAccessForPath.makeQualified(getUri(), getWorkingDirectory());\n+      originalPath \u003d originalPath.makeQualified(getUri(), getWorkingDirectory());\n+\n+      if (!this.authorizer.authorize(requestingAccessForPath.toString(), accessType.toString())) {\n+        throw new WasbAuthorizationException(operation\n+            + \" operation for Path : \" + originalPath.toString() + \" not allowed\");\n+      }\n+\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void performAuthCheck(Path requestingAccessForPath, WasbAuthorizationOperations accessType,\n      String operation, Path originalPath) throws WasbAuthorizationException, IOException {\n\n    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null) {\n\n      requestingAccessForPath \u003d requestingAccessForPath.makeQualified(getUri(), getWorkingDirectory());\n      originalPath \u003d originalPath.makeQualified(getUri(), getWorkingDirectory());\n\n      if (!this.authorizer.authorize(requestingAccessForPath.toString(), accessType.toString())) {\n        throw new WasbAuthorizationException(operation\n            + \" operation for Path : \" + originalPath.toString() + \" not allowed\");\n      }\n\n    }\n  }",
          "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
          "extendedDetails": {
            "oldValue": "[requestingAccessForPath-String, accessType-WasbAuthorizationOperations, operation-String, originalPath-String]",
            "newValue": "[requestingAccessForPath-Path, accessType-WasbAuthorizationOperations, operation-String, originalPath-Path]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HADOOP-14416. Path starting with \u0027wasb:///\u0027 not resolved correctly while authorizing with WASB-Ranger. Contributed by Sivaguru Sankaridurg\n",
          "commitDate": "16/05/17 11:22 AM",
          "commitName": "b415c6fe743242acf1d1d3eb7ea7091d90d2c0d4",
          "commitAuthor": "Mingliang Liu",
          "commitDateOld": "10/05/17 3:05 PM",
          "commitNameOld": "eed731496f63537350206274af09d2118b116a17",
          "commitAuthorOld": "Mingliang Liu",
          "daysBetweenCommits": 5.85,
          "commitsBetweenForRepo": 20,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,9 +1,15 @@\n-  private void performAuthCheck(String requestingAccessForPath, WasbAuthorizationOperations accessType,\n-      String operation, String originalPath) throws WasbAuthorizationException, IOException {\n+  private void performAuthCheck(Path requestingAccessForPath, WasbAuthorizationOperations accessType,\n+      String operation, Path originalPath) throws WasbAuthorizationException, IOException {\n \n-    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null \u0026\u0026\n-        !this.authorizer.authorize(requestingAccessForPath, accessType.toString())) {\n-      throw new WasbAuthorizationException(operation\n-          + \" operation for Path : \" + originalPath + \" not allowed\");\n+    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null) {\n+\n+      requestingAccessForPath \u003d requestingAccessForPath.makeQualified(getUri(), getWorkingDirectory());\n+      originalPath \u003d originalPath.makeQualified(getUri(), getWorkingDirectory());\n+\n+      if (!this.authorizer.authorize(requestingAccessForPath.toString(), accessType.toString())) {\n+        throw new WasbAuthorizationException(operation\n+            + \" operation for Path : \" + originalPath.toString() + \" not allowed\");\n+      }\n+\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void performAuthCheck(Path requestingAccessForPath, WasbAuthorizationOperations accessType,\n      String operation, Path originalPath) throws WasbAuthorizationException, IOException {\n\n    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null) {\n\n      requestingAccessForPath \u003d requestingAccessForPath.makeQualified(getUri(), getWorkingDirectory());\n      originalPath \u003d originalPath.makeQualified(getUri(), getWorkingDirectory());\n\n      if (!this.authorizer.authorize(requestingAccessForPath.toString(), accessType.toString())) {\n        throw new WasbAuthorizationException(operation\n            + \" operation for Path : \" + originalPath.toString() + \" not allowed\");\n      }\n\n    }\n  }",
          "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
          "extendedDetails": {}
        }
      ]
    },
    "0cab57223e3f54be17a5f27cefdb6d1da1b073e5": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HADOOP-14274. Azure: Simplify Ranger-WASB policy model. Contributed by Sivaguru Sankaridurg\n",
      "commitDate": "12/04/17 4:07 PM",
      "commitName": "0cab57223e3f54be17a5f27cefdb6d1da1b073e5",
      "commitAuthor": "Mingliang Liu",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HADOOP-14274. Azure: Simplify Ranger-WASB policy model. Contributed by Sivaguru Sankaridurg\n",
          "commitDate": "12/04/17 4:07 PM",
          "commitName": "0cab57223e3f54be17a5f27cefdb6d1da1b073e5",
          "commitAuthor": "Mingliang Liu",
          "commitDateOld": "04/04/17 11:10 AM",
          "commitNameOld": "56ab02eed9b61e1c80605104dfc4c87fc6abac96",
          "commitAuthorOld": "Mingliang Liu",
          "daysBetweenCommits": 8.21,
          "commitsBetweenForRepo": 67,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,9 +1,9 @@\n-  private void performAuthCheck(String path, String accessType,\n-      String operation) throws WasbAuthorizationException, IOException {\n+  private void performAuthCheck(String requestingAccessForPath, WasbAuthorizationOperations accessType,\n+      String operation, String originalPath) throws WasbAuthorizationException, IOException {\n \n     if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null \u0026\u0026\n-        !this.authorizer.authorize(path, accessType)) {\n+        !this.authorizer.authorize(requestingAccessForPath, accessType.toString())) {\n       throw new WasbAuthorizationException(operation\n-          + \" operation for Path : \" + path + \" not allowed\");\n+          + \" operation for Path : \" + originalPath + \" not allowed\");\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void performAuthCheck(String requestingAccessForPath, WasbAuthorizationOperations accessType,\n      String operation, String originalPath) throws WasbAuthorizationException, IOException {\n\n    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null \u0026\u0026\n        !this.authorizer.authorize(requestingAccessForPath, accessType.toString())) {\n      throw new WasbAuthorizationException(operation\n          + \" operation for Path : \" + originalPath + \" not allowed\");\n    }\n  }",
          "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
          "extendedDetails": {
            "oldValue": "[path-String, accessType-String, operation-String]",
            "newValue": "[requestingAccessForPath-String, accessType-WasbAuthorizationOperations, operation-String, originalPath-String]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HADOOP-14274. Azure: Simplify Ranger-WASB policy model. Contributed by Sivaguru Sankaridurg\n",
          "commitDate": "12/04/17 4:07 PM",
          "commitName": "0cab57223e3f54be17a5f27cefdb6d1da1b073e5",
          "commitAuthor": "Mingliang Liu",
          "commitDateOld": "04/04/17 11:10 AM",
          "commitNameOld": "56ab02eed9b61e1c80605104dfc4c87fc6abac96",
          "commitAuthorOld": "Mingliang Liu",
          "daysBetweenCommits": 8.21,
          "commitsBetweenForRepo": 67,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,9 +1,9 @@\n-  private void performAuthCheck(String path, String accessType,\n-      String operation) throws WasbAuthorizationException, IOException {\n+  private void performAuthCheck(String requestingAccessForPath, WasbAuthorizationOperations accessType,\n+      String operation, String originalPath) throws WasbAuthorizationException, IOException {\n \n     if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null \u0026\u0026\n-        !this.authorizer.authorize(path, accessType)) {\n+        !this.authorizer.authorize(requestingAccessForPath, accessType.toString())) {\n       throw new WasbAuthorizationException(operation\n-          + \" operation for Path : \" + path + \" not allowed\");\n+          + \" operation for Path : \" + originalPath + \" not allowed\");\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private void performAuthCheck(String requestingAccessForPath, WasbAuthorizationOperations accessType,\n      String operation, String originalPath) throws WasbAuthorizationException, IOException {\n\n    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null \u0026\u0026\n        !this.authorizer.authorize(requestingAccessForPath, accessType.toString())) {\n      throw new WasbAuthorizationException(operation\n          + \" operation for Path : \" + originalPath + \" not allowed\");\n    }\n  }",
          "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
          "extendedDetails": {}
        }
      ]
    },
    "8e15e240597f821968e14893eabfea39815de207": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-13945. Azure: Add Kerberos and Delegation token support to WASB client. Contributed by Santhosh G Nayak\n\nChange-Id: I39fb0a3b0491bf2160571366939a0502a0045429\n",
      "commitDate": "20/03/17 4:31 PM",
      "commitName": "8e15e240597f821968e14893eabfea39815de207",
      "commitAuthor": "Mingliang Liu",
      "commitDateOld": "07/03/17 2:55 PM",
      "commitNameOld": "28daaf0eb206d723d2baf0f9d91e43d98bb2fd26",
      "commitAuthorOld": "Mingliang Liu",
      "daysBetweenCommits": 13.02,
      "commitsBetweenForRepo": 70,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,9 +1,9 @@\n   private void performAuthCheck(String path, String accessType,\n       String operation) throws WasbAuthorizationException, IOException {\n \n     if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null \u0026\u0026\n-        !this.authorizer.authorize(path, accessType, delegationToken)) {\n+        !this.authorizer.authorize(path, accessType)) {\n       throw new WasbAuthorizationException(operation\n           + \" operation for Path : \" + path + \" not allowed\");\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private void performAuthCheck(String path, String accessType,\n      String operation) throws WasbAuthorizationException, IOException {\n\n    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null \u0026\u0026\n        !this.authorizer.authorize(path, accessType)) {\n      throw new WasbAuthorizationException(operation\n          + \" operation for Path : \" + path + \" not allowed\");\n    }\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java",
      "extendedDetails": {}
    },
    "686823529be09bea2a6cecb3503ef722017475bc": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-13930. Azure: Add Authorization support to WASB. Contributed by Sivaguru Sankaridurg and Dushyanth\n",
      "commitDate": "06/03/17 5:16 PM",
      "commitName": "686823529be09bea2a6cecb3503ef722017475bc",
      "commitAuthor": "Mingliang Liu",
      "diff": "@@ -0,0 +1,9 @@\n+  private void performAuthCheck(String path, String accessType,\n+      String operation) throws WasbAuthorizationException, IOException {\n+\n+    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null \u0026\u0026\n+        !this.authorizer.authorize(path, accessType, delegationToken)) {\n+      throw new WasbAuthorizationException(operation\n+          + \" operation for Path : \" + path + \" not allowed\");\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  private void performAuthCheck(String path, String accessType,\n      String operation) throws WasbAuthorizationException, IOException {\n\n    if (azureAuthorization \u0026\u0026 this.authorizer !\u003d null \u0026\u0026\n        !this.authorizer.authorize(path, accessType, delegationToken)) {\n      throw new WasbAuthorizationException(operation\n          + \" operation for Path : \" + path + \" not allowed\");\n    }\n  }",
      "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/NativeAzureFileSystem.java"
    }
  }
}