{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "LocalMetadataStore.java",
  "functionName": "doDelete",
  "functionId": "doDelete___p-Path__recursive-boolean__tombstone-boolean",
  "sourceFilePath": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java",
  "functionStartLine": 150,
  "functionEndLine": 162,
  "numCommitsSeen": 62,
  "timeTaken": 5666,
  "changeHistory": [
    "7b219778e05a50e33cca75d727e62783322b7f80",
    "c58e11bf521d746842ce16724211a2a0339d7b61",
    "f9cc9e162175444efe9d5b07ecb9a795f750ca3c",
    "c687a6617d73293019d8d91ac48bbfd2ccca3b40",
    "69aac696d9d4e32a55ba9b6992f41a9ad13424f1",
    "621b43e254afaff708cd6fc4698b29628f6abc33"
  ],
  "changeHistoryShort": {
    "7b219778e05a50e33cca75d727e62783322b7f80": "Ymultichange(Yparameterchange,Ybodychange)",
    "c58e11bf521d746842ce16724211a2a0339d7b61": "Ymultichange(Yparameterchange,Ybodychange)",
    "f9cc9e162175444efe9d5b07ecb9a795f750ca3c": "Ymultichange(Yparameterchange,Ybodychange)",
    "c687a6617d73293019d8d91ac48bbfd2ccca3b40": "Ybodychange",
    "69aac696d9d4e32a55ba9b6992f41a9ad13424f1": "Ybodychange",
    "621b43e254afaff708cd6fc4698b29628f6abc33": "Yintroduced"
  },
  "changeHistoryDetails": {
    "7b219778e05a50e33cca75d727e62783322b7f80": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HADOOP-16433. S3Guard: Filter expired entries and tombstones when listing with MetadataStore.listChildren().\n\nContributed by Gabor Bota.\n\nThis pulls the tracking of the lastUpdated timestamp of metadata entries up from the DDB metastore into all s3guard stores, and then uses this to filter out expired tombstones from listings.\n\nChange-Id: I80f121236b49c75a024116f65a3ef29d3580b462\n",
      "commitDate": "24/07/19 10:11 AM",
      "commitName": "7b219778e05a50e33cca75d727e62783322b7f80",
      "commitAuthor": "Gabor Bota",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HADOOP-16433. S3Guard: Filter expired entries and tombstones when listing with MetadataStore.listChildren().\n\nContributed by Gabor Bota.\n\nThis pulls the tracking of the lastUpdated timestamp of metadata entries up from the DDB metastore into all s3guard stores, and then uses this to filter out expired tombstones from listings.\n\nChange-Id: I80f121236b49c75a024116f65a3ef29d3580b462\n",
          "commitDate": "24/07/19 10:11 AM",
          "commitName": "7b219778e05a50e33cca75d727e62783322b7f80",
          "commitAuthor": "Gabor Bota",
          "commitDateOld": "17/07/19 7:24 AM",
          "commitNameOld": "c58e11bf521d746842ce16724211a2a0339d7b61",
          "commitAuthorOld": "Gabor Bota",
          "daysBetweenCommits": 7.12,
          "commitsBetweenForRepo": 47,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,14 +1,13 @@\n   private synchronized void doDelete(Path p, boolean recursive,\n-      boolean tombstone, ITtlTimeProvider ttlTp) {\n+      boolean tombstone) {\n \n     Path path \u003d standardize(p);\n \n     // Delete entry from file cache, then from cached parent directory, if any\n-\n-    deleteCacheEntries(path, tombstone, ttlTp);\n+    deleteCacheEntries(path, tombstone);\n \n     if (recursive) {\n       // Remove all entries that have this dir as path prefix.\n-      deleteEntryByAncestor(path, localCache, tombstone, ttlTp);\n+      deleteEntryByAncestor(path, localCache, tombstone, ttlTimeProvider);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private synchronized void doDelete(Path p, boolean recursive,\n      boolean tombstone) {\n\n    Path path \u003d standardize(p);\n\n    // Delete entry from file cache, then from cached parent directory, if any\n    deleteCacheEntries(path, tombstone);\n\n    if (recursive) {\n      // Remove all entries that have this dir as path prefix.\n      deleteEntryByAncestor(path, localCache, tombstone, ttlTimeProvider);\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java",
          "extendedDetails": {
            "oldValue": "[p-Path, recursive-boolean, tombstone-boolean, ttlTp-ITtlTimeProvider]",
            "newValue": "[p-Path, recursive-boolean, tombstone-boolean]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HADOOP-16433. S3Guard: Filter expired entries and tombstones when listing with MetadataStore.listChildren().\n\nContributed by Gabor Bota.\n\nThis pulls the tracking of the lastUpdated timestamp of metadata entries up from the DDB metastore into all s3guard stores, and then uses this to filter out expired tombstones from listings.\n\nChange-Id: I80f121236b49c75a024116f65a3ef29d3580b462\n",
          "commitDate": "24/07/19 10:11 AM",
          "commitName": "7b219778e05a50e33cca75d727e62783322b7f80",
          "commitAuthor": "Gabor Bota",
          "commitDateOld": "17/07/19 7:24 AM",
          "commitNameOld": "c58e11bf521d746842ce16724211a2a0339d7b61",
          "commitAuthorOld": "Gabor Bota",
          "daysBetweenCommits": 7.12,
          "commitsBetweenForRepo": 47,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,14 +1,13 @@\n   private synchronized void doDelete(Path p, boolean recursive,\n-      boolean tombstone, ITtlTimeProvider ttlTp) {\n+      boolean tombstone) {\n \n     Path path \u003d standardize(p);\n \n     // Delete entry from file cache, then from cached parent directory, if any\n-\n-    deleteCacheEntries(path, tombstone, ttlTp);\n+    deleteCacheEntries(path, tombstone);\n \n     if (recursive) {\n       // Remove all entries that have this dir as path prefix.\n-      deleteEntryByAncestor(path, localCache, tombstone, ttlTp);\n+      deleteEntryByAncestor(path, localCache, tombstone, ttlTimeProvider);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private synchronized void doDelete(Path p, boolean recursive,\n      boolean tombstone) {\n\n    Path path \u003d standardize(p);\n\n    // Delete entry from file cache, then from cached parent directory, if any\n    deleteCacheEntries(path, tombstone);\n\n    if (recursive) {\n      // Remove all entries that have this dir as path prefix.\n      deleteEntryByAncestor(path, localCache, tombstone, ttlTimeProvider);\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java",
          "extendedDetails": {}
        }
      ]
    },
    "c58e11bf521d746842ce16724211a2a0339d7b61": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HADOOP-16383. Pass ITtlTimeProvider instance in initialize method in MetadataStore interface.  Contributed by Gabor Bota. (#1009) \n\n\r\n",
      "commitDate": "17/07/19 7:24 AM",
      "commitName": "c58e11bf521d746842ce16724211a2a0339d7b61",
      "commitAuthor": "Gabor Bota",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HADOOP-16383. Pass ITtlTimeProvider instance in initialize method in MetadataStore interface.  Contributed by Gabor Bota. (#1009) \n\n\r\n",
          "commitDate": "17/07/19 7:24 AM",
          "commitName": "c58e11bf521d746842ce16724211a2a0339d7b61",
          "commitAuthor": "Gabor Bota",
          "commitDateOld": "20/06/19 1:56 AM",
          "commitNameOld": "e02eb24e0a9139418120027b694492e0738df20a",
          "commitAuthorOld": "Steve Loughran",
          "daysBetweenCommits": 27.23,
          "commitsBetweenForRepo": 235,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,14 +1,14 @@\n   private synchronized void doDelete(Path p, boolean recursive,\n-      boolean tombstone, ITtlTimeProvider ttlTimeProvider) {\n+      boolean tombstone, ITtlTimeProvider ttlTp) {\n \n     Path path \u003d standardize(p);\n \n     // Delete entry from file cache, then from cached parent directory, if any\n \n-    deleteCacheEntries(path, tombstone, ttlTimeProvider);\n+    deleteCacheEntries(path, tombstone, ttlTp);\n \n     if (recursive) {\n       // Remove all entries that have this dir as path prefix.\n-      deleteEntryByAncestor(path, localCache, tombstone, ttlTimeProvider);\n+      deleteEntryByAncestor(path, localCache, tombstone, ttlTp);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private synchronized void doDelete(Path p, boolean recursive,\n      boolean tombstone, ITtlTimeProvider ttlTp) {\n\n    Path path \u003d standardize(p);\n\n    // Delete entry from file cache, then from cached parent directory, if any\n\n    deleteCacheEntries(path, tombstone, ttlTp);\n\n    if (recursive) {\n      // Remove all entries that have this dir as path prefix.\n      deleteEntryByAncestor(path, localCache, tombstone, ttlTp);\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java",
          "extendedDetails": {
            "oldValue": "[p-Path, recursive-boolean, tombstone-boolean, ttlTimeProvider-ITtlTimeProvider]",
            "newValue": "[p-Path, recursive-boolean, tombstone-boolean, ttlTp-ITtlTimeProvider]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HADOOP-16383. Pass ITtlTimeProvider instance in initialize method in MetadataStore interface.  Contributed by Gabor Bota. (#1009) \n\n\r\n",
          "commitDate": "17/07/19 7:24 AM",
          "commitName": "c58e11bf521d746842ce16724211a2a0339d7b61",
          "commitAuthor": "Gabor Bota",
          "commitDateOld": "20/06/19 1:56 AM",
          "commitNameOld": "e02eb24e0a9139418120027b694492e0738df20a",
          "commitAuthorOld": "Steve Loughran",
          "daysBetweenCommits": 27.23,
          "commitsBetweenForRepo": 235,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,14 +1,14 @@\n   private synchronized void doDelete(Path p, boolean recursive,\n-      boolean tombstone, ITtlTimeProvider ttlTimeProvider) {\n+      boolean tombstone, ITtlTimeProvider ttlTp) {\n \n     Path path \u003d standardize(p);\n \n     // Delete entry from file cache, then from cached parent directory, if any\n \n-    deleteCacheEntries(path, tombstone, ttlTimeProvider);\n+    deleteCacheEntries(path, tombstone, ttlTp);\n \n     if (recursive) {\n       // Remove all entries that have this dir as path prefix.\n-      deleteEntryByAncestor(path, localCache, tombstone, ttlTimeProvider);\n+      deleteEntryByAncestor(path, localCache, tombstone, ttlTp);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private synchronized void doDelete(Path p, boolean recursive,\n      boolean tombstone, ITtlTimeProvider ttlTp) {\n\n    Path path \u003d standardize(p);\n\n    // Delete entry from file cache, then from cached parent directory, if any\n\n    deleteCacheEntries(path, tombstone, ttlTp);\n\n    if (recursive) {\n      // Remove all entries that have this dir as path prefix.\n      deleteEntryByAncestor(path, localCache, tombstone, ttlTp);\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java",
          "extendedDetails": {}
        }
      ]
    },
    "f9cc9e162175444efe9d5b07ecb9a795f750ca3c": {
      "type": "Ymultichange(Yparameterchange,Ybodychange)",
      "commitMessage": "HADOOP-16279. S3Guard: Implement time-based (TTL) expiry for entries (and tombstones).\n\nContributed by Gabor Bota.\n\nChange-Id: I73a2d2861901dedfe7a0e783b310fbb95e7c1af9\n",
      "commitDate": "16/06/19 9:05 AM",
      "commitName": "f9cc9e162175444efe9d5b07ecb9a795f750ca3c",
      "commitAuthor": "Gabor Bota",
      "subchanges": [
        {
          "type": "Yparameterchange",
          "commitMessage": "HADOOP-16279. S3Guard: Implement time-based (TTL) expiry for entries (and tombstones).\n\nContributed by Gabor Bota.\n\nChange-Id: I73a2d2861901dedfe7a0e783b310fbb95e7c1af9\n",
          "commitDate": "16/06/19 9:05 AM",
          "commitName": "f9cc9e162175444efe9d5b07ecb9a795f750ca3c",
          "commitAuthor": "Gabor Bota",
          "commitDateOld": "19/05/19 2:29 PM",
          "commitNameOld": "a36274d69947648dbe82721220cc5240ec5d396d",
          "commitAuthorOld": "Ben Roling",
          "daysBetweenCommits": 27.77,
          "commitsBetweenForRepo": 198,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,14 +1,14 @@\n-  private synchronized void doDelete(Path p, boolean recursive, boolean\n-      tombstone) {\n+  private synchronized void doDelete(Path p, boolean recursive,\n+      boolean tombstone, ITtlTimeProvider ttlTimeProvider) {\n \n     Path path \u003d standardize(p);\n \n     // Delete entry from file cache, then from cached parent directory, if any\n \n-    deleteCacheEntries(path, tombstone);\n+    deleteCacheEntries(path, tombstone, ttlTimeProvider);\n \n     if (recursive) {\n       // Remove all entries that have this dir as path prefix.\n-      deleteEntryByAncestor(path, localCache, tombstone);\n+      deleteEntryByAncestor(path, localCache, tombstone, ttlTimeProvider);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private synchronized void doDelete(Path p, boolean recursive,\n      boolean tombstone, ITtlTimeProvider ttlTimeProvider) {\n\n    Path path \u003d standardize(p);\n\n    // Delete entry from file cache, then from cached parent directory, if any\n\n    deleteCacheEntries(path, tombstone, ttlTimeProvider);\n\n    if (recursive) {\n      // Remove all entries that have this dir as path prefix.\n      deleteEntryByAncestor(path, localCache, tombstone, ttlTimeProvider);\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java",
          "extendedDetails": {
            "oldValue": "[p-Path, recursive-boolean, tombstone-boolean]",
            "newValue": "[p-Path, recursive-boolean, tombstone-boolean, ttlTimeProvider-ITtlTimeProvider]"
          }
        },
        {
          "type": "Ybodychange",
          "commitMessage": "HADOOP-16279. S3Guard: Implement time-based (TTL) expiry for entries (and tombstones).\n\nContributed by Gabor Bota.\n\nChange-Id: I73a2d2861901dedfe7a0e783b310fbb95e7c1af9\n",
          "commitDate": "16/06/19 9:05 AM",
          "commitName": "f9cc9e162175444efe9d5b07ecb9a795f750ca3c",
          "commitAuthor": "Gabor Bota",
          "commitDateOld": "19/05/19 2:29 PM",
          "commitNameOld": "a36274d69947648dbe82721220cc5240ec5d396d",
          "commitAuthorOld": "Ben Roling",
          "daysBetweenCommits": 27.77,
          "commitsBetweenForRepo": 198,
          "commitsBetweenForFile": 1,
          "diff": "@@ -1,14 +1,14 @@\n-  private synchronized void doDelete(Path p, boolean recursive, boolean\n-      tombstone) {\n+  private synchronized void doDelete(Path p, boolean recursive,\n+      boolean tombstone, ITtlTimeProvider ttlTimeProvider) {\n \n     Path path \u003d standardize(p);\n \n     // Delete entry from file cache, then from cached parent directory, if any\n \n-    deleteCacheEntries(path, tombstone);\n+    deleteCacheEntries(path, tombstone, ttlTimeProvider);\n \n     if (recursive) {\n       // Remove all entries that have this dir as path prefix.\n-      deleteEntryByAncestor(path, localCache, tombstone);\n+      deleteEntryByAncestor(path, localCache, tombstone, ttlTimeProvider);\n     }\n   }\n\\ No newline at end of file\n",
          "actualSource": "  private synchronized void doDelete(Path p, boolean recursive,\n      boolean tombstone, ITtlTimeProvider ttlTimeProvider) {\n\n    Path path \u003d standardize(p);\n\n    // Delete entry from file cache, then from cached parent directory, if any\n\n    deleteCacheEntries(path, tombstone, ttlTimeProvider);\n\n    if (recursive) {\n      // Remove all entries that have this dir as path prefix.\n      deleteEntryByAncestor(path, localCache, tombstone, ttlTimeProvider);\n    }\n  }",
          "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java",
          "extendedDetails": {}
        }
      ]
    },
    "c687a6617d73293019d8d91ac48bbfd2ccca3b40": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-15423. Merge fileCache and dirCache into ine single cache in LocalMetadataStore. Contributed by Gabor Bota.\n",
      "commitDate": "25/06/18 1:59 PM",
      "commitName": "c687a6617d73293019d8d91ac48bbfd2ccca3b40",
      "commitAuthor": "Sean Mackrory",
      "commitDateOld": "08/05/18 6:58 PM",
      "commitNameOld": "8981674bbcff0663af820f3e87a3eaea5789968a",
      "commitAuthorOld": "Aaron Fabbri",
      "daysBetweenCommits": 47.79,
      "commitsBetweenForRepo": 363,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,15 +1,14 @@\n   private synchronized void doDelete(Path p, boolean recursive, boolean\n       tombstone) {\n \n     Path path \u003d standardize(p);\n \n     // Delete entry from file cache, then from cached parent directory, if any\n \n     deleteCacheEntries(path, tombstone);\n \n     if (recursive) {\n       // Remove all entries that have this dir as path prefix.\n-      deleteEntryByAncestor(path, dirCache, tombstone);\n-      deleteEntryByAncestor(path, fileCache, tombstone);\n+      deleteEntryByAncestor(path, localCache, tombstone);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private synchronized void doDelete(Path p, boolean recursive, boolean\n      tombstone) {\n\n    Path path \u003d standardize(p);\n\n    // Delete entry from file cache, then from cached parent directory, if any\n\n    deleteCacheEntries(path, tombstone);\n\n    if (recursive) {\n      // Remove all entries that have this dir as path prefix.\n      deleteEntryByAncestor(path, localCache, tombstone);\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java",
      "extendedDetails": {}
    },
    "69aac696d9d4e32a55ba9b6992f41a9ad13424f1": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-13649 s3guard: implement time-based (TTL) expiry for LocalMetadataStore (Gabor Bota)\n",
      "commitDate": "08/05/18 3:29 PM",
      "commitName": "69aac696d9d4e32a55ba9b6992f41a9ad13424f1",
      "commitAuthor": "Aaron Fabbri",
      "commitDateOld": "26/04/18 8:41 PM",
      "commitNameOld": "7d8bcf534acce52fb8cfb745a8671f9350d3b5be",
      "commitAuthorOld": "Aaron Fabbri",
      "daysBetweenCommits": 11.78,
      "commitsBetweenForRepo": 72,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,15 +1,15 @@\n   private synchronized void doDelete(Path p, boolean recursive, boolean\n       tombstone) {\n \n     Path path \u003d standardize(p);\n \n     // Delete entry from file cache, then from cached parent directory, if any\n \n-    deleteHashEntries(path, tombstone);\n+    deleteCacheEntries(path, tombstone);\n \n     if (recursive) {\n       // Remove all entries that have this dir as path prefix.\n-      deleteHashByAncestor(path, dirHash, tombstone);\n-      deleteHashByAncestor(path, fileHash, tombstone);\n+      deleteEntryByAncestor(path, dirCache, tombstone);\n+      deleteEntryByAncestor(path, fileCache, tombstone);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  private synchronized void doDelete(Path p, boolean recursive, boolean\n      tombstone) {\n\n    Path path \u003d standardize(p);\n\n    // Delete entry from file cache, then from cached parent directory, if any\n\n    deleteCacheEntries(path, tombstone);\n\n    if (recursive) {\n      // Remove all entries that have this dir as path prefix.\n      deleteEntryByAncestor(path, dirCache, tombstone);\n      deleteEntryByAncestor(path, fileCache, tombstone);\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java",
      "extendedDetails": {}
    },
    "621b43e254afaff708cd6fc4698b29628f6abc33": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-13345 HS3Guard: Improved Consistency for S3A.\nContributed by: Chris Nauroth, Aaron Fabbri, Mingliang Liu, Lei (Eddy) Xu,\nSean Mackrory, Steve Loughran and others.\n",
      "commitDate": "01/09/17 6:13 AM",
      "commitName": "621b43e254afaff708cd6fc4698b29628f6abc33",
      "commitAuthor": "Steve Loughran",
      "diff": "@@ -0,0 +1,15 @@\n+  private synchronized void doDelete(Path p, boolean recursive, boolean\n+      tombstone) {\n+\n+    Path path \u003d standardize(p);\n+\n+    // Delete entry from file cache, then from cached parent directory, if any\n+\n+    deleteHashEntries(path, tombstone);\n+\n+    if (recursive) {\n+      // Remove all entries that have this dir as path prefix.\n+      deleteHashByAncestor(path, dirHash, tombstone);\n+      deleteHashByAncestor(path, fileHash, tombstone);\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  private synchronized void doDelete(Path p, boolean recursive, boolean\n      tombstone) {\n\n    Path path \u003d standardize(p);\n\n    // Delete entry from file cache, then from cached parent directory, if any\n\n    deleteHashEntries(path, tombstone);\n\n    if (recursive) {\n      // Remove all entries that have this dir as path prefix.\n      deleteHashByAncestor(path, dirHash, tombstone);\n      deleteHashByAncestor(path, fileHash, tombstone);\n    }\n  }",
      "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/s3guard/LocalMetadataStore.java"
    }
  }
}