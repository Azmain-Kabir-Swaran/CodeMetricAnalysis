{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "FSImageFormatProtobuf.java",
  "functionName": "saveErasureCodingSection",
  "functionId": "saveErasureCodingSection___summary-FileSummary.Builder",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormatProtobuf.java",
  "functionStartLine": 915,
  "functionEndLine": 930,
  "numCommitsSeen": 38,
  "timeTaken": 2670,
  "changeHistory": [
    "8d99648c203004045a9339ad27258092969145d6",
    "e565b5277d5b890dad107fe85e295a3907e4bfc1",
    "ae8f55b93243560bd891962d6c64320ddc62a7d7"
  ],
  "changeHistoryShort": {
    "8d99648c203004045a9339ad27258092969145d6": "Ybodychange",
    "e565b5277d5b890dad107fe85e295a3907e4bfc1": "Ybodychange",
    "ae8f55b93243560bd891962d6c64320ddc62a7d7": "Yintroduced"
  },
  "changeHistoryDetails": {
    "8d99648c203004045a9339ad27258092969145d6": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-14039. ec -listPolicies doesn\u0027t show correct state for the default policy when the default is not RS(6,3). Contributed by Kitti Nanasi.\n\nSigned-off-by: Xiao Chen \u003cxiao@apache.org\u003e\n",
      "commitDate": "08/11/18 10:01 AM",
      "commitName": "8d99648c203004045a9339ad27258092969145d6",
      "commitAuthor": "Kitti Nanasi",
      "commitDateOld": "15/10/18 3:18 AM",
      "commitNameOld": "b60ca37914b22550e3630fa02742d40697decb31",
      "commitAuthorOld": "Vinayakumar B",
      "daysBetweenCommits": 24.32,
      "commitsBetweenForRepo": 220,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,16 +1,16 @@\n     private void saveErasureCodingSection(\n         FileSummary.Builder summary) throws IOException {\n       final FSNamesystem fsn \u003d context.getSourceNamesystem();\n       ErasureCodingPolicyInfo[] ecPolicies \u003d\n-          fsn.getErasureCodingPolicyManager().getPolicies();\n+          fsn.getErasureCodingPolicyManager().getPersistedPolicies();\n       ArrayList\u003cErasureCodingPolicyProto\u003e ecPolicyProtoes \u003d\n           new ArrayList\u003cErasureCodingPolicyProto\u003e();\n       for (ErasureCodingPolicyInfo p : ecPolicies) {\n         ecPolicyProtoes.add(PBHelperClient.convertErasureCodingPolicy(p));\n       }\n \n       ErasureCodingSection section \u003d ErasureCodingSection.newBuilder().\n           addAllPolicies(ecPolicyProtoes).build();\n       section.writeDelimitedTo(sectionOutputStream);\n       commitSection(summary, SectionName.ERASURE_CODING);\n     }\n\\ No newline at end of file\n",
      "actualSource": "    private void saveErasureCodingSection(\n        FileSummary.Builder summary) throws IOException {\n      final FSNamesystem fsn \u003d context.getSourceNamesystem();\n      ErasureCodingPolicyInfo[] ecPolicies \u003d\n          fsn.getErasureCodingPolicyManager().getPersistedPolicies();\n      ArrayList\u003cErasureCodingPolicyProto\u003e ecPolicyProtoes \u003d\n          new ArrayList\u003cErasureCodingPolicyProto\u003e();\n      for (ErasureCodingPolicyInfo p : ecPolicies) {\n        ecPolicyProtoes.add(PBHelperClient.convertErasureCodingPolicy(p));\n      }\n\n      ErasureCodingSection section \u003d ErasureCodingSection.newBuilder().\n          addAllPolicies(ecPolicyProtoes).build();\n      section.writeDelimitedTo(sectionOutputStream);\n      commitSection(summary, SectionName.ERASURE_CODING);\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormatProtobuf.java",
      "extendedDetails": {}
    },
    "e565b5277d5b890dad107fe85e295a3907e4bfc1": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-12682. ECAdmin -listPolicies will always show SystemErasureCodingPolicies state as DISABLED.\n",
      "commitDate": "02/11/17 9:27 PM",
      "commitName": "e565b5277d5b890dad107fe85e295a3907e4bfc1",
      "commitAuthor": "Xiao Chen",
      "commitDateOld": "14/09/17 6:08 PM",
      "commitNameOld": "ae8f55b93243560bd891962d6c64320ddc62a7d7",
      "commitAuthorOld": "Kai Zheng",
      "daysBetweenCommits": 49.14,
      "commitsBetweenForRepo": 363,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,16 +1,16 @@\n     private void saveErasureCodingSection(\n         FileSummary.Builder summary) throws IOException {\n       final FSNamesystem fsn \u003d context.getSourceNamesystem();\n-      ErasureCodingPolicy[] ecPolicies \u003d\n+      ErasureCodingPolicyInfo[] ecPolicies \u003d\n           fsn.getErasureCodingPolicyManager().getPolicies();\n       ArrayList\u003cErasureCodingPolicyProto\u003e ecPolicyProtoes \u003d\n           new ArrayList\u003cErasureCodingPolicyProto\u003e();\n-      for (ErasureCodingPolicy p : ecPolicies) {\n+      for (ErasureCodingPolicyInfo p : ecPolicies) {\n         ecPolicyProtoes.add(PBHelperClient.convertErasureCodingPolicy(p));\n       }\n \n       ErasureCodingSection section \u003d ErasureCodingSection.newBuilder().\n           addAllPolicies(ecPolicyProtoes).build();\n       section.writeDelimitedTo(sectionOutputStream);\n       commitSection(summary, SectionName.ERASURE_CODING);\n     }\n\\ No newline at end of file\n",
      "actualSource": "    private void saveErasureCodingSection(\n        FileSummary.Builder summary) throws IOException {\n      final FSNamesystem fsn \u003d context.getSourceNamesystem();\n      ErasureCodingPolicyInfo[] ecPolicies \u003d\n          fsn.getErasureCodingPolicyManager().getPolicies();\n      ArrayList\u003cErasureCodingPolicyProto\u003e ecPolicyProtoes \u003d\n          new ArrayList\u003cErasureCodingPolicyProto\u003e();\n      for (ErasureCodingPolicyInfo p : ecPolicies) {\n        ecPolicyProtoes.add(PBHelperClient.convertErasureCodingPolicy(p));\n      }\n\n      ErasureCodingSection section \u003d ErasureCodingSection.newBuilder().\n          addAllPolicies(ecPolicyProtoes).build();\n      section.writeDelimitedTo(sectionOutputStream);\n      commitSection(summary, SectionName.ERASURE_CODING);\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormatProtobuf.java",
      "extendedDetails": {}
    },
    "ae8f55b93243560bd891962d6c64320ddc62a7d7": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-7859. Erasure Coding: Persist erasure coding policies in NameNode. Contributed by Sammi Chen\n",
      "commitDate": "14/09/17 6:08 PM",
      "commitName": "ae8f55b93243560bd891962d6c64320ddc62a7d7",
      "commitAuthor": "Kai Zheng",
      "diff": "@@ -0,0 +1,16 @@\n+    private void saveErasureCodingSection(\n+        FileSummary.Builder summary) throws IOException {\n+      final FSNamesystem fsn \u003d context.getSourceNamesystem();\n+      ErasureCodingPolicy[] ecPolicies \u003d\n+          fsn.getErasureCodingPolicyManager().getPolicies();\n+      ArrayList\u003cErasureCodingPolicyProto\u003e ecPolicyProtoes \u003d\n+          new ArrayList\u003cErasureCodingPolicyProto\u003e();\n+      for (ErasureCodingPolicy p : ecPolicies) {\n+        ecPolicyProtoes.add(PBHelperClient.convertErasureCodingPolicy(p));\n+      }\n+\n+      ErasureCodingSection section \u003d ErasureCodingSection.newBuilder().\n+          addAllPolicies(ecPolicyProtoes).build();\n+      section.writeDelimitedTo(sectionOutputStream);\n+      commitSection(summary, SectionName.ERASURE_CODING);\n+    }\n\\ No newline at end of file\n",
      "actualSource": "    private void saveErasureCodingSection(\n        FileSummary.Builder summary) throws IOException {\n      final FSNamesystem fsn \u003d context.getSourceNamesystem();\n      ErasureCodingPolicy[] ecPolicies \u003d\n          fsn.getErasureCodingPolicyManager().getPolicies();\n      ArrayList\u003cErasureCodingPolicyProto\u003e ecPolicyProtoes \u003d\n          new ArrayList\u003cErasureCodingPolicyProto\u003e();\n      for (ErasureCodingPolicy p : ecPolicies) {\n        ecPolicyProtoes.add(PBHelperClient.convertErasureCodingPolicy(p));\n      }\n\n      ErasureCodingSection section \u003d ErasureCodingSection.newBuilder().\n          addAllPolicies(ecPolicyProtoes).build();\n      section.writeDelimitedTo(sectionOutputStream);\n      commitSection(summary, SectionName.ERASURE_CODING);\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormatProtobuf.java"
    }
  }
}