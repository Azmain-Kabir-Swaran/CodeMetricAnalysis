{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "AliyunOSSFileSystemStore.java",
  "functionName": "requestNextBatch",
  "functionId": "requestNextBatch",
  "sourceFilePath": "hadoop-tools/hadoop-aliyun/src/main/java/org/apache/hadoop/fs/aliyun/oss/AliyunOSSFileSystemStore.java",
  "functionStartLine": 552,
  "functionEndLine": 593,
  "numCommitsSeen": 19,
  "timeTaken": 1559,
  "changeHistory": [
    "5ff0cf86a940fd83f1425794921cc075b19f1108",
    "18621af7ae8f8ed703245744f8f2a770d07bbfb9"
  ],
  "changeHistoryShort": {
    "5ff0cf86a940fd83f1425794921cc075b19f1108": "Ybodychange",
    "18621af7ae8f8ed703245744f8f2a770d07bbfb9": "Yintroduced"
  },
  "changeHistoryDetails": {
    "5ff0cf86a940fd83f1425794921cc075b19f1108": {
      "type": "Ybodychange",
      "commitMessage": "HADOOP-15943. AliyunOSS: add missing owner \u0026 group attributes for oss FileStatus. Contributed by wujinhu.\n",
      "commitDate": "22/11/18 9:56 PM",
      "commitName": "5ff0cf86a940fd83f1425794921cc075b19f1108",
      "commitAuthor": "Weiwei Yang",
      "commitDateOld": "18/11/18 10:00 PM",
      "commitNameOld": "be0708c6eb3c759e43639e0f8df7c9910308fb97",
      "commitAuthorOld": "Weiwei Yang",
      "daysBetweenCommits": 4.0,
      "commitsBetweenForRepo": 42,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,41 +1,42 @@\n       private boolean requestNextBatch() {\n         if (meetEnd) {\n           return false;\n         }\n         ListObjectsRequest listRequest \u003d new ListObjectsRequest(bucketName);\n         listRequest.setPrefix(AliyunOSSUtils.maybeAddTrailingSlash(prefix));\n         listRequest.setMaxKeys(maxListingLength);\n         listRequest.setMarker(nextMarker);\n         listRequest.setDelimiter(delimiter);\n         ObjectListing listing \u003d ossClient.listObjects(listRequest);\n         List\u003cFileStatus\u003e stats \u003d new ArrayList\u003c\u003e(\n             listing.getObjectSummaries().size() +\n             listing.getCommonPrefixes().size());\n         for (OSSObjectSummary summary : listing.getObjectSummaries()) {\n           String key \u003d summary.getKey();\n           Path path \u003d fs.makeQualified(new Path(\"/\" + key));\n           if (filter.accept(path) \u0026\u0026 acceptor.accept(path, summary)) {\n-            FileStatus status \u003d new FileStatus(summary.getSize(),\n+            FileStatus status \u003d new OSSFileStatus(summary.getSize(),\n                 key.endsWith(\"/\"), 1, fs.getDefaultBlockSize(path),\n-                summary.getLastModified().getTime(), path);\n+                summary.getLastModified().getTime(), path, username);\n             stats.add(status);\n           }\n         }\n \n         for (String commonPrefix : listing.getCommonPrefixes()) {\n           Path path \u003d fs.makeQualified(new Path(\"/\" + commonPrefix));\n           if (filter.accept(path) \u0026\u0026 acceptor.accept(path, commonPrefix)) {\n-            FileStatus status \u003d new FileStatus(0, true, 1, 0, 0, path);\n+            FileStatus status \u003d new OSSFileStatus(0, true, 1, 0, 0,\n+                path, username);\n             stats.add(status);\n           }\n         }\n \n         batchIterator \u003d stats.listIterator();\n         if (listing.isTruncated()) {\n           nextMarker \u003d listing.getNextMarker();\n         } else {\n           meetEnd \u003d true;\n         }\n         statistics.incrementReadOps(1);\n         return batchIterator.hasNext();\n       }\n\\ No newline at end of file\n",
      "actualSource": "      private boolean requestNextBatch() {\n        if (meetEnd) {\n          return false;\n        }\n        ListObjectsRequest listRequest \u003d new ListObjectsRequest(bucketName);\n        listRequest.setPrefix(AliyunOSSUtils.maybeAddTrailingSlash(prefix));\n        listRequest.setMaxKeys(maxListingLength);\n        listRequest.setMarker(nextMarker);\n        listRequest.setDelimiter(delimiter);\n        ObjectListing listing \u003d ossClient.listObjects(listRequest);\n        List\u003cFileStatus\u003e stats \u003d new ArrayList\u003c\u003e(\n            listing.getObjectSummaries().size() +\n            listing.getCommonPrefixes().size());\n        for (OSSObjectSummary summary : listing.getObjectSummaries()) {\n          String key \u003d summary.getKey();\n          Path path \u003d fs.makeQualified(new Path(\"/\" + key));\n          if (filter.accept(path) \u0026\u0026 acceptor.accept(path, summary)) {\n            FileStatus status \u003d new OSSFileStatus(summary.getSize(),\n                key.endsWith(\"/\"), 1, fs.getDefaultBlockSize(path),\n                summary.getLastModified().getTime(), path, username);\n            stats.add(status);\n          }\n        }\n\n        for (String commonPrefix : listing.getCommonPrefixes()) {\n          Path path \u003d fs.makeQualified(new Path(\"/\" + commonPrefix));\n          if (filter.accept(path) \u0026\u0026 acceptor.accept(path, commonPrefix)) {\n            FileStatus status \u003d new OSSFileStatus(0, true, 1, 0, 0,\n                path, username);\n            stats.add(status);\n          }\n        }\n\n        batchIterator \u003d stats.listIterator();\n        if (listing.isTruncated()) {\n          nextMarker \u003d listing.getNextMarker();\n        } else {\n          meetEnd \u003d true;\n        }\n        statistics.incrementReadOps(1);\n        return batchIterator.hasNext();\n      }",
      "path": "hadoop-tools/hadoop-aliyun/src/main/java/org/apache/hadoop/fs/aliyun/oss/AliyunOSSFileSystemStore.java",
      "extendedDetails": {}
    },
    "18621af7ae8f8ed703245744f8f2a770d07bbfb9": {
      "type": "Yintroduced",
      "commitMessage": "HADOOP-14993. AliyunOSS: Override listFiles and listLocatedStatus. Contributed Genmao Yu\n",
      "commitDate": "14/11/17 1:58 AM",
      "commitName": "18621af7ae8f8ed703245744f8f2a770d07bbfb9",
      "commitAuthor": "Kai Zheng",
      "diff": "@@ -0,0 +1,41 @@\n+      private boolean requestNextBatch() {\n+        if (meetEnd) {\n+          return false;\n+        }\n+        ListObjectsRequest listRequest \u003d new ListObjectsRequest(bucketName);\n+        listRequest.setPrefix(AliyunOSSUtils.maybeAddTrailingSlash(prefix));\n+        listRequest.setMaxKeys(maxListingLength);\n+        listRequest.setMarker(nextMarker);\n+        listRequest.setDelimiter(delimiter);\n+        ObjectListing listing \u003d ossClient.listObjects(listRequest);\n+        List\u003cFileStatus\u003e stats \u003d new ArrayList\u003c\u003e(\n+            listing.getObjectSummaries().size() +\n+            listing.getCommonPrefixes().size());\n+        for(OSSObjectSummary summary: listing.getObjectSummaries()) {\n+          String key \u003d summary.getKey();\n+          Path path \u003d fs.makeQualified(new Path(\"/\" + key));\n+          if (filter.accept(path) \u0026\u0026 acceptor.accept(path, summary)) {\n+            FileStatus status \u003d new FileStatus(summary.getSize(),\n+                key.endsWith(\"/\"), 1, fs.getDefaultBlockSize(path),\n+                summary.getLastModified().getTime(), path);\n+            stats.add(status);\n+          }\n+        }\n+\n+        for(String commonPrefix: listing.getCommonPrefixes()) {\n+          Path path \u003d fs.makeQualified(new Path(\"/\" + commonPrefix));\n+          if (filter.accept(path) \u0026\u0026 acceptor.accept(path, commonPrefix)) {\n+            FileStatus status \u003d new FileStatus(0, true, 1, 0, 0, path);\n+            stats.add(status);\n+          }\n+        }\n+\n+        batchIterator \u003d stats.listIterator();\n+        if (listing.isTruncated()) {\n+          nextMarker \u003d listing.getNextMarker();\n+        } else {\n+          meetEnd \u003d true;\n+        }\n+        statistics.incrementReadOps(1);\n+        return batchIterator.hasNext();\n+      }\n\\ No newline at end of file\n",
      "actualSource": "      private boolean requestNextBatch() {\n        if (meetEnd) {\n          return false;\n        }\n        ListObjectsRequest listRequest \u003d new ListObjectsRequest(bucketName);\n        listRequest.setPrefix(AliyunOSSUtils.maybeAddTrailingSlash(prefix));\n        listRequest.setMaxKeys(maxListingLength);\n        listRequest.setMarker(nextMarker);\n        listRequest.setDelimiter(delimiter);\n        ObjectListing listing \u003d ossClient.listObjects(listRequest);\n        List\u003cFileStatus\u003e stats \u003d new ArrayList\u003c\u003e(\n            listing.getObjectSummaries().size() +\n            listing.getCommonPrefixes().size());\n        for(OSSObjectSummary summary: listing.getObjectSummaries()) {\n          String key \u003d summary.getKey();\n          Path path \u003d fs.makeQualified(new Path(\"/\" + key));\n          if (filter.accept(path) \u0026\u0026 acceptor.accept(path, summary)) {\n            FileStatus status \u003d new FileStatus(summary.getSize(),\n                key.endsWith(\"/\"), 1, fs.getDefaultBlockSize(path),\n                summary.getLastModified().getTime(), path);\n            stats.add(status);\n          }\n        }\n\n        for(String commonPrefix: listing.getCommonPrefixes()) {\n          Path path \u003d fs.makeQualified(new Path(\"/\" + commonPrefix));\n          if (filter.accept(path) \u0026\u0026 acceptor.accept(path, commonPrefix)) {\n            FileStatus status \u003d new FileStatus(0, true, 1, 0, 0, path);\n            stats.add(status);\n          }\n        }\n\n        batchIterator \u003d stats.listIterator();\n        if (listing.isTruncated()) {\n          nextMarker \u003d listing.getNextMarker();\n        } else {\n          meetEnd \u003d true;\n        }\n        statistics.incrementReadOps(1);\n        return batchIterator.hasNext();\n      }",
      "path": "hadoop-tools/hadoop-aliyun/src/main/java/org/apache/hadoop/fs/aliyun/oss/AliyunOSSFileSystemStore.java"
    }
  }
}