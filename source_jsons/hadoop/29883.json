{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "EntityGroupFSTimelineStore.java",
  "functionName": "removeEldestEntry",
  "functionId": "removeEldestEntry___eldest-Map.Entry__TimelineEntityGroupId,EntityCacheItem__",
  "sourceFilePath": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-timeline-pluginstorage/src/main/java/org/apache/hadoop/yarn/server/timeline/EntityGroupFSTimelineStore.java",
  "functionStartLine": 176,
  "functionEndLine": 191,
  "numCommitsSeen": 17,
  "timeTaken": 1812,
  "changeHistory": [
    "7f3c306e2ed9e865171324898decb9b587d90e73",
    "705286ccaeea36941d97ec1c1700746b74264924",
    "06413da72efed9a50e49efaf7110c220c88a7f4a",
    "02f597c5db36ded385413958bdee793ad7eda40e"
  ],
  "changeHistoryShort": {
    "7f3c306e2ed9e865171324898decb9b587d90e73": "Ybodychange",
    "705286ccaeea36941d97ec1c1700746b74264924": "Ybodychange",
    "06413da72efed9a50e49efaf7110c220c88a7f4a": "Ybodychange",
    "02f597c5db36ded385413958bdee793ad7eda40e": "Yintroduced"
  },
  "changeHistoryDetails": {
    "7f3c306e2ed9e865171324898decb9b587d90e73": {
      "type": "Ybodychange",
      "commitMessage": "YARN-5432. Lock already held by another process while LevelDB cache store creation for dag. Contributed by Li Lu.\n",
      "commitDate": "28/07/16 6:35 AM",
      "commitName": "7f3c306e2ed9e865171324898decb9b587d90e73",
      "commitAuthor": "Junping Du",
      "commitDateOld": "07/07/16 10:37 PM",
      "commitNameOld": "673e5e02feba9171498a518c06ae70639c5f8854",
      "commitAuthorOld": "Vinod Kumar Vavilapalli",
      "daysBetweenCommits": 20.33,
      "commitsBetweenForRepo": 249,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,23 +1,16 @@\n           protected boolean removeEldestEntry(\n               Map.Entry\u003cTimelineEntityGroupId, EntityCacheItem\u003e eldest) {\n             if (super.size() \u003e appCacheMaxSize) {\n               TimelineEntityGroupId groupId \u003d eldest.getKey();\n               LOG.debug(\"Evicting {} due to space limitations\", groupId);\n               EntityCacheItem cacheItem \u003d eldest.getValue();\n-              int activeStores \u003d EntityCacheItem.getActiveStores();\n-              if (activeStores \u003e appCacheMaxSize * CACHE_ITEM_OVERFLOW_FACTOR) {\n-                LOG.debug(\"Force release cache {} since {} stores are active\",\n-                    groupId, activeStores);\n-                cacheItem.forceRelease();\n-              } else {\n-                LOG.debug(\"Try release cache {}\", groupId);\n-                cacheItem.tryRelease();\n-              }\n+              LOG.debug(\"Force release cache {}.\", groupId);\n+              cacheItem.forceRelease();\n               if (cacheItem.getAppLogs().isDone()) {\n                 appIdLogMap.remove(groupId.getApplicationId());\n               }\n               metrics.incrCacheEvicts();\n               return true;\n             }\n             return false;\n           }\n\\ No newline at end of file\n",
      "actualSource": "          protected boolean removeEldestEntry(\n              Map.Entry\u003cTimelineEntityGroupId, EntityCacheItem\u003e eldest) {\n            if (super.size() \u003e appCacheMaxSize) {\n              TimelineEntityGroupId groupId \u003d eldest.getKey();\n              LOG.debug(\"Evicting {} due to space limitations\", groupId);\n              EntityCacheItem cacheItem \u003d eldest.getValue();\n              LOG.debug(\"Force release cache {}.\", groupId);\n              cacheItem.forceRelease();\n              if (cacheItem.getAppLogs().isDone()) {\n                appIdLogMap.remove(groupId.getApplicationId());\n              }\n              metrics.incrCacheEvicts();\n              return true;\n            }\n            return false;\n          }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-timeline-pluginstorage/src/main/java/org/apache/hadoop/yarn/server/timeline/EntityGroupFSTimelineStore.java",
      "extendedDetails": {}
    },
    "705286ccaeea36941d97ec1c1700746b74264924": {
      "type": "Ybodychange",
      "commitMessage": "YARN-4987. Read cache concurrency issue between read and evict in EntityGroupFS timeline store. Contributed by Li Lu.\n",
      "commitDate": "27/05/16 6:58 AM",
      "commitName": "705286ccaeea36941d97ec1c1700746b74264924",
      "commitAuthor": "Junping Du",
      "commitDateOld": "03/05/16 4:16 AM",
      "commitNameOld": "06413da72efed9a50e49efaf7110c220c88a7f4a",
      "commitAuthorOld": "Junping Du",
      "daysBetweenCommits": 24.11,
      "commitsBetweenForRepo": 182,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,15 +1,23 @@\n           protected boolean removeEldestEntry(\n               Map.Entry\u003cTimelineEntityGroupId, EntityCacheItem\u003e eldest) {\n             if (super.size() \u003e appCacheMaxSize) {\n               TimelineEntityGroupId groupId \u003d eldest.getKey();\n               LOG.debug(\"Evicting {} due to space limitations\", groupId);\n               EntityCacheItem cacheItem \u003d eldest.getValue();\n-              cacheItem.releaseCache(groupId);\n+              int activeStores \u003d EntityCacheItem.getActiveStores();\n+              if (activeStores \u003e appCacheMaxSize * CACHE_ITEM_OVERFLOW_FACTOR) {\n+                LOG.debug(\"Force release cache {} since {} stores are active\",\n+                    groupId, activeStores);\n+                cacheItem.forceRelease();\n+              } else {\n+                LOG.debug(\"Try release cache {}\", groupId);\n+                cacheItem.tryRelease();\n+              }\n               if (cacheItem.getAppLogs().isDone()) {\n                 appIdLogMap.remove(groupId.getApplicationId());\n               }\n               metrics.incrCacheEvicts();\n               return true;\n             }\n             return false;\n           }\n\\ No newline at end of file\n",
      "actualSource": "          protected boolean removeEldestEntry(\n              Map.Entry\u003cTimelineEntityGroupId, EntityCacheItem\u003e eldest) {\n            if (super.size() \u003e appCacheMaxSize) {\n              TimelineEntityGroupId groupId \u003d eldest.getKey();\n              LOG.debug(\"Evicting {} due to space limitations\", groupId);\n              EntityCacheItem cacheItem \u003d eldest.getValue();\n              int activeStores \u003d EntityCacheItem.getActiveStores();\n              if (activeStores \u003e appCacheMaxSize * CACHE_ITEM_OVERFLOW_FACTOR) {\n                LOG.debug(\"Force release cache {} since {} stores are active\",\n                    groupId, activeStores);\n                cacheItem.forceRelease();\n              } else {\n                LOG.debug(\"Try release cache {}\", groupId);\n                cacheItem.tryRelease();\n              }\n              if (cacheItem.getAppLogs().isDone()) {\n                appIdLogMap.remove(groupId.getApplicationId());\n              }\n              metrics.incrCacheEvicts();\n              return true;\n            }\n            return false;\n          }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-timeline-pluginstorage/src/main/java/org/apache/hadoop/yarn/server/timeline/EntityGroupFSTimelineStore.java",
      "extendedDetails": {}
    },
    "06413da72efed9a50e49efaf7110c220c88a7f4a": {
      "type": "Ybodychange",
      "commitMessage": "YARN-4851. Metric improvements for ATS v1.5 storage components. Li Lu via junping_du.\n",
      "commitDate": "03/05/16 4:16 AM",
      "commitName": "06413da72efed9a50e49efaf7110c220c88a7f4a",
      "commitAuthor": "Junping Du",
      "commitDateOld": "13/04/16 10:38 AM",
      "commitNameOld": "e0cb426758b3d716ff143f723fc16ef2f1e4971b",
      "commitAuthorOld": "Xuan",
      "daysBetweenCommits": 19.73,
      "commitsBetweenForRepo": 118,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,14 +1,15 @@\n           protected boolean removeEldestEntry(\n               Map.Entry\u003cTimelineEntityGroupId, EntityCacheItem\u003e eldest) {\n             if (super.size() \u003e appCacheMaxSize) {\n               TimelineEntityGroupId groupId \u003d eldest.getKey();\n               LOG.debug(\"Evicting {} due to space limitations\", groupId);\n               EntityCacheItem cacheItem \u003d eldest.getValue();\n               cacheItem.releaseCache(groupId);\n               if (cacheItem.getAppLogs().isDone()) {\n                 appIdLogMap.remove(groupId.getApplicationId());\n               }\n+              metrics.incrCacheEvicts();\n               return true;\n             }\n             return false;\n           }\n\\ No newline at end of file\n",
      "actualSource": "          protected boolean removeEldestEntry(\n              Map.Entry\u003cTimelineEntityGroupId, EntityCacheItem\u003e eldest) {\n            if (super.size() \u003e appCacheMaxSize) {\n              TimelineEntityGroupId groupId \u003d eldest.getKey();\n              LOG.debug(\"Evicting {} due to space limitations\", groupId);\n              EntityCacheItem cacheItem \u003d eldest.getValue();\n              cacheItem.releaseCache(groupId);\n              if (cacheItem.getAppLogs().isDone()) {\n                appIdLogMap.remove(groupId.getApplicationId());\n              }\n              metrics.incrCacheEvicts();\n              return true;\n            }\n            return false;\n          }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-timeline-pluginstorage/src/main/java/org/apache/hadoop/yarn/server/timeline/EntityGroupFSTimelineStore.java",
      "extendedDetails": {}
    },
    "02f597c5db36ded385413958bdee793ad7eda40e": {
      "type": "Yintroduced",
      "commitMessage": "YARN-4265. Provide new timeline plugin storage to support fine-grained entity caching. Contributed by Li Lu and Jason Lowe\n",
      "commitDate": "17/01/16 5:37 PM",
      "commitName": "02f597c5db36ded385413958bdee793ad7eda40e",
      "commitAuthor": "Junping Du",
      "diff": "@@ -0,0 +1,14 @@\n+          protected boolean removeEldestEntry(\n+              Map.Entry\u003cTimelineEntityGroupId, EntityCacheItem\u003e eldest) {\n+            if (super.size() \u003e appCacheMaxSize) {\n+              TimelineEntityGroupId groupId \u003d eldest.getKey();\n+              LOG.debug(\"Evicting {} due to space limitations\", groupId);\n+              EntityCacheItem cacheItem \u003d eldest.getValue();\n+              cacheItem.releaseCache(groupId);\n+              if (cacheItem.getAppLogs().isDone()) {\n+                appIdLogMap.remove(groupId.getApplicationId());\n+              }\n+              return true;\n+            }\n+            return false;\n+          }\n\\ No newline at end of file\n",
      "actualSource": "          protected boolean removeEldestEntry(\n              Map.Entry\u003cTimelineEntityGroupId, EntityCacheItem\u003e eldest) {\n            if (super.size() \u003e appCacheMaxSize) {\n              TimelineEntityGroupId groupId \u003d eldest.getKey();\n              LOG.debug(\"Evicting {} due to space limitations\", groupId);\n              EntityCacheItem cacheItem \u003d eldest.getValue();\n              cacheItem.releaseCache(groupId);\n              if (cacheItem.getAppLogs().isDone()) {\n                appIdLogMap.remove(groupId.getApplicationId());\n              }\n              return true;\n            }\n            return false;\n          }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-timeline-pluginstorage/src/main/java/org/apache/hadoop/yarn/server/timeline/EntityGroupFSTimelineStore.java"
    }
  }
}