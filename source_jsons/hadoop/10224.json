{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "BlockPoolManager.java",
  "functionName": "refreshNamenodes",
  "functionId": "refreshNamenodes___conf-Configuration",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolManager.java",
  "functionStartLine": 147,
  "functionEndLine": 172,
  "numCommitsSeen": 17,
  "timeTaken": 2578,
  "changeHistory": [
    "0be0f1ce1da984ff3a8fd4b079297ead2dc6722d",
    "65a941008d4bbf906772399d3f035f2a0da5abfa",
    "aa4b6fbe754ab7e3cf8ee106598d550f6e14783e",
    "2759689d7d23001f007cb0dbe2521de90734dd5c",
    "c6107f566ff01e9bfee9052f86f6e5b21d5e89f3",
    "260dfa367e3c161edcc9d2b2217661710199c95e",
    "f4fa76719e622a4ef883c51ec0abc6e6e6ddf09e"
  ],
  "changeHistoryShort": {
    "0be0f1ce1da984ff3a8fd4b079297ead2dc6722d": "Ybodychange",
    "65a941008d4bbf906772399d3f035f2a0da5abfa": "Ybodychange",
    "aa4b6fbe754ab7e3cf8ee106598d550f6e14783e": "Ybodychange",
    "2759689d7d23001f007cb0dbe2521de90734dd5c": "Ybodychange",
    "c6107f566ff01e9bfee9052f86f6e5b21d5e89f3": "Ybodychange",
    "260dfa367e3c161edcc9d2b2217661710199c95e": "Ybodychange",
    "f4fa76719e622a4ef883c51ec0abc6e6e6ddf09e": "Yintroduced"
  },
  "changeHistoryDetails": {
    "0be0f1ce1da984ff3a8fd4b079297ead2dc6722d": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-13275. Adding log for BlockPoolManager#refreshNamenodes failures. Contributed by Ajay Kumar.\n",
      "commitDate": "14/03/18 10:38 AM",
      "commitName": "0be0f1ce1da984ff3a8fd4b079297ead2dc6722d",
      "commitAuthor": "Xiaoyu Yao",
      "commitDateOld": "12/02/18 8:44 AM",
      "commitNameOld": "35c17351cab645dcc72e0d2ae1608507aa787ffb",
      "commitAuthorOld": "Brahma Reddy Battula",
      "daysBetweenCommits": 30.04,
      "commitsBetweenForRepo": 212,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,14 +1,26 @@\n   void refreshNamenodes(Configuration conf)\n       throws IOException {\n-    LOG.info(\"Refresh request received for nameservices: \" + conf.get\n-            (DFSConfigKeys.DFS_NAMESERVICES));\n+    LOG.info(\"Refresh request received for nameservices: \" +\n+        conf.get(DFSConfigKeys.DFS_NAMESERVICES));\n \n-    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d DFSUtil\n-            .getNNServiceRpcAddressesForCluster(conf);\n-    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newLifelineAddressMap \u003d DFSUtil\n-            .getNNLifelineRpcAddressesForCluster(conf);\n+    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d null;\n+    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newLifelineAddressMap \u003d null;\n+\n+    try {\n+      newAddressMap \u003d\n+          DFSUtil.getNNServiceRpcAddressesForCluster(conf);\n+      newLifelineAddressMap \u003d\n+          DFSUtil.getNNLifelineRpcAddressesForCluster(conf);\n+    } catch (IOException ioe) {\n+      LOG.warn(\"Unable to get NameNode addresses.\");\n+    }\n+\n+    if (newAddressMap \u003d\u003d null || newAddressMap.isEmpty()) {\n+      throw new IOException(\"No services to connect, missing NameNode \" +\n+          \"address.\");\n+    }\n \n     synchronized (refreshNamenodesLock) {\n       doRefreshNamenodes(newAddressMap, newLifelineAddressMap);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void refreshNamenodes(Configuration conf)\n      throws IOException {\n    LOG.info(\"Refresh request received for nameservices: \" +\n        conf.get(DFSConfigKeys.DFS_NAMESERVICES));\n\n    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d null;\n    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newLifelineAddressMap \u003d null;\n\n    try {\n      newAddressMap \u003d\n          DFSUtil.getNNServiceRpcAddressesForCluster(conf);\n      newLifelineAddressMap \u003d\n          DFSUtil.getNNLifelineRpcAddressesForCluster(conf);\n    } catch (IOException ioe) {\n      LOG.warn(\"Unable to get NameNode addresses.\");\n    }\n\n    if (newAddressMap \u003d\u003d null || newAddressMap.isEmpty()) {\n      throw new IOException(\"No services to connect, missing NameNode \" +\n          \"address.\");\n    }\n\n    synchronized (refreshNamenodesLock) {\n      doRefreshNamenodes(newAddressMap, newLifelineAddressMap);\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolManager.java",
      "extendedDetails": {}
    },
    "65a941008d4bbf906772399d3f035f2a0da5abfa": {
      "type": "Ybodychange",
      "commitMessage": "Revert \"HDFS-10391. Always enable NameNode service RPC port. Contributed by Gergely Novak.\"\n\nThis reverts commit aa4b6fbe754ab7e3cf8ee106598d550f6e14783e.\n",
      "commitDate": "14/09/17 11:17 AM",
      "commitName": "65a941008d4bbf906772399d3f035f2a0da5abfa",
      "commitAuthor": "Arpit Agarwal",
      "commitDateOld": "09/09/17 8:40 AM",
      "commitNameOld": "aa4b6fbe754ab7e3cf8ee106598d550f6e14783e",
      "commitAuthorOld": "Arpit Agarwal",
      "daysBetweenCommits": 5.11,
      "commitsBetweenForRepo": 81,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,14 +1,14 @@\n   void refreshNamenodes(Configuration conf)\n       throws IOException {\n     LOG.info(\"Refresh request received for nameservices: \" + conf.get\n             (DFSConfigKeys.DFS_NAMESERVICES));\n \n     Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d DFSUtil\n-            .getNNServiceRpcAddresses(conf);\n+            .getNNServiceRpcAddressesForCluster(conf);\n     Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newLifelineAddressMap \u003d DFSUtil\n             .getNNLifelineRpcAddressesForCluster(conf);\n \n     synchronized (refreshNamenodesLock) {\n       doRefreshNamenodes(newAddressMap, newLifelineAddressMap);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void refreshNamenodes(Configuration conf)\n      throws IOException {\n    LOG.info(\"Refresh request received for nameservices: \" + conf.get\n            (DFSConfigKeys.DFS_NAMESERVICES));\n\n    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d DFSUtil\n            .getNNServiceRpcAddressesForCluster(conf);\n    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newLifelineAddressMap \u003d DFSUtil\n            .getNNLifelineRpcAddressesForCluster(conf);\n\n    synchronized (refreshNamenodesLock) {\n      doRefreshNamenodes(newAddressMap, newLifelineAddressMap);\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolManager.java",
      "extendedDetails": {}
    },
    "aa4b6fbe754ab7e3cf8ee106598d550f6e14783e": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-10391. Always enable NameNode service RPC port. Contributed by Gergely Novak.\n",
      "commitDate": "09/09/17 8:40 AM",
      "commitName": "aa4b6fbe754ab7e3cf8ee106598d550f6e14783e",
      "commitAuthor": "Arpit Agarwal",
      "commitDateOld": "11/04/17 3:29 PM",
      "commitNameOld": "3a91376707d451777b8269f81bcd48315edd9fc7",
      "commitAuthorOld": "Mingliang Liu",
      "daysBetweenCommits": 150.72,
      "commitsBetweenForRepo": 928,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,14 +1,14 @@\n   void refreshNamenodes(Configuration conf)\n       throws IOException {\n     LOG.info(\"Refresh request received for nameservices: \" + conf.get\n             (DFSConfigKeys.DFS_NAMESERVICES));\n \n     Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d DFSUtil\n-            .getNNServiceRpcAddressesForCluster(conf);\n+            .getNNServiceRpcAddresses(conf);\n     Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newLifelineAddressMap \u003d DFSUtil\n             .getNNLifelineRpcAddressesForCluster(conf);\n \n     synchronized (refreshNamenodesLock) {\n       doRefreshNamenodes(newAddressMap, newLifelineAddressMap);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void refreshNamenodes(Configuration conf)\n      throws IOException {\n    LOG.info(\"Refresh request received for nameservices: \" + conf.get\n            (DFSConfigKeys.DFS_NAMESERVICES));\n\n    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d DFSUtil\n            .getNNServiceRpcAddresses(conf);\n    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newLifelineAddressMap \u003d DFSUtil\n            .getNNLifelineRpcAddressesForCluster(conf);\n\n    synchronized (refreshNamenodesLock) {\n      doRefreshNamenodes(newAddressMap, newLifelineAddressMap);\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolManager.java",
      "extendedDetails": {}
    },
    "2759689d7d23001f007cb0dbe2521de90734dd5c": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-9239. DataNode Lifeline Protocol: an alternative protocol for reporting DataNode liveness. Contributed by Chris Nauroth.\n",
      "commitDate": "04/03/16 3:29 PM",
      "commitName": "2759689d7d23001f007cb0dbe2521de90734dd5c",
      "commitAuthor": "Chris Nauroth",
      "commitDateOld": "22/11/15 3:54 PM",
      "commitNameOld": "176ff5ce90f2cbcd8342016d0f5570337d2ff79f",
      "commitAuthorOld": "Haohui Mai",
      "daysBetweenCommits": 102.98,
      "commitsBetweenForRepo": 682,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,12 +1,14 @@\n   void refreshNamenodes(Configuration conf)\n       throws IOException {\n     LOG.info(\"Refresh request received for nameservices: \" + conf.get\n             (DFSConfigKeys.DFS_NAMESERVICES));\n \n     Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d DFSUtil\n             .getNNServiceRpcAddressesForCluster(conf);\n+    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newLifelineAddressMap \u003d DFSUtil\n+            .getNNLifelineRpcAddressesForCluster(conf);\n \n     synchronized (refreshNamenodesLock) {\n-      doRefreshNamenodes(newAddressMap);\n+      doRefreshNamenodes(newAddressMap, newLifelineAddressMap);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void refreshNamenodes(Configuration conf)\n      throws IOException {\n    LOG.info(\"Refresh request received for nameservices: \" + conf.get\n            (DFSConfigKeys.DFS_NAMESERVICES));\n\n    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d DFSUtil\n            .getNNServiceRpcAddressesForCluster(conf);\n    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newLifelineAddressMap \u003d DFSUtil\n            .getNNLifelineRpcAddressesForCluster(conf);\n\n    synchronized (refreshNamenodesLock) {\n      doRefreshNamenodes(newAddressMap, newLifelineAddressMap);\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolManager.java",
      "extendedDetails": {}
    },
    "c6107f566ff01e9bfee9052f86f6e5b21d5e89f3": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-6376. Distcp data between two HA clusters requires another configuration. Contributed by Dave Marion and Haohui Mai.\n",
      "commitDate": "05/09/14 10:40 AM",
      "commitName": "c6107f566ff01e9bfee9052f86f6e5b21d5e89f3",
      "commitAuthor": "Jing Zhao",
      "commitDateOld": "29/04/14 3:27 AM",
      "commitNameOld": "9d21180c1a625295bb9da0d9d5d8c55740944008",
      "commitAuthorOld": "Vinayakumar B",
      "daysBetweenCommits": 129.3,
      "commitsBetweenForRepo": 917,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,12 +1,12 @@\n   void refreshNamenodes(Configuration conf)\n       throws IOException {\n-    LOG.info(\"Refresh request received for nameservices: \"\n-        + conf.get(DFSConfigKeys.DFS_NAMESERVICES));\n-    \n-    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d \n-      DFSUtil.getNNServiceRpcAddresses(conf);\n-    \n+    LOG.info(\"Refresh request received for nameservices: \" + conf.get\n+            (DFSConfigKeys.DFS_NAMESERVICES));\n+\n+    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d DFSUtil\n+            .getNNServiceRpcAddressesForCluster(conf);\n+\n     synchronized (refreshNamenodesLock) {\n       doRefreshNamenodes(newAddressMap);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void refreshNamenodes(Configuration conf)\n      throws IOException {\n    LOG.info(\"Refresh request received for nameservices: \" + conf.get\n            (DFSConfigKeys.DFS_NAMESERVICES));\n\n    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d DFSUtil\n            .getNNServiceRpcAddressesForCluster(conf);\n\n    synchronized (refreshNamenodesLock) {\n      doRefreshNamenodes(newAddressMap);\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolManager.java",
      "extendedDetails": {}
    },
    "260dfa367e3c161edcc9d2b2217661710199c95e": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-2885. Remove \"federation\" from the nameservice config options. Contributed by Tsz Wo (Nicholas), SZE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1340841 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "20/05/12 2:13 PM",
      "commitName": "260dfa367e3c161edcc9d2b2217661710199c95e",
      "commitAuthor": "Eli Collins",
      "commitDateOld": "28/02/12 5:09 PM",
      "commitNameOld": "978a8050e28b2afb193a3e00d82a8475fa4d2428",
      "commitAuthorOld": "Aaron Myers",
      "daysBetweenCommits": 81.84,
      "commitsBetweenForRepo": 573,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,12 +1,12 @@\n   void refreshNamenodes(Configuration conf)\n       throws IOException {\n     LOG.info(\"Refresh request received for nameservices: \"\n-        + conf.get(DFSConfigKeys.DFS_FEDERATION_NAMESERVICES));\n+        + conf.get(DFSConfigKeys.DFS_NAMESERVICES));\n     \n     Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d \n       DFSUtil.getNNServiceRpcAddresses(conf);\n     \n     synchronized (refreshNamenodesLock) {\n       doRefreshNamenodes(newAddressMap);\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  void refreshNamenodes(Configuration conf)\n      throws IOException {\n    LOG.info(\"Refresh request received for nameservices: \"\n        + conf.get(DFSConfigKeys.DFS_NAMESERVICES));\n    \n    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d \n      DFSUtil.getNNServiceRpcAddresses(conf);\n    \n    synchronized (refreshNamenodesLock) {\n      doRefreshNamenodes(newAddressMap);\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolManager.java",
      "extendedDetails": {}
    },
    "f4fa76719e622a4ef883c51ec0abc6e6e6ddf09e": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-2612. Handle refreshNameNodes in federated HA clusters. Contributed by Todd Lipcon.\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/HDFS-1623@1209249 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": "01/12/11 1:26 PM",
      "commitName": "f4fa76719e622a4ef883c51ec0abc6e6e6ddf09e",
      "commitAuthor": "Todd Lipcon",
      "diff": "@@ -0,0 +1,12 @@\n+  void refreshNamenodes(Configuration conf)\n+      throws IOException {\n+    LOG.info(\"Refresh request received for nameservices: \"\n+        + conf.get(DFSConfigKeys.DFS_FEDERATION_NAMESERVICES));\n+    \n+    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d \n+      DFSUtil.getNNServiceRpcAddresses(conf);\n+    \n+    synchronized (refreshNamenodesLock) {\n+      doRefreshNamenodes(newAddressMap);\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  void refreshNamenodes(Configuration conf)\n      throws IOException {\n    LOG.info(\"Refresh request received for nameservices: \"\n        + conf.get(DFSConfigKeys.DFS_FEDERATION_NAMESERVICES));\n    \n    Map\u003cString, Map\u003cString, InetSocketAddress\u003e\u003e newAddressMap \u003d \n      DFSUtil.getNNServiceRpcAddresses(conf);\n    \n    synchronized (refreshNamenodesLock) {\n      doRefreshNamenodes(newAddressMap);\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockPoolManager.java"
    }
  }
}