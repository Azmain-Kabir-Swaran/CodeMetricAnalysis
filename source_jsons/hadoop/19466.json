{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "JobConf.java",
  "functionName": "getTaskJavaOpts",
  "functionId": "getTaskJavaOpts___taskType-TaskType",
  "sourceFilePath": "hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapred/JobConf.java",
  "functionStartLine": 2141,
  "functionEndLine": 2165,
  "numCommitsSeen": 34,
  "timeTaken": 1323,
  "changeHistory": [
    "a003f71cacd35834a1abbc2ffb5446a1166caf73"
  ],
  "changeHistoryShort": {
    "a003f71cacd35834a1abbc2ffb5446a1166caf73": "Yintroduced"
  },
  "changeHistoryDetails": {
    "a003f71cacd35834a1abbc2ffb5446a1166caf73": {
      "type": "Yintroduced",
      "commitMessage": "MAPREDUCE-5785. Derive heap size or mapreduce.*.memory.mb automatically. (Gera Shegalov and Karthik Kambatla via gera)\n",
      "commitDate": "21/01/15 6:42 PM",
      "commitName": "a003f71cacd35834a1abbc2ffb5446a1166caf73",
      "commitAuthor": "Gera Shegalov",
      "diff": "@@ -0,0 +1,25 @@\n+  public String getTaskJavaOpts(TaskType taskType) {\n+    String javaOpts \u003d getConfiguredTaskJavaOpts(taskType);\n+\n+    if (!javaOpts.contains(\"-Xmx\")) {\n+      float heapRatio \u003d getFloat(MRJobConfig.HEAP_MEMORY_MB_RATIO,\n+          MRJobConfig.DEFAULT_HEAP_MEMORY_MB_RATIO);\n+\n+      if (heapRatio \u003e 1.0f || heapRatio \u003c 0) {\n+        LOG.warn(\"Invalid value for \" + MRJobConfig.HEAP_MEMORY_MB_RATIO\n+            + \", using the default.\");\n+        heapRatio \u003d MRJobConfig.DEFAULT_HEAP_MEMORY_MB_RATIO;\n+      }\n+\n+      int taskContainerMb \u003d getMemoryRequired(taskType);\n+      int taskHeapSize \u003d (int)Math.ceil(taskContainerMb * heapRatio);\n+\n+      String xmxArg \u003d String.format(\"-Xmx%dm\", taskHeapSize);\n+      LOG.info(\"Task java-opts do not specify heap size. Setting task attempt\" +\n+          \" jvm max heap size to \" + xmxArg);\n+\n+      javaOpts +\u003d \" \" + xmxArg;\n+    }\n+\n+    return javaOpts;\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public String getTaskJavaOpts(TaskType taskType) {\n    String javaOpts \u003d getConfiguredTaskJavaOpts(taskType);\n\n    if (!javaOpts.contains(\"-Xmx\")) {\n      float heapRatio \u003d getFloat(MRJobConfig.HEAP_MEMORY_MB_RATIO,\n          MRJobConfig.DEFAULT_HEAP_MEMORY_MB_RATIO);\n\n      if (heapRatio \u003e 1.0f || heapRatio \u003c 0) {\n        LOG.warn(\"Invalid value for \" + MRJobConfig.HEAP_MEMORY_MB_RATIO\n            + \", using the default.\");\n        heapRatio \u003d MRJobConfig.DEFAULT_HEAP_MEMORY_MB_RATIO;\n      }\n\n      int taskContainerMb \u003d getMemoryRequired(taskType);\n      int taskHeapSize \u003d (int)Math.ceil(taskContainerMb * heapRatio);\n\n      String xmxArg \u003d String.format(\"-Xmx%dm\", taskHeapSize);\n      LOG.info(\"Task java-opts do not specify heap size. Setting task attempt\" +\n          \" jvm max heap size to \" + xmxArg);\n\n      javaOpts +\u003d \" \" + xmxArg;\n    }\n\n    return javaOpts;\n  }",
      "path": "hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapred/JobConf.java"
    }
  }
}