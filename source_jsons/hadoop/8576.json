{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "EditsDoubleBuffer.java",
  "functionName": "dumpRemainingEditLogs",
  "functionId": "dumpRemainingEditLogs",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditsDoubleBuffer.java",
  "functionStartLine": 170,
  "functionEndLine": 194,
  "numCommitsSeen": 10,
  "timeTaken": 1141,
  "changeHistory": [
    "1cde954a4fe7760a09b680413ad763cbe4a8feb3"
  ],
  "changeHistoryShort": {
    "1cde954a4fe7760a09b680413ad763cbe4a8feb3": "Yintroduced"
  },
  "changeHistoryDetails": {
    "1cde954a4fe7760a09b680413ad763cbe4a8feb3": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-11306. Print remaining edit logs from buffer if edit log can\u0027t be rolled. Contributed by Wei-Chiu Chuang.\n",
      "commitDate": "13/01/17 11:46 AM",
      "commitName": "1cde954a4fe7760a09b680413ad763cbe4a8feb3",
      "commitAuthor": "Wei-Chiu Chuang",
      "diff": "@@ -0,0 +1,25 @@\n+    private void dumpRemainingEditLogs() {\n+      byte[] buf \u003d this.getData();\n+      byte[] remainingRawEdits \u003d Arrays.copyOfRange(buf, 0, this.size());\n+      ByteArrayInputStream bis \u003d new ByteArrayInputStream(remainingRawEdits);\n+      DataInputStream dis \u003d new DataInputStream(bis);\n+      FSEditLogLoader.PositionTrackingInputStream tracker \u003d\n+          new FSEditLogLoader.PositionTrackingInputStream(bis);\n+      FSEditLogOp.Reader reader \u003d FSEditLogOp.Reader.create(dis, tracker,\n+          NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);\n+      FSEditLogOp op;\n+      LOG.warn(\"The edits buffer is \" + size() + \" bytes long with \" + numTxns +\n+          \" unflushed transactions. \" +\n+          \"Below is the list of unflushed transactions:\");\n+      int numTransactions \u003d 0;\n+      try {\n+        while ((op \u003d reader.readOp(false)) !\u003d null) {\n+          LOG.warn(\"Unflushed op [\" + numTransactions + \"]: \" + op);\n+          numTransactions++;\n+        }\n+      } catch (IOException ioe) {\n+        // If any exceptions, print raw bytes and stop.\n+        LOG.warn(\"Unable to dump remaining ops. Remaining raw bytes: \" +\n+            Hex.encodeHexString(remainingRawEdits), ioe);\n+      }\n+    }\n\\ No newline at end of file\n",
      "actualSource": "    private void dumpRemainingEditLogs() {\n      byte[] buf \u003d this.getData();\n      byte[] remainingRawEdits \u003d Arrays.copyOfRange(buf, 0, this.size());\n      ByteArrayInputStream bis \u003d new ByteArrayInputStream(remainingRawEdits);\n      DataInputStream dis \u003d new DataInputStream(bis);\n      FSEditLogLoader.PositionTrackingInputStream tracker \u003d\n          new FSEditLogLoader.PositionTrackingInputStream(bis);\n      FSEditLogOp.Reader reader \u003d FSEditLogOp.Reader.create(dis, tracker,\n          NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);\n      FSEditLogOp op;\n      LOG.warn(\"The edits buffer is \" + size() + \" bytes long with \" + numTxns +\n          \" unflushed transactions. \" +\n          \"Below is the list of unflushed transactions:\");\n      int numTransactions \u003d 0;\n      try {\n        while ((op \u003d reader.readOp(false)) !\u003d null) {\n          LOG.warn(\"Unflushed op [\" + numTransactions + \"]: \" + op);\n          numTransactions++;\n        }\n      } catch (IOException ioe) {\n        // If any exceptions, print raw bytes and stop.\n        LOG.warn(\"Unable to dump remaining ops. Remaining raw bytes: \" +\n            Hex.encodeHexString(remainingRawEdits), ioe);\n      }\n    }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EditsDoubleBuffer.java"
    }
  }
}