{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "DiskBalancer.java",
  "functionName": "shutdown",
  "functionId": "shutdown",
  "sourceFilePath": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DiskBalancer.java",
  "functionStartLine": 131,
  "functionEndLine": 150,
  "numCommitsSeen": 32,
  "timeTaken": 2134,
  "changeHistory": [
    "baab48922a301d639ea84ecf00d8a7616acd950d",
    "6c606bf5c8c1ace381ce73679c2be96d5475ba34",
    "e646c2eb50b9ae2b0b084d78a4ea68e106804321",
    "2b1b2faf76a7ff148650a7836935a85439f60c49"
  ],
  "changeHistoryShort": {
    "baab48922a301d639ea84ecf00d8a7616acd950d": "Ybodychange",
    "6c606bf5c8c1ace381ce73679c2be96d5475ba34": "Ybodychange",
    "e646c2eb50b9ae2b0b084d78a4ea68e106804321": "Ybodychange",
    "2b1b2faf76a7ff148650a7836935a85439f60c49": "Yintroduced"
  },
  "changeHistoryDetails": {
    "baab48922a301d639ea84ecf00d8a7616acd950d": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-9849. DiskBalancer: reduce lock path in shutdown code. Contributed by Yuanbo Liu.\n",
      "commitDate": "08/09/16 8:00 PM",
      "commitName": "baab48922a301d639ea84ecf00d8a7616acd950d",
      "commitAuthor": "Anu Engineer",
      "commitDateOld": "16/08/16 10:20 AM",
      "commitNameOld": "b047bc7270f3461156e4d08423c728ee9c67dba5",
      "commitAuthorOld": "Anu Engineer",
      "daysBetweenCommits": 23.4,
      "commitsBetweenForRepo": 145,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,14 +1,20 @@\n   public void shutdown() {\n     lock.lock();\n+    boolean needShutdown \u003d false;\n     try {\n       this.isDiskBalancerEnabled \u003d false;\n       this.currentResult \u003d Result.NO_PLAN;\n       if ((this.future !\u003d null) \u0026\u0026 (!this.future.isDone())) {\n         this.currentResult \u003d Result.PLAN_CANCELLED;\n         this.blockMover.setExitFlag();\n-        shutdownExecutor();\n+        scheduler.shutdown();\n+        needShutdown \u003d true;\n       }\n     } finally {\n       lock.unlock();\n     }\n+    // no need to hold lock while shutting down executor.\n+    if (needShutdown) {\n+      shutdownExecutor();\n+    }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void shutdown() {\n    lock.lock();\n    boolean needShutdown \u003d false;\n    try {\n      this.isDiskBalancerEnabled \u003d false;\n      this.currentResult \u003d Result.NO_PLAN;\n      if ((this.future !\u003d null) \u0026\u0026 (!this.future.isDone())) {\n        this.currentResult \u003d Result.PLAN_CANCELLED;\n        this.blockMover.setExitFlag();\n        scheduler.shutdown();\n        needShutdown \u003d true;\n      }\n    } finally {\n      lock.unlock();\n    }\n    // no need to hold lock while shutting down executor.\n    if (needShutdown) {\n      shutdownExecutor();\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DiskBalancer.java",
      "extendedDetails": {}
    },
    "6c606bf5c8c1ace381ce73679c2be96d5475ba34": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-9709. DiskBalancer : Add tests for disk balancer using a Mock Mover class. Contributed by Anu Engineer.\n",
      "commitDate": "23/06/16 6:18 PM",
      "commitName": "6c606bf5c8c1ace381ce73679c2be96d5475ba34",
      "commitAuthor": "Anu Engineer",
      "commitDateOld": "23/06/16 6:18 PM",
      "commitNameOld": "75a711a2d53966361f5d5fa727b43c9fddb01504",
      "commitAuthorOld": "Arpit Agarwal",
      "daysBetweenCommits": 0.0,
      "commitsBetweenForRepo": 3,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,13 +1,14 @@\n   public void shutdown() {\n     lock.lock();\n     try {\n       this.isDiskBalancerEnabled \u003d false;\n       this.currentResult \u003d Result.NO_PLAN;\n       if ((this.future !\u003d null) \u0026\u0026 (!this.future.isDone())) {\n+        this.currentResult \u003d Result.PLAN_CANCELLED;\n         this.blockMover.setExitFlag();\n         shutdownExecutor();\n       }\n     } finally {\n       lock.unlock();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void shutdown() {\n    lock.lock();\n    try {\n      this.isDiskBalancerEnabled \u003d false;\n      this.currentResult \u003d Result.NO_PLAN;\n      if ((this.future !\u003d null) \u0026\u0026 (!this.future.isDone())) {\n        this.currentResult \u003d Result.PLAN_CANCELLED;\n        this.blockMover.setExitFlag();\n        shutdownExecutor();\n      }\n    } finally {\n      lock.unlock();\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DiskBalancer.java",
      "extendedDetails": {}
    },
    "e646c2eb50b9ae2b0b084d78a4ea68e106804321": {
      "type": "Ybodychange",
      "commitMessage": "HDFS-9681. DiskBalancer: Add QueryPlan implementation. (Contributed by Anu Engineer)\n",
      "commitDate": "23/06/16 6:18 PM",
      "commitName": "e646c2eb50b9ae2b0b084d78a4ea68e106804321",
      "commitAuthor": "Arpit Agarwal",
      "commitDateOld": "23/06/16 6:18 PM",
      "commitNameOld": "2b1b2faf76a7ff148650a7836935a85439f60c49",
      "commitAuthorOld": "Arpit Agarwal",
      "daysBetweenCommits": 0.0,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,12 +1,13 @@\n   public void shutdown() {\n     lock.lock();\n     try {\n       this.isDiskBalancerEnabled \u003d false;\n+      this.currentResult \u003d Result.NO_PLAN;\n       if ((this.future !\u003d null) \u0026\u0026 (!this.future.isDone())) {\n         this.blockMover.setExitFlag();\n         shutdownExecutor();\n       }\n     } finally {\n       lock.unlock();\n     }\n   }\n\\ No newline at end of file\n",
      "actualSource": "  public void shutdown() {\n    lock.lock();\n    try {\n      this.isDiskBalancerEnabled \u003d false;\n      this.currentResult \u003d Result.NO_PLAN;\n      if ((this.future !\u003d null) \u0026\u0026 (!this.future.isDone())) {\n        this.blockMover.setExitFlag();\n        shutdownExecutor();\n      }\n    } finally {\n      lock.unlock();\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DiskBalancer.java",
      "extendedDetails": {}
    },
    "2b1b2faf76a7ff148650a7836935a85439f60c49": {
      "type": "Yintroduced",
      "commitMessage": "HDFS-9671. DiskBalancer: SubmitPlan implementation. (Contributed by Anu Engineer)\n",
      "commitDate": "23/06/16 6:18 PM",
      "commitName": "2b1b2faf76a7ff148650a7836935a85439f60c49",
      "commitAuthor": "Arpit Agarwal",
      "diff": "@@ -0,0 +1,12 @@\n+  public void shutdown() {\n+    lock.lock();\n+    try {\n+      this.isDiskBalancerEnabled \u003d false;\n+      if ((this.future !\u003d null) \u0026\u0026 (!this.future.isDone())) {\n+        this.blockMover.setExitFlag();\n+        shutdownExecutor();\n+      }\n+    } finally {\n+      lock.unlock();\n+    }\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  public void shutdown() {\n    lock.lock();\n    try {\n      this.isDiskBalancerEnabled \u003d false;\n      if ((this.future !\u003d null) \u0026\u0026 (!this.future.isDone())) {\n        this.blockMover.setExitFlag();\n        shutdownExecutor();\n      }\n    } finally {\n      lock.unlock();\n    }\n  }",
      "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DiskBalancer.java"
    }
  }
}