{
  "origin": "codeshovel",
  "repositoryName": "hadoop",
  "repositoryPath": "/home/shaiful/research/codeshovel/codeshovel-projects/hadoop/.git",
  "startCommitName": "HEAD",
  "sourceFileName": "TimelineV2ClientImpl.java",
  "functionName": "serviceInit",
  "functionId": "serviceInit___conf-Configuration",
  "sourceFilePath": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/client/api/impl/TimelineV2ClientImpl.java",
  "functionStartLine": 101,
  "functionEndLine": 134,
  "numCommitsSeen": 11,
  "timeTaken": 2225,
  "changeHistory": [
    "f8b8bd53c4797d406bea5b1b0cdb179e209169cc",
    "d09058b2fd18803d12f0835fdf78aef5e0b99c90",
    "ac7f52df83d2b4758e7debe9416be7db0ec69d2b",
    "4fa1afdb883dab8786d2fb5c72a195dd2e87d711"
  ],
  "changeHistoryShort": {
    "f8b8bd53c4797d406bea5b1b0cdb179e209169cc": "Ybodychange",
    "d09058b2fd18803d12f0835fdf78aef5e0b99c90": "Ybodychange",
    "ac7f52df83d2b4758e7debe9416be7db0ec69d2b": "Ybodychange",
    "4fa1afdb883dab8786d2fb5c72a195dd2e87d711": "Yintroduced"
  },
  "changeHistoryDetails": {
    "f8b8bd53c4797d406bea5b1b0cdb179e209169cc": {
      "type": "Ybodychange",
      "commitMessage": "YARN-6936. [Atsv2] Retrospect storing entities into sub application table from client perspective. (Rohith Sharma K S via Haibo Chen)\n",
      "commitDate": "05/04/18 10:23 AM",
      "commitName": "f8b8bd53c4797d406bea5b1b0cdb179e209169cc",
      "commitAuthor": "Haibo Chen",
      "commitDateOld": "15/01/18 6:28 PM",
      "commitNameOld": "d09058b2fd18803d12f0835fdf78aef5e0b99c90",
      "commitAuthorOld": "Rohith Sharma K S",
      "daysBetweenCommits": 79.62,
      "commitsBetweenForRepo": 651,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,33 +1,34 @@\n   protected void serviceInit(Configuration conf) throws Exception {\n     if (!YarnConfiguration.timelineServiceV2Enabled(conf)) {\n       throw new IOException(\"Timeline V2 client is not properly configured. \"\n           + \"Either timeline service is not enabled or version is not set to\"\n           + \" 2\");\n     }\n     UserGroupInformation ugi \u003d UserGroupInformation.getCurrentUser();\n     UserGroupInformation realUgi \u003d ugi.getRealUser();\n     String doAsUser \u003d null;\n     if (realUgi !\u003d null) {\n       authUgi \u003d realUgi;\n       doAsUser \u003d ugi.getShortUserName();\n     } else {\n       authUgi \u003d ugi;\n       doAsUser \u003d null;\n     }\n     // TODO need to add/cleanup filter retry later for ATSV2. similar to V1\n     DelegationTokenAuthenticatedURL.Token token \u003d\n         new DelegationTokenAuthenticatedURL.Token();\n     connector \u003d new TimelineConnector(false, authUgi, doAsUser, token);\n     addIfService(connector);\n \n     // new version need to auto discovery (with retry till ATS v2 address is\n     // got).\n     maxServiceRetries \u003d\n         conf.getInt(YarnConfiguration.TIMELINE_SERVICE_CLIENT_MAX_RETRIES,\n             YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_MAX_RETRIES);\n     serviceRetryInterval \u003d conf.getLong(\n         YarnConfiguration.TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS,\n         YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS);\n     entityDispatcher \u003d new TimelineEntityDispatcher(conf);\n+    subAppEntityDispatcher \u003d new TimelineEntityDispatcher(conf);\n     super.serviceInit(conf);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceInit(Configuration conf) throws Exception {\n    if (!YarnConfiguration.timelineServiceV2Enabled(conf)) {\n      throw new IOException(\"Timeline V2 client is not properly configured. \"\n          + \"Either timeline service is not enabled or version is not set to\"\n          + \" 2\");\n    }\n    UserGroupInformation ugi \u003d UserGroupInformation.getCurrentUser();\n    UserGroupInformation realUgi \u003d ugi.getRealUser();\n    String doAsUser \u003d null;\n    if (realUgi !\u003d null) {\n      authUgi \u003d realUgi;\n      doAsUser \u003d ugi.getShortUserName();\n    } else {\n      authUgi \u003d ugi;\n      doAsUser \u003d null;\n    }\n    // TODO need to add/cleanup filter retry later for ATSV2. similar to V1\n    DelegationTokenAuthenticatedURL.Token token \u003d\n        new DelegationTokenAuthenticatedURL.Token();\n    connector \u003d new TimelineConnector(false, authUgi, doAsUser, token);\n    addIfService(connector);\n\n    // new version need to auto discovery (with retry till ATS v2 address is\n    // got).\n    maxServiceRetries \u003d\n        conf.getInt(YarnConfiguration.TIMELINE_SERVICE_CLIENT_MAX_RETRIES,\n            YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_MAX_RETRIES);\n    serviceRetryInterval \u003d conf.getLong(\n        YarnConfiguration.TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS,\n        YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS);\n    entityDispatcher \u003d new TimelineEntityDispatcher(conf);\n    subAppEntityDispatcher \u003d new TimelineEntityDispatcher(conf);\n    super.serviceInit(conf);\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/client/api/impl/TimelineV2ClientImpl.java",
      "extendedDetails": {}
    },
    "d09058b2fd18803d12f0835fdf78aef5e0b99c90": {
      "type": "Ybodychange",
      "commitMessage": "YARN-6736. Consider writing to both ats v1 \u0026 v2 from RM for smoother upgrades. Contributed by Aaron Gresch.\n",
      "commitDate": "15/01/18 6:28 PM",
      "commitName": "d09058b2fd18803d12f0835fdf78aef5e0b99c90",
      "commitAuthor": "Rohith Sharma K S",
      "commitDateOld": "29/08/17 10:59 PM",
      "commitNameOld": "16ba4f544f13d614c1ebd6101ee14f7714e0fc54",
      "commitAuthorOld": "Varun Saxena",
      "daysBetweenCommits": 138.85,
      "commitsBetweenForRepo": 1023,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,34 +1,33 @@\n   protected void serviceInit(Configuration conf) throws Exception {\n-    if (!YarnConfiguration.timelineServiceEnabled(conf)\n-        || (int) YarnConfiguration.getTimelineServiceVersion(conf) !\u003d 2) {\n+    if (!YarnConfiguration.timelineServiceV2Enabled(conf)) {\n       throw new IOException(\"Timeline V2 client is not properly configured. \"\n           + \"Either timeline service is not enabled or version is not set to\"\n           + \" 2\");\n     }\n     UserGroupInformation ugi \u003d UserGroupInformation.getCurrentUser();\n     UserGroupInformation realUgi \u003d ugi.getRealUser();\n     String doAsUser \u003d null;\n     if (realUgi !\u003d null) {\n       authUgi \u003d realUgi;\n       doAsUser \u003d ugi.getShortUserName();\n     } else {\n       authUgi \u003d ugi;\n       doAsUser \u003d null;\n     }\n     // TODO need to add/cleanup filter retry later for ATSV2. similar to V1\n     DelegationTokenAuthenticatedURL.Token token \u003d\n         new DelegationTokenAuthenticatedURL.Token();\n     connector \u003d new TimelineConnector(false, authUgi, doAsUser, token);\n     addIfService(connector);\n \n     // new version need to auto discovery (with retry till ATS v2 address is\n     // got).\n     maxServiceRetries \u003d\n         conf.getInt(YarnConfiguration.TIMELINE_SERVICE_CLIENT_MAX_RETRIES,\n             YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_MAX_RETRIES);\n     serviceRetryInterval \u003d conf.getLong(\n         YarnConfiguration.TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS,\n         YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS);\n     entityDispatcher \u003d new TimelineEntityDispatcher(conf);\n     super.serviceInit(conf);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceInit(Configuration conf) throws Exception {\n    if (!YarnConfiguration.timelineServiceV2Enabled(conf)) {\n      throw new IOException(\"Timeline V2 client is not properly configured. \"\n          + \"Either timeline service is not enabled or version is not set to\"\n          + \" 2\");\n    }\n    UserGroupInformation ugi \u003d UserGroupInformation.getCurrentUser();\n    UserGroupInformation realUgi \u003d ugi.getRealUser();\n    String doAsUser \u003d null;\n    if (realUgi !\u003d null) {\n      authUgi \u003d realUgi;\n      doAsUser \u003d ugi.getShortUserName();\n    } else {\n      authUgi \u003d ugi;\n      doAsUser \u003d null;\n    }\n    // TODO need to add/cleanup filter retry later for ATSV2. similar to V1\n    DelegationTokenAuthenticatedURL.Token token \u003d\n        new DelegationTokenAuthenticatedURL.Token();\n    connector \u003d new TimelineConnector(false, authUgi, doAsUser, token);\n    addIfService(connector);\n\n    // new version need to auto discovery (with retry till ATS v2 address is\n    // got).\n    maxServiceRetries \u003d\n        conf.getInt(YarnConfiguration.TIMELINE_SERVICE_CLIENT_MAX_RETRIES,\n            YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_MAX_RETRIES);\n    serviceRetryInterval \u003d conf.getLong(\n        YarnConfiguration.TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS,\n        YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS);\n    entityDispatcher \u003d new TimelineEntityDispatcher(conf);\n    super.serviceInit(conf);\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/client/api/impl/TimelineV2ClientImpl.java",
      "extendedDetails": {}
    },
    "ac7f52df83d2b4758e7debe9416be7db0ec69d2b": {
      "type": "Ybodychange",
      "commitMessage": "YARN-5648. [ATSv2 Security] Client side changes for authentication. Contributed by Varun Saxena\n",
      "commitDate": "29/08/17 10:59 PM",
      "commitName": "ac7f52df83d2b4758e7debe9416be7db0ec69d2b",
      "commitAuthor": "Jian He",
      "commitDateOld": "30/03/17 1:32 PM",
      "commitNameOld": "7c2bc444b3d6750aafeed9b530c8e5b1bf95c1f4",
      "commitAuthorOld": "Varun Saxena",
      "daysBetweenCommits": 152.39,
      "commitsBetweenForRepo": 897,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,36 +1,35 @@\n   protected void serviceInit(Configuration conf) throws Exception {\n     if (!YarnConfiguration.timelineServiceEnabled(conf)\n         || (int) YarnConfiguration.getTimelineServiceVersion(conf) !\u003d 2) {\n       throw new IOException(\"Timeline V2 client is not properly configured. \"\n           + \"Either timeline service is not enabled or version is not set to\"\n           + \" 2\");\n     }\n     UserGroupInformation ugi \u003d UserGroupInformation.getCurrentUser();\n     UserGroupInformation realUgi \u003d ugi.getRealUser();\n     String doAsUser \u003d null;\n-    UserGroupInformation authUgi \u003d null;\n     if (realUgi !\u003d null) {\n       authUgi \u003d realUgi;\n       doAsUser \u003d ugi.getShortUserName();\n     } else {\n       authUgi \u003d ugi;\n       doAsUser \u003d null;\n     }\n \n     // TODO need to add/cleanup filter retry later for ATSV2. similar to V1\n     DelegationTokenAuthenticatedURL.Token token \u003d\n         new DelegationTokenAuthenticatedURL.Token();\n     connector \u003d new TimelineConnector(false, authUgi, doAsUser, token);\n     addIfService(connector);\n \n     // new version need to auto discovery (with retry till ATS v2 address is\n     // got).\n     maxServiceRetries \u003d\n         conf.getInt(YarnConfiguration.TIMELINE_SERVICE_CLIENT_MAX_RETRIES,\n             YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_MAX_RETRIES);\n     serviceRetryInterval \u003d conf.getLong(\n         YarnConfiguration.TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS,\n         YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS);\n     entityDispatcher \u003d new TimelineEntityDispatcher(conf);\n     super.serviceInit(conf);\n   }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceInit(Configuration conf) throws Exception {\n    if (!YarnConfiguration.timelineServiceEnabled(conf)\n        || (int) YarnConfiguration.getTimelineServiceVersion(conf) !\u003d 2) {\n      throw new IOException(\"Timeline V2 client is not properly configured. \"\n          + \"Either timeline service is not enabled or version is not set to\"\n          + \" 2\");\n    }\n    UserGroupInformation ugi \u003d UserGroupInformation.getCurrentUser();\n    UserGroupInformation realUgi \u003d ugi.getRealUser();\n    String doAsUser \u003d null;\n    if (realUgi !\u003d null) {\n      authUgi \u003d realUgi;\n      doAsUser \u003d ugi.getShortUserName();\n    } else {\n      authUgi \u003d ugi;\n      doAsUser \u003d null;\n    }\n\n    // TODO need to add/cleanup filter retry later for ATSV2. similar to V1\n    DelegationTokenAuthenticatedURL.Token token \u003d\n        new DelegationTokenAuthenticatedURL.Token();\n    connector \u003d new TimelineConnector(false, authUgi, doAsUser, token);\n    addIfService(connector);\n\n    // new version need to auto discovery (with retry till ATS v2 address is\n    // got).\n    maxServiceRetries \u003d\n        conf.getInt(YarnConfiguration.TIMELINE_SERVICE_CLIENT_MAX_RETRIES,\n            YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_MAX_RETRIES);\n    serviceRetryInterval \u003d conf.getLong(\n        YarnConfiguration.TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS,\n        YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS);\n    entityDispatcher \u003d new TimelineEntityDispatcher(conf);\n    super.serviceInit(conf);\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/client/api/impl/TimelineV2ClientImpl.java",
      "extendedDetails": {}
    },
    "4fa1afdb883dab8786d2fb5c72a195dd2e87d711": {
      "type": "Yintroduced",
      "commitMessage": "YARN-4675. Reorganize TimelineClient and TimelineClientImpl into separate classes for ATSv1.x and ATSv2. Contributed by Naganarasimha G R.\n",
      "commitDate": "16/02/17 11:41 AM",
      "commitName": "4fa1afdb883dab8786d2fb5c72a195dd2e87d711",
      "commitAuthor": "Sangjin Lee",
      "diff": "@@ -0,0 +1,36 @@\n+  protected void serviceInit(Configuration conf) throws Exception {\n+    if (!YarnConfiguration.timelineServiceEnabled(conf)\n+        || (int) YarnConfiguration.getTimelineServiceVersion(conf) !\u003d 2) {\n+      throw new IOException(\"Timeline V2 client is not properly configured. \"\n+          + \"Either timeline service is not enabled or version is not set to\"\n+          + \" 2\");\n+    }\n+    UserGroupInformation ugi \u003d UserGroupInformation.getCurrentUser();\n+    UserGroupInformation realUgi \u003d ugi.getRealUser();\n+    String doAsUser \u003d null;\n+    UserGroupInformation authUgi \u003d null;\n+    if (realUgi !\u003d null) {\n+      authUgi \u003d realUgi;\n+      doAsUser \u003d ugi.getShortUserName();\n+    } else {\n+      authUgi \u003d ugi;\n+      doAsUser \u003d null;\n+    }\n+\n+    // TODO need to add/cleanup filter retry later for ATSV2. similar to V1\n+    DelegationTokenAuthenticatedURL.Token token \u003d\n+        new DelegationTokenAuthenticatedURL.Token();\n+    connector \u003d new TimelineConnector(false, authUgi, doAsUser, token);\n+    addIfService(connector);\n+\n+    // new version need to auto discovery (with retry till ATS v2 address is\n+    // got).\n+    maxServiceRetries \u003d\n+        conf.getInt(YarnConfiguration.TIMELINE_SERVICE_CLIENT_MAX_RETRIES,\n+            YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_MAX_RETRIES);\n+    serviceRetryInterval \u003d conf.getLong(\n+        YarnConfiguration.TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS,\n+        YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS);\n+    entityDispatcher \u003d new TimelineEntityDispatcher(conf);\n+    super.serviceInit(conf);\n+  }\n\\ No newline at end of file\n",
      "actualSource": "  protected void serviceInit(Configuration conf) throws Exception {\n    if (!YarnConfiguration.timelineServiceEnabled(conf)\n        || (int) YarnConfiguration.getTimelineServiceVersion(conf) !\u003d 2) {\n      throw new IOException(\"Timeline V2 client is not properly configured. \"\n          + \"Either timeline service is not enabled or version is not set to\"\n          + \" 2\");\n    }\n    UserGroupInformation ugi \u003d UserGroupInformation.getCurrentUser();\n    UserGroupInformation realUgi \u003d ugi.getRealUser();\n    String doAsUser \u003d null;\n    UserGroupInformation authUgi \u003d null;\n    if (realUgi !\u003d null) {\n      authUgi \u003d realUgi;\n      doAsUser \u003d ugi.getShortUserName();\n    } else {\n      authUgi \u003d ugi;\n      doAsUser \u003d null;\n    }\n\n    // TODO need to add/cleanup filter retry later for ATSV2. similar to V1\n    DelegationTokenAuthenticatedURL.Token token \u003d\n        new DelegationTokenAuthenticatedURL.Token();\n    connector \u003d new TimelineConnector(false, authUgi, doAsUser, token);\n    addIfService(connector);\n\n    // new version need to auto discovery (with retry till ATS v2 address is\n    // got).\n    maxServiceRetries \u003d\n        conf.getInt(YarnConfiguration.TIMELINE_SERVICE_CLIENT_MAX_RETRIES,\n            YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_MAX_RETRIES);\n    serviceRetryInterval \u003d conf.getLong(\n        YarnConfiguration.TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS,\n        YarnConfiguration.DEFAULT_TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS);\n    entityDispatcher \u003d new TimelineEntityDispatcher(conf);\n    super.serviceInit(conf);\n  }",
      "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/client/api/impl/TimelineV2ClientImpl.java"
    }
  }
}